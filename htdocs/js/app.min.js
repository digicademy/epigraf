(()=>{"use strict";class e{static hide(e){e&&(e.originalDisplay=window.getComputedStyle(e).getPropertyValue("display"),e.style.display="none")}static show(e,t){e&&("none"===e.style.display&&(e.style.display=e.originalDisplay||"block"),void 0!==t&&(e.textContent=t))}static toggle(e,t=!0){t?this.show(e):this.hide(e)}static scrollToTop(e,t){e&&e.scrollIntoView(!0)}static getTotalOffset(e,t){let s=0,r=0,n=e;for(;n&&n!==t.offsetParent;)s+=n.offsetTop,r+=n.offsetLeft,n=n.offsetParent;return{top:s,left:r}}static getStickyElementHeight(e,t){const s=e.querySelector(t);if(s&&e!==s){if("sticky"===window.getComputedStyle(s).position)return s.offsetHeight}return 0}static scrollIntoViewIfNeeded(t,s,r=!0,n=!0){const i="y"===r||!0===r,o="x"===r||!0===r,a="y"===n||!0===n,l="x"===n||!0===n;if(!t||!e.isElementVisible(t))return;s=s||t.parentNode;const c=t.getBoundingClientRect();let u=s.getBoundingClientRect();const p=s.offsetHeight-s.clientHeight,d=e.getStickyElementHeight(s,"thead, li");u=new DOMRect(u.x,u.y+d,u.width,u.height-p-d);const h=c.top<u.top,g=c.bottom>u.bottom;if(a){let e;if(h&&!g?e=c.top-u.top:g&&!h&&(e=c.bottom-u.bottom),void 0!==e){if(i){let r=s.offsetHeight/2-t.offsetHeight/2;r=h?-r:+r,e+=r}s.scrollTop=s.scrollTop+e}}const m=c.left<u.left,f=c.right>u.right;if(l){let e;if(m&&!f?e=c.left-u.left:f&&!m&&(e=c.right-u.right),void 0!==e){if(o){let r=s.offsetWidth/2-t.offsetWidth/2;r=m?-r:+r,e+=r}s.scrollLeft=s.scrollLeft+e}}}static getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var s=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null}static getValue(e,t,s=undefined){if(t&&Array.isArray(t)){for(let s of t){const t=this.getValue(e,s);if(void 0!==t)return t}return s}try{const r=t.split(".").reduce(((e,t)=>null==e||""===t?e:e.constructor===Array?e[parseInt(t)]:e[t]),e);return void 0===r?s:r}catch{return s}}static setValue(t,s,r,n=!1){return"string"==typeof s&&(s=s.replace(/\]/g,"").split(/[\[\.]/)),s.length>1?(t.hasOwnProperty(s[0])?"object"!=typeof t[s[0]]&&(t[s[0]]={}):t[s[0]]={},e.setValue(t[s[0]],s.slice(1),r,n)):n&&"object"==typeof t[s[0]]&&null!==t[s[0]]&&"object"==typeof r&&null!==r?t[s[0]]=Object.assign({},t[s[0]],r):t[s[0]]=r,t}static extractSnippetText(e,t){try{const s=(e=(new DOMParser).parseFromString(e,"text/html")).querySelector('[data-snippet="'+t+'"]');if(s)return s.textContent}catch{return""}return""}static wrapAll(e,t){return[...e.childNodes].forEach((e=>t.appendChild(e))),e.appendChild(t),t}static spawnFromString(e,t,s=!0){const r=document.createElement("template");return r.innerHTML=e.trim().formatUnicorn(t),s?r.content.firstElementChild:r.content}static spawnFromTemplate(t,s,r=!0){if(t)return e.spawnFromString(t.text,s,r)}static childMatches(e,t){return[].some.call(e.children,(e=>e.matches(t)))}static setInputValue(e,t){e&&e.value!==t&&(e.value=t,e.disabled=!1,e.dataset.dirty=!0)}static getInputValue(e,t){return e?e.value:t}static removeInputConstraints(e){e.querySelectorAll("input").forEach((e=>{e.removeAttribute("min"),e.removeAttribute("max")}))}static getDataValue(e,t,s){return e&&e.dataset[t]||s}static setElementContent(e,t){e&&(e.innerHTML=t)}static setElementText(e,t){e&&(e.textContent=t)}static getElementText(e,t){return e?e.textContent:t}static getRenderedText(e,t=""){if(!e)return t;let s="";return function e(t){switch(t.nodeType){case Node.TEXT_NODE:s+=t.nodeValue.trim();break;case Node.ELEMENT_NODE:if("BUTTON"===t.tagName||"INPUT"===t.tagName&&"hidden"===t.type)s+="";else if(t.classList.contains("widget-dropdown-pane"))s+="";else if("SELECT"===t.tagName){const e=t.options[t.selectedIndex];e&&(s+=e.text.trim())}else if("INPUT"===t.tagName)s+=t.value;else for(const s of t.childNodes)e(s)}}(e),s||t}static extractElements(e,t,s){let r=[];return e.querySelectorAll(t).forEach((e=>{r.push(...Array.from(e.querySelectorAll(s))),e.remove()})),r}static toggleClass(e,t,s){s.forEach((t=>t.classList.remove(e))),t&&t.classList.add(e)}static removeClassByPrefix(e,t){let s=[];e.classList.forEach((e=>{0!==e.indexOf(t)&&s.push(e)})),e.className=s.join(" ")}static getClassValue(e,t){if(e)for(let s of e.classList)if(0===s.indexOf(t))return s.substring(t.length)}static encodeHtmlAttribute(e){return"string"!=typeof e?e:e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}static decodeHtmlAttribute(e){return"string"!=typeof e?e:e.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&amp;/g,"&")}static numberToLetters(t,s=!0,r=65,n=26){r="string"==typeof r?r.charCodeAt(0):r;let i=t<=0?"":e.numberToLetters(Math.floor((t-1)/n),s,r,n)+String.fromCharCode((t-1)%n+r);return s?i.toLowerCase():i.toUpperCase()}static numberToRoman(e,t=!0){const s={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};let r="";for(;e>0;)for(const t in s)if(e>=s[t]){e-=s[t],r+=t;break}return t?r.toLowerCase():r}static abbrNum(e){return e.toUpperCase().split("").reduce(((e,t)=>26*e+t.charCodeAt(0)-96),0)}static numberToString(t,s){switch(s){case"alphabetic":case"alphabetic-lower":return e.numberToLetters(t,!0);case"alphabetic-upper":return e.numberToLetters(t,!1);case"roman":case"roman-lower":return e.numberToRoman(t,!0);case"roman-upper":return e.numberToRoman(t,!1);case"greek":case"greek-lower":return e.numberToLetters(t,!0,"Α",24);case"greek-upper":return e.numberToLetters(t,!1,"Α",24);default:return String(t)}}static mod(e,t){return(e%t+t)%t}static isTrue(e){return"string"==typeof e&&(e=e.toLowerCase()),1===e||"1"===e||!0===e||"true"===e}static isString(e){return"[object String]"===Object.prototype.toString.call(e)}static isElementVisible(e){return"none"!==window.getComputedStyle(e).getPropertyValue("display")}static isVisible(e,t){const{bottom:s,height:r,top:n}=e.getBoundingClientRect(),i=t.getBoundingClientRect();return n<=i.top?i.top-n<=r:s-i.bottom<=r}static nearestPositionedAncestor(e){let t=e.parentElement;for(;t;){const e=window.getComputedStyle(t).position;if("relative"===e||"absolute"===e||"fixed"===e||"sticky"===e)return t;t=t.parentElement}return null}static getPrevSibling(e,t){let s=e.previousElementSibling;for(;s;){if(s.matches(t))return s;s=s.previousElementSibling}}static getNextSibling(e,t){if(!e)return;let s=e.nextElementSibling;for(;s;){if(s.matches(t))return s;s=s.nextElementSibling}}static getNextVisibleSibling(t,s){if(!t)return;let r=t.nextElementSibling;for(;r&&(!e.isElementVisible(r)||s&&!r.matches(s));)r=r.nextElementSibling;return r&&e.isElementVisible(r)&&(!s||r.matches(s))?r:void 0}static getPrevVisibleSibling(t,s){if(!t)return;let r=t.previousElementSibling;for(;r&&(!e.isElementVisible(r)||s&&!r.matches(s));)r=r.previousElementSibling;return r&&e.isElementVisible(r)&&(!s||r.matches(s))?r:void 0}static bottomAboveViewport(e,t){const s=e.getBoundingClientRect(),r=t.getBoundingClientRect();return s.bottom<r.bottom}static topBelowViewport(e,t){const s=e.getBoundingClientRect(),r=t.getBoundingClientRect();return s.top>r.top}static querySelectorLast(e,t){return[...e.querySelectorAll(t)].at(-1)}static querySelectorAndSelf(t,s){if(!Array.isArray(t))return t.matches&&t.matches(s)?t:t.querySelector(s);for(let r=0;r<t.length;r++){const n=e.querySelectorAndSelf(t[r],s);if(n)return n}}static querySelectorSelfAndContainer(e,t){return[e,e===document?null:e.closest(t)].filter((e=>null!==e&&e!==document&&e.matches(t)))}static querySelectorAllAndSelf(e,t){return[e,...e.querySelectorAll(t)].filter((e=>!(e instanceof DocumentFragment)&&e!==document&&e.matches(t)))}static querySelectorAllAndSelfAndContainer(e,t){const s=e?e.querySelectorAll(t):[],r=e&&e!==document?e.closest(t):null;return[e,...s,r].filter((e=>null!==e&&e!==document&&e.matches(t)))}static querySelectorText(e,t,s=""){return(e=e.querySelector(t))?e.textContent:s}static querySelectorData(e,t,s,r=""){return(e=e.querySelector(t))?e.dataset[s]:r}static listenEvent(e,t,s,r){if(!e)return;const n=e=>{if(void 0===r||e.target.matches(r))return s(e)};return e.eventListeners||(e.eventListeners={}),e.eventListeners[t]||(e.eventListeners[t]={}),e.eventListeners[t][r]||(e.eventListeners[t][r]=[]),e.eventListeners[t][r].push({source:s,target:n}),e.addEventListener(t,n)}static unlistenEvent(e,t,s,r){if(e&&e.eventListeners&&e.eventListeners[t]&&e.eventListeners[t][r]){const n=e.eventListeners[t][r];let i=n.length;for(;i--;){const r=n[i];r.source===s&&(e.removeEventListener(t,r.target),n.splice(i,1))}}}static emitEvent(e,t,s,r,n=!1){if(!e)return;let i=new CustomEvent(t,{bubbles:!0,cancelable:n,detail:{data:s,sender:r}});return e.dispatchEvent(i)}static getSelectionPosition(e){if(window.getSelection){const e=window.getSelection();if(e.rangeCount>0){return e.getRangeAt(0).startOffset}}return 0}static setSelectionPosition(e,t){const s=document.createRange(),r=window.getSelection();s.setStart(e.childNodes[0],t),s.collapse(!0),r.removeAllRanges(),r.addRange(s)}static lon2tile(e,t){return Math.floor((e+180)/360*Math.pow(2,t))}static lat2tile(e,t){return Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t))}static tile2long(e,t){return e/Math.pow(2,t)*360-180}static tile2lat(e,t){const s=Math.PI-2*Math.PI*e/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)))}static collapseWhitespace(e){return e.replace(/ +/g," ")}static prefixNumbersWithZero(e,t=1){return e.replace(/\d+/g,(e=>e.padStart(t,"0")))}static replaceSpacesWithHyphens(e){return e.replace(/\s+/g,"-")}static removeSpecialCharacters(e){return e.replace(/[^ ~a-z0-9\-_]/g,"")}static replaceUmlauts(e){return e.replace(/ä/g,"ae").replace(/ö/g,"oe").replace(/ü/g,"ue").replace(/Ä/g,"Ae").replace(/Ö/g,"Oe").replace(/Ü/g,"Ue").replace(/ß/g,"sz")}static extractNumber(e){return(e=e.match(/\d+/))?e[0]:""}static parseFormData(t){const s={};for(const[r,n]of t.entries())e.setValue(s,r,n);return s}}const t=e;String.prototype.capitalize||(String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}),$.fn.reverse=[].reverse,String.prototype.formatUnicorn||(String.prototype.formatUnicorn=function(){var e=this.toString();if(arguments.length){var t,s=typeof arguments[0],r="string"===s||"number"===s?Array.prototype.slice.call(arguments):arguments[0];for(t in r)e=e.replace(new RegExp("\\{"+t+"\\}","gi"),r[t])}return e});class s{constructor(){this.pendingRequests=[],this.currentRequests=[],this.parallelRequests=3,this.requesting=0,this.debug=!1}add(e,t,s){this.debug&&console.log(`Add request to ${this.pendingRequests.length} pending requests while there are ${this.currentRequests.length} current requests.`),this.pendingRequests.push({name:e,request:t,delay:s}),this.next()}stop(e){this.debug&&console.log(`Stop ${this.pendingRequests.length} pending requests.`);for(let t=0;t<this.pendingRequests.length;t++)void 0!==e&&this.pendingRequests[t].name!==e||(this.pendingRequests.splice(t,1),t--);this.debug&&console.log(`Stop ${this.currentRequests.length} current requests.`);for(let t=0;t<this.currentRequests.length;t++)if(void 0===e||this.currentRequests[t].name===e){const e=this.currentRequests[t];this.currentRequests.splice(t,1),t--,e.timeout&&clearTimeout(e.timeout),e.request&&e.request.abort&&e.request.abort(),this.next()}}next(){const e=this;if(this.currentRequests.length>=this.parallelRequests)return;if(0===this.pendingRequests.length)return;this.debug&&console.log(`Get next of ${this.pendingRequests.length} pending requests`);const t=this.pendingRequests.splice(0,1)[0],s=t.request,r=s.complete;s.complete=function(){r&&r.apply(this,arguments);const s=e.currentRequests.indexOf(t);s>=0&&(e.debug&&console.log(`Complete and remove request ${s+1} from ${e.currentRequests.length} current requests.`),e.currentRequests.splice(s,1)),e.next()},t.delay?t.timeout=setTimeout((()=>{t.request=$.ajax(s)}),t.delay):t.request=$.ajax(s),this.currentRequests.push(t)}}class r{constructor(){this.user=null,this.role=null,this.scope=null,this.settings=new n("user"),this.session=new n("session"),this.activeTimeout=3e5,this.initEvents()}initEvents(){document.querySelector("body").classList.contains("userrole_guest")||setTimeout((e=>this.updateActive(e)),this.activeTimeout)}load(e){e&&e.settings&&(this.settings.settings=e.settings,delete e.settings),e&&e.session&&(this.session.settings=e.session,delete e.session),Object.assign(this,e),this.settings.readonly="guest"===(this.role||"guest"),this.session.readonly="guest"===(this.role||"guest")}storeTheme(){window.matchMedia&&(window.matchMedia("(prefers-color-scheme: dark)").matches?this.session.save("ui","theme","dark"):this.session.save("ui","theme","light"))}async updateActive(){let e="/users/login.json";const s=t.getParameterByName("token");s&&(e=e+"?token="+s);try{const t=await fetch(e);(await t.json()).success||App.user.showLogin()}catch(e){App.showMessage("Could not connect to Epigraf: "+e)}setTimeout((e=>this.updateActive(e)),this.activeTimeout)}showLogin(e={}){(e=Object.assign({title:"Login",modal:!0,name:"app.login",ajaxButtons:!0,height:400,width:400},e)).onLoad=function(s,r,n){const i=t.querySelectorAndSelf(t.spawnFromString(r,void 0,!1),'[data-row-table="users"][data-row-id]');i&&i.dataset.rowId&&(s.closeWindow(),e.onLogin&&e.onLogin())},App.openPopup("/users/login?redirect=/users/view/me",e)}}class n{constructor(e="user"){this.settings={},this.settingsQueue={},this.readonly=!0,this.storage=e,this.ajaxQueue=new s}get(e,t,s){let r;return this.settings&&e&&!t?r=this.settings[e]:this.settings&&e&&this.settings[e]&&t&&(r=this.settings[e][t]),void 0===r?s:r}save(e,s,r,n=!0){if(this.readonly)return;this.settings=t.setValue(this.settings,e+"."+s,r,n);const i="/users/settings/"+e+"/"+s+"?storage="+this.storage;this.settingsQueue[i]={...this.settingsQueue[i]||{},...r};const o={type:n?"PATCH":"PUT",url:i,data:this.settingsQueue[i],dataType:"json",success:()=>this.settingsQueue[i]={}};this.ajaxQueue.stop(i),this.ajaxQueue.add(i,o,1e3)}}window.App=new class{constructor(){this.settings={timeout:800,colwidth:150},this.data={},this.user=new r,this.ajaxQueue=new s,this.loaderCount=0,this.models={},this.widgets={},this.xhr=null,this.initEvents()}initEvents(){window.addEventListener("error",(e=>this.logError(e))),t.listenEvent(document,"click",(e=>this.hideMessage(e)),".message"),t.listenEvent(document,"click",(e=>this.openPopupLink(e)),"a.popup, a.popup *"),t.listenEvent(document,"click",(e=>this.openDetailLink(e)),"a.frame, a.frame *"),t.listenEvent(document,"app:show:message",(e=>this.showMessage(e))),t.listenEvent(document,"app:hide:message",(e=>this.hideMessage())),t.listenEvent(document,"app:show:loader",(e=>this.showLoader())),t.listenEvent(document,"app:hide:loader",(e=>this.hideLoader())),t.listenEvent(document,"app:open:dialog",(e=>this.showDialog(e))),t.listenEvent(document,"app:close:dialog",(e=>this.hideDialog(e)))}logError(e){if(!App.baseUrl||!App.user||!App.user.role||"guest"===App.user.role)return;const t=e.message||"Unknown error",s={name:e.error&&e.error.name||"Unknown error type",filename:e.filename||"Unknown file",line:e.lineno||0,column:e.colno||0,stack:e.error?e.error.stack:"No stack trace available",timestamp:(new Date).toISOString(),"Request URL":window.location.href,"Referer URL":document.referrer},r=new URL("/users/track/error/"+encodeURIComponent(t),App.baseUrl);fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then((e=>{e.ok?console.log("Sent error log to server"):console.error("Failed to log error to server",e.statusText)})).catch((e=>{console.error("Error while logging error to server:",e)}))}addWidget(e,t){return void 0!==e&&(this.widgets[e]=t),t}getWidget(e){if(void 0!==e)return this.widgets[e]||void 0}clearWidget(e){let t;return void 0!==e&&(t=this.getWidget(e),delete this.widgets[e]),t}focusContent(){let e=document.querySelectorAll(".content-wrapper input, .content-wrapper a, .content-wrapper select, .content-wrapper button");e.length>0&&e[0].focus()}showLoader(){this.loaderCount+=1,$("#loader").show()}hideLoader(){this.loaderCount-=1,this.loaderCount<=0&&(this.loaderCount=0,$("#loader").hide())}showMessage(e,s="error",r,n){if(e instanceof Event){s=e.detail.data.status||s;let t=e.detail.data.errors||{};e=e.detail.data.msg,t&&(e=e+"<br>"+Object.entries(t).flatMap((([e,t])=>t.map((t=>`${e}: ${t}`)))))}if(r)r.showMessage(e,s);else{const r=document.querySelector(".content-flash");if(r){let n=t.spawnFromString(`<div class="message ${s}">${e}</div>`);r.replaceChildren(n)}}const i=document.querySelector("#loader");i&&"error"===s&&i.classList.add("error")}hideMessage(e){if(!e||"A"!==e.target.tagName){const t=e?e.target.closest(".message"):document.querySelector(".message");t&&t.classList.add("hidden");const s=document.querySelector("#loader");s&&s.classList.remove("error")}}confirmAction(e){return new Promise(((t,s)=>{const r={message:e,onConfirm:e=>t(e)};App.confirmWindow.showData(r)}))}getContentPane(e,t=!0){if(!e)return document;const s=e.closest(".widget-content-pane");if(t){const e=s?s.widgets["content-pane"]:document;return e||document}return s&&!s.classList.contains("widget-content-pane-main")?s:document}emitEvent(e,t,s,r=!1){let n=new CustomEvent(t,{bubbles:!0,cancelable:r,detail:{data:s,sender:this}});return e.dispatchEvent(n)}fetch(e,t){App.ajaxQueue.add("api",{type:"GET",url:e,dataType:"json",beforeSend:function(e){App.showLoader()},success:function(e,s,r){e.status="success",t(e)},error:function(e,s,r){e.readyState===XMLHttpRequest.UNSENT&&0===e.status?t({status:"abort"}):(t({status:"error"}),App.showMessage(r,s))},complete:function(e,t){App.hideLoader()}})}fetchHtml(e,s){null!==this.xhr&&this.xhr.abort(),App.showLoader(),this.xhr=$.ajax({type:"GET",url:e,dataType:"html",success:(e,r,n)=>{s(e);const i=t.extractSnippetText(e,"message");i&&this.showMessage(i)},error:(e,s,r)=>{if(e.readyState===XMLHttpRequest.UNSENT&&0===e.status)return;let n=t.extractSnippetText(e.responseText,"error");n||(n=r),this.showMessage(n,"error")},complete:(e,t)=>{this.hideLoader()}})}loadDataSnippets(e,s,r=!1,n=!1){null!==this.xhr&&this.xhr.abort(),App.showLoader(),this.xhr=$.ajax({type:"GET",url:e,dataType:"html",success:(i,o,a)=>{r&&window.history.pushState&&window.history.pushState(e,"Epigraf",e);const l=this.getContentPane(s);this.replaceDataSnippets(i,s);const c=t.extractSnippetText(i,"message");c&&this.showMessage(c),n&&l&&l.updateNavigation&&l.updateNavigation(i),s&&this.emitEvent(s,"epi:load:content")},error:(e,s,r)=>{if(e.readyState===XMLHttpRequest.UNSENT&&0===e.status)return;let n=t.extractSnippetText(e.responseText,"error");n||(n=r),this.showMessage(n,"error")},complete:(e,t)=>{this.hideLoader()}})}replaceDataSnippets(e,s){const r=t.querySelectorAllAndSelf(t.spawnFromString(e,void 0,!1),"[data-snippet]");r&&(void 0!==s&&s!==document||(s=[document.querySelector(".widget-content-pane-main"),document.querySelector(".page-wrapper > footer")]),Array.isArray(s)||(s=[s]),r.forEach((e=>{const r='[data-snippet="'+e.dataset.snippet+'"]',n=t.querySelectorAndSelf(s,r);n&&("function"==typeof this.finishWidgets&&this.finishWidgets(n),n.replaceWith(e),"function"==typeof this.initWidgets&&this.initWidgets(e),this.emitEvent(n,"epi:replace:content",{newTarget:e}))})))}appendDataSnippets(e){$(e).find("[data-snippet]").addBack("[data-snippet]").each((function(e,t){$('[data-snippet="'+$(this).data("snippet")+'"]').after(this)}))}openPopupLink(e){if(e.detail>1)return;const t=e.target.closest("a");let s=t.href;if(s&&!e.ctrlKey){const r=t.dataset.popupSize;let n=t.dataset.popupModal;return n="true"===n||"1"===n,App.openPopup(s,{external:!0,modal:n,focus:n,size:r}),e.preventDefault(),!1}}openDetailLink(e){if(e.detail>1||e.ctrlKey)return;if(e.ctrlKey)return;const t=e.target.closest(".ui-dialog, .sidebar"),s=e.target.closest("a");if(t&&s.dataset.linkwrapper)return e.preventDefault(),!1;if(t)return App.openPopupLink(e),e.preventDefault(),!1;let r=s.href;if(s.dataset.linkwrapper){const e=App.findWidget(s,"table");if(e){const t=s.closest(".node");r=e.getFirstAction(t)||r}}if(r){const t=s.dataset.frameTarget||"details",n=s.dataset.frameCaption||"Details";return App.openDetails(r,{external:!0,frameTarget:t,frameCaption:n,force:!1}),e.preventDefault(),!1}}openDetails(e,t){"string"==typeof e?(t=t||{}).url=e:"object"==typeof e?(t=t||{}).element=e:t=e||t||{};const s=App.findWidget(App.sidebarright.widgetElement,"tabsheets");if(!s)return;t.frameTarget=t.frameTarget||"details",t.frameCaption=t.frameCaption||"Details";const r=s.createTab(t.frameTarget,t.frameCaption),n=App.createWidget(r,"frame");return n.showData(t),n}activateTabsheet(e){App.sidebarright.showSidebar();return App.findWidget(App.sidebarright.widgetElement,"tabsheets").showTab(e)}}})();