(()=>{var t,e,i,s,o={584:(t,e,i)=>{"use strict";i.d(e,{I:()=>a,Xt:()=>n,dl:()=>l,gq:()=>o,lf:()=>r,xm:()=>c});var s=i(182);class o{constructor(t){this.modelParent=t,this.modelChildren=[],t&&t.modelChildren.push(this),this.eventListeners=[],this.resizeListeners=[],this.hasFocus=!1}listenEvent(t,e,i,o){if(t)if(t instanceof NodeList)t.forEach((t=>this.listenEvent(t,e,i,o)));else{s.Z.listenEvent(t,e,i,o);const n={element:t,event:e,handler:i,selector:o};this.eventListeners.push(n),"submit"===e&&this.listenEvent(t,"epi:submit:form",i)}}unlistenEvent(t,e,i,o){let n=this.eventListeners.length;for(;n--;){const r=this.eventListeners[n];r.element!==t||r.event!==e||r.handler!==i&&i||r.selector!==o&&o||(s.Z.unlistenEvent(t,r.event,r.handler,r.selector),this.eventListeners.splice(n,1))}"submit"===e&&this.unlistenEvent(t,"epi:submit:form",i)}emitEvent(t,e,i,o=!1){return s.Z.emitEvent(t,e,i,this,o)}getWidget(t,e,i=!0){if(t)return i&&(t=t.closest(".widget-"+e)),t&&t.widgets?t.widgets[e]:void 0}clearWidget(){this.eventListeners.forEach((t=>s.Z.unlistenEvent(t.element,t.event,t.handler,t.selector))),this.eventListeners=[],this.resizeListeners.forEach((t=>t.observer.unobserve(t.element))),this.resizeListeners=[],this.modelChildren.forEach((t=>t.clearWidget())),this.modelChildren=[]}}class n extends o{widgetElement=void 0;widgetName=void 0;widgetInitialized=!1;hasFocus=!1;constructor(t,e,i){super(i),this.widgetInitialized=!1,this.attachElement(t,e),this.listenEvent(document,"epi:clear:widgets",(t=>this.onClearWidgets(t.target))),this.listenEvent(document,"epi:init:widgets",(t=>this.onInitWidgets(t))),this.listenEvent(document,"focusout",(t=>this.onFocusChanged(t))),this.listenEvent(document,"focusin",(t=>this.onFocusChanged(t))),this.listenEvent(document,"click",(t=>this.onFocusChanged(t)))}clearWidget(){super.clearWidget(),this.detachElement(this.widgetElement,this.widgetName)}initWidget(){}updateWidget(){}onClearWidgets(t){t&&this.widgetElement&&t!==this.widgetElement&&t.contains(this.widgetElement)&&this.clearWidget()}attachElement(t,e,i=!0){i&&(this.widgetElement=t,this.widgetName=e),t&&e&&(t.widgets=t.widgets||{},t.widgets[e]=this)}detachElement(t,e){t&&e&&(t.widgets=t.widgets||{},delete t.widgets[e])}emitEvent(t,e,i){return super.emitEvent(this.widgetElement,t,e,i)}listenResize(t,e){if(t){const i=new ResizeObserver((t=>e(t)));i.observe(t);const s={element:t,observer:i,handler:e};this.resizeListeners.push(s)}}unlistenResize(t,e){e.unobserve(t)}spawnFromTemplate(t,e){const i=this.widgetElement.querySelector(".template."+t);return s.Z.spawnFromTemplate(i,e)}onInitWidgets(t){this.widgetInitialized||(this.widgetInitialized=!0,this.initWidget())}onFocusChanged(t){this.widgetElement&&this.widgetElement instanceof Element&&(void 0===t?this.setFocus(!0):this.widgetElement.contains(t.target)?this.setFocus("focusout"!==t.type):"focusout"!==t.type&&this.setFocus(!1))}setFocus(t=!0){if(this.widgetElement&&this.widgetElement instanceof Element){if(this.hasFocus===t)return;this.hasFocus=t,this.widgetElement.classList.toggle("widget-focused",this.hasFocus),this.emitEvent("epi:focus:widgets",{focus:this.hasFocus})}}doFocus(){this.widgetElement&&this.widgetElement instanceof Element&&(this.setFocus(!0),this.widgetElement.focus())}getSetting(t,e){if("undefined"!=typeof App&&App.user.session){if(this.widgetElement&&this.widgetElement.dataset.uiKey){const e=App.user.session.get("ui",this.widgetElement.dataset.uiKey);if(void 0!==e&&t in e)return e[t]}return e}}setSetting(t,e){if("undefined"!=typeof App&&App.user.session&&this.widgetElement&&this.widgetElement.dataset&&this.widgetElement.dataset.uiKey){let i={};i[t]=e,App.user.session.save("ui",this.widgetElement.dataset.uiKey,i)}}getController(){return s.Z.getClassValue(document.querySelector("body"),"controller_")}getAction(){return s.Z.getClassValue(document.querySelector("body"),"action_")}getFrame(t=!0,e=!1){if(!this.widgetElement||this.widgetElement===document)return t?void 0:document;let i;return e&&this.widgetElement.classList.contains("widget-content-pane")&&(i=this.widgetElement),i||(i=this.widgetElement.closest(".widget-content-pane")),t?i?i.widgets["content-pane"]:void 0:i&&!i.classList.contains("widget-content-pane-main")?i:document}isInFrame(){return this.widgetElement&&null!==this.widgetElement.closest(".widget-content-pane")&&!this.widgetElement.closest(".widget-content-pane-main")}}class r extends n{constructor(t,e,i){super(t,e,i),this.documentWidget=null}getDocumentWidget(){if(!this.documentWidget){const t=this.widgetElement.closest("[data-root-table]"),e=this.widgetElement.closest("[data-root-id]");if(!(t&&t.dataset.rootTable&&e&&e.dataset.rootId))return;const i=document.querySelector('.widget-document[data-root-table="'+t.dataset.rootTable+'"][data-root-id="'+e.dataset.rootId+'"]');this.documentWidget=this.getWidget(i,"document",!1)}return this.documentWidget}}class a extends n{constructor(t,e,i){super(t,e,i),this.formElement=void 0,this.cancelButton=void 0,this.deleteButton=void 0,this.lockTimeout=void 0,this.isSaving=!1}attachForm(t,e=!0){this.detachForm(),!e&&this.getWidget(t,"baseform",!1)||(this.formElement=t,this.formElement&&(this.attachElement(t,"baseform",!1),this.listenButtons(),this.listenEvent(document,"epi:open:tab",(t=>this.onExternalClick(t))),this.listenEvent(this.formElement,"submit",(t=>this.submitForm(t))),this.listenEvent(window,"beforeunload",(t=>this.onExit(t)))))}detachForm(){this.unlistenButtons(),this.formElement&&(this.unlistenEvent(document,"epi:open:tab"),this.unlistenEvent(this.formElement,"submit"),this.unlistenEvent(window,"beforeunload"),this.formElement=void 0)}listenButtons(){this.formElement&&(this.cancelButton||(this.cancelButton=document.querySelector('button[data-role="cancel"][form="'+this.formElement.getAttribute("id")+'"]'),this.cancelButton&&this.listenEvent(this.cancelButton,"click",(t=>this.onCancelClick(t)))),this.deleteButton||(this.deleteButton=document.querySelector('button[data-role="delete"][form="'+this.formElement.getAttribute("id")+'"]'),this.deleteButton&&this.listenEvent(this.deleteButton,"click",(t=>this.onDeleteClick(t)))),this.lockTimeout||this.setLockTimeout((()=>this.lock(!0)),15e3))}unlistenButtons(){this.formElement&&this.clearLockTimeout(),this.deleteButton&&this.unlistenEvent(this.deleteButton,"click"),this.cancelButton&&this.unlistenEvent(this.cancelButton,"click")}onExit(t){if(!this.isSaving&&this.hasLock()){const e="You have opened a dataset. The dataset may stay locked if you don't close it. Do you want to leave the page anyways?";return t.preventDefault(),t.returnValue=e,e}}setLockTimeout(t,e){this.lockTimeout=setTimeout((()=>t()),e)}clearLockTimeout(){this.lockTimeout&&(clearTimeout(this.lockTimeout),this.lockTimeout=void 0)}hasLock(){if(!this.formElement)return!1;return null!==this.formElement.querySelector('input[name="lock"][data-lock-url]')}async lock(t=!0){if(this.lockTimeout=void 0,!this.formElement)return;if(this.isSaving)return;const e=this.formElement.querySelector('input[name="lock"][data-lock-url]'),i=e?e.dataset.lockUrl:null,s=e?e.value:null;i&&s&&(await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lock:s})}),t&&this.setLockTimeout((()=>this.lock(!0)),15e3))}async unlock(){if(this.clearLockTimeout(),!this.formElement)return;if(this.isSaving)return;const t=this.formElement.querySelector('input[name="lock"][data-lock-url]'),e=t?t.dataset.unlockUrl:null,i=t?t.value:null;e&&i&&await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lock:i})})}clearWidget(){super.clearWidget()}unlockForm(t,e=!1){if(!t)return void this.cancelForm(!0);let i;if(this.formElement){const t=this.formElement.querySelector('input[name="lock"][data-lock-url]');i=t?t.value:null}if(i)if(this.isSaving=!0,this.clearLockTimeout(),e&&this.loadUrl)this.loadUrl(t,{lock:i,focus:!1});else{const e=s.Z.spawnFromString('<input type="hidden" name="lock" value="'+i+'">'),o=document.createElement("form");o.action=t,o.method="POST",o.appendChild(e),document.body.appendChild(o),o.submit()}else this.loadUrl&&this.loadUrl(t);this.cancelForm(!1)}onCancelClick(t){if(this.formElement){const t=s.Z.decodeHtmlAttribute(this.formElement.dataset.cancelUrl);this.unlockForm(t)}}onExternalClick(t){if(this.formElement&&t.target.contains(this.formElement)){const t=s.Z.decodeHtmlAttribute(this.formElement.dataset.cancelUrl);this.unlockForm(t,!0)}}onDeleteClick(t){if(this.formElement){const t=s.Z.decodeHtmlAttribute(this.formElement.dataset.deleteUrl);this.unlockForm(t)}}getEntityId(){if(!this.formElement)return;let t=this.formElement.querySelector("[data-root-table][data-root-id]");return t=t||this.formElement.closest("[data-root-table][data-root-id]"),t&&t.dataset.rootTable&&t.dataset.rootId?t.dataset.rootTable+"-"+t.dataset.rootId:void 0}focusWidget(){let t=this.widgetElement.querySelector("[autofocus]");t=t||this.widgetElement.querySelector("select, input[type=text], .widget-xmleditor"),t&&(t.removeAttribute("autofocus"),t.focus(),"function"==typeof t.select&&t.select())}cancelForm(t=!0){if(!this.formElement)return!1;t&&this.closeWindow(!0);const e=this.getEntityId();e&&this.emitEvent("epi:cancel:row",{row:e,sender:this})}submitForm(t){if(!this.formElement)return!1;let e=[];this.footerPane&&(e=Array.from(this.footerPane.querySelectorAll("[data-position=fixed]")),e.forEach(((t,e)=>{this.formElement.appendChild(t)})));try{if(!this.validateForm())return;if(t.submitter&&"submit"===t.submitter.dataset.role)return this.isSaving=!0,!1;t.preventDefault(),t.stopPropagation(),this.saveForm()}finally{e.forEach(((t,e)=>{this.footerPane.appendChild(t)}))}return!1}validateForm(){return!(!this.formElement||!this.formElement.reportValidity())&&!!this.emitEvent("epi:save:form",{},!0)}saveForm(){return!!this.formElement&&(!this.isSaving&&(!!this.onSaveStart()&&this.onSavePost()))}onSaveStart(){this.emitEvent("app:show:loader");const t=this.formElement&&"message"in this.formElement.dataset?this.formElement.dataset.message:"Processing data";return t&&this.emitEvent("app:open:dialog",{message:t,loader:!0,id:"save-dialog",delay:150}),this.clearLockTimeout(),this.isSaving=!0,!0}onSavePost(){let t,e=null,i=!1;const o=this.formElement.method||"POST";"GET"===o.toUpperCase()?t=s.Z.formToUrl(this.formElement,App.baseUrl):(t=this.formElement.getAttribute("action"),this.formElement.action="",e=new FormData(this.formElement),"json"===this.formElement.dataset.format&&(e=JSON.stringify(s.Z.parseFormData(e)),i="application/json"),this.formElement.action=t);const n=this,r=new XMLHttpRequest;return r.method=o.toUpperCase(),$.ajax({type:o,url:t,data:e,xhr:()=>r,async:!0,contentType:i,processData:!1,success:(t,e,i)=>n.onSaveSuccess(n.getEntityId(),t,e,r),error:t=>n.onSaveFailed(r),complete:t=>n.onSaveEnd(r)}),!0}onSaveSuccess(t,e,i,s){this.hideLoader();const o=t?t.split("-"):[];if(o.length>1&&"new"===o[1]&&(t=void 0),this.formOptions&&this.formOptions.onSubmitted)return this.formOptions.onSubmitted(this,e,i,s),!1;const n=s.getResponseHeader("content-type");let r="update",a=[];if("GET"===s.method)r="unchanged";else if(t){const i=(new DOMParser).parseFromString(e,"text/html").querySelector("[data-root-table][data-root-id]");if(i&&"1"===i.dataset.deleted&&a.push(t),i&&i.dataset.mergedIds){let t=i.dataset.mergedIds.split(",").map((t=>i.dataset.rootTable+"-"+t));a=a.concat(t)}i&&"1"===i.dataset.moved&&(r="moved")}else if(r="create","application/json"===n){const i=e[Object.keys(e)[0]];i&&(t=i.id)}else{const i=(new DOMParser).parseFromString(e,"text/html").querySelector("[data-root-table][data-root-id]");i&&(t=i.dataset.rootTable+"-"+i.dataset.rootId)}return"update"===r&&t&&!a.includes(t)?this.emitEvent("epi:update:row",{row:t,sender:this}):"moved"===r&&t?this.emitEvent("epi:move:row",{row:t,sender:this}):"create"===r&&t&&this.emitEvent("epi:create:row",{row:t,sender:this}),a.forEach((t=>this.emitEvent("epi:delete:row",{row:t,sender:this}))),this.onSaveProceed(e,s)}onSaveProceed(t,e){let i,o,n;return"application/json"===e.getResponseHeader("content-type")?(i=s.Z.getValue(t,"status.message"),o=s.Z.getValue(t,"status.success",!1)?"success":"error",n=s.Z.getValue(t,"status.errors")):(i=(new DOMParser).parseFromString(t,"text/html").querySelector("[data-snippet=message]"),o=i&&i.classList.contains("error")?"error":"success",i=i?i.textContent:void 0),i&&this.emitEvent("app:show:message",{msg:i,status:o,errors:n}),"success"===o}onSaveFailed(t){this.emitEvent("app:show:message",{msg:"Saving failed: "+t.responseText,status:"error"})}onSaveEnd(t){return s.Z.emitEvent(document,"app:close:dialog",{id:"save-dialog"}),s.Z.emitEvent(document,"app:hide:loader"),this.isSaving=!1,!0}}class l{constructor(t){if(t&&t.modelEntity)return t.modelEntity;this.element=t;const e=t?t.closest("[data-row-table][data-row-id]"):void 0;if(e){t.modelEntity=this;const i=e.closest("[data-row-table]"),s=e.closest("[data-row-id]"),o=e.closest("[data-row-type]"),n=e.closest("[data-root-table]"),r=e.closest("[data-root-id]");this.table=i?i.dataset.rowTable:void 0,this.id=s?s.dataset.rowId:void 0,this.type=o?o.dataset.rowType:void 0,this.rootTable=n?n.dataset.rootTable:void 0,this.rootId=r?r.dataset.rootId:void 0,this.deleted=s?s.dataset.deleted:void 0}}}class c{constructor(t){if(t&&t.modelField)return t.modelField;this.element=t;const e=t?t.closest("[data-row-field]"):void 0;if(e){t.modelField=this;const i=e.closest("[data-row-table]"),s=e.closest("[data-row-id]"),o=e.closest("[data-row-type]"),n=e.closest("[data-root-table]"),r=e.closest("[data-root-id]");this.field=e?e.dataset.rowField:void 0,this.table=i?i.dataset.rowTable:void 0,this.id=s?s.dataset.rowId:void 0,this.type=o?o.dataset.rowType:void 0,this.rootTable=n?n.dataset.rootTable:void 0,this.rootId=r?r.dataset.rootId:void 0,this.deleted=s?s.dataset.deleted:void 0}}get rowNumber(){if(!this.element)return;const t=this.element.closest('[data-row-table="items"]');if(!t)return 1;const e=t.querySelector('[data-row-field="sortno"] input');return e?parseInt(e.value):1}}},649:(t,e,i)=>{"use strict";i.a(t,(async(t,s)=>{try{i.d(e,{a:()=>p});var o,n,r,a,l,c,d={498:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.errorMessages=e.ErrorType=void 0,function(t){t.MalformedUnicode="MALFORMED_UNICODE",t.MalformedHexadecimal="MALFORMED_HEXADECIMAL",t.CodePointLimit="CODE_POINT_LIMIT",t.OctalDeprecation="OCTAL_DEPRECATION",t.EndOfString="END_OF_STRING"}(i=e.ErrorType||(e.ErrorType={})),e.errorMessages=new Map([[i.MalformedUnicode,"malformed Unicode character escape sequence"],[i.MalformedHexadecimal,"malformed hexadecimal character escape sequence"],[i.CodePointLimit,"Unicode codepoint must not be greater than 0x10FFFF in escape sequence"],[i.OctalDeprecation,'"0"-prefixed octal literals and octal escape sequences are deprecated; for octal literals use the "0o" prefix instead'],[i.EndOfString,"malformed escape sequence at end of string"]])},12:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.unraw=e.errorMessages=e.ErrorType=void 0;const s=i(498);function o(t,e,i){const o=function(t){return t.match(/[^a-f0-9]/i)?NaN:parseInt(t,16)}(t);if(Number.isNaN(o)||void 0!==i&&i!==t.length)throw new SyntaxError(s.errorMessages.get(e));return o}function n(t,e){const i=o(t,s.ErrorType.MalformedUnicode,4);if(void 0!==e){const t=o(e,s.ErrorType.MalformedUnicode,4);return String.fromCharCode(i,t)}return String.fromCharCode(i)}Object.defineProperty(e,"ErrorType",{enumerable:!0,get:function(){return s.ErrorType}}),Object.defineProperty(e,"errorMessages",{enumerable:!0,get:function(){return s.errorMessages}});const r=new Map([["b","\b"],["f","\f"],["n","\n"],["r","\r"],["t","\t"],["v","\v"],["0","\0"]]),a=/\\(?:(\\)|x([\s\S]{0,2})|u(\{[^}]*\}?)|u([\s\S]{4})\\u([^{][\s\S]{0,3})|u([\s\S]{0,4})|([0-3]?[0-7]{1,2})|([\s\S])|$)/g;function l(t,e=!1){return t.replace(a,(function(t,i,a,l,c,d,u,h,p){if(void 0!==i)return"\\";if(void 0!==a)return function(t){const e=o(t,s.ErrorType.MalformedHexadecimal,2);return String.fromCharCode(e)}(a);if(void 0!==l)return function(t){if("{"!==(e=t).charAt(0)||"}"!==e.charAt(e.length-1))throw new SyntaxError(s.errorMessages.get(s.ErrorType.MalformedUnicode));var e;const i=o(t.slice(1,-1),s.ErrorType.MalformedUnicode);try{return String.fromCodePoint(i)}catch(t){throw t instanceof RangeError?new SyntaxError(s.errorMessages.get(s.ErrorType.CodePointLimit)):t}}(l);if(void 0!==c)return n(c,d);if(void 0!==u)return n(u);if("0"===h)return"\0";if(void 0!==h)return function(t,e=!1){if(e)throw new SyntaxError(s.errorMessages.get(s.ErrorType.OctalDeprecation));const i=parseInt(t,8);return String.fromCharCode(i)}(h,!e);if(void 0!==p)return g=p,r.get(g)||g;var g;throw new SyntaxError(s.errorMessages.get(s.ErrorType.EndOfString))}))}e.unraw=l,e.default=l},494:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.d(e,{a:()=>o.ag});var o=i(555);const{messages:t}=await i.e(190).then(i.bind(i,455));o.ag.load("de_DE",t),o.ag.activate("de_DE"),s()}catch(t){s(t)}}),1)},555:(t,e,i)=>{i.d(e,{ag:()=>y});var s=i(12);const o=t=>"string"==typeof t,n=new Map;function r(t){return[...Array.isArray(t)?t:[t],"en"]}function a(t,e,i){const s=r(t);return d((()=>u("date",s,i)),(()=>new Intl.DateTimeFormat(s,i))).format(o(e)?new Date(e):e)}function l(t,e,i){const s=r(t);return d((()=>u("number",s,i)),(()=>new Intl.NumberFormat(s,i))).format(e)}function c(t,e,i,{offset:s=0,...o}){const n=r(t),a=e?d((()=>u("plural-ordinal",n)),(()=>new Intl.PluralRules(n,{type:"ordinal"}))):d((()=>u("plural-cardinal",n)),(()=>new Intl.PluralRules(n,{type:"cardinal"})));return o[i]??o[a.select(i-s)]??o.other}function d(t,e){const i=t();let s=n.get(i);return s||(s=e(),n.set(i,s)),s}function u(t,e,i){return`${t}-${e.join("-")}-${JSON.stringify(i)}`}const h=/\\u[a-fA-F0-9]{4}|\\x[a-fA-F0-9]{2}/g;function p(t,e,i){return(n,r={})=>{const d=((t,e,i={})=>{e=e||t;const s=t=>o(t)?i[t]||{style:t}:t,n=(t,o)=>{const n=Object.keys(i).length?s("number"):{},r=l(e,t,n);return o.replace("#",r)};return{plural:(t,i)=>{const{offset:s=0}=i,o=c(e,!1,t,i);return n(t-s,o)},selectordinal:(t,i)=>{const{offset:s=0}=i,o=c(e,!0,t,i);return n(t-s,o)},select:(t,e)=>e[t]??e.other,number:(t,i)=>l(e,t,s(i)),date:(t,i)=>a(e,t,s(i)),undefined:t=>t}})(e,i,r),u=t=>Array.isArray(t)?t.reduce(((t,e)=>{if(o(e))return t+e;const[i,s,r]=e;let a={};null==r||o(r)?a=r:Object.keys(r).forEach((t=>{a[t]=u(r[t])}));const l=d[s](n[i],a);return null==l?t:t+l}),""):t,p=u(t);return o(p)&&h.test(p)?s(p.trim()):o(p)?p.trim():p}}var g=Object.defineProperty;class m{constructor(){((t,e,i)=>{((t,e,i)=>{e in t?g(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i)})(this,"_events",{})}on(t,e){return this._hasEvent(t)||(this._events[t]=[]),this._events[t].push(e),()=>this.removeListener(t,e)}removeListener(t,e){if(!this._hasEvent(t))return;const i=this._events[t].indexOf(e);~i&&this._events[t].splice(i,1)}emit(t,...e){this._hasEvent(t)&&this._events[t].map((t=>t.apply(this,e)))}_hasEvent(t){return Array.isArray(this._events[t])}}var f=Object.defineProperty,v=(t,e,i)=>(((t,e,i)=>{e in t?f(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i),i);class w extends m{constructor(t){super(),v(this,"_locale"),v(this,"_locales"),v(this,"_localeData"),v(this,"_messages"),v(this,"_missing"),v(this,"t",this._.bind(this)),this._messages={},this._localeData={},null!=t.missing&&(this._missing=t.missing),null!=t.messages&&this.load(t.messages),null!=t.localeData&&this.loadLocaleData(t.localeData),null==t.locale&&null==t.locales||this.activate(t.locale,t.locales)}get locale(){return this._locale}get locales(){return this._locales}get messages(){return this._messages[this._locale]??{}}get localeData(){return this._localeData[this._locale]??{}}_loadLocaleData(t,e){null==this._localeData[t]?this._localeData[t]=e:Object.assign(this._localeData[t],e)}loadLocaleData(t,e){null!=e?this._loadLocaleData(t,e):Object.keys(t).forEach((e=>this._loadLocaleData(e,t[e]))),this.emit("change")}_load(t,e){null==this._messages[t]?this._messages[t]=e:Object.assign(this._messages[t],e)}load(t,e){null!=e?this._load(t,e):Object.keys(t).forEach((e=>this._load(e,t[e]))),this.emit("change")}loadAndActivate({locale:t,locales:e,messages:i}){this._locale=t,this._locales=e||void 0,this._messages[this._locale]=i,this.emit("change")}activate(t,e){this._locale=t,this._locales=e,this.emit("change")}_(t,e={},{message:i,formats:s}={}){o(t)||(e=t.values||e,i=t.message,t=t.id);const n=!this.messages[t],r=this._missing;if(r&&n)return"function"==typeof r?r(this._locale,t):r;n&&this.emit("missing",{id:t,locale:this._locale});let a=this.messages[t]||i||t;return o(a)&&h.test(a)?JSON.parse(`"${a}"`):o(a)?a:p(a,this._locale,this._locales)(e,s)}date(t,e){return a(this._locales||this._locale,t,e)}number(t,e){return l(this._locales||this._locale,t,e)}}const y=function(t={}){return new w(t)}()}},u={};function g(t){var e=u[t];if(void 0!==e)return e.exports;var i=u[t]={exports:{}};return d[t](i,i.exports,g),i.exports}g.m=d,o="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",n="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",r="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",a=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},g.a=(t,e,i)=>{var s;i&&((s=[]).d=-1);var l,c,d,u=new Set,h=t.exports,p=new Promise(((t,e)=>{d=e,c=t}));p[n]=h,p[o]=t=>(s&&t(s),u.forEach(t),p.catch((t=>{}))),t.exports=p,e((t=>{var e;l=(t=>t.map((t=>{if(null!==t&&"object"==typeof t){if(t[o])return t;if(t.then){var e=[];e.d=0,t.then((t=>{i[n]=t,a(e)}),(t=>{i[r]=t,a(e)}));var i={};return i[o]=t=>t(e),i}}var s={};return s[o]=t=>{},s[n]=t,s})))(t);var i=()=>l.map((t=>{if(t[r])throw t[r];return t[n]})),c=new Promise((t=>{(e=()=>t(i)).r=0;var n=t=>t!==s&&!u.has(t)&&(u.add(t),t&&!t.d&&(e.r++,t.push(e)));l.map((t=>t[o](n)))}));return e.r?c:i()}),(t=>(t?d(p[r]=t):c(h),a(s)))),s&&s.d<0&&(s.d=0)},g.d=(t,e)=>{for(var i in e)g.o(e,i)&&!g.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},g.f={},g.e=t=>Promise.all(Object.keys(g.f).reduce(((e,i)=>(g.f[i](t,e),e)),[])),g.u=t=>"../msg/de_DE.js",g.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),l={},c="Epigraf Widgets:",g.l=(t,e,i,s)=>{if(l[t])l[t].push(e);else{var o,n;if(void 0!==i)for(var r=document.getElementsByTagName("script"),a=0;a<r.length;a++){var d=r[a];if(d.getAttribute("src")==t||d.getAttribute("data-webpack")==c+i){o=d;break}}o||(n=!0,(o=document.createElement("script")).type="module",o.charset="utf-8",o.timeout=120,g.nc&&o.setAttribute("nonce",g.nc),o.setAttribute("data-webpack",c+i),o.src=t),l[t]=[e];var u=(e,i)=>{o.onerror=o.onload=null,clearTimeout(h);var s=l[t];if(delete l[t],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach((t=>t(i))),e)return e(i)},h=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),n&&document.head.appendChild(o)}},g.p="/",(()=>{var t={434:0};g.f.j=(e,i)=>{var s=g.o(t,e)?t[e]:void 0;if(0!==s)if(s)i.push(s[2]);else{var o=new Promise(((i,o)=>s=t[e]=[i,o]));i.push(s[2]=o);var n=g.p+g.u(e),r=new Error;g.l(n,(i=>{if(g.o(t,e)&&(0!==(s=t[e])&&(t[e]=void 0),s)){var o=i&&("load"===i.type?"missing":i.type),n=i&&i.target&&i.target.src;r.message="Loading chunk "+e+" failed.\n("+o+": "+n+")",r.name="ChunkLoadError",r.type=o,r.request=n,s[1](r)}}),"chunk-"+e,e)}};var e=(e,i)=>{var s,o,[n,r,a]=i,l=0;if(n.some((e=>0!==t[e]))){for(s in r)g.o(r,s)&&(g.m[s]=r[s]);a&&a(g)}for(e&&e(i);l<n.length;l++)o=n[l],g.o(t,o)&&t[o]&&t[o][0](),t[o]=0},i=self.webpackChunkEpigraf_Widgets=self.webpackChunkEpigraf_Widgets||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var h=g(494),p=(h=await h).a;s()}catch(o){s(o)}}),1)},182:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});class s{static hide(t){t&&(t.originalDisplay=window.getComputedStyle(t).getPropertyValue("display"),t.style.display="none")}static show(t,e){t&&("none"===t.style.display&&(t.style.display=t.originalDisplay||"block"),"none"===t.style.display&&(t.style.display="block"),void 0!==e&&(t.textContent=e))}static toggle(t,e=!0){e?this.show(t):this.hide(t)}static isElementVisible(t){return"none"!==window.getComputedStyle(t).getPropertyValue("display")}waitFor(t,e=3e3){return new Promise(((i,o)=>{let n=0;const r=()=>{const a=document.querySelector(t);a&&s.isElementVisible(a)?i(a):n>=e?o(new Error("Element not loaded.")):(n+=50,setTimeout(r,50))};r()}))}static scrollToTop(t,e){t&&t.scrollIntoView(!0)}static getTotalOffset(t,e){let i=0,s=0,o=t;for(;o&&o!==e.offsetParent;)i+=o.offsetTop,s+=o.offsetLeft,o=o.offsetParent;return{top:i,left:s}}static getStickyElementHeight(t,e){const i=t.querySelector(e);if(i&&t!==i){if("sticky"===window.getComputedStyle(i).position)return i.offsetHeight}return 0}static scrollIntoViewIfNeeded(t,e,i=!0,o=!0){const n="y"===i||!0===i,r="x"===i||!0===i,a="y"===o||!0===o,l="x"===o||!0===o;if(!t||!s.isElementVisible(t))return;e=e||t.parentNode;const c=t.getBoundingClientRect();let d=e.getBoundingClientRect();const u=e.offsetHeight-e.clientHeight,h=s.getStickyElementHeight(e,"thead, li");d=new DOMRect(d.x,d.y+h,d.width,d.height-u-h);const p=c.top<d.top,g=c.bottom>d.bottom;if(a){let i;if(p&&!g?i=c.top-d.top:g&&!p&&(i=c.bottom-d.bottom),void 0!==i){if(n){let s=e.offsetHeight/2-t.offsetHeight/2;s=p?-s:+s,i+=s}e.scrollTop=e.scrollTop+i}}const m=c.left<d.left,f=c.right>d.right;if(l){let i;if(m&&!f?i=c.left-d.left:f&&!m&&(i=c.right-d.right),void 0!==i){if(r){let s=e.offsetWidth/2-t.offsetWidth/2;s=m?-s:+s,i+=s}e.scrollLeft=e.scrollLeft+i}}}static getParameterByName(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}static getValue(t,e,i=undefined){if(e&&Array.isArray(e)){for(let i of e){const e=this.getValue(t,i);if(void 0!==e)return e}return i}try{const s=e.split(".").reduce(((t,e)=>null==t||""===e?t:t.constructor===Array?t[parseInt(e)]:t[e]),t);return void 0===s?i:s}catch{return i}}static setValue(t,e,i,o=!1){return"string"==typeof e&&(e=e.replace(/\]/g,"").split(/[\[\.]/)),e.length>1?(t.hasOwnProperty(e[0])?"object"!=typeof t[e[0]]&&(t[e[0]]={}):t[e[0]]={},s.setValue(t[e[0]],e.slice(1),i,o)):o&&"object"==typeof t[e[0]]&&null!==t[e[0]]&&"object"==typeof i&&null!==i?t[e[0]]=Object.assign({},t[e[0]],i):t[e[0]]=i,t}static extractSnippetText(t,e){try{const i=(t=(new DOMParser).parseFromString(t,"text/html")).querySelector('[data-snippet="'+e+'"]');if(i)return i.textContent}catch{return""}return""}static wrapAll(t,e){return[...t.childNodes].forEach((t=>e.appendChild(t))),t.appendChild(e),e}static spawnFromString(t,e,i=!0){const o=document.createElement("template");return o.innerHTML=s.formatUnicorn(t.trim(),e),i?o.content.firstElementChild:o.content}static spawnFromTemplate(t,e,i=!0){if(t)return s.spawnFromString(t.text,e,i)}static childMatches(t,e){return[].some.call(t.children,(t=>t.matches(e)))}static setInputValue(t,e){t&&t.value!==e&&(t.value=e,t.disabled=!1,t.dataset.dirty=!0)}static getInputValue(t,e){return t?"checkbox"===t.type?t.checked?t.value:0:t.value:e}static removeInputConstraints(t){t.querySelectorAll("input").forEach((t=>{t.removeAttribute("min"),t.removeAttribute("max")}))}static getDataValue(t,e,i){return t&&t.dataset[e]||i}static setElementContent(t,e){t&&(t.innerHTML=e)}static setElementText(t,e){t&&(t.textContent=e)}static getElementText(t,e){return t?t.textContent:e}static getRenderedText(t,e=""){if(!t)return e;let i="";return function t(e){switch(e.nodeType){case Node.TEXT_NODE:i+=e.nodeValue.trim();break;case Node.ELEMENT_NODE:if("BUTTON"===e.tagName||"INPUT"===e.tagName&&"hidden"===e.type)i+="";else if(e.classList.contains("widget-dropdown-pane"))i+="";else if("SELECT"===e.tagName){const t=e.options[e.selectedIndex];t&&(i+=t.text.trim())}else if("INPUT"===e.tagName)i+=e.value;else for(const i of e.childNodes)t(i)}}(t),i||e}static extractElements(t,e,i){let s=[];return t.querySelectorAll(e).forEach((t=>{s.push(...Array.from(t.querySelectorAll(i))),t.remove()})),s}static toggleClass(t,e,i){i.forEach((e=>e.classList.remove(t))),e&&e.classList.add(t)}static removeClassByPrefix(t,e){let i=[];t.classList.forEach((t=>{0!==t.indexOf(e)&&i.push(t)})),t.className=i.join(" ")}static getClassValue(t,e){if(t)for(let i of t.classList)if(0===i.indexOf(e))return i.substring(e.length)}static encodeHtmlAttribute(t){return"string"!=typeof t?t:t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}static decodeHtmlAttribute(t){return"string"!=typeof t?t:t.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&amp;/g,"&")}static formatUnicorn(t,e){for(const i in e){let o=new RegExp("\\{"+i+"\\}","gi");t=t.replace(o,e[i]);let n=new RegExp("\\{"+i+"\\|attr\\}","gi");t=t.replace(n,s.encodeHtmlAttribute(e[i]))}return t}static numberToLetters(t,e=!0,i=65,o=26){i="string"==typeof i?i.charCodeAt(0):i;let n=t<=0?"":s.numberToLetters(Math.floor((t-1)/o),e,i,o)+String.fromCharCode((t-1)%o+i);return e?n.toLowerCase():n.toUpperCase()}static numberToRoman(t,e=!0){const i={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};let s="";for(;t>0;)for(const e in i)if(t>=i[e]){t-=i[e],s+=e;break}return e?s.toLowerCase():s}static abbrNum(t){return t.toUpperCase().split("").reduce(((t,e)=>26*t+e.charCodeAt(0)-96),0)}static numberToString(t,e){switch(e){case"alphabetic":case"alphabetic-lower":return s.numberToLetters(t,!0);case"alphabetic-upper":return s.numberToLetters(t,!1);case"roman":case"roman-lower":return s.numberToRoman(t,!0);case"roman-upper":return s.numberToRoman(t,!1);case"greek":case"greek-lower":return s.numberToLetters(t,!0,"Α",24);case"greek-upper":return s.numberToLetters(t,!1,"Α",24);default:return String(t)}}static mod(t,e){return(t%e+e)%e}static isTrue(t,e=!1){return"string"==typeof t&&(t=t.toLowerCase()),null==t?e:1===t||"1"===t||!0===t||"true"===t}static isString(t){return"[object String]"===Object.prototype.toString.call(t)}static isVisible(t,e){const{bottom:i,height:s,top:o}=t.getBoundingClientRect(),n=e.getBoundingClientRect();return o<=n.top?n.top-o<=s:i-n.bottom<=s}static nearestPositionedAncestor(t){let e=t.parentElement;for(;e;){const t=window.getComputedStyle(e).position;if("relative"===t||"absolute"===t||"fixed"===t||"sticky"===t)return e;e=e.parentElement}return null}static getPrevSibling(t,e){let i=t.previousElementSibling;for(;i;){if(i.matches(e))return i;i=i.previousElementSibling}}static getNextSibling(t,e){if(!t)return;let i=t.nextElementSibling;for(;i;){if(i.matches(e))return i;i=i.nextElementSibling}}static getNextVisibleSibling(t,e){if(!t)return;let i=t.nextElementSibling;for(;i&&(!s.isElementVisible(i)||e&&!i.matches(e));)i=i.nextElementSibling;return i&&s.isElementVisible(i)&&(!e||i.matches(e))?i:void 0}static getPrevVisibleSibling(t,e){if(!t)return;let i=t.previousElementSibling;for(;i&&(!s.isElementVisible(i)||e&&!i.matches(e));)i=i.previousElementSibling;return i&&s.isElementVisible(i)&&(!e||i.matches(e))?i:void 0}static bottomAboveViewport(t,e){const i=t.getBoundingClientRect(),s=e.getBoundingClientRect();return i.bottom<s.bottom}static topBelowViewport(t,e){const i=t.getBoundingClientRect(),s=e.getBoundingClientRect();return i.top>s.top}static querySelectorLast(t,e){return[...t.querySelectorAll(e)].at(-1)}static querySelectorAndSelf(t,e){if(!Array.isArray(t))return t.matches&&t.matches(e)?t:t.querySelector(e);for(let i=0;i<t.length;i++){const o=s.querySelectorAndSelf(t[i],e);if(o)return o}}static querySelectorSelfAndContainer(t,e){return[t,t===document?null:t.closest(e)].filter((t=>null!==t&&t!==document&&t.matches(e)))}static querySelectorAllAndSelf(t,e){return[t,...t.querySelectorAll(e)].filter((t=>!(t instanceof DocumentFragment)&&t!==document&&t.matches(e)))}static querySelectorAllAndSelfAndContainer(t,e){const i=t?t.querySelectorAll(e):[],s=t&&t!==document?t.closest(e):null;return[t,...i,s].filter((t=>null!==t&&t!==document&&t.matches(e)))}static querySelectorText(t,e,i=""){return(t=t.querySelector(e))?t.textContent:i}static querySelectorData(t,e,i,s=""){return(t=t.querySelector(e))?t.dataset[i]:s}static listenEvent(t,e,i,s){if(!t)return;const o=t=>{if(t.defaultPrevented)return;if(void 0===s)return i(t);const e=t.target.closest(s);if(e&&t.currentTarget.contains(e)){if(("mouseover"===t.type||"mouseout"===t.type)&&e.contains(t.relatedTarget))return;return i.call(e,t)}};return t.eventListeners||(t.eventListeners={}),t.eventListeners[e]||(t.eventListeners[e]={}),t.eventListeners[e][s]||(t.eventListeners[e][s]=[]),t.eventListeners[e][s].push({source:i,target:o}),t.addEventListener(e,o)}static unlistenEvent(t,e,i,s){if(t&&t.eventListeners&&t.eventListeners[e]&&t.eventListeners[e][s]){const o=t.eventListeners[e][s];let n=o.length;for(;n--;){const s=o[n];s.source===i&&(t.removeEventListener(e,s.target),o.splice(n,1))}}}static emitEvent(t,e,i,s,o=!1){if(!t)return;let n=new CustomEvent(e,{bubbles:!0,cancelable:o,detail:{data:i,sender:s}});return t.dispatchEvent(n)}static getSelectionPosition(t){if(window.getSelection){const t=window.getSelection();if(t.rangeCount>0){return t.getRangeAt(0).startOffset}}return 0}static setSelectionPosition(t,e){const i=document.createRange(),s=window.getSelection();i.setStart(t.childNodes[0],e),i.collapse(!0),s.removeAllRanges(),s.addRange(i)}static lon2tile(t,e){return Math.floor((t+180)/360*Math.pow(2,e))}static lat2tile(t,e){return Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e))}static tile2long(t,e){return t/Math.pow(2,e)*360-180}static tile2lat(t,e){const i=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))}static collapseWhitespace(t){return t.replace(/ +/g," ")}static prefixNumbersWithZero(t,e=1){return t.replace(/\d+/g,(t=>t.padStart(e,"0")))}static replaceSpacesWithHyphens(t){return t.replace(/\s+/g,"-")}static removeSpecialCharacters(t){return t.replace(/[^ ~a-z0-9\-_]/g,"")}static replaceUmlauts(t){return t.replace(/ä/g,"ae").replace(/ö/g,"oe").replace(/ü/g,"ue").replace(/Ä/g,"Ae").replace(/Ö/g,"Oe").replace(/Ü/g,"Ue").replace(/ß/g,"sz")}static extractNumber(t){return(t=t.match(/\d+/))?t[0]:""}static extractFileName(t){if(!t)return;return t.split(/[/\\]/).pop()}static parseFormData(t){const e={};for(const[i,o]of t.entries())s.setValue(e,i,o);return e}static formToUrl(t,e){let i=new URL(t.getAttribute("action"),e);const s=new URLSearchParams(new FormData(t));let o=i.searchParams;return o=new URLSearchParams({...Object.fromEntries(o),...Object.fromEntries(s)}),o=o.toString(),i.search=o,i.toString()}static toObject(t,e="data"){if("object"==typeof t)return t;if("string"==typeof t){const i={};return i[e]=t,i}throw new Error("Input must be an object or a string")}static groupElements(t,e,i=""){const s={};return t.forEach((t=>{let o=t.dataset[e];void 0===o&&void 0!==i&&(o=i),s[o]||(s[o]=[]),s[o].push(t)})),s}static splitString(t,e=","){return t?""===t?[]:Array.isArray(t)?t:t.split(e).map((t=>t.trim())).filter(Boolean):[]}static getPrefix(t,e=":",i=""){const s=t.indexOf(e);return-1!==s?t.substring(0,s):i}static evalCheckboxes(t){const e=t.querySelectorAll('input[type="checkbox"]'),i={};let s=!0;return e.forEach((t=>{i[t.name]=t.checked,s&&=t.checked})),[i,s]}static cleanId(t){return t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}static getHorizontalDistance(t,e){const i=t.getBoundingClientRect(),s=e.getBoundingClientRect();return Math.max(s.left-i.right,i.left-s.right,0)}static replaceRecursive(t,e,...i){for(const o of i)for(const i in o)o.hasOwnProperty(i)&&("object"!=typeof o[i]||null===o[i]||Array.isArray(o[i])||"object"!=typeof e[i]||null===e[i]||Array.isArray(e[i])?t&&["number","string","boolean"].includes(typeof e[i])&&e[i]!==o[i]?e[i]+=","+o[i]:e[i]=o[i]:e[i]=s.replaceRecursive(!1,e[i],o[i]));return e}}const o=s;String.prototype.capitalize||(String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}),$.fn.reverse=[].reverse,String.prototype.formatUnicorn||(String.prototype.formatUnicorn=function(){let t=this.toString();if(arguments.length){let e=typeof arguments[0],i="string"===e||"number"===e?Array.prototype.slice.call(arguments):arguments[0];t=s.formatUnicorn(t,i)}return t})},348:()=>{},968:(t,e,i)=>{"use strict";i.a(t,(async(t,s)=>{try{i.d(e,{EY:()=>g,Eh:()=>v,Ju:()=>p,KM:()=>w,PH:()=>u,TS:()=>d,Vg:()=>y,Y1:()=>b,dt:()=>h,g9:()=>m,iW:()=>f});var o=i(182),n=i(649),r=i(584),a=i(482),l=t([n,a]);[n,a]=l.then?(await l)():l;class c extends r.gq{constructor(t){super(t),this.doc=t,this.rootTable=t?this.doc.rootTable:void 0,this.rootId=t?this.doc.rootId:void 0}enableInputs(t){t.querySelectorAll("input, select, textarea").forEach((t=>{t.disabled=!1}))}disableInputs(t){t.querySelectorAll("input, select, textarea").forEach((t=>{t.disabled=!0}))}}class d extends c{}class u extends c{getTree(t){let e=[];const i=this.modelParent.widgetElement;return t&&t.articles&&Array.isArray(t.articles)&&t.articles.includes(i.dataset.rowType)&&e.push({table:i.dataset.rowTable,id:i.dataset.rowId,treeId:i.dataset.rowTable+"-"+i.dataset.rowId,treeParent:null,treeLevel:0,labelName:"Article",labelPath:"Article"}),t&&t.sections&&e.push(...this.doc.models.sections.getTree(t,i)),t&&t.footnotes&&e.push(...this.doc.models.footnotes.getTree(t,i)),e}getProjectId(){return o.Z.getInputValue(this.modelParent.widgetElement.querySelector(".doc-content select[name=projects_id]"))}}class h extends c{constructor(t){if(super(t),this.lastId=0,this.sectionMenu=document.querySelector(".menu-sections"),this.sectionMenu){this.widgetTree=this.getWidget(this.sectionMenu,"tree");const t=this.sectionMenu.closest(".sidebar");this.listenEvent(t,"click",(t=>this.sectionMenuClick(t))),this.listenEvent(t,"changed",(t=>this.sectionMenuClick(t))),this.listenEvent(this.sectionMenu,"epi:move:row",(t=>this.updatePositions())),this.listenEvent(this.doc.widgetElement,"epi:focus:section",(t=>this.view(t.target.dataset.rowId)))}this.listenEvent(this.doc.widgetElement,"change",(t=>this.onNameChanged(t)))}_createId(){return this.lastId+=1,"sections-int"+this.lastId}getTree(t,e){let i=[];return e.querySelectorAll(".doc-section").forEach((s=>{t.sections&&Array.isArray(t.sections)&&t.sections.includes(s.dataset.rowType)&&i.push({table:s.dataset.rowTable,id:s.dataset.rowId,treeId:s.dataset.rowTable+"-"+s.dataset.rowId,treeParent:s.dataset.rowParentId?s.dataset.rowTable+"-"+s.dataset.rowParentId:e.dataset.rowTable+"-"+e.dataset.rowId,treeLevel:parseInt(s.dataset.rowLevel||"0")+1,labelText:this.getPath(s),labelName:this.getName(s),labelPath:this.getTitle(s),searchText:this.getPath(s)}),t.items&&i.push(...this.doc.models.items.getTree(t,s))})),i}getAllSections(){return this.doc.widgetElement.querySelectorAll('.doc-section[data-row-table="sections"]')}getMenuItems(){return this.sectionMenu.querySelectorAll(".node:not(.item-removed)")}getSectionByMenuItem(t){if(t){if(t.classList.contains("doc-section"))return t;try{return this.modelParent.widgetElement.querySelector("#sections-"+t.dataset.id)}catch{return}}}getMenuItemBySection(t){return this.getMenuItemById(t.dataset.rowId)}getMenuItemById(t){return this.sectionMenu.querySelector('[data-id="'+t+'"]')}getActiveSection(){if(App.scrollsync)return App.scrollsync.activeSection}getActiveMenuItem(){return this.sectionMenu.querySelector(".active")}getName(t){return t.querySelector(".doc-section-name").dataset.rowName}getTitle(t){return o.Z.getElementText(t.querySelector('.doc-section-name [data-value="name"]'))}getPosition(t,e=!0,i=!0){let s=[],o=t.previousElementSibling;for(;o;){let n=o.classList.contains("doc-section")&&!o.classList.contains("doc-section-removed");n&&e&&(n=o.dataset.rowParentId===t.dataset.rowParentId),n&&i&&(n=o.dataset.rowType===t.dataset.rowType),n&&s.push(o),o=o.previousElementSibling}return s.length+1}getPath(t){let e=[this.getName(t)];try{const i=t.dataset.rowTable;let s={},n={},r=!1;"sections"===i&&(s=o.Z.getValue(this.modelParent.models.types._types,i,{}),n=s[t.dataset?.rowType]||this.getConfig(t),r=o.Z.getValue(n,"config.name.path",!1));let a=t.previousElementSibling;for(;r&&a&&a.dataset.rowTable===i;)a.dataset.rowId===t.dataset.rowParentId&&(e.push(this.getName(a)),t=a,"sections"===i&&(n=s[t.dataset?.rowType]||this.getConfig(t),r=o.Z.getValue(n,"config.name.path",!1))),a=a.previousElementSibling}catch(t){console.error("Error finding the path: ",t)}return e.reverse().join(".")}getConfig(t){try{return JSON.parse(decodeURI(t.dataset.rowConfig))}catch(t){return{}}}updatePositions(t){const e=this.widgetTree;let i=0,s=this.modelParent.widgetElement.querySelector(".doc-section");this.sectionMenu.querySelectorAll("[data-list-itemof], .node").forEach((t=>{if(s&&!t.classList.contains("fixed")){if(s.dataset.rowId!==t.dataset.id){const e=this.modelParent.widgetElement.querySelector('[data-row-id="'+t.dataset.id+'"]');s.before(e),s=e}if(e){const i=e.treeGetParent(t);s.dataset.rowParentId=i&&i.dataset.id?i.dataset.id:"",o.Z.setInputValue(s.querySelector('[data-row-field="parent_id"]'),s.dataset.rowParentId);const n=e.treeGetPrevSibling(t);s.dataset.rowPrecedingId=n&&n.dataset.id?n.dataset.id:"",o.Z.setInputValue(s.querySelector('[data-row-field="preceding_id"]'),s.dataset.rowPrecedingId),s.dataset.rowLevel=t.treeLevel,o.Z.removeClassByPrefix(s,"doc-section-level-"),s.classList.add("doc-section-level-"+t.treeLevel)}i+=1,o.Z.setInputValue(s.querySelector('.doc-section-name [data-row-field="sortno"], :scope > [data-row-field="sortno"]'),i),s=s.nextElementSibling}})),this.updateNames(),App.scrollsync&&(App.scrollsync.updateWidget(),App.scrollsync.scrollToSection(this.getActiveSection(),!0))}updateNames(){this.getMenuItems().forEach((t=>{this.updateName(t)}))}updateName(t){const e=this.getSectionByMenuItem(t);e&&this.modelParent.models.types.loadTypes("sections").then((i=>{const s=e.querySelector("select.doc-section-published");if(s){const e=o.Z.getInputValue(s,""),i=t.querySelector(".tree-published");o.Z.removeClassByPrefix(i,"tree-published-"),i.classList.add("tree-published-"+e)}const n=i[e.dataset?.rowType]||this.getConfig(e);let r=o.Z.getValue(n,"config.name.number");const a=o.Z.getValue(n,"config.name.path",!1),l=o.Z.getValue(n,"config.name.scoped",!1),c=this.getPosition(e,a,l),d=this.getPosition(e,!1,!1),u=o.Z.getInputValue(e.querySelector('[data-row-field="name"]'));let h;if(void 0!==r?(r="alphabetic"===r?"alphabetic-upper":r,h=o.Z.numberToString(c,r)):void 0!==u&&(h=u),void 0!==h){o.Z.setInputValue(e.querySelector('[data-row-field="name"]'),h),e.querySelector(".doc-section-name").dataset.rowName=h;const i=o.Z.getValue(n,"config.name.prefix",""),s=o.Z.getValue(n,"config.name.postfix",""),r=i+h+s;o.Z.setElementContent(t.querySelector(".tree-content a"),r);const a=i+this.getPath(e)+s;o.Z.setElementContent(e.querySelector(".doc-section-name").querySelector('[data-value="name"]'),a);const l=" ⬥ ".repeat(parseInt(e.dataset.rowLevel));o.Z.setElementContent(e.querySelector(".doc-section-indent"),l),o.Z.setInputValue(e.querySelector('.doc-section-name [data-row-field="number"], :scope > [data-row-field="number"]'),c)}o.Z.setInputValue(e.querySelector('.doc-section-name [data-row-field="sortno"], :scope > [data-row-field="sortno"]'),d)}))}view(t){if(t&&App.scrollsync){const e=document.getElementById("sections-"+t);App.switchbuttons.switchButton(e.querySelector(".doc-section-head"),!0),App.scrollsync.scrollToSection(e,!0)}}async delete(t){if(!t)return!1;if(!await App.confirmAction("Are you sure you want to delete the selected section?"))return!1;const e=this.widgetTree.treeGetDescendants(t);e.push(t);const i=this;return e.forEach((function(t){const e=i.getSectionByMenuItem(t);if(e){const s=i.doc.satellites.notes?i.doc.satellites.notes.widgetElement:void 0,n=s?s.querySelector('.doc-section-note[data-section-id="'+e.id+'"]'):void 0,r=e.querySelector('[data-row-field="deleted"]');r?(o.Z.setInputValue(r,1),n&&(i.doc.models.footnotes.removeFrom(n),n.classList.remove("active"),n.classList.add("doc-section-removed")),i.doc.models.footnotes.removeIn(e),e.classList.add("doc-section-removed"),t.classList.add("item-removed")):(n&&(i.doc.models.footnotes.removeFrom(n),n.remove()),i.doc.models.footnotes.removeIn(e),e.remove(),t.remove())}})),this.widgetTree.treeUpdatePositions(),this.updateNames(),!0}add(t,e){e||(e=this.doc.widgetElement.querySelector(".doc-content"));const i=t.querySelector(".doc-section-note");return i&&(this.doc.satellites.notes.widgetElement.appendChild(i),App.initWidgets(i)),e.after(t),App.initWidgets(t),t}sectionMenuClick(t){const e=this.getActiveMenuItem();t.target.classList.contains("doc-section-add")&&"changed"===t.type?this.fetchNewSections(e,!1,t.detail.data.id):t.target.classList.contains("doc-section-remove")&&this.delete(e)}fetchNewSections(t,e,i){let s=this.sectionMenu.dataset.listAdd+"/"+i;s=new URL(s,App.baseUrl);const n=this.widgetTree?this.widgetTree.treeGetParent(t):void 0;t&&e?s.searchParams.set("parent_id",t.dataset.id):e||(s.searchParams.set("parent_id",n?n.dataset.id:null),t&&s.searchParams.set("preceding_id",t.dataset.id));const r=this;App.fetchHtml(s.toString(),(function(i){let s;o.Z.spawnFromString(i,void 0,!1).querySelectorAll(".doc-section").forEach((function(i){const o=r.createMenuItem(i,t,e),n=r.getSectionByMenuItem(t);i=r.add(i,n),r.updatePositions(),t=o,s=s||o})),s&&App.scrollsync&&App.scrollsync.activateLi(s)}))}createMenuItem(t,e,i){let s=o.Z.spawnFromTemplate(this.sectionMenu.querySelector(".template"),{id:t.dataset.rowId,parent_id:t.dataset.rowParentId});return t.dataset.rowParentId&&(e=this.getMenuItemById(t.dataset.rowParentId),i=!0),s=i?this.widgetTree.treeAppendChild(e,s):this.widgetTree.treeAppendAfter(e,s),s}onNameChanged(t){const e=t.target.closest(".doc-section-published select");if(e){const t=o.Z.getInputValue(e,""),i=e.closest("div.doc-section-published");o.Z.removeClassByPrefix(i,"doc-section-published-"),i.classList.add("doc-section-published-"+t);const s=e.closest(".doc-section");if(s){const t=this.getMenuItemBySection(s);this.updateName(t)}return}let i=t.target.closest('.doc-section-name [data-row-field="name"]');if(i){const t=i.closest(".doc-section"),e=this.getMenuItemBySection(t);return void this.updateName(e)}const s=t.target.closest('.doc-section-name [data-row-field="properties_id"]');if(s){const t=s.closest(".doc-section");if(t){const e=o.Z.getInputValue(s,""),i=s.options[s.selectedIndex].text;o.Z.setInputValue(t.querySelector('[data-row-field="name"]'),i),o.Z.setInputValue(t.querySelector('[data-row-format="sectionname"] input'),e);const n=this.getMenuItemBySection(t);this.updateName(n)}}else;}}class p extends c{constructor(t){super(t),this.lastId=0,this.listenEvent(document,"click",(t=>this.onClick(t)),".doc-item-remove, .doc-item-add"),this.listenEvent(document,"changed",(t=>this.onChanged(t))),this.listenEvent(document,"input",(t=>this.onInput(t))),this.listenEvent(document,"keydown",(t=>this.onKeyDown(t))),this.listenEvent(document,"epi:upload:files",(t=>this.onUploadFiles(t))),this.listenEvent(document,"epi:update:item",(t=>this.onUpdateItem(t))),this.listenEvent(document,"epi:import:item",(t=>this.onImportItem(t)))}getTree(t,e){let i=[];return e.querySelectorAll(".doc-section-item").forEach((s=>{t.items&&Array.isArray(t.items)&&t.items.includes(s.dataset.rowType)&&i.push({table:s.dataset.rowTable,id:s.dataset.rowId,treeId:s.dataset.rowTable+"-"+s.dataset.rowId,treeParent:e.dataset.rowId?e.dataset.rowTable+"-"+e.dataset.rowId:null,treeLevel:parseInt(e.dataset.rowLevel||"0")+2,labelText:`Item ${s.dataset.rowId}`,labelName:`Item ${s.dataset.rowId}`,labelPath:`Item ${s.dataset.rowId}`})})),i}async onClick(t){const e=t.target;if(this.doc.ownedByDocument(e))if(t.target.classList.contains("doc-item-remove")){const e=t.target.closest(".doc-section-item");e&&(t.preventDefault(),t.stopPropagation(),await App.confirmAction("Are you sure you want to delete the selected item?")&&this.delete(e))}else if(t.target.classList.contains("doc-item-add")){t.preventDefault(),t.stopPropagation();const e=t.target.closest(".doc-section-item");this.add(e),"1"===t.target.dataset.itemsMax&&e.remove()}}updateDropDown(t){if(!t.target.classList.contains("widget-dropdown-selector"))return;const e=t.target.closest(".doc-field");if(e)if("property"===e.dataset.rowFormat){const t=e.querySelector("input.input-reference-value"),i=e.querySelector("input.input-reference-text"),s=e.querySelector("input.input-reference-type"),o=t.getAttribute("name"),n=o.replace("properties_id","newproperty")+"[name]";if(i.setAttribute("name",n),s){const t=o.replace("properties_id","newproperty")+"[propertytype]";s.setAttribute("name",t)}}else if("relation"===e.dataset.rowFormat||"record"===e.dataset.rowFormat){const t=e.querySelector("input.input-reference-value");if(t){const i=t.value.split("-"),s=i[0]||"",n=i.slice(1).join("-");o.Z.setInputValue(e.querySelector("input[data-row-field=links_tab]"),s),o.Z.setInputValue(e.querySelector("input[data-row-field=links_id]"),n)}}}onChanged(t){const e=t.target;this.doc.ownedByDocument(e)&&(t.target.classList.contains("widget-dropdown-selector")&&this.updateDropDown(t),this.onInput(t))}onInput(t){const e=t.target;if(!this.doc.ownedByDocument(e))return;const i=t.target.closest(".doc-section-item");this.emitEvent(i,"epi:change:item",{},!1)}onKeyDown(t){if(13===t.keyCode){const e=t.target;if(!this.doc.ownedByDocument(e))return;const i=t.target.closest('[data-row-table="items"]');this.moveItem(i)}}onUploadFiles(t){const e=t.detail.data;if(!e||!e.listName||!e.items)return;const i=this.doc.findInDocument('[data-target-list="'+e.listName+'"]');if(!i)return;const s=i.closest(".doc-section-item");if(!s)return;const n=Array.from(s.closest(".doc-section-content").querySelectorAll('.doc-section-item:not([data-deleted]) input[data-itemtype="file"]'),(t=>o.Z.extractFileName(t.value||"").toLowerCase()));e.items.forEach((t=>{n.includes(t.fileName.toLowerCase())||this.add(s,t,!1)}))}onImportItem(t){const e=t.detail.data;if(!(e&&e.sectiontype&&e.itemtype&&e.items))return;if(0===e.items.length)return;const i=this.doc.findInDocument('[data-row-table="sections"][data-row-type="'+e.sectiontype+'"] ');if(!i)return;const s=i.querySelector(".doc-section-item .doc-field-add-"+e.itemtype);if(s){const t=s.closest(".doc-section-item");if(!t)return;return void e.items.forEach((e=>{this.add(t,e,!1)}))}const o=i.querySelector('[data-row-table="items"][data-row-type="'+e.itemtype+'"]');if(o){const t={};t.table=o.dataset.rowTable,t.id=o.dataset.rowId,t.content=e.items[0],this.emitEvent(o,"epi:update:item",t)}}onUpdateItem(t){const e=t.detail.data;if(!(e&&e.table&&e.id&&e.content))return;const i=document.querySelector('[data-row-table="'+e.table+'"][data-row-id="'+e.id+'"]');if(this.doc.ownedByDocument(i))for(const t in e.content){let s=i.querySelector(`[data-row-field="${t}"]`);s||"properties_id"!==t?s||"properties_label"!==t||(s=i.querySelector('[data-row-field="property"] input.input-reference-text')):s=i.querySelector('[data-row-field="property"] input.input-reference-value'),this.setContent(s,e.content[t])}}delete(t){if(t.classList.contains("doc-section-item-first")){const e=o.Z.getNextVisibleSibling(t);e&&e.classList.add("doc-section-item-first")}this.doc.models.annotations.removeFrom(t);const e=t.querySelector("input[data-row-field=deleted]");e?(o.Z.setInputValue(e,1),t.dataset.deleted="1",o.Z.removeInputConstraints(t),"1"===t.dataset.new&&this.disableInputs(t)):t.remove(),this.updateSortnumbers(t.parentElement);const i=new Event("epi:remove:item",{bubbles:!0,cancelable:!1});t.dispatchEvent(i)}moveItem(t){if(!t)return;const e=this.doc.getFieldData(t).rowNumber;let i,s=!1,n=t;for(;(n=o.Z.getPrevVisibleSibling(n,'[data-row-table="items"]'))&&n.dataset.rowType===t.dataset.rowType&&(i=this.doc.getFieldData(n).rowNumber,!(i<e));)n.classList.remove("doc-section-item-first"),n.insertAdjacentElement("beforebegin",t),s=!0;if(!s)for(n=t;(n=o.Z.getNextVisibleSibling(n,'[data-row-table="items"]'))&&n.dataset.rowType===t.dataset.rowType&&(i=this.doc.getFieldData(n).rowNumber,!(i>e));)n.classList.remove("doc-section-item-first"),n.insertAdjacentElement("afterend",t),s=!0;this.updateSortnumbers(t.parentElement),t.classList.remove("doc-section-item-first");const r=t.parentElement.querySelector('[data-row-type="'+t.dataset.rowType+'"]:not([data-deleted="1"]):not([data-preview="1"])');r&&r.classList.add("doc-section-item-first")}updateSortnumbers(t){const e=t.querySelectorAll('[data-row-table="items"]:not([data-deleted="1"]):not([data-preview="1"])');e.forEach(((t,e)=>{o.Z.setInputValue(t.querySelector('input[data-row-field="sortno"], [data-row-field="sortno"] input'),e+1)})),t.classList.toggle("doc-section-groups-empty",0===e.length)}setContent(t,e){if(!t)return;const i=o.Z.querySelectorAndSelf(t,"input");o.Z.setInputValue(i,e||"");const s=this.getWidget(t.querySelector(".doc-field-content"),"xmleditor");s&&s.setContent(e)}add(t,e,i=!0){const s=t.closest('.doc-section, [data-container-table="sections"]');if(!s)return;const n=s.dataset.rowId||s.dataset.containerId,r=this._createId();let a=o.Z.spawnFromTemplate(t.querySelector(".template-doc-section-item"),{id:r,"sections-id":n,rootTable:s.dataset.rootTable,rootId:s.dataset.rootId});if(a||console.log("Template not found"),a.dataset.new="1",e&&e.fileName){const i="file",s=a.querySelector(`.doc-fieldname-${i} input[data-itemtype="file"]`);if(s){const i=o.Z.getDataValue(t.closest("[data-file-defaultpath]"),"fileDefaultpath"),n=i+"/"+e.fileName;o.Z.setInputValue(s,n),s.dataset.path=i}}if(e&&e.properties_id&&(o.Z.setInputValue(a.querySelector(".doc-fieldname-property input.input-reference-value"),e.properties_id),o.Z.setInputValue(a.querySelector(".doc-fieldname-property input.input-reference-text"),e.properties_label)),e&&e.content){const t="content",i=a.querySelector(`.doc-fieldname-${t} input`);i&&o.Z.setInputValue(i,e[t])}e&&e.value&&o.Z.setInputValue(a.querySelector(".doc-fieldname-value input"),e.value),t.before(a);let l=t.previousElementSibling;const c=l.parentElement;if(this.updateSortnumbers(c),t.classList.contains("doc-section-item-first")&&(t.classList.remove("doc-section-item-first"),l.classList.add("doc-section-item-first")),App.initWidgets(l),i){const t='div[data-row-field]:not([data-row-field="sortno"]) input:not([type="hidden"]), div[data-row-field]:not([data-row-field="sortno"]) select',e=l.querySelector(t);e&&(e.focus(),e.click())}o.Z.emitEvent(l,"epi:add:item",{},!1)}_createId(){return this.lastId+=1,"items-int"+this.lastId}}class g extends c{constructor(t){super(t),this.listenEvent(document,"click",(t=>this.click(t)))}click(t){const e=t.target.closest(".doc-fieldname-file");!t.target.closest(".frame-content")&&e&&(t.preventDefault(),t.stopPropagation(),this.show(e))}show(t){const e=t.querySelector(".doc-field-content");e&&this.view(e.dataset.path,e.dataset.fileName)}view(t,e){if(!t||!e)return;let i=App.databaseUrl+"files/view?root=root&path="+t+"&filename="+e;App.openDetails(i,{title:"File",ajaxButtons:["submit"],external:!0})}}class m extends c{constructor(t){super(t),this.listenEvent(document,"click",(t=>this.clickProperty(t)))}clickProperty(t){const e=t.target.closest(".doc-fieldname-property"),i=t.target.closest(".frame-content"),s=e?e.querySelector(".widget-dropdown-selector"):void 0;if(e&&!i&&!s){t.preventDefault(),t.stopPropagation();const i=e.querySelector("[data-row-field=properties_id]"),s=this.doc.getFieldData(i),o=i?i.dataset.rowValue:void 0;s.field&&o&&this.view(o)}}view(t){if(!t)return;const e=App.databaseUrl+"properties/view/"+t;App.openDetails(e,{title:"Property",ajaxButtons:["submit"],external:!0})}}class f extends c{constructor(t){super(t),this.lastRowId=0,this.listenEvent(document,"mouseover",(t=>this.hoverAnno(t)),"[data-tagid] .xml_bracket_open, [data-tagid] .xml_bracket_close , .xml_text[data-tagid], .xml_format[data-tagid], [data-from-tagid]"),this.listenEvent(document,"mouseout",(t=>this.unhoverAnno(t)),"[data-tagid], [data-from-tagid]"),this.listenEvent(document,"click",(t=>this.onClickAnno(t))),this.listenEvent(document,"epi:toggle:switch",(t=>this.updatePositions(t.target.closest(".doc-section-links")))),this.updatePositions()}_createRowId(){return this.lastRowId+=1,"links-int"+this.lastRowId}_getAnnoByEvent(t){let e,i,s,o=t.target.closest(".doc-section-link");if(o)i=o.dataset.fromTagid,s=this._getSection(o),s&&(e=s.querySelector('[data-tagid="'+i+'"]'));else if(e=t.target.closest(".xml_text, .xml_bracket_open, .xml_bracket_close"),e){let t=e.closest("[data-tagid]");i=t.dataset.tagid,s=this._getSection(t),s&&(o=s.querySelector('.doc-section-link[data-from-tagid="'+i+'"]'))}return[o,e]}_getAnnoByTagId(t,e){let i;return i=e?e.querySelector('[data-from-tagid="'+t+'"]'):document.querySelector('.doc-section-links [data-from-tagid="'+t+'"]'),i}_getAnnosByTagId(t,e){let i;return i=e?e.querySelectorAll('[data-from-tagid="'+t+'"]'):document.querySelectorAll('.doc-section-links [data-from-tagid="'+t+'"]'),i}_getAnnoByTag(t,e){return this._getAnnoByTagId(t.dataset.tagid,e)}_getAnnoContainer(t){let e=t.closest(".doc-section-content, .doc-section-note");return e?e.querySelector(".doc-section-links"):void 0}_getSection(t){return t.closest(".doc-section-content, .doc-section-note")}hoverAnno(t){this.unhoverAnno();let e=t.target,i=e.dataset.tagid||e.dataset.fromTagid;return i||(e=e.closest("[data-tagid], [data-from-tagid]"),i=e.dataset.tagid||e.dataset.fromTagid),document.querySelectorAll('.doc-section-link[data-from-tagid="'+i+'"]').forEach((function(t){t.classList.add("tag-hover");const e=o.Z.getElementText(t.querySelector(".doc-section-link-text"));document.querySelectorAll('.doc-section-content [data-tagid="'+i+'"]').forEach((function(t){t.classList.add("tag-hover"),t.title=e}))})),t.preventDefault(),!1}unhoverAnno(t){return document.querySelectorAll(".tag-hover").forEach((function(t){t.classList.remove("tag-hover")})),t&&t.preventDefault(),!1}orderAnnos(t,e){const i=Array.from(t.querySelectorAll("[data-tagid]"));let s=e.querySelector(["data-from-tagid"]);i.forEach((t=>{const i=t.dataset.tagid,o=e.querySelectorAll('[data-from-tagid="'+i+'"]');if(o)for(const t of o)for(t.previousElementSibling&&t.previousElementSibling.classList.contains("spacer")&&e.removeChild(t.previousElementSibling),t!==s&&e.insertBefore(t,s),s=t.nextElementSibling;s&&s.classList.contains("spacer");)s=s.nextElementSibling}))}updatePositions(t){if(!t){return void document.querySelectorAll(".doc-section-links").forEach((t=>{this.updatePositions(t),this.initResizeObservers(t)}))}if(!t.classList.contains("doc-section-links"))return;const e=t.closest(".doc-section");e&&this.arrangeAnnos(e,t)}initResizeObservers(t){if(!t.classList.contains("doc-section-links"))return;const e=t.closest(".doc-section");e&&this.doc.listenResize(e,(t=>{for(let e of t){const t=e.target.closest(".doc-section");if(t){const e=t.querySelector(".doc-section-links");e&&this.updatePositions(e)}}}))}arrangeAnnos(t,e){e.style.position="relative";if(!t.querySelector(".doc-section-content"))return;const i=e.getBoundingClientRect().top,s=e.getBoundingClientRect().left,n=e.querySelectorAll("button");let r=0;if(n.length>0){const t=n[n.length-1];r=t.getBoundingClientRect().bottom-i}const a=t.querySelectorAll("[data-tagid]");let l=-1,c=-2,d=0,u=0,h=0;a.forEach((t=>{const n=e.querySelectorAll('[data-from-tagid="'+t.dataset.tagid+'"]');if(n.length){let a=Math.max(t.getBoundingClientRect().top-i,r);a=10*Math.floor(a/10),n.forEach((t=>{o.Z.isElementVisible(t)&&(a<c?(d=u+2,h=d+2+t.scrollWidth,h>e.clientWidth&&(l=c+2,d=0)):(l=a,d=0),t.style.position="absolute",t.style.top=l+"px",t.style.left=d+"px",u=t.getBoundingClientRect().right-s,c=t.getBoundingClientRect().bottom-i)}))}}))}show(t){let e=t.dataset.toId,i=t.dataset.toTab,s=t.dataset.fromTagid,n=t.dataset.fromTagname;this.doc.models.types.loadTypes().then((t=>{let r=t.links[n]||t.footnotes[n]||{};o.Z.getValue(r,"config.fields.to.targets",{});"articles"===i&&e?this.doc.view(i+"-"+e):"sections"===i&&e?this.doc.models.sections.view(e):"properties"===i&&e?this.doc.models.properties.view(e):"footnotes"===r.scope&&s&&this.doc.models.footnotes.view(s)}))}edit(t,e=!0){const i=t.dataset.fromTagid,s=this.doc.models.annotations._getSection(t),o=this.doc.models.tags.getTagByTagId(i,s);o?this.modelParent.models.tags.editAnnoOrTag(o,e):this.modelParent.models.tags.editAnnoOrTag(t,e)}delete(t,e){const i=this._getAnnoContainer(t);let s=i.querySelectorAll('[data-from-tagid="'+e+'"]');for(const t of s)this.removeAnno(t);if(i){const t=i.querySelector('.doc-section-link:not([data-deleted="1"])');i.classList.toggle("doc-section-links-empty",!t)}return s}removeAnno(t){t&&"1"!==t.dataset.deleted&&(o.Z.setInputValue(t.querySelector("input[data-row-field=deleted]"),1),t.dataset.deleted="1",t.dataset.new&&this.disableInputs(t),"footnotes"===t.dataset.rowTable&&this.doc.models.footnotes.delete(t))}reviveAnno(t){t&&"1"===t.dataset.deleted&&(o.Z.setInputValue(t.querySelector("input[data-row-field=deleted]"),0),t.dataset.deleted="0",t.dataset.new&&this.enableInputs(t))}removeTag(t){const e=this.modelParent.models.tags.getTagContainer(t),i=this.doc.getWidget(e,"xmleditor",!1);i&&i.removeTag(t)}removeFrom(t){t.querySelectorAll("[data-tagid]").forEach((t=>this.delete(t,t.dataset.tagid)))}updateCounter(t,e,i,s){if(t.ckeditorInstance)this.doc.models.tags.updateAnnoOrTag(e,i,!1,s);else{const s=e.dataset.fromTagid,o=e.dataset.fromTagname,n=this.modelParent.models.tags.getTagByTagId(s,t);if(n){const t=i[o]||{};n.textContent=t.label||"*"}}}addProperty(t,e){if(e.new){const i=t.querySelector("input[data-row-field=to_id]");let s=i.cloneNode();s.dataset.rowField="to_value",s.value=e.label,s.name=i.name.replace("[to_id]","[to_value]"),t.appendChild(s);let o=i.cloneNode();o.dataset.rowField="to_type",o.value=e.type,o.name=i.name.replace("[to_id]","[to_type]"),t.appendChild(o),t.dataset.toNew="1"}else{const e=t.querySelector("input[data-row-field=to_value]");e&&e.remove();const i=t.querySelector("input[data-row-field=to_type]");i&&i.remove(),t.removeAttribute("data-to-new")}}onClickAnno(t){const[e,i]=this._getAnnoByEvent(t);if(e){if(t.preventDefault(),t.stopPropagation(),this.doc.editMode)return this.edit(e,!1);this.show(e)}}}class v extends c{constructor(t){super(t),this.listenEvent(document,"click",(t=>this.onClick(t)))}getTree(t,e){let i=[];const s=this.doc.satellites.footnotes.widgetElement;return s&&s.querySelectorAll(".doc-footnote").forEach((e=>{t.footnotes&&Array.isArray(t.footnotes)&&t.footnotes.includes(e.dataset.rowType)&&i.push({table:e.dataset.rowTable,id:e.dataset.rowId,treeId:e.dataset.rowTable+"-"+e.dataset.rowId,treeParent:null,treeLevel:0,labelText:o.Z.querySelectorText(e,".doc-footnote-number"),labelName:n.a.t("Footnote")+" "+o.Z.querySelectorText(e,".doc-footnote-number"),labelPath:n.a.t("Footnote")+" "+o.Z.querySelectorText(e,".doc-footnote-number"),searchText:o.Z.querySelectorText(e,".doc-footnote-number")})})),i}getAllFootnotes(t){let e=[];return this.doc.models.sections.getAllSections().forEach((i=>{const s=i.dataset.rowId;if(s){document.querySelectorAll('[data-row-table="sections"][data-row-id="'+s+'"], [data-container-table="sections"][data-container-id="'+s+'"]').forEach((i=>{const s=i.querySelectorAll(".widget-xmleditor [data-type="+t+"]");e=[...e].concat([...s])}))}})),e}getFootnoteElement(t){const e='[data-tagid="'+t+'"]',i=this.doc.satellites.footnotes.widgetElement;return i?i.querySelector(e):void 0}getFootnoteAnno(t){return this.doc.models.annotations._getAnnoByTagId(t)}getFootnoteTag(t){return this.modelParent.models.tags.getTagByTagId(t)}updateNumbers(t){if(void 0===t)return;const e=this;this.doc.models.types.loadTypes("footnotes").then((i=>{const s=i[t]||{},n=this.getAllFootnotes(t);let r=0;n.forEach((function(t){r+=1;const i=e.doc.models.tags.getTagContainer(t),n=e.doc.models.annotations._getAnnoByTag(t),a={label:o.Z.numberToString(r,o.Z.getValue(s,"config.fields.name.counter","numeric")),tab:n.dataset.toTab,id:n.dataset.toId};e.doc.models.annotations.updateCounter(i,n,{typeName:a},s),n.parentElement.appendChild(n);const l=e.getFootnoteElement(t.dataset.tagid);o.Z.setElementText(l.querySelector(".doc-footnote-number"),a.label),o.Z.setInputValue(l.querySelector('[data-row-field="name"]'),a.label),l.parentElement.appendChild(l)}))}))}view(t){this.doc.satellites.footnotes.view();const e=this.getFootnoteElement(t);if(e){const t=e.closest(".doc-section");App.switchbuttons.switchButton(t.querySelector(".doc-section-head"),!0);const i=e.closest(".widget-tabsheets-sheets");o.Z.scrollIntoViewIfNeeded(e,i)}}edit(t){this.doc.satellites.footnotes.view();const e=this.getFootnoteElement(t);if(e){const t=e.closest(".doc-section");App.switchbuttons.switchButton(t.querySelector(".doc-section-head"),!0);const i=e.closest(".widget-tabsheets-sheets");o.Z.scrollIntoViewIfNeeded(e,i);const s=App.findWidget(e,"xmleditor");s&&s.activateEditor()}}add(t,e,i){const s=e["data-tagid"],n=e["data-type"],r=this.doc.models.annotations._getAnnoContainer(t),a=this.doc.models.annotations._getAnnoByTagId(s,r);let l=this.doc.getFieldData(t),c=this.getFootnoteElement(s);if(c)c&&(o.Z.setInputValue(c.querySelector("input[data-row-field=deleted]"),0),c.dataset.deleted="0",this.enableInputs(c));else{const t=this.doc.satellites.footnotes.widgetElement.querySelector('.doc-section-footnotes[data-row-type="'+n+'"] .doc-section-content .doc-footnotes');if(!t)return App.showMessage("The footnote container for "+n+" is missing, check the article configuration."),c;let r=o.Z.getValue(i,n+".config.html.content",o.Z.getValue(i,n+".config.html_content",o.Z.getValue(i,n+".config.content","*")));const d=a.dataset.rowId||this.doc.models.annotations._createRowId();let u={idx:d,id:d,deleted:0,type:n,rootId:l.rootId,rootTab:l.rootTab,fromId:l.id,fromTab:l.table,fromField:l.field,fromTagid:s,fromTagname:n,displayname:r};for(const t of["content","segment"]){u[t]="";let s=o.Z.getValue(i,n+".config.fields."+t+".autofill",!1);if(s){if("object"!=typeof s&&(s={enabled:s}),u[t]=e["data-selected"]||"",s.wrap&&""!==u[t]){const e=s.wrap,n=o.Z.getValue(i,e+".config");if(n&&"format"===n.tag_type){const i=o.Z.getValue(n,"html.tag","span");u[t]="<"+i+' class="xml_tag xml_format xml_tag_'+e+'" data-type="'+e+'">'+u[t]+"</"+i+">"}}s.postfix&&(u[t]=u[t]+s.postfix),s.prefix&&(u[t]=s.prefix+u[t])}}const h=this.doc.satellites.footnotes.spawnFromTemplate("template-footnote-"+n,u);if(!h)return App.showMessage("The footnote template for "+n+" is missing, check the article configuration."),c;t.appendChild(h),c=this.getFootnoteElement(s),c.dataset.new="1",this.updateNumbers(n),App.initWidgets(c)}return c}removeIn(t){t.querySelectorAll('.doc-section-link[data-row-table="footnotes"]').forEach((t=>this.delete(t)))}removeFrom(t){t.querySelectorAll("[data-tagid]").forEach((t=>this.delete(t.dataset.tagid)))}delete(t){const e="string"==typeof t?t:t.dataset.fromTagid,i=this.getFootnoteElement(e);if(i&&"1"!==i.dataset.deleted){this.doc.models.annotations.removeFrom(i),i.dataset.deleted="1",o.Z.setInputValue(i.querySelector("input[data-row-field=deleted]"),1),"1"===i.dataset.new&&this.disableInputs(i);const t=this.getFootnoteTag(e);t&&this.doc.models.annotations.removeTag(t);const s=this.getFootnoteAnno(e);s&&this.doc.models.annotations.removeAnno(s);const n=i.dataset.rowType;this.updateNumbers(n)}}async onClick(t){if(t.target.classList.contains("doc-item-remove")){const e=t.target.closest(".doc-footnote");e&&(t.preventDefault(),t.stopPropagation(),await App.confirmAction("Are you sure you want to delete the selected footnote?")&&this.delete(e.dataset.tagid))}if(t.target.classList.contains("doc-footnote-number")){const e=t.target.closest(".doc-footnote"),i=e?e.dataset.tagid:void 0,s=this.getFootnoteTag(i);if(s){const t=s.closest(".content-content"),e=s.closest(".doc-section");App.switchbuttons.switchButton(e.querySelector(".doc-section-head"),!0),o.Z.scrollIntoViewIfNeeded(s,t)}}}}class w extends c{getAttributes(t){const e={id:t.dataset.toId,tab:t.dataset.toTab,type:t.dataset.toType,label:void 0,new:void 0};return e.new=o.Z.isTrue(t.dataset.toNew),e.new?(e.label=o.Z.getInputValue(t.querySelector('[data-row-field="to_value"]')),e.type=o.Z.getInputValue(t.querySelector('[data-row-field="to_type"]'))):t.dataset.toId&&(e.label=o.Z.getElementText(t.querySelector(".doc-section-link-text"))),e}getTargets(t){let e=t.dataset.fromTagname,i=[];const s=this.modelParent.models.types._types;if(s.links||s.footnotes){let t=s.links[e]||s.footnotes[e];i=s.footnotes&&void 0!==s.footnotes[e]?{footnotes:[e]}:o.Z.getValue(t,"config.fields.to.targets",{})}return i}getConfig(t){const e=t.dataset.fromTagname,i=this.modelParent.models.types._types;if(i.links||i.footnotes)return i.links[e]||i.footnotes[e]}add(t,e,i,s){const n=e["data-tagid"],r=e["data-type"],a=o.Z.getValue(i,r+".scope"),l=o.Z.getValue(i,r+".config.group"),c=o.Z.getValue(i,t+".config");let d,u,h,p=o.Z.getValue(c,"fields.to.targets.properties.0");if(p){const t="data-link-"+p;d=o.Z.getValue(e,t+"-value",""),u=o.Z.getValue(e,t+"-tab",""),h=o.Z.getValue(e,t+"-id","")}else{const t="data-target";d=o.Z.getValue(e,t+"-value",""),u=o.Z.getValue(e,t+"-tab",""),h=o.Z.getValue(e,t+"-id",""),p=o.Z.getValue(e,t+"-type","")}d||(d=o.Z.getValue(i,t+".caption","UNDEFINED"));const g=this.doc.models.annotations._createRowId();return this.doc.spawnFromTemplate("template-annotation-"+a,{scope:a,idx:g,id:g,group:l,rootId:s.rootId,rootTab:s.rootTab,fromId:s.id,fromTab:s.table,fromField:s.field,fromTagid:n,fromTagname:r,toId:h,toTab:u,toValue:d,toType:p,deleted:0})}}class y extends c{getLinkAttributes(t,e,i){const s=this;let o={};const n=t.querySelectorAll('[data-from-tagid="'+e+'"]');for(const t of n){const e=t.dataset.toType,i="1"===t.dataset.deleted;e&&!i&&(o["data-links-"+e]=s.modelParent.models.links.getAttributes(t))}return o}getTagAttributes(t,e,i){let s={};if(o.Z.getValue(i,"config.attributes",!1)){s=t.plugins.get("XmlTagEditing").tagGetModelAttributes(t,e)}return s}getTagByTagId(t,e){let i;return i=e?e.querySelector('[data-tagid="'+t+'"]'):this.modelParent.widgetElement.querySelector('.widget-xmleditor [data-tagid="'+t+'"], .doc-field-content [data-tagid="'+t+'"]'),i}getTagContainer(t){return t?t.closest(".widget-xmleditor"):void 0}onCreateTag(t,e){return this.doc.models.types.getTagSet(t,!1).then((i=>{const s=this.modelParent.models.annotations,n=this.modelParent.models.links,r=this.modelParent.models.footnotes,a=e["data-tagid"],l=e["data-type"],c=o.Z.getValue(i,l+".scope"),d=s._getAnnoContainer(t);if(!d)return void console.log("Annotation container not found.");d.classList.remove("doc-section-links-empty");const u=o.Z.getValue(i,l+".config.attributes",{});let h=Object.values(u).filter((t=>"link"===t.input)).map((t=>t.type));const p=h.length>0;p||(h=[l]);let g=s._getAnnosByTagId(a,d),m=[];p&&(g=o.Z.groupElements(g,"toType"),m=o.Z.getValue(g,"",m));let f=this.modelParent.getFieldData(t);h.forEach(((t,s)=>{let r;if(p){const e=o.Z.getValue(i,t+".config.fields.to.targets.properties.0");r=o.Z.getValue(g,e+".0"),!r&&m.length>0&&(r=m.pop(),r.dataset.toType=e)}else r=g[0];r?"1"!==f.deleted&&(o.Z.setInputValue(r.querySelector("input[data-row-field=deleted]"),0),r.dataset.deleted="0",this.enableInputs(r)):(r=n.add(t,e,i,f),r&&(d.appendChild(r),r.dataset.new="1"))})),"footnotes"===c&&r.add(t,e,i);const v=e["data-new"],w=this.getTagByTagId(a,t);v&&w&&(s.updatePositions(d),this.editAnnoOrTag(w,v))}))}onRemoveTag(t,e){const i=e["data-tagid"];this.doc.models.annotations.delete(t,i)}editAnnoOrTag(t,e=!0){this.doc.models.types.loadTypes().then((i=>{const s=t.dataset.type?t.dataset.type:t.dataset.fromTagname,n=i.links[s]||i.footnotes[s],r=i.footnotes&&void 0!==i.footnotes[s],a=o.Z.getValue(n,"config.fields.to.format"),l=Object.keys(o.Z.getValue(n,"config.fields.to.targets",{})),c=void 0!==o.Z.getValue(n,"config.attributes");let d;r?d=this.editFootnote:l.includes("properties")?d=this.editProperty:"record"===a?d=this.editRecord:"relation"===a?d=this.editRelation:!c&&e||(d=this.editAttributes),d&&d.call(this,t,(e=>this.updateAnnoOrTag(t,e,!0,n)),e)}))}updateAnnoOrTag(t,e,i,s){if("string"==typeof e)try{e=JSON.parse(decodeURI(e))}catch(t){console.log(t.toString()),e={}}const n=t.dataset.fromTagid?t.dataset.fromTagid:t.dataset.tagid,r=t.dataset.fromTagid?this.getTagByTagId(n,this.doc.models.annotations._getSection(t)):t,a=this.getTagContainer(r),l=this.modelParent.models.annotations._getAnnoContainer(t),c=this.modelParent.models.annotations._getAnnosByTagId(n,l);let d={};if(null===e){for(const t of c)this.doc.models.annotations.removeAnno(t);d=null}else{let t=0,i=[];for(const[n,r]of Object.entries(e))if(n.startsWith("attr-"))d[n.slice(5)]=r;else{void 0!==r.label&&i.push(r.label);let e=c[t];if(e){if(void 0!==r.label){let t=r.label;""===t&&s&&(t=s.caption||""),e.querySelector("span").textContent=t,e.title=t}void 0!==r.tab&&(e.dataset.toTab=r.tab,o.Z.setInputValue(e.querySelector("input[data-row-field=to_tab]"),r.tab)),void 0!==r.type&&"undefined"!==r.type&&(e.dataset.toType=r.type,o.Z.setInputValue(e.querySelector("input[data-row-field=to_type]"),r.type)),void 0!==r.id&&(e.dataset.toId=r.id,o.Z.setInputValue(e.querySelector("input[data-row-field=to_id]"),r.id)),this.doc.models.annotations.reviveAnno(e),this.modelParent.models.annotations.addProperty(e,r),t+=1}}for(let e=t;e<c.length;e++)this.doc.models.annotations.removeAnno(c[e]);i.length>0&&(d.label=i.join(" / "))}const u=this.doc.getWidget(a,"xmleditor",!1);u&&u.updateTag(n,d,!0)}editAttributes(t,e,i){const s=this;let o,n;t.classList.contains("doc-section-link")?(o=t.dataset.fromTagid,n=this.getTagByTagId(o,this.doc.models.annotations._getSection(t))):(o=t.dataset.tagid,n=t);const r=this.getTagContainer(n),a=this.doc.getWidget(r,"xmleditor",!1);this.doc.models.types.loadTypes().then((l=>{if(a&&n&&r)a.createEditor().then((a=>{const c=n.dataset.type,d=l.links[c]||l.footnotes[c],u=this.modelParent.models.annotations._getAnnoContainer(t),h={...s.getTagAttributes(a,o,d),...s.getLinkAttributes(u,o,d)};s.openAttributesDialog(d,e,i,r,h)}));else if(t.dataset.rowType){const o=t.dataset.rowType,n=l.links[o]||l.footnotes[o];s.openAttributesDialog(n,e,i)}}))}editFootnote(t,e,i){t&&this.doc.models.footnotes.edit(t.dataset.tagid)}editProperty(t,e,i){let s=t;if(!s.classList.contains("doc-section-link")&&(s=this.modelParent.models.annotations._getAnnoByTag(t,this.doc.models.annotations._getAnnoContainer(t)),!s))return;const n=this.modelParent.models.links.getAttributes(s),r=void 0===n.id||n.new?void 0:n.id,l=this.modelParent.models.links.getTargets(s),c=o.Z.getValue(l,"properties.0");if(void 0===c)return;let d=App.databaseUrl+"properties/index/"+c+"?template=input&show=content";d=void 0!==r?d+"&seek="+r:d,n.new&&void 0!==n.value&&(d=d+"&append=1&find="+n.value);let u=this.modelParent.models.links.getConfig(s);const h=o.Z.getValue(u,"config.fields.to.limit");if("article"===h&&"articles"===this.rootTable&&this.rootId&&(d=d+"&articles.field=id&articles.term="+this.rootId),"project"===h&&this.doc.models.articles){const t=this.doc.models.articles.getProjectId();t&&(d=d+"&projects="+t)}const p=o.Z.getValue(u,"config.fields.to.required",!0);p||(d+="&empty=1"),o.Z.getValue(u,"config.fields.to.append",!1)&&(d+="&append=1");let g=App.databaseUrl+"properties/index/"+c;g=void 0!==r?g+"?seek="+r:g;const m={title:"Select property",height:500,width:600,focus:!0,openDropdown:!0,url:d,external:g,selected:n,required:p,removeOnCancel:i,buttonRemove:!i,onRemove:()=>e(null),onSelect:t=>e(null===t?null:{propertytype:{tab:"properties",id:t.value,type:t.type,new:1==(t.new||!1),label:t.label||t.caption||""}})};new a.Gp(m)}editRecord(t,e,i){let s=t;if(!s.classList.contains("doc-section-link")&&(s=this.modelParent.models.annotations._getAnnoByTag(t,this.doc.models.annotations._getAnnoContainer(t)),!s))return;const o=this.modelParent.models.links.getTargets(s);let n=App.databaseUrl+"articles/index?template=choose&show=content,searchbar&columns=signature,name, project_signature&targets="+JSON.stringify(o);const r=this.modelParent.models.articles.getProjectId();r&&(n=n+"&projects="+r);const l={title:"External link",height:600,width:600,focus:!0,url:n,removeOnCancel:i,buttonRemove:!i,buttonSelect:!0,selectOnClick:!1,onRemove:()=>e(null),onSelect:t=>{const i=t.dataset.value.split("-",2),s=i.length>1?i[0]:"articles",o=i.length>1?i[1]:i[0];e(t?{record:{tab:s,id:o,label:t.dataset.label}}:null)}};new a.Gp(l)}editRelation(t,e,i){let s=t;if(!s.classList.contains("doc-section-link")&&(s=this.modelParent.models.annotations._getAnnoByTag(t,this.doc.models.annotations._getAnnoContainer(t)),!s))return;const n=this.modelParent.models.links.getAttributes(s),r=this.modelParent.models.links.getTargets(s),l=this.doc.getTargetList(r,n);let c=o.Z.spawnFromString('<div class="content-main widget-scrollbox"><div class="input reference"><div class="widget-dropdown-selector widget-dropdown-selector-frame"><input type="text" name="value-text" value="" title="" autocomplete="off" class="input-reference-text" data-label="" data-oldvalue=""><input type="hidden" name="value" class="input-reference-value"><div class="widget-dropdown-pane widget-scrollbox widget-dropdown-pane-frame"></div></div></div></div>');c.querySelector(".widget-dropdown-pane").appendChild(l);const d={title:"Select target",selected:n.id+"-"+n.tab,element:c,height:400,width:300,focus:!0,removeOnCancel:i,buttonRemove:!i,openDropdown:!0,onRemove:()=>e(null),onSelect:t=>{if(t){const i=t.value.split("-",2),s=i.length>1?i[0]:void 0,o=i.length>1?i[1]:i[0];e({relation:{tab:s,id:o,label:t.label||t.caption||""}})}else e(null)}};new a.Gp(d)}openAttributesDialog(t,e,i,s,n={}){const r=this,a=o.Z.getValue(t,"caption")||"";let l={};const c=o.Z.getValue(t,"config.attributes"),d=r.createAttributesInputs(c,n);c||i||(d.textContent="Do you want to remove the annotation?");let u={};u.cancel={text:"Cancel",handler:t=>{i&&e(null),t.closeWindow(),s&&s.focus()}},i||(u.remove={text:"Remove",handler:t=>{e(null),t.closeWindow(),s&&s.focus()}}),c&&(u.apply={text:"Apply",handler:t=>{const{value:i,valid:o}=r.getAttributesInputValues(t);o&&(e(i),t.closeWindow(),s&&s.focus())}}),l={title:a,height:o.Z.getValue(t,"config.attributes")?450:150,width:400,focus:!0,dialogButtons:u},App.openPopup(d,l)}createAttributesInputs(t,e){const i=document.createElement("div");if(i.classList.add("doc-attributes"),!t)return i;for(const[s,n]of Object.entries(t)){const t=o.Z.spawnFromString('<div class="doc-content-element"></div>');i.append(t);const r=o.Z.spawnFromString('<label class="doc-content-fieldname"></label>');r.textContent=n.caption||"",r.setAttribute("for",s),t.appendChild(r);const a=n.title;if(void 0!==a){const e=o.Z.spawnFromString('<div class="doc-content-help widget-tooltip">?</div>');e.setAttribute("title",a),t.append(e)}const l=o.Z.spawnFromString('<div class="doc-content-content"></div>');t.append(l);let c=n.values;Array.isArray(c)&&(c=c.reduce(((t,e,i)=>(t[i.toString()]=e,t)),{}));let d,u=n.input;if(void 0===u&&"object"==typeof c?u="select":void 0===u&&(u="text"),"link"===u){const t=o.Z.getValue(n,"type"),i=this.modelParent.models.types._types,r=i.links[t]||i.footnotes[t],a=o.Z.getValue(r,"config.fields.to.targets.properties.0");if(void 0!==a){const t=e["data-links-"+a]||{},i="dropdown-pane-properties-"+a;let n=document.getElementById(i);n&&(n.remove(),n=void 0);let c=App.databaseUrl+"properties/index/"+a+"?template=choose&references=0&show=content";const u=o.Z.getValue(r,"config.fields.to.limit");if("article"===u&&"articles"===this.rootTable&&this.rootId&&(c=c+"&articles.field=id&articles.term="+this.rootId),"project"===u&&this.doc.models.articles){const t=this.doc.models.articles.getProjectId();t&&(c=c+"&projects="+t)}let h;o.Z.getValue(r,"config.fields.to.append",!1)&&(c+="&append=1"),o.Z.getValue(r,"config.fields.to.manage",!1)&&(c+="&manage=1"),void 0===t.id||t.new||(c=c+"&seek="+t.id,h=t.id);const p={id:i,url:c,table:"properties",type:a,name:"links-"+s,label:t.label||"",value:h||""};d=this.doc.spawnFromTemplate("template-widget-dropdown-selector",p),l.appendChild(d)}}else if("select"===u){d=document.createElement("select"),d.setAttribute("name","attr-"+s);for(let t in c)if(c.hasOwnProperty(t)){let e=document.createElement("option");e.value=t,e.text=c[t],d.appendChild(e)}d.value=e["data-attr-"+s]||"",l.appendChild(d)}else if("checkbox"===u){"object"!=typeof c&&(c=c||n.caption||s,c={0:c,1:c});const t=document.createElement("label");t.textContent=" "+(Object.values(c)[1]||n.caption||s),d=document.createElement("input"),d.setAttribute("type","checkbox"),d.setAttribute("name","attr-"+s),d.setAttribute("value",Object.keys(c)[1]||"1"),d.dataset.default=Object.keys(c)[0]||"0",t.prepend(d);const i=e["data-attr-"+s]||"";d.checked=i===(Object.keys(c)[1]||"1"),l.appendChild(t)}else{d=document.createElement("input"),d.setAttribute("type","text"),d.setAttribute("name","attr-"+s);const t=n.values;void 0!==t&&"string"==typeof t&&(d.setAttribute("pattern",t),d.classList.add("widget-validate")),d.value=e["data-attr-"+s]||"",l.appendChild(d)}void 0!==a&&d.setAttribute("title",a)}return i}getAttributesInputValues(t){let e={};const i=t.widgetElement.querySelectorAll("input[type=text], input[type=checkbox], select");let s=!0;return i&&i.forEach((t=>{if(s=s&&(!t.classList.contains("widget-validate")||t.reportValidity()),t.classList.contains("input-reference-text")){const i=o.Z.getNextSibling(t,".input-reference-value"),s=t.closest(".input.reference"),n={id:i.value,tab:s.dataset.referenceTab,type:s.dataset.referenceType,label:t.value};e[i.name]=n}else t&&("checkbox"===t.getAttribute("type")?e[t.name]=t.checked?t.value:t.dataset.default||"":e[t.name]=t.value)})),{value:e,valid:s}}}class b extends c{constructor(t){super(t),this._types=null,this._isLoading=!1}groupTypes(t){let e={};t="Array"===t.constructor?t:Object.values(t);for(const i of t)e[i.scope]??={},e[i.scope][i.name]??=[],e[i.scope][i.name].push(i);for(const t of Object.keys(e)){e[t]??={};for(const[i,s]of Object.entries(e[t]))e[t][i]=o.Z.replaceRecursive(!0,...s)}return e}async loadTypes(t){function e(t){return new Promise((e=>setTimeout(e,t)))}for(t=t||"";this._isLoading;)await e(5);const i=this;return new Promise((function(e,s){App.databaseUrl?null===i._types?(i._isLoading=!0,App.fetch(App.databaseUrl+"types.json?sort=sortno&limit=1000&modes=default",(function(n){"success"===n.status?(i._types=i.groupTypes(n.types||{}),i._isLoading=!1,e(o.Z.getValue(i._types,t))):(i._isLoading=!1,s(n))}))):e(o.Z.getValue(i._types,t)):e({})}))}async loadAnnoConfig(t=["links","footnotes"],e=["character"]){return new Promise(((i,s)=>{this.loadTypes().then((s=>{const o={};for(const i of t){const t=s[i]||{};Object.entries(t).forEach((([t,i])=>{let s=i.config?.tag_type||"";if(s="group"===s?"":s,!e.includes(s)){const t=i.config?.group||"";if(t){const e=o[t]||{};e.caption=s?e.caption||t:i.caption,o[t]=e}}}))}const n={};Object.keys(o).sort().forEach((t=>{n[t]=o[t]})),i(n)}))}))}getFieldConfig(t,e,i,s,n){if(!i)return n;let r;return 1===(i=i.split(".")).length?r=o.Z.getValue(t,e+".config.fields."+i[0]):(i=[i[0],i.splice(1,i.length).join(".")],r=o.Z.getValue(t,e+".config.fields."+i[0]+".keys."+i[1])),s?o.Z.getValue(r,s,n):r||n}getTagSet(t,e=!0){let i=this.doc.getFieldData(t);return this.loadTypes().then((t=>{let s=Object.entries({...t.links,...t.footnotes}),n=[];if(i.field&&i.type&&i.table){const e=i.table+"."+i.type+".config.fields."+i.field+".types";n=o.Z.getValue(t,e,[])}return s=s.map((([t,e])=>{e.matched=!1;let i=[e.name,e.scope+"."+e.name,e.category,e.scope+"."+e.category];const s=o.Z.getValue(e,"config.group");s&&(i.push(s),i.push(e.scope+"."+s));for(let t=0;t<i.length;t++)if(e.sortidx=n.indexOf(i[t]),e.sortidx>-1){e.matched=!0;break}return[t,e]})),e&&(s=s.filter((([t,e])=>e.matched))),s=Object.fromEntries(s),s}))}}s()}catch(t){s(t)}}))},979:(t,e,i)=>{"use strict";i.a(t,(async(t,s)=>{try{i.d(e,{U9:()=>h,r7:()=>l,s0:()=>c});var o=i(182),n=i(584),r=i(482),a=t([r]);r=(a.then?(await a)():a)[0];class l extends n.Xt{constructor(t,e,i){super(t,e,i),t&&(t.widgetSwitchButtons=this),document.addEventListener("click",(t=>this.switchClick(t)))}switchClick(t){if(t.target.matches("input, select, a, button")&&!t.target.matches(".widget-switch, .widget-switch-button"))return;const e=t.target.closest(".widget-switch");e&&(this.switchButton(e),t.preventDefault(),t.stopImmediatePropagation())}switchButton(t,e=undefined){if(t){const i=new CustomEvent("epi:toggle:switch:before",{bubbles:!0,cancelable:!0});if(!t.dispatchEvent(i))return;t.classList.toggle("widget-switch-active",e),e=t.classList.contains("widget-switch-active");const s=t.dataset.switchClass,o=t.dataset.switchContent;let n=t.dataset.switchElement;let r;if(r="1"===t.dataset.switchClosest&&n?[t.closest(n)]:document.querySelectorAll(n),s&&r){let i="1"===t.dataset.switchReverse?!e:e;r.forEach((t=>t.classList.toggle(s,"1"===t.dataset.switchReverse?!i:i)))}o&&r&&r.forEach((e=>{t.dataset.switchContent=e.textContent,e.textContent=o}));const a=new Event("epi:toggle:switch",{bubbles:!0,cancelable:!1});t.dispatchEvent(a);const l=t.dataset.uiKey;this.setSetting(l,"active",e)}}setSetting(t,e,i){if(t){let s={};s[e]=i,App.user.session.save("ui",t,s)}}}class c extends n.Xt{constructor(t,e,i){super(t,e,i),t&&(t.widgetToggleButtons=this,this.widgetElement=t),document.addEventListener("click",(t=>this.toggleClick(t)))}toggleClick(t){const e=t.target.closest("[data-toggle-element]");if(e){const i=e.dataset.toggleElement,s=document.getElementById(i);s.classList.toggle("toggle-hide"),e.classList.toggle("active",!s.classList.contains("toggle-hide"));const o=new Event("toggled",{bubbles:!0,cancelable:!1});t.currentTarget.dispatchEvent(o)}}}class d extends n.Xt{constructor(t,e,i){super(t,e,i),this.sandwichButton=this.widgetElement.querySelector("button"),this.sandwichPane=document.getElementById(this.sandwichButton.dataset.toggle),this.sandwichSources=document.querySelectorAll(this.widgetElement.dataset.sandwichSources),this.resizeTimeout=null,this.listenEvent(this.sandwichSources,"epi:replace:content",(t=>this.onReplaced(t))),this.listenEvent(window,"resize",(t=>this.onResize(t))),this.onResize()}onResize(t){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout((()=>{this.sandwichSources.forEach((t=>{this.updateSandwichSource(t)}))}),40)}onReplaced(t){const e=t.target,i=this.sandwichPane.querySelector('ul[data-sandwich-source="'+e.dataset.sandwichSource+'"]');i&&i.remove(),this.listenEvent(t.detail.data.newTarget,"epi:replace:content",(t=>this.onReplaced(t))),this.sandwichSources=document.querySelectorAll(this.widgetElement.dataset.sandwichSources),this.onResize()}updateSandwichSource(t){let e=this.sandwichPane.querySelector('ul[data-sandwich-source="'+t.dataset.sandwichSource+'"]');e||(e=document.createElement("ul"),e.dataset.sandwichSource=t.dataset.sandwichSource,this.sandwichPane.appendChild(e));const i=t.querySelector("ul");let s=t.offsetWidth-0;this.widgetElement.classList.contains("hidden")&&(s-=50);const n=i.lastElementChild,r=i.firstElementChild;if(n&&r&&(s-=n.offsetLeft+n.offsetWidth-r.offsetLeft,n.classList.contains("action-group-last"))){const t=parseFloat(getComputedStyle(n).fontSize);s-=1*t}for(;s>0&&e.childElementCount>0;){const t=e.firstElementChild;let n=[t];if(t.classList.contains("action-group")){const i=o.Z.getClassValue(t,"action-group-");n=[...e.querySelectorAll(":scope > .action-group-"+i)]}n.forEach((t=>{i.appendChild(t),s-=t.offsetWidth+0}))}const a=Array.from(i.children).reverse(),l="in-one-go"==getComputedStyle(t).getPropertyValue("--sandwich");s<0&&a.forEach((t=>{const n=null!=t.querySelector(".sandwich-exclude")||t.matches(".menu_database.first");if((s<0||l)&&!n){let n=[t];if(t.classList.contains("action-group")){const e=o.Z.getClassValue(t,"action-group-");n=[...i.querySelectorAll(":scope > .action-group-"+e)]}n.reverse().forEach((t=>{s+=t.offsetWidth+0,e.prepend(t)}))}})),this.widgetElement.classList.toggle("hidden",!this.sandwichPane.querySelector("li"))}}class u extends n.Xt{constructor(t,e,i){super(t,e,i);let s=t.dataset.shortcuts?t.dataset.shortcuts.split(" "):[];App.shortcuts=App.shortcuts||[],this.shortcuts=s.filter((t=>!App.shortcuts.includes(t))),App.shortcuts.push(...this.shortcuts),this.handledShortcuts=this.shortcuts,this.shortcuts=this.shortcuts.map((t=>t.split("+"))),this.listenEvent(document,"keydown",(t=>this.onKeydown(t)))}clearWidget(){super.clearWidget(),App.shortcuts=App.shortcuts||[],App.shortcuts=App.shortcuts.filter((t=>!this.handledShortcuts.includes(t))),this.handledShortcuts=[]}onKeydown(t){let e=!1;if(t.ctrlKey||t.metaKey||t.altKey||t.keyCode>=112&&t.keyCode<=123){const i=t.key.toUpperCase();this.shortcuts.forEach((s=>{(!t.ctrlKey&&!t.metaKey||s.includes("Ctrl"))&&(t.altKey&&!s.includes("Alt")||s.includes(i)&&(this.widgetElement.classList.contains("hide")||(this.widgetElement.click(),e=!0)))}))}if(e)return t.preventDefault(),t.stopPropagation(),!1}}class h extends n.Xt{constructor(t,e,i){super(t,e,i),this.listenEvent(document,"click",(t=>{if(t.target.matches(".widget-choose button")){const e=o.Z.splitString(t.target.dataset.itemtype),i=t.target.closest(".widget-choose").querySelector('input[type="text"]'),s={title:"Select "+e.join(" or "),value:i.value,height:600,width:600,url:t.target.dataset.url,external:t.target.dataset.external||!1,itemtype:e,selectList:e.includes("folder"),selectItem:!e.includes("folder")||e.length>1,ajaxButtons:"exclusive",buttonSelect:e.includes("folder"),selectOnClick:!e.includes("folder"),onSelect:e=>{let s;i.value=e.dataset.value,e.dataset.listItemof?s=e.closest('[data-list-name="'+e.dataset.listItemof+'"]'):e.dataset.listName&&(s=e),s&&(i.dataset.path=s.dataset.value||i.dataset.path,t.target.dataset.url=s.dataset.url||t.target.dataset.url)}};return new r.Gp(s),!1}})),this.listenEvent(document,"epi:select",(t=>{let e={title:"Select "+t.detail.data.itemtype,height:600,width:600};return e={...e,...t.detail.data},new r.Gp(e),!1}))}}class p extends n.Xt{constructor(t,e,i){super(t,e,i),this.codeblocks=t.querySelectorAll('[data-row-table="docs"] pre code, [data-row-table="help"] pre code'),this.codeblocks.forEach((t=>this.createCopyButton(t)))}createCopyButton(t){const e=o.Z.spawnFromString('<button class="btn-copy"></button>');t.appendChild(e),this.listenEvent(e,"click",(t=>this.copyToClipboard(t)))}async copyToClipboard(t){const e=t.target.closest("code").innerText;await navigator.clipboard.writeText(e)}}class g extends n.Xt{constructor(t,e,i){super(t,e,i),t.dataset.help=t.getAttribute("title"),t.removeAttribute("title")}onClick(t){}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.shortcut=u,window.App.widgetClasses.sandwich=d,window.App.widgetClasses.codeblocks=p,window.App.widgetClasses.tooltip=g,s()}catch(t){s(t)}}))},954:(t,e,i)=>{"use strict";i.a(t,(async(t,e)=>{try{var s=i(182),o=i(649),n=i(584),r=i(482),a=i(968),l=t([o,r,a]);[o,r,a]=l.then?(await l)():l;class c extends n.I{constructor(t,e,i){super(t,e,i),this.doc=i||this,this.rootTable=i?this.doc.rootTable:t.dataset.rootTable,this.rootId=i?this.doc.rootId:t.dataset.rootId,this.widgetElement&&this.listenEvent(this.widgetElement,"epi:load:dropdown",(t=>this.onLoadDropdown(t)))}onClearWidgets(t){t&&this.widgetElement&&t!==this.widgetElement&&t.contains(this.widgetElement)&&this.toolbarContainer&&(this.toolbarContainer.innerHTML=""),super.onClearWidgets(t)}getFieldData(t){return new n.xm(t)}getEntityData(t){return new n.dl(t)}onLoadDropdown(t){if(t.target.closest(".doc-fieldname-links")){let e=this.getFieldData(t.target);this.doc.models.types.loadTypes(e.table).then((i=>{let s=this.doc.models.types.getFieldConfig(i,e.type,e.field,"targets");t.detail.data.pane.replaceChildren(this.getTargetList(s))}))}}}class d extends c{models={};satellites={};constructor(t){super(t,"document",void 0),this.models={},this.dataBindings={},this.editMode="1"===t.dataset.editMode,this.isSaving=!1,this.toolbarContainer=null,this.initModels(),this.initSatellites(),this.initToolbar(),this.listenEvent(document,"focusin",(t=>this.onFocusChanged(t))),this.listenEvent(document,"focusout",(t=>this.onFocusChanged(t))),this.listenEvent(document,"epi:focus:entity",(t=>this.onFocusEntity(t))),this.listenEvent(document,"click",(t=>this.onDetachClick(t)),".button-section-detach, button.doc-item-more")}initModels(){this.models.types=new a.Y1(this),this.models.projects=new a.TS(this),this.models.articles=new a.PH(this),this.models.sections=new a.dt(this),this.models.items=new a.Ju(this),this.models.properties=new a.g9(this),this.models.files=new a.EY(this),this.models.annotations=new a.iW(this),this.models.links=new a.KM(this),this.models.footnotes=new a.Eh(this),this.models.tags=new a.Vg(this),this.listenBindings()}initSatellites(){const t=document.querySelector('.doc-article-footnotes[data-root-table="'+this.rootTable+'"][data-root-id="'+this.rootId+'"]');t&&new m(this,t,"footnotes");const e=document.querySelector('.doc-article-notes[data-root-table="'+this.rootTable+'"][data-root-id="'+this.rootId+'"]');e&&new m(this,e,"notes")}initToolbar(t=!1){if(!this.toolbarContainer){const t=this.widgetElement.closest(".sidebar, .content, .widget-tabsheets-sheet");if(t){this.toolbarContainer=t.querySelector(".content-toolbar");const e=t.querySelector(".content-header, .sidebar-title, .frame-title");!this.toolbarContainer&&e&&(this.toolbarContainer=document.createElement("div"),this.toolbarContainer.classList.add("content-toolbar"),e.after(this.toolbarContainer))}}t&&this.toolbarContainer&&(this.toolbarContainer.classList.add("empty"),this.toolbarContainer.classList.add("active"))}getFieldData(t){const e=super.getFieldData(t);return e.table&&this.models[e.table]&&(e.model=this.models[e.table]),e}getSectionWidget(t){let e=this.getWidget(t,"section",!1);return e||(e=new u(t,"section",this)),e}getItemWidget(t){let e=this.getWidget(t,"item",!1);return e||(e=new h(t,"item",this)),e}focusEditor(){const t=this.toolbarContainer&&this.toolbarContainer.classList.contains("active");if(this.editMode&&t){let t=[...this.widgetElement.querySelectorAll(".widget-xmleditor")].filter((t=>!(0===t.clientHeight||0===t.clientWidth))),e=t.length>0?this.getWidget(t[0],"xmleditor",!1):null;e&&e.activateEditor(!1)}}attachToolbar(t){this.toolbarContainer&&(this.toolbarContainer.innerHTML="",this.toolbarContainer.appendChild(t),this.toolbarContainer.classList.add("active"),this.toolbarContainer.classList.remove("empty"))}onFocusChanged(t){const e=t.target.closest(".doc-section");if(e&&"focusout"===t.type&&(e.dataset.dirty="true"),e&&"focusin"===t.type){this.getSectionWidget(e).setFocus("focusout"!==t.type)}}onFocusEntity(t){t.detail.data.id===this.getEntityId()&&this.focusWidget()}onDetachClick(t){if(!this.ownedByDocument(t.target))return;let e,i,s;t.target.matches(".button-section-detach")?(i=t.target.closest(".doc-section"),s=this.getSectionWidget(i),e=document.querySelector("#"+t.target.dataset.target)):t.target.matches("button.doc-item-more")&&(i=t.target.closest(".doc-section-item"),s=this.getItemWidget(i),e=i);let o=t.target.closest(".widget-content-pane-main")?"tab":"popup";return e&&s&&s.detach(e,o),t.preventDefault(),!1}listenBindings(){this.models&&this.models.types&&this.getFieldData&&(this.dataBindings={},this.models.types.loadTypes().then((t=>{this.widgetElement.querySelectorAll("input[data-autofill]").forEach((e=>{let i=this.getFieldData(e);const s=this.doc.models.types.getFieldConfig(t[i.table],i.type,i.field,"autofill");if(s&&s.source){let t=s.source.split(".");t=t.length<2?[i.table+"["+i.type+"]",t[0]]:t,t=t.join("."),this.dataBindings.hasOwnProperty(t)||(this.dataBindings[t]=[]),this.dataBindings[t].push({targetElement:e,config:s})}}))})),this.listenEvent(document,"input",(t=>this.onInput(t))))}onInput(t){const e=t.target;if(!this.ownedByDocument(e))return;this.widgetElement.classList.contains("widget-entity")&&this.emitEvent("epi:change:entity",{source:e}),e.dataset.autofill&&delete e.dataset.autofill,e.dataset.dirty=!0,this.autofillSource(e)}autofillSource(t){const e=this.getFieldData(t);if(t.bindProperty||(t.bindProperty=e.table+"["+e.type+"]."+e.field),1!==e.rowNumber)return;const i=this.dataBindings[t.bindProperty];i&&i.forEach((e=>{this.autofillValue(e.targetElement,t,e.config)}))}autofillValue(t,e,i){if(!e||!t)return;if("1"!==t.dataset.autofill)return;let o=e.value;const n=i.pathSeparator||" › ";if(i.process&&Array.isArray(i.process))for(var r=0;r<i.process.length;r++){let t=i.process[r],a="object"==typeof t?t:{};if(t=a.method||t,"path"===t){const t=e.closest(".doc-section").querySelector("input[name=parent_id-text]");t&&""!==t.value&&(o=t.value+n+o)}else"number"===t?(o=o.toLowerCase().trim(),o=s.Z.extractNumber(o)):"sortkey"===t?(o=o.toLowerCase().trim(),o=s.Z.prefixNumbersWithZero(o,a?.width??5),o=s.Z.collapseWhitespace(o)):"irifragment"===t&&(o=o.toLowerCase().trim(),o=s.Z.replaceUmlauts(o),o=s.Z.removeSpecialCharacters(o),o=s.Z.collapseWhitespace(o),o=s.Z.replaceSpacesWithHyphens(o))}t.value=o,this.autofillSource(t)}ownedByDocument(t){if(!t)return!1;if(this.widgetElement&&this.widgetElement.contains(t))return!0;for(let e in this.satellites)if(this.satellites[e].widgetElement&&this.satellites[e].widgetElement.contains(t))return!0;return!1}findInDocument(t){if(!t)return;let e=this.widgetElement.querySelector(t);if(!e)for(let e in this.satellites)if(this.satellites[e].widgetElement){let i=this.satellites[e].widgetElement.querySelector(t);if(i)return i}return e}getTree(t){return this.models.articles.getTree(t)}getTargetList(t,e){const i='<li class="node item item-nochildren{selected} item-level-0" data-list-itemof="targets" data-value="{table}-{id}" data-search-text="{searchText}" data-label="{labelText}"> <div class="tree-content">  <label class="text" title="{labelPath}" data-label="{labelText}">{labelPath}</label> </div></li>';let o=this.getTree(t);const n=e?e.tab+"-"+e.id:void 0;return o=o.map((t=>(n&&t.table+"-"+t.id===n?t.selected=" row-selected selected":t.selected="",i.formatUnicorn(t)))).join(""),s.Z.spawnFromString('<ul class="widget-tree widget-tree-fixed" data-list-name="targets">'+o+"</ul>")}view(t,e){if(s.Z.isString(t)){const i=t.split("-");e=i[0],t=i[1]}if("articles"===e){const e=App.databaseUrl+"articles/view/"+t;App.openDetails(e,{title:"Article",ajaxButtons:["submit"],external:!0})}}}class u extends n.lf{constructor(t,e,i){super(t,e,i),this.isDetached=!1,this.popup=void 0}initWidget(t){}detach(t,e="popup"){if(this.isDetached)return void(this.popup&&this.popup.closeWindow());this.isDetached=!0;const i=this.widgetElement.querySelector(".doc-section-head");App.switchbuttons&&App.switchbuttons.switchButton(i,!0),i.classList.toggle("widget-switch",!1);const n=this.widgetElement.querySelector(".doc-section-head .button-section-content");if(s.Z.hide(n),new m(this.modelParent,t,this.widgetElement.id),"tab"===e){const e=App.findWidget(App.sidebarright.widgetElement,"tabsheets");if(!e)return;this.popup=new r.dF(t,e,{title:this.modelParent.models.sections.getTitle(this.widgetElement),onClose:e=>this.onRetach(t),dialogButtons:{close:{text:o.a.t("Apply"),handler:t=>e.removeTab("more")}}})}else this.popup=new r.R4(t,{title:this.modelParent.models.sections.getTitle(this.widgetElement),collapsable:!0,onClose:()=>this.onRetach(t)})}onRetach(t){if(!this.isDetached)return;this.isDetached=!1;this.widgetElement.querySelector(".doc-section-head").classList.toggle("widget-switch",!0);const e=this.widgetElement.querySelector(".doc-section-head .button-section-content");s.Z.show(e),delete this.modelParent.satellites[this.widgetElement.id],this.popup=void 0}}class h extends n.lf{constructor(t,e,i){super(t,e,i),this.isDetached=!1,this.doc=i,this.popup,this.wrapper,this.satellite}initWidget(t){}detach(t,e="popup"){if(this.isDetached)this.popup&&this.popup.closeWindow();else if(this.isDetached=!0,this.satellite=new m(this.doc,t,this.widgetElement.id),"tab"===e){const e=App.findWidget(App.sidebarright.widgetElement,"tabsheets");if(!e)return;this.popup=new r.dF(t,e,{title:s.Z.getElementText(t.querySelector(".doc-field-itemtype"),"Item"),onLoad:e=>this.onLoad(e,t),onClose:e=>this.onRetach(e,t),dialogButtons:{close:{text:this.editMode?o.a.t("Apply"):o.a.t("Close"),handler:t=>e.removeTab("more")}}})}else this.popup=new r.R4(t,{title:s.Z.getElementText(t.querySelector(".doc-field-itemtype"),"Item"),collapsable:!0,onLoad:e=>this.onLoad(e,t),onClose:e=>this.onRetach(e,t)})}onLoad(t,e){this.wrapper=s.Z.spawnFromString('<div class="doc-section-content frame-detached"></div>'),this.wrapper.classList.toggle("widget-document-edit",this.doc.editMode),e.parentElement.appendChild(this.wrapper);const i=s.Z.spawnFromString('<div class="doc-section-stack"></div>');if(this.wrapper.appendChild(i),i.appendChild(e),this.doc.models.annotations){const i=this.doc.models.annotations._getAnnoContainer(t.placeholder);if(i){const t=document.createElement("div");t.className=i.className,this.wrapper.appendChild(t);let s=i.querySelector("button.button-links-toggle");s&&t.appendChild(s.cloneNode(!0)),i.querySelectorAll('.doc-section-link[data-from-tab="'+e.dataset.rowTable+'"][data-from-id="'+e.dataset.rowId+'"]').forEach((e=>t.appendChild(e))),t.classList.toggle("doc-section-links-hidden",!s.classList.contains("widget-switch-active")),t.classList.toggle("doc-section-links-empty",!t.querySelector(".doc-section-link"))}}const o=this.doc.getEntityData(e);t.placeholder.classList.add("doc-section-item"),e.classList.contains("doc-section-item-first")&&t.placeholder.classList.add("doc-section-item-first"),this.doc.models.types.loadTypes(o.table).then((i=>{e.querySelectorAll(".doc-field").forEach((e=>{const n=s.Z.getRenderedText(e),r=s.Z.spawnFromString(`<div>${n}</div>`);r.className=e.className,t.placeholder.appendChild(r);let a=e.querySelector(".doc-field-content");a||(a=s.Z.spawnFromString('<div class="doc-field-content"></div>'),a.replaceChildren(...e.children),e.appendChild(a));const l=this.doc.models.types.getFieldConfig(i,o.type,e.dataset.rowField,"caption"),c=s.Z.spawnFromString(`<span class="doc-field-caption">${l}</span>`);a.parentElement.insertBefore(c,a)}))}))}onRetach(t,e){if(!this.isDetached)return;this.isDetached=!1,e.querySelectorAll(".doc-field").forEach((t=>{t.querySelector(".doc-field-caption").remove()}));const i=this.doc.models.annotations._getAnnoContainer(e);i&&(this.wrapper.querySelectorAll(".doc-section-link").forEach((t=>i.appendChild(t))),i.classList.toggle("doc-section-links-empty",!i.querySelector(".doc-section-link"))),this.satellite.clear(),delete this.modelParent.satellites[this.widgetElement.id],this.popup=void 0}}class p extends n.lf{constructor(t,e,i){super(t,e,i),this.widgetElement=t,this.target=document.getElementById(this.widgetElement.dataset.target),this.listenEvent(this.widgetElement,"click",(t=>this.clickLabel(t))),this.pane=null;const s=this.getSection();s&&this.listenEvent(s,"epi:toggle:switch",(t=>this.containerToggled(t)))}initWidget(){if(this.pane)return;const t=this.getDocumentWidget();t&&t.models.types.loadAnnoConfig().then((t=>{const e=this.getSetting("annos",{}),i=Object.values(e),o=0===i.length||i.every((t=>s.Z.isTrue(t)));this.pane=this.buildPane(t,!!o||e,this.widgetElement.id),this.widgetElement.appendChild(this.pane),this.updateAnnos(e,o),this.updateButton(!o)}))}buildPane(t,e,i){const o=document.createElement("ul");for(const n in t){if(!n)continue;const r=t[n],a=document.createElement("li"),l=!0===e||s.Z.isTrue(e[n],!1),c=document.createElement("span");c.className=`anno-selector-group anno-selector-group-${s.Z.cleanId(n)}`;const d=document.createElement("input");d.type="checkbox",d.name=n,d.value="1",d.id=`${i}_${s.Z.cleanId(n)}`,l&&(d.checked=!0);const u=document.createElement("label");u.setAttribute("for",d.id),u.appendChild(d),u.appendChild(c);const h=r.caption||n;u.appendChild(document.createTextNode(h)),a.appendChild(u),o.appendChild(a)}return o}getSection(){const t=document.querySelector('[data-toggle="'+this.widgetElement.id+'"]');if(t)return t.closest(".doc-section, .doc-section-note")}containerToggled(t){if(!t)return;const e=document.querySelector('[data-toggle="'+this.widgetElement.id+'"]');if(!e)return;if(!e.closest(".doc-section-content.toggle-hide, .doc-section-links-hidden"))return;const i=this.getWidget(e,"dropdown",!1);i&&i.closeDropdown(t)}clickLabel(t){t.currentTarget.classList.contains("active")&&t.target.closest("li")&&this.switchGroups()}switchGroups(){const[t,e]=s.Z.evalCheckboxes(this.widgetElement);this.setSetting("annos",t),this.updateAnnos(t,e),this.updateButton(!e)}async updateAnnos(t,e){const i=this.target.closest(".doc-section");if(!i)return;for(const[o,n]of Object.entries(t))i.classList.toggle("xml_group_"+o+"_unadorned",!(s.Z.isTrue(n)||e));const o=this.getDocumentWidget();o&&o.models.annotations.updatePositions(this.target)}updateButton(t){if(!this.widgetElement.classList.contains("widget-dropdown-pane"))return;const e="[data-toggle="+this.widgetElement.id+"]";let i=document.querySelector(e);i&&(t?i.classList.add("used"):i.classList.remove("used"))}}class g extends n.Xt{constructor(t,e,i){super(t,e,i),this.listenEvent(document,"epi:focus:widgets",(t=>this.onFocusWidgets(t))),this.listenEvent(document,"input",(t=>this.onInput(t)))}onInput(t){const e=t.target;this.widgetElement.contains(e)&&(this.clearGroups(),this.highlightGroup(t.target))}onFocusWidgets(t){this.clearGroups(),t.detail.data.focus&&!t.detail.data.sender!==this.widgetElement&&this.highlightGroup(t.target)}clearGroups(){document.querySelectorAll(".doc-section-item-highlight").forEach((t=>t.classList.remove("doc-section-item-highlight")))}highlightGroup(t){const e=t.closest(".doc-section-item");if(!e)return;const i=e.querySelector(".doc-fieldname-itemgroup input");if(!i)return;const o=s.Z.getInputValue(i);if(""===o)return;const n=e.closest(".doc-section");n&&n.querySelectorAll(".doc-section-item").forEach((t=>{const e=t.querySelector(".doc-fieldname-itemgroup input");e&&s.Z.getInputValue(e)===o&&t.classList.add("doc-section-item-highlight")}))}}class m extends c{constructor(t,e,i){super(e,i,t),this.satelliteName=i,this.modelParent.satellites[i]=this;const s=this.getEntityData(e);e.dataset.rootTable=e.dataset.rootTable||s.rootTable,e.dataset.rootId=e.dataset.rootId||s.rootId,e.dataset.containerTable=e.dataset.containerTable||s.table,e.dataset.containerId=e.dataset.containerId||s.id,e.classList.toggle("widget-document-edit",t.editMode),this.initForm()}clear(){this.widgetElement.classList.remove("widget-document-edit")}initForm(){const t=this.modelParent.widgetElement.querySelector("form");if(t){const e=t.getAttribute("id");this.widgetElement.querySelectorAll("input, textarea, button, select").forEach((t=>t.setAttribute("form",e)))}}getTargetList(t,e){return this.modelParent.getTargetList(t,e)}view(){App.activateTabsheet(this.satelliteName)}}class f extends n.I{constructor(t,e,i){super(t,e,i)}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.document=d,window.App.widgetClasses.entity=f,window.App.widgetClasses.fieldgroup=g,window.App.widgetClasses["anno-selector"]=p,e()}catch(t){e(t)}}))},934:(t,e,i)=>{"use strict";var s=i(584),o=i(182);class n extends s.Xt{constructor(t,e,i){super(t,e,i),this.dropZone=this.widgetElement.querySelector(".doc-section-grid-table"),this.draggedItem=null,this.dragOrigin=null,this.lastDragoverTarget=null,this.mouseCoords={x:null,y:null},this.listenEvent(this.dropZone,"dragstart",(t=>this.onDragStart(t))),this.listenEvent(document,"dragover",(t=>this.onDragOver(t))),this.listenEvent(document,"drop",(t=>this.onDrop(t)))}onDragStart(t){this.draggedItem=t.target.closest('[draggable="true"]'),this.draggedItem.position=Array.from(this.draggedItem.parentElement.querySelectorAll(".doc-section-item:not(.doc-section-item-empty)")).findIndex((t=>t===this.draggedItem)),this.dragOrigin=t.target.parentElement}onDragOver(t){if(t.preventDefault(),!t.target.closest(".doc-section-grid-table td"))return t.dataTransfer.effectAllowed="none",void this.dropZone.querySelector(".doc-section-item-empty")?.remove();t.dataTransfer.effectAllowed="move";const e=t.target.closest("td");if(this.draggedItem?.remove(),t.target.closest(".doc-section-item-empty"))return;this.lastDragoverTarget&&e!==this.lastDragoverTarget&&this.dropZone.querySelector(".doc-section-item-empty")?.remove();const i=e.querySelector(".doc-section-item-group");if(0===i.querySelectorAll(".doc-section-item:not(.doc-section-item-empty)").length){if(i.querySelector(".doc-section-item-empty"))return;{const t=o.Z.spawnFromString('<div class="doc-section-item doc-section-item-empty"></div>');i.prepend(t)}}else if(t.target.closest(".doc-section-item:not(.doc-section-item-empty)")&&this.mouseCoords.x!==t.clientX&&this.mouseCoords.y!==t.clientY){this.mouseCoords.x=t.clientX,this.mouseCoords.y=t.clientY;const s=this.findPositionToInsert(t,e);this.dropZone.querySelector(".doc-section-item-empty")?.remove();const n=o.Z.spawnFromString('<div class="doc-section-item doc-section-item-empty"></div>');i.insertBefore(n,i.children[s])}this.lastDragoverTarget=e}onDrop(t){t.preventDefault(),t.target.closest(".doc-section-grid-table")&&this.dropZone.querySelector(".doc-section-item-empty")?this.dropItem(t):this.cancelDrop(t),this.draggedItem=null,this.lastDragoverTarget=null}dropItem(t){this.dropZone.querySelector(".doc-section-item-empty").replaceWith(this.draggedItem),o.Z.emitEvent(this.draggedItem,"epi:drop:item",{dragOrigin:this.dragOrigin,dragTarget:this.draggedItem.parentElement}),t.stopPropagation()}cancelDrop(t){this.dragOrigin.insertBefore(this.draggedItem,this.dragOrigin.children[this.draggedItem.position]),t.stopPropagation()}findPositionToInsert(t,e){const i=[...e.querySelectorAll(".doc-section-item")],s=t.target.closest(".doc-section-item"),o=s.getBoundingClientRect(),n=o.left+o.width/2,r=i.findIndex((t=>t===s));return t.clientX<n?r:r+1}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.dragdrop=n},6:(t,e,i)=>{"use strict";i.a(t,(async(t,e)=>{try{var s=i(584),o=i(182),n=i(482),r=t([n]);n=(r.then?(await r)():r)[0];class a extends s.Xt{constructor(t,e,i){super(t,e,i),t.widgetDropdownSelector=this,this.input_id,this.pane,this.pane_id}isOpen(){return this.widgetElement.classList.contains("active")}positionDropdown(t=!0){if(!this.widgetElement||!this.pane||this.pane.classList.contains("widget-dropdown-pane-frame"))return;let e=this.widgetElement.dataset.paneAlignTo;e=e?this.widgetElement.closest(e):void 0,e=e||this.widgetElement;let i=e.getBoundingClientRect(),s=this.widgetElement.dataset.paneAlignToY;if(s=s?this.widgetElement.closest(s):void 0,s){const t=s.getBoundingClientRect();i=new DOMRect(i.left,t.top,i.width,t.height)}let o,n,r=this.pane.scrollWidth+[...this.pane.querySelectorAll(".tree-content label")].reduce(((t,e)=>Math.max(t,e.scrollWidth-e.parentElement.clientWidth)),0);r=Math.max(r,i.width);const a=this.getFrame(!1);a&&a!==document?(o=a.getBoundingClientRect().width,n=this.widgetElement.getBoundingClientRect().left-a.getBoundingClientRect().left):(o=window.innerWidth,n=i.left);const l=Math.min(o-n,600),c=window.innerHeight-i.bottom-50;if(this.pane.style.maxHeight=c+"px",this.pane.offsetHeight>c&&(this.pane.style.height=c+"px"),this.pane.classList.contains("widget-dropdown-pane-moved")){let t=this.pane.dataset.widgetDropdownPosition||"bottomleft";"right"!==t&&"left"!==t||(t+="top"),"bottom"!==t&&"top"!==t||(t+="left");let e="";e=t.startsWith("bottom")||t.endsWith("top")?"down":"up";let s=0,o=0,n=0,a=0;o=t.startsWith("right")?window.innerWidth-i.right:window.innerWidth-i.left,s=t.startsWith("left")?i.left:i.right,n=t.startsWith("top")?i.top:i.bottom,a=t.startsWith("bottom")?window.innerHeight-i.bottom:window.innerHeight-i.top;let l="";o<r&&(l="left",t.startsWith("bottom")||t.startsWith("top")?t=t.replace("left","right"):t.startsWith("right")&&(t=t.replace("right","left"))),s<r&&("left"===l?t="down"===e?"bottomfull":"topfull":t.startsWith("bottom")||t.startsWith("top")?t=t.replace("right","left"):t.startsWith("left")&&(t=t.replace("left","right"))),a<250&&(t.startsWith("right")||t.startsWith("left")?t=t.replace("top","bottom"):t.startsWith("bottom")&&(t=t.replace("bottom","top"))),n<250&&(t.startsWith("right")||t.startsWith("left")?t=t.replace("bottom","top"):t.startsWith("top")&&(t=t.replace("top","bottom"))),"lefttop"===t?(this.pane.style.left=i.left-r+"px",this.pane.style.width=r+"px",this.pane.style.top=i.top+"px"):"righttop"===t?(this.pane.style.left=i.right+"px",this.pane.style.width=r+"px",this.pane.style.top=i.top+"px"):"bottomright"===t?(this.pane.style.left=i.right-r+"px",this.pane.style.width=r+"px",this.pane.style.top=i.bottom+1+"px"):"topright"===t?(this.pane.style.left=i.right-r+"px",this.pane.style.width=r+"px",this.pane.style.top=i.top-1-this.pane.clientHeight+"px"):"topleft"===t?(this.pane.style.left=i.left+"px",this.pane.style.width=r+"px",this.pane.style.top=i.top-1-this.pane.clientHeight+"px"):"topfull"===t?(this.pane.style.left="0px",this.pane.style.width="100%",this.pane.style.top=i.top-1-this.pane.clientHeight+"px"):"bottomfull"===t?(this.pane.style.left="0px",this.pane.style.width="100%",this.pane.style.maxWidth="100%",this.pane.style.top=i.bottom+1+"px"):"full"===t?(this.pane.style.left="0px",this.pane.style.width="100%",this.pane.style.maxWidth="100%",this.pane.style.top="0px"):(this.pane.style.left=i.left+"px",this.pane.style.width=r+"px",this.pane.style.top=i.bottom+1+"px")}else{const t=100;this.pane.style.width=Math.min(Math.max(t,r),l)+"px"}t&&this.positionDropdown(!1)}}class l extends a{constructor(t,e,i){if(super(t,e,i),this.widgetElement.classList.contains("widget-dropdown-toggle")?this.toggle=this.widgetElement:this.toggle=this.widgetElement.querySelector(".widget-dropdown-toggle"),!this.toggle)return;this.toggle.widgetDropdown=this,this.detachPane(),this.listenEvent(this.toggle,"click",(t=>this.toggleDropdown(t))),this.listenEvent(document,"click",(t=>this.outsideDropdown(t))),this.listenEvent(window,"resize",(t=>this.positionDropdown()));const s=this.widgetElement.closest(".widget-scrollsync-content");s&&this.listenEvent(s,"scroll",(t=>this.positionDropdown()))}detachPane(){const t=document.querySelector("#"+this.toggle.dataset.toggle+".widget-dropdown-pane-moved");t&&t.remove();const e="#"+this.toggle.dataset.toggle;if(this.pane=document.querySelector(e),this.pane){const t=this.widgetElement.closest("[data-root-table]"),e=this.widgetElement.closest("[data-root-id]");this.pane.dataset.rootTable=t?t.dataset.rootTable:"",this.pane.dataset.rootId=e?e.dataset.rootId:"",document.querySelector("body").append(this.pane),this.pane.classList.add("widget-dropdown-pane-moved");const i=this.getFrame(!1);i&&this.listenEvent(i,"epi:clear:widgets",(t=>this.closeDropdown(t))),App.initWidgets(this.pane)}this.positionDropdown()}toggleDropdown(t){this.widgetElement.classList.contains("active")?this.closeDropdown(t):this.openDropdown(t)}outsideDropdown(t){return!!this.widgetElement.contains(t.target)||(!(!this.pane||!this.pane.contains(t.target))||void this.closeDropdown(t))}closeDropdown(t){this.widgetElement.classList.remove("active"),this.pane&&this.pane.classList.remove("active"),this.toggle&&this.toggle.classList.remove("active")}openDropdown(t){this.widgetElement.classList.add("active"),this.pane.classList.add("active"),this.toggle.classList.add("active"),window.matchMedia("screen and (max-width: 767.98px)").matches?this.openDropDownInOverlay():this.positionDropdown();const e=this.pane.querySelector('input[type="text"]');e&&!e.readOnly&&e.select&&e.select()}openDropDownInOverlay(){const t=this.widgetElement.parentElement.querySelector(".widget-dropdown-pane-header");let e=null;t&&(e=t.textContent),this.pane.style.cssText="";const i=new n.aV(this.pane);i.build(e),this.listenEvent(document,"epi:close:overlay",(t=>{t.detail.data.paneId===this.pane.id&&this.closeDropdown(t)})),i.show()}}class c extends a{constructor(t,e,i){super(t,e,i),this.input_id=null,this.pane=null,this.pane_id=null,this.valueAttribute="value",this.url=null,this.inputTimeout=200,this.input_id=this.widgetElement.querySelector('input[type="hidden"]'),this.input_label=o.Z.querySelectorAndSelf(this.widgetElement,'input[type="text"],input[type="button"]'),this.input_toggle=o.Z.querySelectorAndSelf(this.widgetElement,'input[type="text"],input[type="button"],button'),this.detachPane(),this.url=this.widgetElement.dataset.url,this.param=this.widgetElement.dataset.urlParam||"term",this.pane&&(this.valueAttribute=this.pane.dataset.listValue||this.valueAttribute),this.input_label&&(this.input_label.dataset.oldvalue=this.input_label.value),this.input_toggle&&(this.input_toggle.addEventListener("input",(t=>this.onInputChanged(t))),this.input_toggle.addEventListener("keydown",(t=>this.onKeyDown(t))),this.input_toggle.addEventListener("click",(t=>this.onLabelClick(t)))),this.listenEvent(document,"click",(t=>this.onDocumentClick(t))),this.listenEvent(window,"resize",(t=>this.positionDropdown())),this.listenEvent(this.widgetElement,"epi:load:content",(t=>this.positionDropdown())),this.listenEvent(this.pane,"epi:load:content",(t=>this.positionDropdown()))}updateWidget(){}detachPane(){if(this.pane_id=this.widgetElement.dataset.paneId,this.pane=this.widgetElement.querySelector(".widget-dropdown-pane"),this.pane_id||this.pane||(this.pane=o.Z.spawnFromString('<div class="widget-dropdown-pane widget-dropdown-pane-moved"><div data-snippet="widget-dropdown-pane"></div></div>'),document.querySelector("body").append(this.pane)),this.pane_id){const t="#"+this.pane_id,e=document.querySelector(t+".widget-dropdown-pane-moved");e&&e.remove(),this.pane=document.querySelector(t)}if(this.pane&&this.pane_id)if(this.pane.classList.contains("widget-dropdown-pane-frame"))this.openDropdown();else{document.querySelector("body").append(this.pane),this.pane.classList.add("widget-dropdown-pane-moved");const t=this.getFrame(!1);t&&this.listenEvent(t,"epi:clear:widgets",(t=>this.closeDropdown(t)))}}onDocumentClick(t){if(this.widgetElement&&this.pane)if(this.widgetElement.contains(t.target)||this.pane.contains(t.target))if(t.target.closest('[data-role="manage"]'))this.resetValue();else if(t.target.closest(".selector-reset"))this.resetSelection();else{if(t.target.closest(".tree-indent"))return;{const e=t.target.closest("[data-"+this.valueAttribute+"]");e&&(t.target.querySelector("input[type=checkbox]")||(this.selectValue(e),t.stopPropagation()))}}else this.resetValue()}onLabelClick(t){o.Z.querySelectorSelfAndContainer(t.currentTarget,".widget-dropdown-selector")&&(this.pane.classList.contains("widget-dropdown-pane-frame")||(this.isOpen()?this.resetValue():this.openDropdown()))}onInputChanged(t){this.input_label.classList.add("dirty");const e=this.input_label.value;this.url?(clearTimeout(this.inputTimeout),this.inputTimeout=setTimeout((()=>this.loadResults(e)),200)):this.loadResults(e)}onKeyDown(t){const e=t.keyCode;if(40!==e&&38!==e&&13!==e&&27!==e)return;if(27===e)return void this.resetValue();if(!this.isOpen())return this.openDropdown(),!1;let i=this.pane.querySelector(".selected");if(i&&i.classList.remove("selected"),40===e){if(i=i?this.nextItem(i):this.firstItem(),!i)return!1;o.Z.scrollIntoViewIfNeeded(i,this.pane,!1,"y")}else if(38===e){if(i=i?this.prevItem(i):this.firstItem(),!i)return!1;o.Z.scrollIntoViewIfNeeded(i,this.pane,!1,"y")}else if(13===e)return i?this.selectValue(i,!0):this.clearValue(),t.preventDefault(),!1;i&&i.classList.add("selected")}openDropdown(){this.isOpen()||(this.input_label&&!this.input_label.readOnly&&this.input_label.select&&this.input_label.select(),this.pane.classList.add("active"),this.widgetElement.classList.add("active"),this.positionDropdown(),this.loadResults())}closeDropdown(){if(this.isOpen()){if(this.pane.classList.contains("widget-dropdown-pane-frame"))return!1;this.widgetElement.classList.remove("active"),this.pane.classList.remove("active")}}loadResults(t=""){if(this.openDropdown(),this.url){clearTimeout(this.inputTimeout),this.widgetElement.classList.add("active");let e=new URL(this.url,App.baseUrl);""!==t?e.searchParams.set(this.param,t):e.searchParams.set("seek",this.getValue()),e=e.toString(),App.loadDataSnippets(e,this.pane)}else{this.emitEvent("epi:load:dropdown",{term:t,pane:this.pane},!0);this.pane.querySelectorAll("[data-"+this.valueAttribute+"]").forEach((e=>{const i=e.querySelector("input:checked"),s=e.dataset.searchText||e.textContent,o=""===t||s.toLowerCase().indexOf(t.toLowerCase())>-1;e.classList.toggle("list-item-hide",!o&&!i)}));this.pane.querySelectorAll(".item-nochildren[data-"+this.valueAttribute+"]").forEach((e=>{const i=e.dataset.searchText||e.textContent,s=""===t||i.toLowerCase().indexOf(t.toLowerCase())>-1;e.classList.toggle("item-hidden",!s)}));this.pane.querySelectorAll(".selector-actionlist").forEach((t=>{const e=0===t.querySelectorAll("[data-"+this.valueAttribute+"]:not(.list-item-hide)").length;t.classList.toggle("list-item-hide",e);const i=o.Z.getPrevSibling(t,".selector-grouplabel");i&&i.classList.toggle("list-item-hide",e)}))}}getCheckedInputs(){return this.pane?Array.from(this.pane.querySelectorAll("input:checked")):[]}getNodeLabel(t){if(!t)return"";const e=this.getWidget(t,"tree");return e?e.treeGetPath(t):t.dataset.label||t.textContent.trim()}firstItem(){return this.pane.querySelector("[data-"+this.valueAttribute+"]:not(.list-item-hide)")}nextItem(t){const e="[data-"+this.valueAttribute+"]:not(.list-item-hide)";let i=o.Z.getNextSibling(t,e);if(!i&&t){let s=o.Z.getNextSibling(t.closest("ul"),"ul");for(;s&&!i;)i=s.querySelector(e),s=o.Z.getNextSibling(s,"ul")}return i}prevItem(t){const e="[data-"+this.valueAttribute+"]";let i=o.Z.getPrevSibling(t,e+":not(.list-item-hide)");if(!i&&t){let s=o.Z.getPrevSibling(t.closest("ul"),"ul");for(;s&&!i;)i=o.Z.querySelectorLast(s,e),s=o.Z.getPrevSibling(s,"ul")}return i}resetSelection(){this.getCheckedInputs().forEach((t=>{t.checked=!1})),this.clearValue()}selectValue(t,e=!1){if(!t)return;let i,s;const o=t.dataset.append||!1;if(this.pane.classList.contains("widget-checkboxlist")){const o=t.querySelector("input[type=checkbox]");o&&e&&(o.checked=!o.checked);const n=this.getCheckedInputs();if(i=n.map((t=>t.closest("[data-"+this.valueAttribute+"]").dataset[this.valueAttribute])).join(","),0===n.length)s="";else if(1===n.length){const t=n[0].closest("[data-"+this.valueAttribute+"]");s=this.getNodeLabel(t)}else s=n.length+" "+(this.input_label.dataset.label||"")}else i=t.dataset[this.valueAttribute],s=this.getNodeLabel(t);this.input_id&&(this.input_id.value=i,this.input_id.dataset.append=o,this.input_id.dataset.type=t.dataset.type),this.input_label&&(this.input_label.value=s,this.input_label.setAttribute("title",s),this.input_label.dataset.oldvalue=s,this.input_label.classList.remove("dirty"),this.input_label.classList.toggle("append",o)),this.emitEvent("changed",{id:i,label:s}),this.pane.classList.contains("widget-checkboxlist")||this.closeDropdown()}clearValue(){this.input_id.value="",this.input_label.value="",this.input_label.dataset.oldvalue="",this.input_label.classList.remove("dirty");const t=new Event("changed",{bubbles:!0,cancelable:!1});this.widgetElement.dispatchEvent(t),this.pane.classList.contains("widget-checkboxlist")||this.closeDropdown()}resetValue(){this.isOpen()&&(this.input_label&&(this.input_label.value=this.input_label.dataset.oldvalue,this.input_label.classList.remove("dirty")),this.closeDropdown())}getValue(){return this.input_id?this.input_id.value:void 0}}class d extends s.Xt{constructor(t,e,i){super(t,e,i),this.listenEvent(t,"change",(t=>this.updateForm(t)))}updateForm(t){const e=t.target.dataset.formUpdate;if(!e)return;const i=t.target.closest("form");if(!i)return;let s=new URL(i.getAttribute("action"),App.baseUrl);const n=o.Z.getInputValue(t.target);s.searchParams.set(e,n),s=s.toString(),this.disableForm();const r=!this.isInFrame();return App.loadDataSnippets(s,this.widgetElement,r,!0),!1}disableForm(){this.widgetElement.querySelectorAll("input, textarea, button, select").forEach((t=>t.setAttribute("disabled","disabled")))}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.formupdate=d,window.App.widgetClasses.dropdown=l,window.App.widgetClasses["dropdown-selector"]=c,e()}catch(t){e(t)}}))},370:t=>{var e;self,e=function(){return function(){var t={3099:function(t){t.exports=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}},6077:function(t,e,i){var s=i(111);t.exports=function(t){if(!s(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t}},1223:function(t,e,i){var s=i(5112),o=i(30),n=i(3070),r=s("unscopables"),a=Array.prototype;null==a[r]&&n.f(a,r,{configurable:!0,value:o(null)}),t.exports=function(t){a[r][t]=!0}},1530:function(t,e,i){"use strict";var s=i(8710).charAt;t.exports=function(t,e,i){return e+(i?s(t,e).length:1)}},5787:function(t){t.exports=function(t,e,i){if(!(t instanceof e))throw TypeError("Incorrect "+(i?i+" ":"")+"invocation");return t}},9670:function(t,e,i){var s=i(111);t.exports=function(t){if(!s(t))throw TypeError(String(t)+" is not an object");return t}},4019:function(t){t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},260:function(t,e,i){"use strict";var s,o=i(4019),n=i(9781),r=i(7854),a=i(111),l=i(6656),c=i(648),d=i(8880),u=i(1320),h=i(3070).f,p=i(9518),g=i(7674),m=i(5112),f=i(9711),v=r.Int8Array,w=v&&v.prototype,y=r.Uint8ClampedArray,b=y&&y.prototype,E=v&&p(v),S=w&&p(w),x=Object.prototype,L=x.isPrototypeOf,A=m("toStringTag"),C=f("TYPED_ARRAY_TAG"),T=o&&!!g&&"Opera"!==c(r.opera),k=!1,I={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},P={BigInt64Array:8,BigUint64Array:8},q=function(t){if(!a(t))return!1;var e=c(t);return l(I,e)||l(P,e)};for(s in I)r[s]||(T=!1);if((!T||"function"!=typeof E||E===Function.prototype)&&(E=function(){throw TypeError("Incorrect invocation")},T))for(s in I)r[s]&&g(r[s],E);if((!T||!S||S===x)&&(S=E.prototype,T))for(s in I)r[s]&&g(r[s].prototype,S);if(T&&p(b)!==S&&g(b,S),n&&!l(S,A))for(s in k=!0,h(S,A,{get:function(){return a(this)?this[C]:void 0}}),I)r[s]&&d(r[s],C,s);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:T,TYPED_ARRAY_TAG:k&&C,aTypedArray:function(t){if(q(t))return t;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(t){if(g){if(L.call(E,t))return t}else for(var e in I)if(l(I,s)){var i=r[e];if(i&&(t===i||L.call(i,t)))return t}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(t,e,i){if(n){if(i)for(var s in I){var o=r[s];o&&l(o.prototype,t)&&delete o.prototype[t]}S[t]&&!i||u(S,t,i?e:T&&w[t]||e)}},exportTypedArrayStaticMethod:function(t,e,i){var s,o;if(n){if(g){if(i)for(s in I)(o=r[s])&&l(o,t)&&delete o[t];if(E[t]&&!i)return;try{return u(E,t,i?e:T&&v[t]||e)}catch(t){}}for(s in I)!(o=r[s])||o[t]&&!i||u(o,t,e)}},isView:function(t){if(!a(t))return!1;var e=c(t);return"DataView"===e||l(I,e)||l(P,e)},isTypedArray:q,TypedArray:E,TypedArrayPrototype:S}},3331:function(t,e,i){"use strict";var s=i(7854),o=i(9781),n=i(4019),r=i(8880),a=i(2248),l=i(7293),c=i(5787),d=i(9958),u=i(7466),h=i(7067),p=i(1179),g=i(9518),m=i(7674),f=i(8006).f,v=i(3070).f,w=i(1285),y=i(8003),b=i(9909),E=b.get,S=b.set,x="ArrayBuffer",L="DataView",A="prototype",C="Wrong index",T=s[x],k=T,I=s[L],P=I&&I[A],q=Object.prototype,R=s.RangeError,F=p.pack,M=p.unpack,D=function(t){return[255&t]},_=function(t){return[255&t,t>>8&255]},B=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},U=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},O=function(t){return F(t,23,4)},W=function(t){return F(t,52,8)},Z=function(t,e){v(t[A],e,{get:function(){return E(this)[e]}})},N=function(t,e,i,s){var o=h(i),n=E(t);if(o+e>n.byteLength)throw R(C);var r=E(n.buffer).bytes,a=o+n.byteOffset,l=r.slice(a,a+e);return s?l:l.reverse()},z=function(t,e,i,s,o,n){var r=h(i),a=E(t);if(r+e>a.byteLength)throw R(C);for(var l=E(a.buffer).bytes,c=r+a.byteOffset,d=s(+o),u=0;u<e;u++)l[c+u]=d[n?u:e-u-1]};if(n){if(!l((function(){T(1)}))||!l((function(){new T(-1)}))||l((function(){return new T,new T(1.5),new T(NaN),T.name!=x}))){for(var j,V=(k=function(t){return c(this,k),new T(h(t))})[A]=T[A],H=f(T),G=0;H.length>G;)(j=H[G++])in k||r(k,j,T[j]);V.constructor=k}m&&g(P)!==q&&m(P,q);var $=new I(new k(2)),X=P.setInt8;$.setInt8(0,2147483648),$.setInt8(1,2147483649),!$.getInt8(0)&&$.getInt8(1)||a(P,{setInt8:function(t,e){X.call(this,t,e<<24>>24)},setUint8:function(t,e){X.call(this,t,e<<24>>24)}},{unsafe:!0})}else k=function(t){c(this,k,x);var e=h(t);S(this,{bytes:w.call(new Array(e),0),byteLength:e}),o||(this.byteLength=e)},I=function(t,e,i){c(this,I,L),c(t,k,L);var s=E(t).byteLength,n=d(e);if(n<0||n>s)throw R("Wrong offset");if(n+(i=void 0===i?s-n:u(i))>s)throw R("Wrong length");S(this,{buffer:t,byteLength:i,byteOffset:n}),o||(this.buffer=t,this.byteLength=i,this.byteOffset=n)},o&&(Z(k,"byteLength"),Z(I,"buffer"),Z(I,"byteLength"),Z(I,"byteOffset")),a(I[A],{getInt8:function(t){return N(this,1,t)[0]<<24>>24},getUint8:function(t){return N(this,1,t)[0]},getInt16:function(t){var e=N(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=N(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return U(N(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return U(N(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return M(N(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return M(N(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){z(this,1,t,D,e)},setUint8:function(t,e){z(this,1,t,D,e)},setInt16:function(t,e){z(this,2,t,_,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){z(this,2,t,_,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){z(this,4,t,B,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){z(this,4,t,B,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){z(this,4,t,O,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){z(this,8,t,W,e,arguments.length>2?arguments[2]:void 0)}});y(k,x),y(I,L),t.exports={ArrayBuffer:k,DataView:I}},1048:function(t,e,i){"use strict";var s=i(7908),o=i(1400),n=i(7466),r=Math.min;t.exports=[].copyWithin||function(t,e){var i=s(this),a=n(i.length),l=o(t,a),c=o(e,a),d=arguments.length>2?arguments[2]:void 0,u=r((void 0===d?a:o(d,a))-c,a-l),h=1;for(c<l&&l<c+u&&(h=-1,c+=u-1,l+=u-1);u-- >0;)c in i?i[l]=i[c]:delete i[l],l+=h,c+=h;return i}},1285:function(t,e,i){"use strict";var s=i(7908),o=i(1400),n=i(7466);t.exports=function(t){for(var e=s(this),i=n(e.length),r=arguments.length,a=o(r>1?arguments[1]:void 0,i),l=r>2?arguments[2]:void 0,c=void 0===l?i:o(l,i);c>a;)e[a++]=t;return e}},8533:function(t,e,i){"use strict";var s=i(2092).forEach,o=i(9341)("forEach");t.exports=o?[].forEach:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}},8457:function(t,e,i){"use strict";var s=i(9974),o=i(7908),n=i(3411),r=i(7659),a=i(7466),l=i(6135),c=i(1246);t.exports=function(t){var e,i,d,u,h,p,g=o(t),m="function"==typeof this?this:Array,f=arguments.length,v=f>1?arguments[1]:void 0,w=void 0!==v,y=c(g),b=0;if(w&&(v=s(v,f>2?arguments[2]:void 0,2)),null==y||m==Array&&r(y))for(i=new m(e=a(g.length));e>b;b++)p=w?v(g[b],b):g[b],l(i,b,p);else for(h=(u=y.call(g)).next,i=new m;!(d=h.call(u)).done;b++)p=w?n(u,v,[d.value,b],!0):d.value,l(i,b,p);return i.length=b,i}},1318:function(t,e,i){var s=i(5656),o=i(7466),n=i(1400),r=function(t){return function(e,i,r){var a,l=s(e),c=o(l.length),d=n(r,c);if(t&&i!=i){for(;c>d;)if((a=l[d++])!=a)return!0}else for(;c>d;d++)if((t||d in l)&&l[d]===i)return t||d||0;return!t&&-1}};t.exports={includes:r(!0),indexOf:r(!1)}},2092:function(t,e,i){var s=i(9974),o=i(8361),n=i(7908),r=i(7466),a=i(5417),l=[].push,c=function(t){var e=1==t,i=2==t,c=3==t,d=4==t,u=6==t,h=7==t,p=5==t||u;return function(g,m,f,v){for(var w,y,b=n(g),E=o(b),S=s(m,f,3),x=r(E.length),L=0,A=v||a,C=e?A(g,x):i||h?A(g,0):void 0;x>L;L++)if((p||L in E)&&(y=S(w=E[L],L,b),t))if(e)C[L]=y;else if(y)switch(t){case 3:return!0;case 5:return w;case 6:return L;case 2:l.call(C,w)}else switch(t){case 4:return!1;case 7:l.call(C,w)}return u?-1:c||d?d:C}};t.exports={forEach:c(0),map:c(1),filter:c(2),some:c(3),every:c(4),find:c(5),findIndex:c(6),filterOut:c(7)}},6583:function(t,e,i){"use strict";var s=i(5656),o=i(9958),n=i(7466),r=i(9341),a=Math.min,l=[].lastIndexOf,c=!!l&&1/[1].lastIndexOf(1,-0)<0,d=r("lastIndexOf"),u=c||!d;t.exports=u?function(t){if(c)return l.apply(this,arguments)||0;var e=s(this),i=n(e.length),r=i-1;for(arguments.length>1&&(r=a(r,o(arguments[1]))),r<0&&(r=i+r);r>=0;r--)if(r in e&&e[r]===t)return r||0;return-1}:l},1194:function(t,e,i){var s=i(7293),o=i(5112),n=i(7392),r=o("species");t.exports=function(t){return n>=51||!s((function(){var e=[];return(e.constructor={})[r]=function(){return{foo:1}},1!==e[t](Boolean).foo}))}},9341:function(t,e,i){"use strict";var s=i(7293);t.exports=function(t,e){var i=[][t];return!!i&&s((function(){i.call(null,e||function(){throw 1},1)}))}},3671:function(t,e,i){var s=i(3099),o=i(7908),n=i(8361),r=i(7466),a=function(t){return function(e,i,a,l){s(i);var c=o(e),d=n(c),u=r(c.length),h=t?u-1:0,p=t?-1:1;if(a<2)for(;;){if(h in d){l=d[h],h+=p;break}if(h+=p,t?h<0:u<=h)throw TypeError("Reduce of empty array with no initial value")}for(;t?h>=0:u>h;h+=p)h in d&&(l=i(l,d[h],h,c));return l}};t.exports={left:a(!1),right:a(!0)}},5417:function(t,e,i){var s=i(111),o=i(3157),n=i(5112)("species");t.exports=function(t,e){var i;return o(t)&&("function"!=typeof(i=t.constructor)||i!==Array&&!o(i.prototype)?s(i)&&null===(i=i[n])&&(i=void 0):i=void 0),new(void 0===i?Array:i)(0===e?0:e)}},3411:function(t,e,i){var s=i(9670),o=i(9212);t.exports=function(t,e,i,n){try{return n?e(s(i)[0],i[1]):e(i)}catch(e){throw o(t),e}}},7072:function(t,e,i){var s=i(5112)("iterator"),o=!1;try{var n=0,r={next:function(){return{done:!!n++}},return:function(){o=!0}};r[s]=function(){return this},Array.from(r,(function(){throw 2}))}catch(t){}t.exports=function(t,e){if(!e&&!o)return!1;var i=!1;try{var n={};n[s]=function(){return{next:function(){return{done:i=!0}}}},t(n)}catch(t){}return i}},4326:function(t){var e={}.toString;t.exports=function(t){return e.call(t).slice(8,-1)}},648:function(t,e,i){var s=i(1694),o=i(4326),n=i(5112)("toStringTag"),r="Arguments"==o(function(){return arguments}());t.exports=s?o:function(t){var e,i,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),n))?i:r?o(e):"Object"==(s=o(e))&&"function"==typeof e.callee?"Arguments":s}},9920:function(t,e,i){var s=i(6656),o=i(3887),n=i(1236),r=i(3070);t.exports=function(t,e){for(var i=o(e),a=r.f,l=n.f,c=0;c<i.length;c++){var d=i[c];s(t,d)||a(t,d,l(e,d))}}},8544:function(t,e,i){var s=i(7293);t.exports=!s((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},4994:function(t,e,i){"use strict";var s=i(3383).IteratorPrototype,o=i(30),n=i(9114),r=i(8003),a=i(7497),l=function(){return this};t.exports=function(t,e,i){var c=e+" Iterator";return t.prototype=o(s,{next:n(1,i)}),r(t,c,!1,!0),a[c]=l,t}},8880:function(t,e,i){var s=i(9781),o=i(3070),n=i(9114);t.exports=s?function(t,e,i){return o.f(t,e,n(1,i))}:function(t,e,i){return t[e]=i,t}},9114:function(t){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},6135:function(t,e,i){"use strict";var s=i(7593),o=i(3070),n=i(9114);t.exports=function(t,e,i){var r=s(e);r in t?o.f(t,r,n(0,i)):t[r]=i}},654:function(t,e,i){"use strict";var s=i(2109),o=i(4994),n=i(9518),r=i(7674),a=i(8003),l=i(8880),c=i(1320),d=i(5112),u=i(1913),h=i(7497),p=i(3383),g=p.IteratorPrototype,m=p.BUGGY_SAFARI_ITERATORS,f=d("iterator"),v="keys",w="values",y="entries",b=function(){return this};t.exports=function(t,e,i,d,p,E,S){o(i,e,d);var x,L,A,C=function(t){if(t===p&&q)return q;if(!m&&t in I)return I[t];switch(t){case v:case w:case y:return function(){return new i(this,t)}}return function(){return new i(this)}},T=e+" Iterator",k=!1,I=t.prototype,P=I[f]||I["@@iterator"]||p&&I[p],q=!m&&P||C(p),R="Array"==e&&I.entries||P;if(R&&(x=n(R.call(new t)),g!==Object.prototype&&x.next&&(u||n(x)===g||(r?r(x,g):"function"!=typeof x[f]&&l(x,f,b)),a(x,T,!0,!0),u&&(h[T]=b))),p==w&&P&&P.name!==w&&(k=!0,q=function(){return P.call(this)}),u&&!S||I[f]===q||l(I,f,q),h[e]=q,p)if(L={values:C(w),keys:E?q:C(v),entries:C(y)},S)for(A in L)(m||k||!(A in I))&&c(I,A,L[A]);else s({target:e,proto:!0,forced:m||k},L);return L}},9781:function(t,e,i){var s=i(7293);t.exports=!s((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},317:function(t,e,i){var s=i(7854),o=i(111),n=s.document,r=o(n)&&o(n.createElement);t.exports=function(t){return r?n.createElement(t):{}}},8324:function(t){t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},8113:function(t,e,i){var s=i(5005);t.exports=s("navigator","userAgent")||""},7392:function(t,e,i){var s,o,n=i(7854),r=i(8113),a=n.process,l=a&&a.versions,c=l&&l.v8;c?o=(s=c.split("."))[0]+s[1]:r&&(!(s=r.match(/Edge\/(\d+)/))||s[1]>=74)&&(s=r.match(/Chrome\/(\d+)/))&&(o=s[1]),t.exports=o&&+o},748:function(t){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},2109:function(t,e,i){var s=i(7854),o=i(1236).f,n=i(8880),r=i(1320),a=i(3505),l=i(9920),c=i(4705);t.exports=function(t,e){var i,d,u,h,p,g=t.target,m=t.global,f=t.stat;if(i=m?s:f?s[g]||a(g,{}):(s[g]||{}).prototype)for(d in e){if(h=e[d],u=t.noTargetGet?(p=o(i,d))&&p.value:i[d],!c(m?d:g+(f?".":"#")+d,t.forced)&&void 0!==u){if(typeof h==typeof u)continue;l(h,u)}(t.sham||u&&u.sham)&&n(h,"sham",!0),r(i,d,h,t)}}},7293:function(t){t.exports=function(t){try{return!!t()}catch(t){return!0}}},7007:function(t,e,i){"use strict";i(4916);var s=i(1320),o=i(7293),n=i(5112),r=i(2261),a=i(8880),l=n("species"),c=!o((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),d="$0"==="a".replace(/./,"$0"),u=n("replace"),h=!!/./[u]&&""===/./[u]("a","$0"),p=!o((function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var i="ab".split(t);return 2!==i.length||"a"!==i[0]||"b"!==i[1]}));t.exports=function(t,e,i,u){var g=n(t),m=!o((function(){var e={};return e[g]=function(){return 7},7!=""[t](e)})),f=m&&!o((function(){var e=!1,i=/a/;return"split"===t&&((i={}).constructor={},i.constructor[l]=function(){return i},i.flags="",i[g]=/./[g]),i.exec=function(){return e=!0,null},i[g](""),!e}));if(!m||!f||"replace"===t&&(!c||!d||h)||"split"===t&&!p){var v=/./[g],w=i(g,""[t],(function(t,e,i,s,o){return e.exec===r?m&&!o?{done:!0,value:v.call(e,i,s)}:{done:!0,value:t.call(i,e,s)}:{done:!1}}),{REPLACE_KEEPS_$0:d,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:h}),y=w[0],b=w[1];s(String.prototype,t,y),s(RegExp.prototype,g,2==e?function(t,e){return b.call(t,this,e)}:function(t){return b.call(t,this)})}u&&a(RegExp.prototype[g],"sham",!0)}},9974:function(t,e,i){var s=i(3099);t.exports=function(t,e,i){if(s(t),void 0===e)return t;switch(i){case 0:return function(){return t.call(e)};case 1:return function(i){return t.call(e,i)};case 2:return function(i,s){return t.call(e,i,s)};case 3:return function(i,s,o){return t.call(e,i,s,o)}}return function(){return t.apply(e,arguments)}}},5005:function(t,e,i){var s=i(857),o=i(7854),n=function(t){return"function"==typeof t?t:void 0};t.exports=function(t,e){return arguments.length<2?n(s[t])||n(o[t]):s[t]&&s[t][e]||o[t]&&o[t][e]}},1246:function(t,e,i){var s=i(648),o=i(7497),n=i(5112)("iterator");t.exports=function(t){if(null!=t)return t[n]||t["@@iterator"]||o[s(t)]}},8554:function(t,e,i){var s=i(9670),o=i(1246);t.exports=function(t){var e=o(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return s(e.call(t))}},647:function(t,e,i){var s=i(7908),o=Math.floor,n="".replace,r=/\$([$&'`]|\d\d?|<[^>]*>)/g,a=/\$([$&'`]|\d\d?)/g;t.exports=function(t,e,i,l,c,d){var u=i+t.length,h=l.length,p=a;return void 0!==c&&(c=s(c),p=r),n.call(d,p,(function(s,n){var r;switch(n.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,i);case"'":return e.slice(u);case"<":r=c[n.slice(1,-1)];break;default:var a=+n;if(0===a)return s;if(a>h){var d=o(a/10);return 0===d?s:d<=h?void 0===l[d-1]?n.charAt(1):l[d-1]+n.charAt(1):s}r=l[a-1]}return void 0===r?"":r}))}},7854:function(t,e,i){var s=function(t){return t&&t.Math==Math&&t};t.exports=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof i.g&&i.g)||function(){return this}()||Function("return this")()},6656:function(t){var e={}.hasOwnProperty;t.exports=function(t,i){return e.call(t,i)}},3501:function(t){t.exports={}},490:function(t,e,i){var s=i(5005);t.exports=s("document","documentElement")},4664:function(t,e,i){var s=i(9781),o=i(7293),n=i(317);t.exports=!s&&!o((function(){return 7!=Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}))},1179:function(t){var e=Math.abs,i=Math.pow,s=Math.floor,o=Math.log,n=Math.LN2;t.exports={pack:function(t,r,a){var l,c,d,u=new Array(a),h=8*a-r-1,p=(1<<h)-1,g=p>>1,m=23===r?i(2,-24)-i(2,-77):0,f=t<0||0===t&&1/t<0?1:0,v=0;for((t=e(t))!=t||t===1/0?(c=t!=t?1:0,l=p):(l=s(o(t)/n),t*(d=i(2,-l))<1&&(l--,d*=2),(t+=l+g>=1?m/d:m*i(2,1-g))*d>=2&&(l++,d/=2),l+g>=p?(c=0,l=p):l+g>=1?(c=(t*d-1)*i(2,r),l+=g):(c=t*i(2,g-1)*i(2,r),l=0));r>=8;u[v++]=255&c,c/=256,r-=8);for(l=l<<r|c,h+=r;h>0;u[v++]=255&l,l/=256,h-=8);return u[--v]|=128*f,u},unpack:function(t,e){var s,o=t.length,n=8*o-e-1,r=(1<<n)-1,a=r>>1,l=n-7,c=o-1,d=t[c--],u=127&d;for(d>>=7;l>0;u=256*u+t[c],c--,l-=8);for(s=u&(1<<-l)-1,u>>=-l,l+=e;l>0;s=256*s+t[c],c--,l-=8);if(0===u)u=1-a;else{if(u===r)return s?NaN:d?-1/0:1/0;s+=i(2,e),u-=a}return(d?-1:1)*s*i(2,u-e)}}},8361:function(t,e,i){var s=i(7293),o=i(4326),n="".split;t.exports=s((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==o(t)?n.call(t,""):Object(t)}:Object},9587:function(t,e,i){var s=i(111),o=i(7674);t.exports=function(t,e,i){var n,r;return o&&"function"==typeof(n=e.constructor)&&n!==i&&s(r=n.prototype)&&r!==i.prototype&&o(t,r),t}},2788:function(t,e,i){var s=i(5465),o=Function.toString;"function"!=typeof s.inspectSource&&(s.inspectSource=function(t){return o.call(t)}),t.exports=s.inspectSource},9909:function(t,e,i){var s,o,n,r=i(8536),a=i(7854),l=i(111),c=i(8880),d=i(6656),u=i(5465),h=i(6200),p=i(3501),g=a.WeakMap;if(r){var m=u.state||(u.state=new g),f=m.get,v=m.has,w=m.set;s=function(t,e){return e.facade=t,w.call(m,t,e),e},o=function(t){return f.call(m,t)||{}},n=function(t){return v.call(m,t)}}else{var y=h("state");p[y]=!0,s=function(t,e){return e.facade=t,c(t,y,e),e},o=function(t){return d(t,y)?t[y]:{}},n=function(t){return d(t,y)}}t.exports={set:s,get:o,has:n,enforce:function(t){return n(t)?o(t):s(t,{})},getterFor:function(t){return function(e){var i;if(!l(e)||(i=o(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return i}}}},7659:function(t,e,i){var s=i(5112),o=i(7497),n=s("iterator"),r=Array.prototype;t.exports=function(t){return void 0!==t&&(o.Array===t||r[n]===t)}},3157:function(t,e,i){var s=i(4326);t.exports=Array.isArray||function(t){return"Array"==s(t)}},4705:function(t,e,i){var s=i(7293),o=/#|\.prototype\./,n=function(t,e){var i=a[r(t)];return i==c||i!=l&&("function"==typeof e?s(e):!!e)},r=n.normalize=function(t){return String(t).replace(o,".").toLowerCase()},a=n.data={},l=n.NATIVE="N",c=n.POLYFILL="P";t.exports=n},111:function(t){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},1913:function(t){t.exports=!1},7850:function(t,e,i){var s=i(111),o=i(4326),n=i(5112)("match");t.exports=function(t){var e;return s(t)&&(void 0!==(e=t[n])?!!e:"RegExp"==o(t))}},9212:function(t,e,i){var s=i(9670);t.exports=function(t){var e=t.return;if(void 0!==e)return s(e.call(t)).value}},3383:function(t,e,i){"use strict";var s,o,n,r=i(7293),a=i(9518),l=i(8880),c=i(6656),d=i(5112),u=i(1913),h=d("iterator"),p=!1;[].keys&&("next"in(n=[].keys())?(o=a(a(n)))!==Object.prototype&&(s=o):p=!0);var g=null==s||r((function(){var t={};return s[h].call(t)!==t}));g&&(s={}),u&&!g||c(s,h)||l(s,h,(function(){return this})),t.exports={IteratorPrototype:s,BUGGY_SAFARI_ITERATORS:p}},7497:function(t){t.exports={}},133:function(t,e,i){var s=i(7293);t.exports=!!Object.getOwnPropertySymbols&&!s((function(){return!String(Symbol())}))},590:function(t,e,i){var s=i(7293),o=i(5112),n=i(1913),r=o("iterator");t.exports=!s((function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,i="";return t.pathname="c%20d",e.forEach((function(t,s){e.delete("b"),i+=s+t})),n&&!t.toJSON||!e.sort||"http://a/c%20d?a=1&c=3"!==t.href||"3"!==e.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!e[r]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==i||"x"!==new URL("http://x",void 0).host}))},8536:function(t,e,i){var s=i(7854),o=i(2788),n=s.WeakMap;t.exports="function"==typeof n&&/native code/.test(o(n))},1574:function(t,e,i){"use strict";var s=i(9781),o=i(7293),n=i(1956),r=i(5181),a=i(5296),l=i(7908),c=i(8361),d=Object.assign,u=Object.defineProperty;t.exports=!d||o((function(){if(s&&1!==d({b:1},d(u({},"a",{enumerable:!0,get:function(){u(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},i=Symbol(),o="abcdefghijklmnopqrst";return t[i]=7,o.split("").forEach((function(t){e[t]=t})),7!=d({},t)[i]||n(d({},e)).join("")!=o}))?function(t,e){for(var i=l(t),o=arguments.length,d=1,u=r.f,h=a.f;o>d;)for(var p,g=c(arguments[d++]),m=u?n(g).concat(u(g)):n(g),f=m.length,v=0;f>v;)p=m[v++],s&&!h.call(g,p)||(i[p]=g[p]);return i}:d},30:function(t,e,i){var s,o=i(9670),n=i(6048),r=i(748),a=i(3501),l=i(490),c=i(317),d=i(6200),u="prototype",h="script",p=d("IE_PROTO"),g=function(){},m=function(t){return"<"+h+">"+t+"</"+h+">"},f=function(){try{s=document.domain&&new ActiveXObject("htmlfile")}catch(t){}var t,e,i;f=s?function(t){t.write(m("")),t.close();var e=t.parentWindow.Object;return t=null,e}(s):(e=c("iframe"),i="java"+h+":",e.style.display="none",l.appendChild(e),e.src=String(i),(t=e.contentWindow.document).open(),t.write(m("document.F=Object")),t.close(),t.F);for(var o=r.length;o--;)delete f[u][r[o]];return f()};a[p]=!0,t.exports=Object.create||function(t,e){var i;return null!==t?(g[u]=o(t),i=new g,g[u]=null,i[p]=t):i=f(),void 0===e?i:n(i,e)}},6048:function(t,e,i){var s=i(9781),o=i(3070),n=i(9670),r=i(1956);t.exports=s?Object.defineProperties:function(t,e){n(t);for(var i,s=r(e),a=s.length,l=0;a>l;)o.f(t,i=s[l++],e[i]);return t}},3070:function(t,e,i){var s=i(9781),o=i(4664),n=i(9670),r=i(7593),a=Object.defineProperty;e.f=s?a:function(t,e,i){if(n(t),e=r(e,!0),n(i),o)try{return a(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported");return"value"in i&&(t[e]=i.value),t}},1236:function(t,e,i){var s=i(9781),o=i(5296),n=i(9114),r=i(5656),a=i(7593),l=i(6656),c=i(4664),d=Object.getOwnPropertyDescriptor;e.f=s?d:function(t,e){if(t=r(t),e=a(e,!0),c)try{return d(t,e)}catch(t){}if(l(t,e))return n(!o.f.call(t,e),t[e])}},8006:function(t,e,i){var s=i(6324),o=i(748).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return s(t,o)}},5181:function(t,e){e.f=Object.getOwnPropertySymbols},9518:function(t,e,i){var s=i(6656),o=i(7908),n=i(6200),r=i(8544),a=n("IE_PROTO"),l=Object.prototype;t.exports=r?Object.getPrototypeOf:function(t){return t=o(t),s(t,a)?t[a]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?l:null}},6324:function(t,e,i){var s=i(6656),o=i(5656),n=i(1318).indexOf,r=i(3501);t.exports=function(t,e){var i,a=o(t),l=0,c=[];for(i in a)!s(r,i)&&s(a,i)&&c.push(i);for(;e.length>l;)s(a,i=e[l++])&&(~n(c,i)||c.push(i));return c}},1956:function(t,e,i){var s=i(6324),o=i(748);t.exports=Object.keys||function(t){return s(t,o)}},5296:function(t,e){"use strict";var i={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,o=s&&!i.call({1:2},1);e.f=o?function(t){var e=s(this,t);return!!e&&e.enumerable}:i},7674:function(t,e,i){var s=i(9670),o=i(6077);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,i={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(i,[]),e=i instanceof Array}catch(t){}return function(i,n){return s(i),o(n),e?t.call(i,n):i.__proto__=n,i}}():void 0)},288:function(t,e,i){"use strict";var s=i(1694),o=i(648);t.exports=s?{}.toString:function(){return"[object "+o(this)+"]"}},3887:function(t,e,i){var s=i(5005),o=i(8006),n=i(5181),r=i(9670);t.exports=s("Reflect","ownKeys")||function(t){var e=o.f(r(t)),i=n.f;return i?e.concat(i(t)):e}},857:function(t,e,i){var s=i(7854);t.exports=s},2248:function(t,e,i){var s=i(1320);t.exports=function(t,e,i){for(var o in e)s(t,o,e[o],i);return t}},1320:function(t,e,i){var s=i(7854),o=i(8880),n=i(6656),r=i(3505),a=i(2788),l=i(9909),c=l.get,d=l.enforce,u=String(String).split("String");(t.exports=function(t,e,i,a){var l,c=!!a&&!!a.unsafe,h=!!a&&!!a.enumerable,p=!!a&&!!a.noTargetGet;"function"==typeof i&&("string"!=typeof e||n(i,"name")||o(i,"name",e),(l=d(i)).source||(l.source=u.join("string"==typeof e?e:""))),t!==s?(c?!p&&t[e]&&(h=!0):delete t[e],h?t[e]=i:o(t,e,i)):h?t[e]=i:r(e,i)})(Function.prototype,"toString",(function(){return"function"==typeof this&&c(this).source||a(this)}))},7651:function(t,e,i){var s=i(4326),o=i(2261);t.exports=function(t,e){var i=t.exec;if("function"==typeof i){var n=i.call(t,e);if("object"!=typeof n)throw TypeError("RegExp exec method returned something other than an Object or null");return n}if("RegExp"!==s(t))throw TypeError("RegExp#exec called on incompatible receiver");return o.call(t,e)}},2261:function(t,e,i){"use strict";var s,o,n=i(7066),r=i(2999),a=RegExp.prototype.exec,l=String.prototype.replace,c=a,d=(s=/a/,o=/b*/g,a.call(s,"a"),a.call(o,"a"),0!==s.lastIndex||0!==o.lastIndex),u=r.UNSUPPORTED_Y||r.BROKEN_CARET,h=void 0!==/()??/.exec("")[1];(d||h||u)&&(c=function(t){var e,i,s,o,r=this,c=u&&r.sticky,p=n.call(r),g=r.source,m=0,f=t;return c&&(-1===(p=p.replace("y","")).indexOf("g")&&(p+="g"),f=String(t).slice(r.lastIndex),r.lastIndex>0&&(!r.multiline||r.multiline&&"\n"!==t[r.lastIndex-1])&&(g="(?: "+g+")",f=" "+f,m++),i=new RegExp("^(?:"+g+")",p)),h&&(i=new RegExp("^"+g+"$(?!\\s)",p)),d&&(e=r.lastIndex),s=a.call(c?i:r,f),c?s?(s.input=s.input.slice(m),s[0]=s[0].slice(m),s.index=r.lastIndex,r.lastIndex+=s[0].length):r.lastIndex=0:d&&s&&(r.lastIndex=r.global?s.index+s[0].length:e),h&&s&&s.length>1&&l.call(s[0],i,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(s[o]=void 0)})),s}),t.exports=c},7066:function(t,e,i){"use strict";var s=i(9670);t.exports=function(){var t=s(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},2999:function(t,e,i){"use strict";var s=i(7293);function o(t,e){return RegExp(t,e)}e.UNSUPPORTED_Y=s((function(){var t=o("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),e.BROKEN_CARET=s((function(){var t=o("^r","gy");return t.lastIndex=2,null!=t.exec("str")}))},4488:function(t){t.exports=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t}},3505:function(t,e,i){var s=i(7854),o=i(8880);t.exports=function(t,e){try{o(s,t,e)}catch(i){s[t]=e}return e}},6340:function(t,e,i){"use strict";var s=i(5005),o=i(3070),n=i(5112),r=i(9781),a=n("species");t.exports=function(t){var e=s(t),i=o.f;r&&e&&!e[a]&&i(e,a,{configurable:!0,get:function(){return this}})}},8003:function(t,e,i){var s=i(3070).f,o=i(6656),n=i(5112)("toStringTag");t.exports=function(t,e,i){t&&!o(t=i?t:t.prototype,n)&&s(t,n,{configurable:!0,value:e})}},6200:function(t,e,i){var s=i(2309),o=i(9711),n=s("keys");t.exports=function(t){return n[t]||(n[t]=o(t))}},5465:function(t,e,i){var s=i(7854),o=i(3505),n="__core-js_shared__",r=s[n]||o(n,{});t.exports=r},2309:function(t,e,i){var s=i(1913),o=i(5465);(t.exports=function(t,e){return o[t]||(o[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.9.0",mode:s?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},6707:function(t,e,i){var s=i(9670),o=i(3099),n=i(5112)("species");t.exports=function(t,e){var i,r=s(t).constructor;return void 0===r||null==(i=s(r)[n])?e:o(i)}},8710:function(t,e,i){var s=i(9958),o=i(4488),n=function(t){return function(e,i){var n,r,a=String(o(e)),l=s(i),c=a.length;return l<0||l>=c?t?"":void 0:(n=a.charCodeAt(l))<55296||n>56319||l+1===c||(r=a.charCodeAt(l+1))<56320||r>57343?t?a.charAt(l):n:t?a.slice(l,l+2):r-56320+(n-55296<<10)+65536}};t.exports={codeAt:n(!1),charAt:n(!0)}},3197:function(t){"use strict";var e=2147483647,i=/[^\0-\u007E]/,s=/[.\u3002\uFF0E\uFF61]/g,o="Overflow: input needs wider integers to process",n=Math.floor,r=String.fromCharCode,a=function(t){return t+22+75*(t<26)},l=function(t,e,i){var s=0;for(t=i?n(t/700):t>>1,t+=n(t/e);t>455;s+=36)t=n(t/35);return n(s+36*t/(t+38))},c=function(t){var i=[];t=function(t){for(var e=[],i=0,s=t.length;i<s;){var o=t.charCodeAt(i++);if(o>=55296&&o<=56319&&i<s){var n=t.charCodeAt(i++);56320==(64512&n)?e.push(((1023&o)<<10)+(1023&n)+65536):(e.push(o),i--)}else e.push(o)}return e}(t);var s,c,d=t.length,u=128,h=0,p=72;for(s=0;s<t.length;s++)(c=t[s])<128&&i.push(r(c));var g=i.length,m=g;for(g&&i.push("-");m<d;){var f=e;for(s=0;s<t.length;s++)(c=t[s])>=u&&c<f&&(f=c);var v=m+1;if(f-u>n((e-h)/v))throw RangeError(o);for(h+=(f-u)*v,u=f,s=0;s<t.length;s++){if((c=t[s])<u&&++h>e)throw RangeError(o);if(c==u){for(var w=h,y=36;;y+=36){var b=y<=p?1:y>=p+26?26:y-p;if(w<b)break;var E=w-b,S=36-b;i.push(r(a(b+E%S))),w=n(E/S)}i.push(r(a(w))),p=l(h,v,m==g),h=0,++m}}++h,++u}return i.join("")};t.exports=function(t){var e,o,n=[],r=t.toLowerCase().replace(s,".").split(".");for(e=0;e<r.length;e++)o=r[e],n.push(i.test(o)?"xn--"+c(o):o);return n.join(".")}},6091:function(t,e,i){var s=i(7293),o=i(1361);t.exports=function(t){return s((function(){return!!o[t]()||"​᠎"!="​᠎"[t]()||o[t].name!==t}))}},3111:function(t,e,i){var s=i(4488),o="["+i(1361)+"]",n=RegExp("^"+o+o+"*"),r=RegExp(o+o+"*$"),a=function(t){return function(e){var i=String(s(e));return 1&t&&(i=i.replace(n,"")),2&t&&(i=i.replace(r,"")),i}};t.exports={start:a(1),end:a(2),trim:a(3)}},1400:function(t,e,i){var s=i(9958),o=Math.max,n=Math.min;t.exports=function(t,e){var i=s(t);return i<0?o(i+e,0):n(i,e)}},7067:function(t,e,i){var s=i(9958),o=i(7466);t.exports=function(t){if(void 0===t)return 0;var e=s(t),i=o(e);if(e!==i)throw RangeError("Wrong length or index");return i}},5656:function(t,e,i){var s=i(8361),o=i(4488);t.exports=function(t){return s(o(t))}},9958:function(t){var e=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?i:e)(t)}},7466:function(t,e,i){var s=i(9958),o=Math.min;t.exports=function(t){return t>0?o(s(t),9007199254740991):0}},7908:function(t,e,i){var s=i(4488);t.exports=function(t){return Object(s(t))}},4590:function(t,e,i){var s=i(3002);t.exports=function(t,e){var i=s(t);if(i%e)throw RangeError("Wrong offset");return i}},3002:function(t,e,i){var s=i(9958);t.exports=function(t){var e=s(t);if(e<0)throw RangeError("The argument can't be less than 0");return e}},7593:function(t,e,i){var s=i(111);t.exports=function(t,e){if(!s(t))return t;var i,o;if(e&&"function"==typeof(i=t.toString)&&!s(o=i.call(t)))return o;if("function"==typeof(i=t.valueOf)&&!s(o=i.call(t)))return o;if(!e&&"function"==typeof(i=t.toString)&&!s(o=i.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},1694:function(t,e,i){var s={};s[i(5112)("toStringTag")]="z",t.exports="[object z]"===String(s)},9843:function(t,e,i){"use strict";var s=i(2109),o=i(7854),n=i(9781),r=i(3832),a=i(260),l=i(3331),c=i(5787),d=i(9114),u=i(8880),h=i(7466),p=i(7067),g=i(4590),m=i(7593),f=i(6656),v=i(648),w=i(111),y=i(30),b=i(7674),E=i(8006).f,S=i(7321),x=i(2092).forEach,L=i(6340),A=i(3070),C=i(1236),T=i(9909),k=i(9587),I=T.get,P=T.set,q=A.f,R=C.f,F=Math.round,M=o.RangeError,D=l.ArrayBuffer,_=l.DataView,B=a.NATIVE_ARRAY_BUFFER_VIEWS,U=a.TYPED_ARRAY_TAG,O=a.TypedArray,W=a.TypedArrayPrototype,Z=a.aTypedArrayConstructor,N=a.isTypedArray,z="BYTES_PER_ELEMENT",j="Wrong length",V=function(t,e){for(var i=0,s=e.length,o=new(Z(t))(s);s>i;)o[i]=e[i++];return o},H=function(t,e){q(t,e,{get:function(){return I(this)[e]}})},G=function(t){var e;return t instanceof D||"ArrayBuffer"==(e=v(t))||"SharedArrayBuffer"==e},$=function(t,e){return N(t)&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},X=function(t,e){return $(t,e=m(e,!0))?d(2,t[e]):R(t,e)},K=function(t,e,i){return!($(t,e=m(e,!0))&&w(i)&&f(i,"value"))||f(i,"get")||f(i,"set")||i.configurable||f(i,"writable")&&!i.writable||f(i,"enumerable")&&!i.enumerable?q(t,e,i):(t[e]=i.value,t)};n?(B||(C.f=X,A.f=K,H(W,"buffer"),H(W,"byteOffset"),H(W,"byteLength"),H(W,"length")),s({target:"Object",stat:!0,forced:!B},{getOwnPropertyDescriptor:X,defineProperty:K}),t.exports=function(t,e,i){var n=t.match(/\d+$/)[0]/8,a=t+(i?"Clamped":"")+"Array",l="get"+t,d="set"+t,m=o[a],f=m,v=f&&f.prototype,A={},C=function(t,e){q(t,e,{get:function(){return function(t,e){var i=I(t);return i.view[l](e*n+i.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,s){var o=I(t);i&&(s=(s=F(s))<0?0:s>255?255:255&s),o.view[d](e*n+o.byteOffset,s,!0)}(this,e,t)},enumerable:!0})};B?r&&(f=e((function(t,e,i,s){return c(t,f,a),k(w(e)?G(e)?void 0!==s?new m(e,g(i,n),s):void 0!==i?new m(e,g(i,n)):new m(e):N(e)?V(f,e):S.call(f,e):new m(p(e)),t,f)})),b&&b(f,O),x(E(m),(function(t){t in f||u(f,t,m[t])})),f.prototype=v):(f=e((function(t,e,i,s){c(t,f,a);var o,r,l,d=0,u=0;if(w(e)){if(!G(e))return N(e)?V(f,e):S.call(f,e);o=e,u=g(i,n);var m=e.byteLength;if(void 0===s){if(m%n)throw M(j);if((r=m-u)<0)throw M(j)}else if((r=h(s)*n)+u>m)throw M(j);l=r/n}else l=p(e),o=new D(r=l*n);for(P(t,{buffer:o,byteOffset:u,byteLength:r,length:l,view:new _(o)});d<l;)C(t,d++)})),b&&b(f,O),v=f.prototype=y(W)),v.constructor!==f&&u(v,"constructor",f),U&&u(v,U,a),A[a]=f,s({global:!0,forced:f!=m,sham:!B},A),z in f||u(f,z,n),z in v||u(v,z,n),L(a)}):t.exports=function(){}},3832:function(t,e,i){var s=i(7854),o=i(7293),n=i(7072),r=i(260).NATIVE_ARRAY_BUFFER_VIEWS,a=s.ArrayBuffer,l=s.Int8Array;t.exports=!r||!o((function(){l(1)}))||!o((function(){new l(-1)}))||!n((function(t){new l,new l(null),new l(1.5),new l(t)}),!0)||o((function(){return 1!==new l(new a(2),1,void 0).length}))},3074:function(t,e,i){var s=i(260).aTypedArrayConstructor,o=i(6707);t.exports=function(t,e){for(var i=o(t,t.constructor),n=0,r=e.length,a=new(s(i))(r);r>n;)a[n]=e[n++];return a}},7321:function(t,e,i){var s=i(7908),o=i(7466),n=i(1246),r=i(7659),a=i(9974),l=i(260).aTypedArrayConstructor;t.exports=function(t){var e,i,c,d,u,h,p=s(t),g=arguments.length,m=g>1?arguments[1]:void 0,f=void 0!==m,v=n(p);if(null!=v&&!r(v))for(h=(u=v.call(p)).next,p=[];!(d=h.call(u)).done;)p.push(d.value);for(f&&g>2&&(m=a(m,arguments[2],2)),i=o(p.length),c=new(l(this))(i),e=0;i>e;e++)c[e]=f?m(p[e],e):p[e];return c}},9711:function(t){var e=0,i=Math.random();t.exports=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++e+i).toString(36)}},3307:function(t,e,i){var s=i(133);t.exports=s&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},5112:function(t,e,i){var s=i(7854),o=i(2309),n=i(6656),r=i(9711),a=i(133),l=i(3307),c=o("wks"),d=s.Symbol,u=l?d:d&&d.withoutSetter||r;t.exports=function(t){return n(c,t)||(a&&n(d,t)?c[t]=d[t]:c[t]=u("Symbol."+t)),c[t]}},1361:function(t){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},8264:function(t,e,i){"use strict";var s=i(2109),o=i(7854),n=i(3331),r=i(6340),a="ArrayBuffer",l=n[a];s({global:!0,forced:o[a]!==l},{ArrayBuffer:l}),r(a)},2222:function(t,e,i){"use strict";var s=i(2109),o=i(7293),n=i(3157),r=i(111),a=i(7908),l=i(7466),c=i(6135),d=i(5417),u=i(1194),h=i(5112),p=i(7392),g=h("isConcatSpreadable"),m=9007199254740991,f="Maximum allowed index exceeded",v=p>=51||!o((function(){var t=[];return t[g]=!1,t.concat()[0]!==t})),w=u("concat"),y=function(t){if(!r(t))return!1;var e=t[g];return void 0!==e?!!e:n(t)};s({target:"Array",proto:!0,forced:!v||!w},{concat:function(t){var e,i,s,o,n,r=a(this),u=d(r,0),h=0;for(e=-1,s=arguments.length;e<s;e++)if(y(n=-1===e?r:arguments[e])){if(h+(o=l(n.length))>m)throw TypeError(f);for(i=0;i<o;i++,h++)i in n&&c(u,h,n[i])}else{if(h>=m)throw TypeError(f);c(u,h++,n)}return u.length=h,u}})},7327:function(t,e,i){"use strict";var s=i(2109),o=i(2092).filter;s({target:"Array",proto:!0,forced:!i(1194)("filter")},{filter:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},2772:function(t,e,i){"use strict";var s=i(2109),o=i(1318).indexOf,n=i(9341),r=[].indexOf,a=!!r&&1/[1].indexOf(1,-0)<0,l=n("indexOf");s({target:"Array",proto:!0,forced:a||!l},{indexOf:function(t){return a?r.apply(this,arguments)||0:o(this,t,arguments.length>1?arguments[1]:void 0)}})},6992:function(t,e,i){"use strict";var s=i(5656),o=i(1223),n=i(7497),r=i(9909),a=i(654),l="Array Iterator",c=r.set,d=r.getterFor(l);t.exports=a(Array,"Array",(function(t,e){c(this,{type:l,target:s(t),index:0,kind:e})}),(function(){var t=d(this),e=t.target,i=t.kind,s=t.index++;return!e||s>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==i?{value:s,done:!1}:"values"==i?{value:e[s],done:!1}:{value:[s,e[s]],done:!1}}),"values"),n.Arguments=n.Array,o("keys"),o("values"),o("entries")},1249:function(t,e,i){"use strict";var s=i(2109),o=i(2092).map;s({target:"Array",proto:!0,forced:!i(1194)("map")},{map:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},7042:function(t,e,i){"use strict";var s=i(2109),o=i(111),n=i(3157),r=i(1400),a=i(7466),l=i(5656),c=i(6135),d=i(5112),u=i(1194)("slice"),h=d("species"),p=[].slice,g=Math.max;s({target:"Array",proto:!0,forced:!u},{slice:function(t,e){var i,s,d,u=l(this),m=a(u.length),f=r(t,m),v=r(void 0===e?m:e,m);if(n(u)&&("function"!=typeof(i=u.constructor)||i!==Array&&!n(i.prototype)?o(i)&&null===(i=i[h])&&(i=void 0):i=void 0,i===Array||void 0===i))return p.call(u,f,v);for(s=new(void 0===i?Array:i)(g(v-f,0)),d=0;f<v;f++,d++)f in u&&c(s,d,u[f]);return s.length=d,s}})},561:function(t,e,i){"use strict";var s=i(2109),o=i(1400),n=i(9958),r=i(7466),a=i(7908),l=i(5417),c=i(6135),d=i(1194)("splice"),u=Math.max,h=Math.min;s({target:"Array",proto:!0,forced:!d},{splice:function(t,e){var i,s,d,p,g,m,f=a(this),v=r(f.length),w=o(t,v),y=arguments.length;if(0===y?i=s=0:1===y?(i=0,s=v-w):(i=y-2,s=h(u(n(e),0),v-w)),v+i-s>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(d=l(f,s),p=0;p<s;p++)(g=w+p)in f&&c(d,p,f[g]);if(d.length=s,i<s){for(p=w;p<v-s;p++)m=p+i,(g=p+s)in f?f[m]=f[g]:delete f[m];for(p=v;p>v-s+i;p--)delete f[p-1]}else if(i>s)for(p=v-s;p>w;p--)m=p+i-1,(g=p+s-1)in f?f[m]=f[g]:delete f[m];for(p=0;p<i;p++)f[p+w]=arguments[p+2];return f.length=v-s+i,d}})},8309:function(t,e,i){var s=i(9781),o=i(3070).f,n=Function.prototype,r=n.toString,a=/^\s*function ([^ (]*)/,l="name";s&&!(l in n)&&o(n,l,{configurable:!0,get:function(){try{return r.call(this).match(a)[1]}catch(t){return""}}})},489:function(t,e,i){var s=i(2109),o=i(7293),n=i(7908),r=i(9518),a=i(8544);s({target:"Object",stat:!0,forced:o((function(){r(1)})),sham:!a},{getPrototypeOf:function(t){return r(n(t))}})},1539:function(t,e,i){var s=i(1694),o=i(1320),n=i(288);s||o(Object.prototype,"toString",n,{unsafe:!0})},4916:function(t,e,i){"use strict";var s=i(2109),o=i(2261);s({target:"RegExp",proto:!0,forced:/./.exec!==o},{exec:o})},9714:function(t,e,i){"use strict";var s=i(1320),o=i(9670),n=i(7293),r=i(7066),a="toString",l=RegExp.prototype,c=l[a],d=n((function(){return"/a/b"!=c.call({source:"a",flags:"b"})})),u=c.name!=a;(d||u)&&s(RegExp.prototype,a,(function(){var t=o(this),e=String(t.source),i=t.flags;return"/"+e+"/"+String(void 0===i&&t instanceof RegExp&&!("flags"in l)?r.call(t):i)}),{unsafe:!0})},8783:function(t,e,i){"use strict";var s=i(8710).charAt,o=i(9909),n=i(654),r="String Iterator",a=o.set,l=o.getterFor(r);n(String,"String",(function(t){a(this,{type:r,string:String(t),index:0})}),(function(){var t,e=l(this),i=e.string,o=e.index;return o>=i.length?{value:void 0,done:!0}:(t=s(i,o),e.index+=t.length,{value:t,done:!1})}))},4723:function(t,e,i){"use strict";var s=i(7007),o=i(9670),n=i(7466),r=i(4488),a=i(1530),l=i(7651);s("match",1,(function(t,e,i){return[function(e){var i=r(this),s=null==e?void 0:e[t];return void 0!==s?s.call(e,i):new RegExp(e)[t](String(i))},function(t){var s=i(e,t,this);if(s.done)return s.value;var r=o(t),c=String(this);if(!r.global)return l(r,c);var d=r.unicode;r.lastIndex=0;for(var u,h=[],p=0;null!==(u=l(r,c));){var g=String(u[0]);h[p]=g,""===g&&(r.lastIndex=a(c,n(r.lastIndex),d)),p++}return 0===p?null:h}]}))},5306:function(t,e,i){"use strict";var s=i(7007),o=i(9670),n=i(7466),r=i(9958),a=i(4488),l=i(1530),c=i(647),d=i(7651),u=Math.max,h=Math.min;s("replace",2,(function(t,e,i,s){var p=s.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,g=s.REPLACE_KEEPS_$0,m=p?"$":"$0";return[function(i,s){var o=a(this),n=null==i?void 0:i[t];return void 0!==n?n.call(i,o,s):e.call(String(o),i,s)},function(t,s){if(!p&&g||"string"==typeof s&&-1===s.indexOf(m)){var a=i(e,t,this,s);if(a.done)return a.value}var f=o(t),v=String(this),w="function"==typeof s;w||(s=String(s));var y=f.global;if(y){var b=f.unicode;f.lastIndex=0}for(var E=[];;){var S=d(f,v);if(null===S)break;if(E.push(S),!y)break;""===String(S[0])&&(f.lastIndex=l(v,n(f.lastIndex),b))}for(var x,L="",A=0,C=0;C<E.length;C++){S=E[C];for(var T=String(S[0]),k=u(h(r(S.index),v.length),0),I=[],P=1;P<S.length;P++)I.push(void 0===(x=S[P])?x:String(x));var q=S.groups;if(w){var R=[T].concat(I,k,v);void 0!==q&&R.push(q);var F=String(s.apply(void 0,R))}else F=c(T,v,k,I,q,s);k>=A&&(L+=v.slice(A,k)+F,A=k+T.length)}return L+v.slice(A)}]}))},3123:function(t,e,i){"use strict";var s=i(7007),o=i(7850),n=i(9670),r=i(4488),a=i(6707),l=i(1530),c=i(7466),d=i(7651),u=i(2261),h=i(7293),p=[].push,g=Math.min,m=4294967295,f=!h((function(){return!RegExp(m,"y")}));s("split",2,(function(t,e,i){var s;return s="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,i){var s=String(r(this)),n=void 0===i?m:i>>>0;if(0===n)return[];if(void 0===t)return[s];if(!o(t))return e.call(s,t,n);for(var a,l,c,d=[],h=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),g=0,f=new RegExp(t.source,h+"g");(a=u.call(f,s))&&!((l=f.lastIndex)>g&&(d.push(s.slice(g,a.index)),a.length>1&&a.index<s.length&&p.apply(d,a.slice(1)),c=a[0].length,g=l,d.length>=n));)f.lastIndex===a.index&&f.lastIndex++;return g===s.length?!c&&f.test("")||d.push(""):d.push(s.slice(g)),d.length>n?d.slice(0,n):d}:"0".split(void 0,0).length?function(t,i){return void 0===t&&0===i?[]:e.call(this,t,i)}:e,[function(e,i){var o=r(this),n=null==e?void 0:e[t];return void 0!==n?n.call(e,o,i):s.call(String(o),e,i)},function(t,o){var r=i(s,t,this,o,s!==e);if(r.done)return r.value;var u=n(t),h=String(this),p=a(u,RegExp),v=u.unicode,w=(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.unicode?"u":"")+(f?"y":"g"),y=new p(f?u:"^(?:"+u.source+")",w),b=void 0===o?m:o>>>0;if(0===b)return[];if(0===h.length)return null===d(y,h)?[h]:[];for(var E=0,S=0,x=[];S<h.length;){y.lastIndex=f?S:0;var L,A=d(y,f?h:h.slice(S));if(null===A||(L=g(c(y.lastIndex+(f?0:S)),h.length))===E)S=l(h,S,v);else{if(x.push(h.slice(E,S)),x.length===b)return x;for(var C=1;C<=A.length-1;C++)if(x.push(A[C]),x.length===b)return x;S=E=L}}return x.push(h.slice(E)),x}]}),!f)},3210:function(t,e,i){"use strict";var s=i(2109),o=i(3111).trim;s({target:"String",proto:!0,forced:i(6091)("trim")},{trim:function(){return o(this)}})},2990:function(t,e,i){"use strict";var s=i(260),o=i(1048),n=s.aTypedArray;(0,s.exportTypedArrayMethod)("copyWithin",(function(t,e){return o.call(n(this),t,e,arguments.length>2?arguments[2]:void 0)}))},8927:function(t,e,i){"use strict";var s=i(260),o=i(2092).every,n=s.aTypedArray;(0,s.exportTypedArrayMethod)("every",(function(t){return o(n(this),t,arguments.length>1?arguments[1]:void 0)}))},3105:function(t,e,i){"use strict";var s=i(260),o=i(1285),n=s.aTypedArray;(0,s.exportTypedArrayMethod)("fill",(function(t){return o.apply(n(this),arguments)}))},5035:function(t,e,i){"use strict";var s=i(260),o=i(2092).filter,n=i(3074),r=s.aTypedArray;(0,s.exportTypedArrayMethod)("filter",(function(t){var e=o(r(this),t,arguments.length>1?arguments[1]:void 0);return n(this,e)}))},7174:function(t,e,i){"use strict";var s=i(260),o=i(2092).findIndex,n=s.aTypedArray;(0,s.exportTypedArrayMethod)("findIndex",(function(t){return o(n(this),t,arguments.length>1?arguments[1]:void 0)}))},4345:function(t,e,i){"use strict";var s=i(260),o=i(2092).find,n=s.aTypedArray;(0,s.exportTypedArrayMethod)("find",(function(t){return o(n(this),t,arguments.length>1?arguments[1]:void 0)}))},2846:function(t,e,i){"use strict";var s=i(260),o=i(2092).forEach,n=s.aTypedArray;(0,s.exportTypedArrayMethod)("forEach",(function(t){o(n(this),t,arguments.length>1?arguments[1]:void 0)}))},4731:function(t,e,i){"use strict";var s=i(260),o=i(1318).includes,n=s.aTypedArray;(0,s.exportTypedArrayMethod)("includes",(function(t){return o(n(this),t,arguments.length>1?arguments[1]:void 0)}))},7209:function(t,e,i){"use strict";var s=i(260),o=i(1318).indexOf,n=s.aTypedArray;(0,s.exportTypedArrayMethod)("indexOf",(function(t){return o(n(this),t,arguments.length>1?arguments[1]:void 0)}))},6319:function(t,e,i){"use strict";var s=i(7854),o=i(260),n=i(6992),r=i(5112)("iterator"),a=s.Uint8Array,l=n.values,c=n.keys,d=n.entries,u=o.aTypedArray,h=o.exportTypedArrayMethod,p=a&&a.prototype[r],g=!!p&&("values"==p.name||null==p.name),m=function(){return l.call(u(this))};h("entries",(function(){return d.call(u(this))})),h("keys",(function(){return c.call(u(this))})),h("values",m,!g),h(r,m,!g)},8867:function(t,e,i){"use strict";var s=i(260),o=s.aTypedArray,n=s.exportTypedArrayMethod,r=[].join;n("join",(function(t){return r.apply(o(this),arguments)}))},7789:function(t,e,i){"use strict";var s=i(260),o=i(6583),n=s.aTypedArray;(0,s.exportTypedArrayMethod)("lastIndexOf",(function(t){return o.apply(n(this),arguments)}))},3739:function(t,e,i){"use strict";var s=i(260),o=i(2092).map,n=i(6707),r=s.aTypedArray,a=s.aTypedArrayConstructor;(0,s.exportTypedArrayMethod)("map",(function(t){return o(r(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(a(n(t,t.constructor)))(e)}))}))},4483:function(t,e,i){"use strict";var s=i(260),o=i(3671).right,n=s.aTypedArray;(0,s.exportTypedArrayMethod)("reduceRight",(function(t){return o(n(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)}))},9368:function(t,e,i){"use strict";var s=i(260),o=i(3671).left,n=s.aTypedArray;(0,s.exportTypedArrayMethod)("reduce",(function(t){return o(n(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)}))},2056:function(t,e,i){"use strict";var s=i(260),o=s.aTypedArray,n=s.exportTypedArrayMethod,r=Math.floor;n("reverse",(function(){for(var t,e=this,i=o(e).length,s=r(i/2),n=0;n<s;)t=e[n],e[n++]=e[--i],e[i]=t;return e}))},3462:function(t,e,i){"use strict";var s=i(260),o=i(7466),n=i(4590),r=i(7908),a=i(7293),l=s.aTypedArray;(0,s.exportTypedArrayMethod)("set",(function(t){l(this);var e=n(arguments.length>1?arguments[1]:void 0,1),i=this.length,s=r(t),a=o(s.length),c=0;if(a+e>i)throw RangeError("Wrong length");for(;c<a;)this[e+c]=s[c++]}),a((function(){new Int8Array(1).set({})})))},678:function(t,e,i){"use strict";var s=i(260),o=i(6707),n=i(7293),r=s.aTypedArray,a=s.aTypedArrayConstructor,l=s.exportTypedArrayMethod,c=[].slice;l("slice",(function(t,e){for(var i=c.call(r(this),t,e),s=o(this,this.constructor),n=0,l=i.length,d=new(a(s))(l);l>n;)d[n]=i[n++];return d}),n((function(){new Int8Array(1).slice()})))},7462:function(t,e,i){"use strict";var s=i(260),o=i(2092).some,n=s.aTypedArray;(0,s.exportTypedArrayMethod)("some",(function(t){return o(n(this),t,arguments.length>1?arguments[1]:void 0)}))},3824:function(t,e,i){"use strict";var s=i(260),o=s.aTypedArray,n=s.exportTypedArrayMethod,r=[].sort;n("sort",(function(t){return r.call(o(this),t)}))},5021:function(t,e,i){"use strict";var s=i(260),o=i(7466),n=i(1400),r=i(6707),a=s.aTypedArray;(0,s.exportTypedArrayMethod)("subarray",(function(t,e){var i=a(this),s=i.length,l=n(t,s);return new(r(i,i.constructor))(i.buffer,i.byteOffset+l*i.BYTES_PER_ELEMENT,o((void 0===e?s:n(e,s))-l))}))},2974:function(t,e,i){"use strict";var s=i(7854),o=i(260),n=i(7293),r=s.Int8Array,a=o.aTypedArray,l=o.exportTypedArrayMethod,c=[].toLocaleString,d=[].slice,u=!!r&&n((function(){c.call(new r(1))}));l("toLocaleString",(function(){return c.apply(u?d.call(a(this)):a(this),arguments)}),n((function(){return[1,2].toLocaleString()!=new r([1,2]).toLocaleString()}))||!n((function(){r.prototype.toLocaleString.call([1,2])})))},5016:function(t,e,i){"use strict";var s=i(260).exportTypedArrayMethod,o=i(7293),n=i(7854).Uint8Array,r=n&&n.prototype||{},a=[].toString,l=[].join;o((function(){a.call({})}))&&(a=function(){return l.call(this)});var c=r.toString!=a;s("toString",a,c)},2472:function(t,e,i){i(9843)("Uint8",(function(t){return function(e,i,s){return t(this,e,i,s)}}))},4747:function(t,e,i){var s=i(7854),o=i(8324),n=i(8533),r=i(8880);for(var a in o){var l=s[a],c=l&&l.prototype;if(c&&c.forEach!==n)try{r(c,"forEach",n)}catch(t){c.forEach=n}}},3948:function(t,e,i){var s=i(7854),o=i(8324),n=i(6992),r=i(8880),a=i(5112),l=a("iterator"),c=a("toStringTag"),d=n.values;for(var u in o){var h=s[u],p=h&&h.prototype;if(p){if(p[l]!==d)try{r(p,l,d)}catch(t){p[l]=d}if(p[c]||r(p,c,u),o[u])for(var g in n)if(p[g]!==n[g])try{r(p,g,n[g])}catch(t){p[g]=n[g]}}}},1637:function(t,e,i){"use strict";i(6992);var s=i(2109),o=i(5005),n=i(590),r=i(1320),a=i(2248),l=i(8003),c=i(4994),d=i(9909),u=i(5787),h=i(6656),p=i(9974),g=i(648),m=i(9670),f=i(111),v=i(30),w=i(9114),y=i(8554),b=i(1246),E=i(5112),S=o("fetch"),x=o("Headers"),L=E("iterator"),A="URLSearchParams",C=A+"Iterator",T=d.set,k=d.getterFor(A),I=d.getterFor(C),P=/\+/g,q=Array(4),R=function(t){return q[t-1]||(q[t-1]=RegExp("((?:%[\\da-f]{2}){"+t+"})","gi"))},F=function(t){try{return decodeURIComponent(t)}catch(e){return t}},M=function(t){var e=t.replace(P," "),i=4;try{return decodeURIComponent(e)}catch(t){for(;i;)e=e.replace(R(i--),F);return e}},D=/[!'()~]|%20/g,_={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},B=function(t){return _[t]},U=function(t){return encodeURIComponent(t).replace(D,B)},O=function(t,e){if(e)for(var i,s,o=e.split("&"),n=0;n<o.length;)(i=o[n++]).length&&(s=i.split("="),t.push({key:M(s.shift()),value:M(s.join("="))}))},W=function(t){this.entries.length=0,O(this.entries,t)},Z=function(t,e){if(t<e)throw TypeError("Not enough arguments")},N=c((function(t,e){T(this,{type:C,iterator:y(k(t).entries),kind:e})}),"Iterator",(function(){var t=I(this),e=t.kind,i=t.iterator.next(),s=i.value;return i.done||(i.value="keys"===e?s.key:"values"===e?s.value:[s.key,s.value]),i})),z=function(){u(this,z,A);var t,e,i,s,o,n,r,a,l,c=arguments.length>0?arguments[0]:void 0,d=[];if(T(this,{type:A,entries:d,updateURL:function(){},updateSearchParams:W}),void 0!==c)if(f(c))if("function"==typeof(t=b(c)))for(i=(e=t.call(c)).next;!(s=i.call(e)).done;){if((r=(n=(o=y(m(s.value))).next).call(o)).done||(a=n.call(o)).done||!n.call(o).done)throw TypeError("Expected sequence with length 2");d.push({key:r.value+"",value:a.value+""})}else for(l in c)h(c,l)&&d.push({key:l,value:c[l]+""});else O(d,"string"==typeof c?"?"===c.charAt(0)?c.slice(1):c:c+"")},j=z.prototype;a(j,{append:function(t,e){Z(arguments.length,2);var i=k(this);i.entries.push({key:t+"",value:e+""}),i.updateURL()},delete:function(t){Z(arguments.length,1);for(var e=k(this),i=e.entries,s=t+"",o=0;o<i.length;)i[o].key===s?i.splice(o,1):o++;e.updateURL()},get:function(t){Z(arguments.length,1);for(var e=k(this).entries,i=t+"",s=0;s<e.length;s++)if(e[s].key===i)return e[s].value;return null},getAll:function(t){Z(arguments.length,1);for(var e=k(this).entries,i=t+"",s=[],o=0;o<e.length;o++)e[o].key===i&&s.push(e[o].value);return s},has:function(t){Z(arguments.length,1);for(var e=k(this).entries,i=t+"",s=0;s<e.length;)if(e[s++].key===i)return!0;return!1},set:function(t,e){Z(arguments.length,1);for(var i,s=k(this),o=s.entries,n=!1,r=t+"",a=e+"",l=0;l<o.length;l++)(i=o[l]).key===r&&(n?o.splice(l--,1):(n=!0,i.value=a));n||o.push({key:r,value:a}),s.updateURL()},sort:function(){var t,e,i,s=k(this),o=s.entries,n=o.slice();for(o.length=0,i=0;i<n.length;i++){for(t=n[i],e=0;e<i;e++)if(o[e].key>t.key){o.splice(e,0,t);break}e===i&&o.push(t)}s.updateURL()},forEach:function(t){for(var e,i=k(this).entries,s=p(t,arguments.length>1?arguments[1]:void 0,3),o=0;o<i.length;)s((e=i[o++]).value,e.key,this)},keys:function(){return new N(this,"keys")},values:function(){return new N(this,"values")},entries:function(){return new N(this,"entries")}},{enumerable:!0}),r(j,L,j.entries),r(j,"toString",(function(){for(var t,e=k(this).entries,i=[],s=0;s<e.length;)t=e[s++],i.push(U(t.key)+"="+U(t.value));return i.join("&")}),{enumerable:!0}),l(z,A),s({global:!0,forced:!n},{URLSearchParams:z}),n||"function"!=typeof S||"function"!=typeof x||s({global:!0,enumerable:!0,forced:!0},{fetch:function(t){var e,i,s,o=[t];return arguments.length>1&&(f(e=arguments[1])&&(i=e.body,g(i)===A&&((s=e.headers?new x(e.headers):new x).has("content-type")||s.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),e=v(e,{body:w(0,String(i)),headers:w(0,s)}))),o.push(e)),S.apply(this,o)}}),t.exports={URLSearchParams:z,getState:k}},285:function(t,e,i){"use strict";i(8783);var s,o=i(2109),n=i(9781),r=i(590),a=i(7854),l=i(6048),c=i(1320),d=i(5787),u=i(6656),h=i(1574),p=i(8457),g=i(8710).codeAt,m=i(3197),f=i(8003),v=i(1637),w=i(9909),y=a.URL,b=v.URLSearchParams,E=v.getState,S=w.set,x=w.getterFor("URL"),L=Math.floor,A=Math.pow,C="Invalid scheme",T="Invalid host",k="Invalid port",I=/[A-Za-z]/,P=/[\d+-.A-Za-z]/,q=/\d/,R=/^(0x|0X)/,F=/^[0-7]+$/,M=/^\d+$/,D=/^[\dA-Fa-f]+$/,_=/[\u0000\t\u000A\u000D #%/:?@[\\]]/,B=/[\u0000\t\u000A\u000D #/:?@[\\]]/,U=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,O=/[\t\u000A\u000D]/g,W=function(t,e){var i,s,o;if("["==e.charAt(0)){if("]"!=e.charAt(e.length-1))return T;if(!(i=N(e.slice(1,-1))))return T;t.host=i}else if(K(t)){if(e=m(e),_.test(e))return T;if(null===(i=Z(e)))return T;t.host=i}else{if(B.test(e))return T;for(i="",s=p(e),o=0;o<s.length;o++)i+=$(s[o],j);t.host=i}},Z=function(t){var e,i,s,o,n,r,a,l=t.split(".");if(l.length&&""==l[l.length-1]&&l.pop(),(e=l.length)>4)return t;for(i=[],s=0;s<e;s++){if(""==(o=l[s]))return t;if(n=10,o.length>1&&"0"==o.charAt(0)&&(n=R.test(o)?16:8,o=o.slice(8==n?1:2)),""===o)r=0;else{if(!(10==n?M:8==n?F:D).test(o))return t;r=parseInt(o,n)}i.push(r)}for(s=0;s<e;s++)if(r=i[s],s==e-1){if(r>=A(256,5-e))return null}else if(r>255)return null;for(a=i.pop(),s=0;s<i.length;s++)a+=i[s]*A(256,3-s);return a},N=function(t){var e,i,s,o,n,r,a,l=[0,0,0,0,0,0,0,0],c=0,d=null,u=0,h=function(){return t.charAt(u)};if(":"==h()){if(":"!=t.charAt(1))return;u+=2,d=++c}for(;h();){if(8==c)return;if(":"!=h()){for(e=i=0;i<4&&D.test(h());)e=16*e+parseInt(h(),16),u++,i++;if("."==h()){if(0==i)return;if(u-=i,c>6)return;for(s=0;h();){if(o=null,s>0){if(!("."==h()&&s<4))return;u++}if(!q.test(h()))return;for(;q.test(h());){if(n=parseInt(h(),10),null===o)o=n;else{if(0==o)return;o=10*o+n}if(o>255)return;u++}l[c]=256*l[c]+o,2!=++s&&4!=s||c++}if(4!=s)return;break}if(":"==h()){if(u++,!h())return}else if(h())return;l[c++]=e}else{if(null!==d)return;u++,d=++c}}if(null!==d)for(r=c-d,c=7;0!=c&&r>0;)a=l[c],l[c--]=l[d+r-1],l[d+--r]=a;else if(8!=c)return;return l},z=function(t){var e,i,s,o;if("number"==typeof t){for(e=[],i=0;i<4;i++)e.unshift(t%256),t=L(t/256);return e.join(".")}if("object"==typeof t){for(e="",s=function(t){for(var e=null,i=1,s=null,o=0,n=0;n<8;n++)0!==t[n]?(o>i&&(e=s,i=o),s=null,o=0):(null===s&&(s=n),++o);return o>i&&(e=s,i=o),e}(t),i=0;i<8;i++)o&&0===t[i]||(o&&(o=!1),s===i?(e+=i?":":"::",o=!0):(e+=t[i].toString(16),i<7&&(e+=":")));return"["+e+"]"}return t},j={},V=h({},j,{" ":1,'"':1,"<":1,">":1,"`":1}),H=h({},V,{"#":1,"?":1,"{":1,"}":1}),G=h({},H,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),$=function(t,e){var i=g(t,0);return i>32&&i<127&&!u(e,t)?t:encodeURIComponent(t)},X={ftp:21,file:null,http:80,https:443,ws:80,wss:443},K=function(t){return u(X,t.scheme)},Q=function(t){return""!=t.username||""!=t.password},Y=function(t){return!t.host||t.cannotBeABaseURL||"file"==t.scheme},J=function(t,e){var i;return 2==t.length&&I.test(t.charAt(0))&&(":"==(i=t.charAt(1))||!e&&"|"==i)},tt=function(t){var e;return t.length>1&&J(t.slice(0,2))&&(2==t.length||"/"===(e=t.charAt(2))||"\\"===e||"?"===e||"#"===e)},et=function(t){var e=t.path,i=e.length;!i||"file"==t.scheme&&1==i&&J(e[0],!0)||e.pop()},it=function(t){return"."===t||"%2e"===t.toLowerCase()},st={},ot={},nt={},rt={},at={},lt={},ct={},dt={},ut={},ht={},pt={},gt={},mt={},ft={},vt={},wt={},yt={},bt={},Et={},St={},xt={},Lt=function(t,e,i,o){var n,r,a,l,c,d=i||st,h=0,g="",m=!1,f=!1,v=!1;for(i||(t.scheme="",t.username="",t.password="",t.host=null,t.port=null,t.path=[],t.query=null,t.fragment=null,t.cannotBeABaseURL=!1,e=e.replace(U,"")),e=e.replace(O,""),n=p(e);h<=n.length;){switch(r=n[h],d){case st:if(!r||!I.test(r)){if(i)return C;d=nt;continue}g+=r.toLowerCase(),d=ot;break;case ot:if(r&&(P.test(r)||"+"==r||"-"==r||"."==r))g+=r.toLowerCase();else{if(":"!=r){if(i)return C;g="",d=nt,h=0;continue}if(i&&(K(t)!=u(X,g)||"file"==g&&(Q(t)||null!==t.port)||"file"==t.scheme&&!t.host))return;if(t.scheme=g,i)return void(K(t)&&X[t.scheme]==t.port&&(t.port=null));g="","file"==t.scheme?d=ft:K(t)&&o&&o.scheme==t.scheme?d=rt:K(t)?d=dt:"/"==n[h+1]?(d=at,h++):(t.cannotBeABaseURL=!0,t.path.push(""),d=Et)}break;case nt:if(!o||o.cannotBeABaseURL&&"#"!=r)return C;if(o.cannotBeABaseURL&&"#"==r){t.scheme=o.scheme,t.path=o.path.slice(),t.query=o.query,t.fragment="",t.cannotBeABaseURL=!0,d=xt;break}d="file"==o.scheme?ft:lt;continue;case rt:if("/"!=r||"/"!=n[h+1]){d=lt;continue}d=ut,h++;break;case at:if("/"==r){d=ht;break}d=bt;continue;case lt:if(t.scheme=o.scheme,r==s)t.username=o.username,t.password=o.password,t.host=o.host,t.port=o.port,t.path=o.path.slice(),t.query=o.query;else if("/"==r||"\\"==r&&K(t))d=ct;else if("?"==r)t.username=o.username,t.password=o.password,t.host=o.host,t.port=o.port,t.path=o.path.slice(),t.query="",d=St;else{if("#"!=r){t.username=o.username,t.password=o.password,t.host=o.host,t.port=o.port,t.path=o.path.slice(),t.path.pop(),d=bt;continue}t.username=o.username,t.password=o.password,t.host=o.host,t.port=o.port,t.path=o.path.slice(),t.query=o.query,t.fragment="",d=xt}break;case ct:if(!K(t)||"/"!=r&&"\\"!=r){if("/"!=r){t.username=o.username,t.password=o.password,t.host=o.host,t.port=o.port,d=bt;continue}d=ht}else d=ut;break;case dt:if(d=ut,"/"!=r||"/"!=g.charAt(h+1))continue;h++;break;case ut:if("/"!=r&&"\\"!=r){d=ht;continue}break;case ht:if("@"==r){m&&(g="%40"+g),m=!0,a=p(g);for(var w=0;w<a.length;w++){var y=a[w];if(":"!=y||v){var b=$(y,G);v?t.password+=b:t.username+=b}else v=!0}g=""}else if(r==s||"/"==r||"?"==r||"#"==r||"\\"==r&&K(t)){if(m&&""==g)return"Invalid authority";h-=p(g).length+1,g="",d=pt}else g+=r;break;case pt:case gt:if(i&&"file"==t.scheme){d=wt;continue}if(":"!=r||f){if(r==s||"/"==r||"?"==r||"#"==r||"\\"==r&&K(t)){if(K(t)&&""==g)return T;if(i&&""==g&&(Q(t)||null!==t.port))return;if(l=W(t,g))return l;if(g="",d=yt,i)return;continue}"["==r?f=!0:"]"==r&&(f=!1),g+=r}else{if(""==g)return T;if(l=W(t,g))return l;if(g="",d=mt,i==gt)return}break;case mt:if(!q.test(r)){if(r==s||"/"==r||"?"==r||"#"==r||"\\"==r&&K(t)||i){if(""!=g){var E=parseInt(g,10);if(E>65535)return k;t.port=K(t)&&E===X[t.scheme]?null:E,g=""}if(i)return;d=yt;continue}return k}g+=r;break;case ft:if(t.scheme="file","/"==r||"\\"==r)d=vt;else{if(!o||"file"!=o.scheme){d=bt;continue}if(r==s)t.host=o.host,t.path=o.path.slice(),t.query=o.query;else if("?"==r)t.host=o.host,t.path=o.path.slice(),t.query="",d=St;else{if("#"!=r){tt(n.slice(h).join(""))||(t.host=o.host,t.path=o.path.slice(),et(t)),d=bt;continue}t.host=o.host,t.path=o.path.slice(),t.query=o.query,t.fragment="",d=xt}}break;case vt:if("/"==r||"\\"==r){d=wt;break}o&&"file"==o.scheme&&!tt(n.slice(h).join(""))&&(J(o.path[0],!0)?t.path.push(o.path[0]):t.host=o.host),d=bt;continue;case wt:if(r==s||"/"==r||"\\"==r||"?"==r||"#"==r){if(!i&&J(g))d=bt;else if(""==g){if(t.host="",i)return;d=yt}else{if(l=W(t,g))return l;if("localhost"==t.host&&(t.host=""),i)return;g="",d=yt}continue}g+=r;break;case yt:if(K(t)){if(d=bt,"/"!=r&&"\\"!=r)continue}else if(i||"?"!=r)if(i||"#"!=r){if(r!=s&&(d=bt,"/"!=r))continue}else t.fragment="",d=xt;else t.query="",d=St;break;case bt:if(r==s||"/"==r||"\\"==r&&K(t)||!i&&("?"==r||"#"==r)){if(".."===(c=(c=g).toLowerCase())||"%2e."===c||".%2e"===c||"%2e%2e"===c?(et(t),"/"==r||"\\"==r&&K(t)||t.path.push("")):it(g)?"/"==r||"\\"==r&&K(t)||t.path.push(""):("file"==t.scheme&&!t.path.length&&J(g)&&(t.host&&(t.host=""),g=g.charAt(0)+":"),t.path.push(g)),g="","file"==t.scheme&&(r==s||"?"==r||"#"==r))for(;t.path.length>1&&""===t.path[0];)t.path.shift();"?"==r?(t.query="",d=St):"#"==r&&(t.fragment="",d=xt)}else g+=$(r,H);break;case Et:"?"==r?(t.query="",d=St):"#"==r?(t.fragment="",d=xt):r!=s&&(t.path[0]+=$(r,j));break;case St:i||"#"!=r?r!=s&&("'"==r&&K(t)?t.query+="%27":t.query+="#"==r?"%23":$(r,j)):(t.fragment="",d=xt);break;case xt:r!=s&&(t.fragment+=$(r,V))}h++}},At=function(t){var e,i,s=d(this,At,"URL"),o=arguments.length>1?arguments[1]:void 0,r=String(t),a=S(s,{type:"URL"});if(void 0!==o)if(o instanceof At)e=x(o);else if(i=Lt(e={},String(o)))throw TypeError(i);if(i=Lt(a,r,null,e))throw TypeError(i);var l=a.searchParams=new b,c=E(l);c.updateSearchParams(a.query),c.updateURL=function(){a.query=String(l)||null},n||(s.href=Tt.call(s),s.origin=kt.call(s),s.protocol=It.call(s),s.username=Pt.call(s),s.password=qt.call(s),s.host=Rt.call(s),s.hostname=Ft.call(s),s.port=Mt.call(s),s.pathname=Dt.call(s),s.search=_t.call(s),s.searchParams=Bt.call(s),s.hash=Ut.call(s))},Ct=At.prototype,Tt=function(){var t=x(this),e=t.scheme,i=t.username,s=t.password,o=t.host,n=t.port,r=t.path,a=t.query,l=t.fragment,c=e+":";return null!==o?(c+="//",Q(t)&&(c+=i+(s?":"+s:"")+"@"),c+=z(o),null!==n&&(c+=":"+n)):"file"==e&&(c+="//"),c+=t.cannotBeABaseURL?r[0]:r.length?"/"+r.join("/"):"",null!==a&&(c+="?"+a),null!==l&&(c+="#"+l),c},kt=function(){var t=x(this),e=t.scheme,i=t.port;if("blob"==e)try{return new URL(e.path[0]).origin}catch(t){return"null"}return"file"!=e&&K(t)?e+"://"+z(t.host)+(null!==i?":"+i:""):"null"},It=function(){return x(this).scheme+":"},Pt=function(){return x(this).username},qt=function(){return x(this).password},Rt=function(){var t=x(this),e=t.host,i=t.port;return null===e?"":null===i?z(e):z(e)+":"+i},Ft=function(){var t=x(this).host;return null===t?"":z(t)},Mt=function(){var t=x(this).port;return null===t?"":String(t)},Dt=function(){var t=x(this),e=t.path;return t.cannotBeABaseURL?e[0]:e.length?"/"+e.join("/"):""},_t=function(){var t=x(this).query;return t?"?"+t:""},Bt=function(){return x(this).searchParams},Ut=function(){var t=x(this).fragment;return t?"#"+t:""},Ot=function(t,e){return{get:t,set:e,configurable:!0,enumerable:!0}};if(n&&l(Ct,{href:Ot(Tt,(function(t){var e=x(this),i=String(t),s=Lt(e,i);if(s)throw TypeError(s);E(e.searchParams).updateSearchParams(e.query)})),origin:Ot(kt),protocol:Ot(It,(function(t){var e=x(this);Lt(e,String(t)+":",st)})),username:Ot(Pt,(function(t){var e=x(this),i=p(String(t));if(!Y(e)){e.username="";for(var s=0;s<i.length;s++)e.username+=$(i[s],G)}})),password:Ot(qt,(function(t){var e=x(this),i=p(String(t));if(!Y(e)){e.password="";for(var s=0;s<i.length;s++)e.password+=$(i[s],G)}})),host:Ot(Rt,(function(t){var e=x(this);e.cannotBeABaseURL||Lt(e,String(t),pt)})),hostname:Ot(Ft,(function(t){var e=x(this);e.cannotBeABaseURL||Lt(e,String(t),gt)})),port:Ot(Mt,(function(t){var e=x(this);Y(e)||(""==(t=String(t))?e.port=null:Lt(e,t,mt))})),pathname:Ot(Dt,(function(t){var e=x(this);e.cannotBeABaseURL||(e.path=[],Lt(e,t+"",yt))})),search:Ot(_t,(function(t){var e=x(this);""==(t=String(t))?e.query=null:("?"==t.charAt(0)&&(t=t.slice(1)),e.query="",Lt(e,t,St)),E(e.searchParams).updateSearchParams(e.query)})),searchParams:Ot(Bt),hash:Ot(Ut,(function(t){var e=x(this);""!=(t=String(t))?("#"==t.charAt(0)&&(t=t.slice(1)),e.fragment="",Lt(e,t,xt)):e.fragment=null}))}),c(Ct,"toJSON",(function(){return Tt.call(this)}),{enumerable:!0}),c(Ct,"toString",(function(){return Tt.call(this)}),{enumerable:!0}),y){var Wt=y.createObjectURL,Zt=y.revokeObjectURL;Wt&&c(At,"createObjectURL",(function(t){return Wt.apply(y,arguments)})),Zt&&c(At,"revokeObjectURL",(function(t){return Zt.apply(y,arguments)}))}f(At,"URL"),o({global:!0,forced:!r,sham:!n},{URL:At})}},e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={exports:{}};return t[s](o,o.exports,i),o.exports}i.d=function(t,e){for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};return function(){"use strict";function t(t,i){var s;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(s=function(t,i){if(t){if("string"==typeof t)return e(t,i);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?e(t,i):void 0}}(t))||i&&t&&"number"==typeof t.length){s&&(t=s);var o=0,n=function(){};return{s:n,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,l=!1;return{s:function(){s=t[Symbol.iterator]()},n:function(){var t=s.next();return a=t.done,t},e:function(t){l=!0,r=t},f:function(){try{a||null==s.return||s.return()}finally{if(l)throw r}}}}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function o(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}i.r(s),i.d(s,{Dropzone:function(){return b},default:function(){return A}}),i(2222),i(7327),i(2772),i(6992),i(1249),i(7042),i(561),i(8264),i(8309),i(489),i(1539),i(4916),i(9714),i(8783),i(4723),i(5306),i(3123),i(3210),i(2472),i(2990),i(8927),i(3105),i(5035),i(4345),i(7174),i(2846),i(4731),i(7209),i(6319),i(8867),i(7789),i(3739),i(9368),i(4483),i(2056),i(3462),i(678),i(7462),i(3824),i(5021),i(2974),i(5016),i(4747),i(3948),i(285);var n=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e)}var i,s,n;return i=e,s=[{key:"on",value:function(t,e){return this._callbacks=this._callbacks||{},this._callbacks[t]||(this._callbacks[t]=[]),this._callbacks[t].push(e),this}},{key:"emit",value:function(e){this._callbacks=this._callbacks||{};for(var i=this._callbacks[e],s=arguments.length,o=new Array(s>1?s-1:0),n=1;n<s;n++)o[n-1]=arguments[n];if(i){var r,a=t(i,!0);try{for(a.s();!(r=a.n()).done;)r.value.apply(this,o)}catch(t){a.e(t)}finally{a.f()}}return this.element&&this.element.dispatchEvent(this.makeEvent("dropzone:"+e,{args:o})),this}},{key:"makeEvent",value:function(t,e){var i={bubbles:!0,cancelable:!0,detail:e};if("function"==typeof window.CustomEvent)return new CustomEvent(t,i);var s=document.createEvent("CustomEvent");return s.initCustomEvent(t,i.bubbles,i.cancelable,i.detail),s}},{key:"off",value:function(t,e){if(!this._callbacks||0===arguments.length)return this._callbacks={},this;var i=this._callbacks[t];if(!i)return this;if(1===arguments.length)return delete this._callbacks[t],this;for(var s=0;s<i.length;s++)if(i[s]===e){i.splice(s,1);break}return this}}],s&&o(i.prototype,s),n&&o(i,n),e}();function r(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return a(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var s=0,o=function(){};return{s:o,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r=!0,l=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return r=t.done,t},e:function(t){l=!0,n=t},f:function(){try{r||null==i.return||i.return()}finally{if(l)throw n}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}var l={url:null,method:"post",withCredentials:!1,timeout:null,parallelUploads:2,uploadMultiple:!1,chunking:!1,forceChunking:!1,chunkSize:2e6,parallelChunkUploads:!1,retryChunks:!1,retryChunksLimit:3,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,thumbnailMethod:"crop",resizeWidth:null,resizeHeight:null,resizeMimeType:null,resizeQuality:.8,resizeMethod:"contain",filesizeBase:1e3,maxFiles:null,headers:null,clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,disablePreviews:!1,hiddenInputContainer:"body",capture:null,renameFilename:null,renameFile:null,forceFallback:!1,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictUploadCanceled:"Upload canceled.",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",dictFileSizeUnits:{tb:"TB",gb:"GB",mb:"MB",kb:"KB",b:"b"},init:function(){},params:function(t,e,i){if(i)return{dzuuid:i.file.upload.uuid,dzchunkindex:i.index,dztotalfilesize:i.file.size,dzchunksize:this.options.chunkSize,dztotalchunkcount:i.file.upload.totalChunkCount,dzchunkbyteoffset:i.index*this.options.chunkSize}},accept:function(t,e){return e()},chunksUploaded:function(t,e){e()},fallback:function(){var t;this.element.className="".concat(this.element.className," dz-browser-not-supported");var e,i=r(this.element.getElementsByTagName("div"),!0);try{for(i.s();!(e=i.n()).done;){var s=e.value;if(/(^| )dz-message($| )/.test(s.className)){t=s,s.className="dz-message";break}}}catch(t){i.e(t)}finally{i.f()}t||(t=b.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(t));var o=t.getElementsByTagName("span")[0];return o&&(null!=o.textContent?o.textContent=this.options.dictFallbackMessage:null!=o.innerText&&(o.innerText=this.options.dictFallbackMessage)),this.element.appendChild(this.getFallbackForm())},resize:function(t,e,i,s){var o={srcX:0,srcY:0,srcWidth:t.width,srcHeight:t.height},n=t.width/t.height;null==e&&null==i?(e=o.srcWidth,i=o.srcHeight):null==e?e=i*n:null==i&&(i=e/n);var r=(e=Math.min(e,o.srcWidth))/(i=Math.min(i,o.srcHeight));if(o.srcWidth>e||o.srcHeight>i)if("crop"===s)n>r?(o.srcHeight=t.height,o.srcWidth=o.srcHeight*r):(o.srcWidth=t.width,o.srcHeight=o.srcWidth/r);else{if("contain"!==s)throw new Error("Unknown resizeMethod '".concat(s,"'"));n>r?i=e/n:e=i*n}return o.srcX=(t.width-o.srcWidth)/2,o.srcY=(t.height-o.srcHeight)/2,o.trgWidth=e,o.trgHeight=i,o},transformFile:function(t,e){return(this.options.resizeWidth||this.options.resizeHeight)&&t.type.match(/image.*/)?this.resizeImage(t,this.options.resizeWidth,this.options.resizeHeight,this.options.resizeMethod,e):e(t)},previewTemplate:'<div class="dz-preview dz-file-preview"> <div class="dz-image"><img data-dz-thumbnail/></div> <div class="dz-details"> <div class="dz-size"><span data-dz-size></span></div> <div class="dz-filename"><span data-dz-name></span></div> </div> <div class="dz-progress"> <span class="dz-upload" data-dz-uploadprogress></span> </div> <div class="dz-error-message"><span data-dz-errormessage></span></div> <div class="dz-success-mark"> <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <title>Check</title> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF"></path> </g> </svg> </div> <div class="dz-error-mark"> <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <title>Error</title> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475"> <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z"></path> </g> </g> </svg> </div> </div> ',drop:function(t){return this.element.classList.remove("dz-drag-hover")},dragstart:function(t){},dragend:function(t){return this.element.classList.remove("dz-drag-hover")},dragenter:function(t){return this.element.classList.add("dz-drag-hover")},dragover:function(t){return this.element.classList.add("dz-drag-hover")},dragleave:function(t){return this.element.classList.remove("dz-drag-hover")},paste:function(t){},reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(t){var e=this;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer&&!this.options.disablePreviews){t.previewElement=b.createElement(this.options.previewTemplate.trim()),t.previewTemplate=t.previewElement,this.previewsContainer.appendChild(t.previewElement);var i,s=r(t.previewElement.querySelectorAll("[data-dz-name]"),!0);try{for(s.s();!(i=s.n()).done;){var o=i.value;o.textContent=t.name}}catch(t){s.e(t)}finally{s.f()}var n,a=r(t.previewElement.querySelectorAll("[data-dz-size]"),!0);try{for(a.s();!(n=a.n()).done;)(o=n.value).innerHTML=this.filesize(t.size)}catch(t){a.e(t)}finally{a.f()}this.options.addRemoveLinks&&(t._removeLink=b.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'.concat(this.options.dictRemoveFile,"</a>")),t.previewElement.appendChild(t._removeLink));var l,c=function(i){return i.preventDefault(),i.stopPropagation(),t.status===b.UPLOADING?b.confirm(e.options.dictCancelUploadConfirmation,(function(){return e.removeFile(t)})):e.options.dictRemoveFileConfirmation?b.confirm(e.options.dictRemoveFileConfirmation,(function(){return e.removeFile(t)})):e.removeFile(t)},d=r(t.previewElement.querySelectorAll("[data-dz-remove]"),!0);try{for(d.s();!(l=d.n()).done;)l.value.addEventListener("click",c)}catch(t){d.e(t)}finally{d.f()}}},removedfile:function(t){return null!=t.previewElement&&null!=t.previewElement.parentNode&&t.previewElement.parentNode.removeChild(t.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(t,e){if(t.previewElement){t.previewElement.classList.remove("dz-file-preview");var i,s=r(t.previewElement.querySelectorAll("[data-dz-thumbnail]"),!0);try{for(s.s();!(i=s.n()).done;){var o=i.value;o.alt=t.name,o.src=e}}catch(t){s.e(t)}finally{s.f()}return setTimeout((function(){return t.previewElement.classList.add("dz-image-preview")}),1)}},error:function(t,e){if(t.previewElement){t.previewElement.classList.add("dz-error"),"string"!=typeof e&&e.error&&(e=e.error);var i,s=r(t.previewElement.querySelectorAll("[data-dz-errormessage]"),!0);try{for(s.s();!(i=s.n()).done;)i.value.textContent=e}catch(t){s.e(t)}finally{s.f()}}},errormultiple:function(){},processing:function(t){if(t.previewElement&&(t.previewElement.classList.add("dz-processing"),t._removeLink))return t._removeLink.innerHTML=this.options.dictCancelUpload},processingmultiple:function(){},uploadprogress:function(t,e,i){if(t.previewElement){var s,o=r(t.previewElement.querySelectorAll("[data-dz-uploadprogress]"),!0);try{for(o.s();!(s=o.n()).done;){var n=s.value;"PROGRESS"===n.nodeName?n.value=e:n.style.width="".concat(e,"%")}}catch(t){o.e(t)}finally{o.f()}}},totaluploadprogress:function(){},sending:function(){},sendingmultiple:function(){},success:function(t){if(t.previewElement)return t.previewElement.classList.add("dz-success")},successmultiple:function(){},canceled:function(t){return this.emit("error",t,this.options.dictUploadCanceled)},canceledmultiple:function(){},complete:function(t){if(t._removeLink&&(t._removeLink.innerHTML=this.options.dictRemoveFile),t.previewElement)return t.previewElement.classList.add("dz-complete")},completemultiple:function(){},maxfilesexceeded:function(){},maxfilesreached:function(){},queuecomplete:function(){},addedfiles:function(){}};function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function d(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return u(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?u(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var s=0,o=function(){};return{s:o,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r=!0,a=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return r=t.done,t},e:function(t){a=!0,n=t},f:function(){try{r||null==i.return||i.return()}finally{if(a)throw n}}}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function g(t,e,i){return e&&p(t.prototype,e),i&&p(t,i),t}function m(t,e){return m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},m(t,e)}function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=y(t);if(e){var o=y(this).constructor;i=Reflect.construct(s,arguments,o)}else i=s.apply(this,arguments);return v(this,i)}}function v(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?w(t):e}function w(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},y(t)}var b=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)}(i,t);var e=f(i);function i(t,s){var o,n,r;if(h(this,i),(o=e.call(this)).element=t,o.version=i.version,o.clickableElements=[],o.listeners=[],o.files=[],"string"==typeof o.element&&(o.element=document.querySelector(o.element)),!o.element||null==o.element.nodeType)throw new Error("Invalid dropzone element.");if(o.element.dropzone)throw new Error("Dropzone already attached.");i.instances.push(w(o)),o.element.dropzone=w(o);var a=null!=(r=i.optionsForElement(o.element))?r:{};if(o.options=i.extend({},l,a,null!=s?s:{}),o.options.previewTemplate=o.options.previewTemplate.replace(/\n*/g,""),o.options.forceFallback||!i.isBrowserSupported())return v(o,o.options.fallback.call(w(o)));if(null==o.options.url&&(o.options.url=o.element.getAttribute("action")),!o.options.url)throw new Error("No URL provided.");if(o.options.acceptedFiles&&o.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");if(o.options.uploadMultiple&&o.options.chunking)throw new Error("You cannot set both: uploadMultiple and chunking.");return o.options.acceptedMimeTypes&&(o.options.acceptedFiles=o.options.acceptedMimeTypes,delete o.options.acceptedMimeTypes),null!=o.options.renameFilename&&(o.options.renameFile=function(t){return o.options.renameFilename.call(w(o),t.name,t)}),"string"==typeof o.options.method&&(o.options.method=o.options.method.toUpperCase()),(n=o.getExistingFallback())&&n.parentNode&&n.parentNode.removeChild(n),!1!==o.options.previewsContainer&&(o.options.previewsContainer?o.previewsContainer=i.getElement(o.options.previewsContainer,"previewsContainer"):o.previewsContainer=o.element),o.options.clickable&&(!0===o.options.clickable?o.clickableElements=[o.element]:o.clickableElements=i.getElements(o.options.clickable,"clickable")),o.init(),o}return g(i,[{key:"getAcceptedFiles",value:function(){return this.files.filter((function(t){return t.accepted})).map((function(t){return t}))}},{key:"getRejectedFiles",value:function(){return this.files.filter((function(t){return!t.accepted})).map((function(t){return t}))}},{key:"getFilesWithStatus",value:function(t){return this.files.filter((function(e){return e.status===t})).map((function(t){return t}))}},{key:"getQueuedFiles",value:function(){return this.getFilesWithStatus(i.QUEUED)}},{key:"getUploadingFiles",value:function(){return this.getFilesWithStatus(i.UPLOADING)}},{key:"getAddedFiles",value:function(){return this.getFilesWithStatus(i.ADDED)}},{key:"getActiveFiles",value:function(){return this.files.filter((function(t){return t.status===i.UPLOADING||t.status===i.QUEUED})).map((function(t){return t}))}},{key:"init",value:function(){var t=this;"form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(i.createElement('<div class="dz-default dz-message"><button class="dz-button" type="button">'.concat(this.options.dictDefaultMessage,"</button></div>"))),this.clickableElements.length&&function e(){t.hiddenFileInput&&t.hiddenFileInput.parentNode.removeChild(t.hiddenFileInput),t.hiddenFileInput=document.createElement("input"),t.hiddenFileInput.setAttribute("type","file"),(null===t.options.maxFiles||t.options.maxFiles>1)&&t.hiddenFileInput.setAttribute("multiple","multiple"),t.hiddenFileInput.className="dz-hidden-input",null!==t.options.acceptedFiles&&t.hiddenFileInput.setAttribute("accept",t.options.acceptedFiles),null!==t.options.capture&&t.hiddenFileInput.setAttribute("capture",t.options.capture),t.hiddenFileInput.setAttribute("tabindex","-1"),t.hiddenFileInput.style.visibility="hidden",t.hiddenFileInput.style.position="absolute",t.hiddenFileInput.style.top="0",t.hiddenFileInput.style.left="0",t.hiddenFileInput.style.height="0",t.hiddenFileInput.style.width="0",i.getElement(t.options.hiddenInputContainer,"hiddenInputContainer").appendChild(t.hiddenFileInput),t.hiddenFileInput.addEventListener("change",(function(){var i=t.hiddenFileInput.files;if(i.length){var s,o=d(i,!0);try{for(o.s();!(s=o.n()).done;){var n=s.value;t.addFile(n)}}catch(t){o.e(t)}finally{o.f()}}t.emit("addedfiles",i),e()}))}(),this.URL=null!==window.URL?window.URL:window.webkitURL;var e,s=d(this.events,!0);try{for(s.s();!(e=s.n()).done;){var o=e.value;this.on(o,this.options[o])}}catch(t){s.e(t)}finally{s.f()}this.on("uploadprogress",(function(){return t.updateTotalUploadProgress()})),this.on("removedfile",(function(){return t.updateTotalUploadProgress()})),this.on("canceled",(function(e){return t.emit("complete",e)})),this.on("complete",(function(e){if(0===t.getAddedFiles().length&&0===t.getUploadingFiles().length&&0===t.getQueuedFiles().length)return setTimeout((function(){return t.emit("queuecomplete")}),0)}));var n=function(t){if(function(t){if(t.dataTransfer.types)for(var e=0;e<t.dataTransfer.types.length;e++)if("Files"===t.dataTransfer.types[e])return!0;return!1}(t))return t.stopPropagation(),t.preventDefault?t.preventDefault():t.returnValue=!1};return this.listeners=[{element:this.element,events:{dragstart:function(e){return t.emit("dragstart",e)},dragenter:function(e){return n(e),t.emit("dragenter",e)},dragover:function(e){var i;try{i=e.dataTransfer.effectAllowed}catch(t){}return e.dataTransfer.dropEffect="move"===i||"linkMove"===i?"move":"copy",n(e),t.emit("dragover",e)},dragleave:function(e){return t.emit("dragleave",e)},drop:function(e){return n(e),t.drop(e)},dragend:function(e){return t.emit("dragend",e)}}}],this.clickableElements.forEach((function(e){return t.listeners.push({element:e,events:{click:function(s){return(e!==t.element||s.target===t.element||i.elementInside(s.target,t.element.querySelector(".dz-message")))&&t.hiddenFileInput.click(),!0}}})})),this.enable(),this.options.init.call(this)}},{key:"destroy",value:function(){return this.disable(),this.removeAllFiles(!0),(null!=this.hiddenFileInput?this.hiddenFileInput.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,i.instances.splice(i.instances.indexOf(this),1)}},{key:"updateTotalUploadProgress",value:function(){var t,e=0,i=0;if(this.getActiveFiles().length){var s,o=d(this.getActiveFiles(),!0);try{for(o.s();!(s=o.n()).done;){var n=s.value;e+=n.upload.bytesSent,i+=n.upload.total}}catch(t){o.e(t)}finally{o.f()}t=100*e/i}else t=100;return this.emit("totaluploadprogress",t,i,e)}},{key:"_getParamName",value:function(t){return"function"==typeof this.options.paramName?this.options.paramName(t):"".concat(this.options.paramName).concat(this.options.uploadMultiple?"[".concat(t,"]"):"")}},{key:"_renameFile",value:function(t){return"function"!=typeof this.options.renameFile?t.name:this.options.renameFile(t)}},{key:"getFallbackForm",value:function(){var t,e;if(t=this.getExistingFallback())return t;var s='<div class="dz-fallback">';this.options.dictFallbackText&&(s+="<p>".concat(this.options.dictFallbackText,"</p>")),s+='<input type="file" name="'.concat(this._getParamName(0),'" ').concat(this.options.uploadMultiple?'multiple="multiple"':void 0,' /><input type="submit" value="Upload!"></div>');var o=i.createElement(s);return"FORM"!==this.element.tagName?(e=i.createElement('<form action="'.concat(this.options.url,'" enctype="multipart/form-data" method="').concat(this.options.method,'"></form>'))).appendChild(o):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=e?e:o}},{key:"getExistingFallback",value:function(){for(var t=function(t){var e,i=d(t,!0);try{for(i.s();!(e=i.n()).done;){var s=e.value;if(/(^| )fallback($| )/.test(s.className))return s}}catch(t){i.e(t)}finally{i.f()}},e=0,i=["div","form"];e<i.length;e++){var s,o=i[e];if(s=t(this.element.getElementsByTagName(o)))return s}}},{key:"setupEventListeners",value:function(){return this.listeners.map((function(t){return function(){var e=[];for(var i in t.events){var s=t.events[i];e.push(t.element.addEventListener(i,s,!1))}return e}()}))}},{key:"removeEventListeners",value:function(){return this.listeners.map((function(t){return function(){var e=[];for(var i in t.events){var s=t.events[i];e.push(t.element.removeEventListener(i,s,!1))}return e}()}))}},{key:"disable",value:function(){var t=this;return this.clickableElements.forEach((function(t){return t.classList.remove("dz-clickable")})),this.removeEventListeners(),this.disabled=!0,this.files.map((function(e){return t.cancelUpload(e)}))}},{key:"enable",value:function(){return delete this.disabled,this.clickableElements.forEach((function(t){return t.classList.add("dz-clickable")})),this.setupEventListeners()}},{key:"filesize",value:function(t){var e=0,i="b";if(t>0){for(var s=["tb","gb","mb","kb","b"],o=0;o<s.length;o++){var n=s[o];if(t>=Math.pow(this.options.filesizeBase,4-o)/10){e=t/Math.pow(this.options.filesizeBase,4-o),i=n;break}}e=Math.round(10*e)/10}return"<strong>".concat(e,"</strong> ").concat(this.options.dictFileSizeUnits[i])}},{key:"_updateMaxFilesReachedClass",value:function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")}},{key:"drop",value:function(t){if(t.dataTransfer){this.emit("drop",t);for(var e=[],i=0;i<t.dataTransfer.files.length;i++)e[i]=t.dataTransfer.files[i];if(e.length){var s=t.dataTransfer.items;s&&s.length&&null!=s[0].webkitGetAsEntry?this._addFilesFromItems(s):this.handleFiles(e)}this.emit("addedfiles",e)}}},{key:"paste",value:function(t){if(null!=(e=null!=t?t.clipboardData:void 0,i=function(t){return t.items},null!=e?i(e):void 0)){var e,i;this.emit("paste",t);var s=t.clipboardData.items;return s.length?this._addFilesFromItems(s):void 0}}},{key:"handleFiles",value:function(t){var e,i=d(t,!0);try{for(i.s();!(e=i.n()).done;){var s=e.value;this.addFile(s)}}catch(t){i.e(t)}finally{i.f()}}},{key:"_addFilesFromItems",value:function(t){var e=this;return function(){var i,s=[],o=d(t,!0);try{for(o.s();!(i=o.n()).done;){var n,r=i.value;null!=r.webkitGetAsEntry&&(n=r.webkitGetAsEntry())?n.isFile?s.push(e.addFile(r.getAsFile())):n.isDirectory?s.push(e._addFilesFromDirectory(n,n.name)):s.push(void 0):null==r.getAsFile||null!=r.kind&&"file"!==r.kind?s.push(void 0):s.push(e.addFile(r.getAsFile()))}}catch(t){o.e(t)}finally{o.f()}return s}()}},{key:"_addFilesFromDirectory",value:function(t,e){var i=this,s=t.createReader(),o=function(t){return e=console,i="log",s=function(e){return e.log(t)},null!=e&&"function"==typeof e[i]?s(e,i):void 0;var e,i,s};return function t(){return s.readEntries((function(s){if(s.length>0){var o,n=d(s,!0);try{for(n.s();!(o=n.n()).done;){var r=o.value;r.isFile?r.file((function(t){if(!i.options.ignoreHiddenFiles||"."!==t.name.substring(0,1))return t.fullPath="".concat(e,"/").concat(t.name),i.addFile(t)})):r.isDirectory&&i._addFilesFromDirectory(r,"".concat(e,"/").concat(r.name))}}catch(t){n.e(t)}finally{n.f()}t()}return null}),o)}()}},{key:"accept",value:function(t,e){this.options.maxFilesize&&t.size>1024*this.options.maxFilesize*1024?e(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(t.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):i.isValidFile(t,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(e(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",t)):this.options.accept.call(this,t,e):e(this.options.dictInvalidFileType)}},{key:"addFile",value:function(t){var e=this;t.upload={uuid:i.uuidv4(),progress:0,total:t.size,bytesSent:0,filename:this._renameFile(t)},this.files.push(t),t.status=i.ADDED,this.emit("addedfile",t),this._enqueueThumbnail(t),this.accept(t,(function(i){i?(t.accepted=!1,e._errorProcessing([t],i)):(t.accepted=!0,e.options.autoQueue&&e.enqueueFile(t)),e._updateMaxFilesReachedClass()}))}},{key:"enqueueFiles",value:function(t){var e,i=d(t,!0);try{for(i.s();!(e=i.n()).done;){var s=e.value;this.enqueueFile(s)}}catch(t){i.e(t)}finally{i.f()}return null}},{key:"enqueueFile",value:function(t){var e=this;if(t.status!==i.ADDED||!0!==t.accepted)throw new Error("This file can't be queued because it has already been processed or was rejected.");if(t.status=i.QUEUED,this.options.autoProcessQueue)return setTimeout((function(){return e.processQueue()}),0)}},{key:"_enqueueThumbnail",value:function(t){var e=this;if(this.options.createImageThumbnails&&t.type.match(/image.*/)&&t.size<=1024*this.options.maxThumbnailFilesize*1024)return this._thumbnailQueue.push(t),setTimeout((function(){return e._processThumbnailQueue()}),0)}},{key:"_processThumbnailQueue",value:function(){var t=this;if(!this._processingThumbnail&&0!==this._thumbnailQueue.length){this._processingThumbnail=!0;var e=this._thumbnailQueue.shift();return this.createThumbnail(e,this.options.thumbnailWidth,this.options.thumbnailHeight,this.options.thumbnailMethod,!0,(function(i){return t.emit("thumbnail",e,i),t._processingThumbnail=!1,t._processThumbnailQueue()}))}}},{key:"removeFile",value:function(t){if(t.status===i.UPLOADING&&this.cancelUpload(t),this.files=E(this.files,t),this.emit("removedfile",t),0===this.files.length)return this.emit("reset")}},{key:"removeAllFiles",value:function(t){null==t&&(t=!1);var e,s=d(this.files.slice(),!0);try{for(s.s();!(e=s.n()).done;){var o=e.value;(o.status!==i.UPLOADING||t)&&this.removeFile(o)}}catch(t){s.e(t)}finally{s.f()}return null}},{key:"resizeImage",value:function(t,e,s,o,n){var r=this;return this.createThumbnail(t,e,s,o,!0,(function(e,s){if(null==s)return n(t);var o=r.options.resizeMimeType;null==o&&(o=t.type);var a=s.toDataURL(o,r.options.resizeQuality);return"image/jpeg"!==o&&"image/jpg"!==o||(a=L.restore(t.dataURL,a)),n(i.dataURItoBlob(a))}))}},{key:"createThumbnail",value:function(t,e,i,s,o,n){var r=this,a=new FileReader;a.onload=function(){t.dataURL=a.result,"image/svg+xml"!==t.type?r.createThumbnailFromUrl(t,e,i,s,o,n):null!=n&&n(a.result)},a.readAsDataURL(t)}},{key:"displayExistingFile",value:function(t,e,i,s){var o=this,n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this.emit("addedfile",t),this.emit("complete",t),n?(t.dataURL=e,this.createThumbnailFromUrl(t,this.options.thumbnailWidth,this.options.thumbnailHeight,this.options.thumbnailMethod,this.options.fixOrientation,(function(e){o.emit("thumbnail",t,e),i&&i()}),s)):(this.emit("thumbnail",t,e),i&&i())}},{key:"createThumbnailFromUrl",value:function(t,e,i,s,o,n,r){var a=this,l=document.createElement("img");return r&&(l.crossOrigin=r),o="from-image"!=getComputedStyle(document.body).imageOrientation&&o,l.onload=function(){var r=function(t){return t(1)};return"undefined"!=typeof EXIF&&null!==EXIF&&o&&(r=function(t){return EXIF.getData(l,(function(){return t(EXIF.getTag(this,"Orientation"))}))}),r((function(o){t.width=l.width,t.height=l.height;var r=a.options.resize.call(a,t,e,i,s),c=document.createElement("canvas"),d=c.getContext("2d");switch(c.width=r.trgWidth,c.height=r.trgHeight,o>4&&(c.width=r.trgHeight,c.height=r.trgWidth),o){case 2:d.translate(c.width,0),d.scale(-1,1);break;case 3:d.translate(c.width,c.height),d.rotate(Math.PI);break;case 4:d.translate(0,c.height),d.scale(1,-1);break;case 5:d.rotate(.5*Math.PI),d.scale(1,-1);break;case 6:d.rotate(.5*Math.PI),d.translate(0,-c.width);break;case 7:d.rotate(.5*Math.PI),d.translate(c.height,-c.width),d.scale(-1,1);break;case 8:d.rotate(-.5*Math.PI),d.translate(-c.height,0)}x(d,l,null!=r.srcX?r.srcX:0,null!=r.srcY?r.srcY:0,r.srcWidth,r.srcHeight,null!=r.trgX?r.trgX:0,null!=r.trgY?r.trgY:0,r.trgWidth,r.trgHeight);var u=c.toDataURL("image/png");if(null!=n)return n(u,c)}))},null!=n&&(l.onerror=n),l.src=t.dataURL}},{key:"processQueue",value:function(){var t=this.options.parallelUploads,e=this.getUploadingFiles().length,i=e;if(!(e>=t)){var s=this.getQueuedFiles();if(s.length>0){if(this.options.uploadMultiple)return this.processFiles(s.slice(0,t-e));for(;i<t;){if(!s.length)return;this.processFile(s.shift()),i++}}}}},{key:"processFile",value:function(t){return this.processFiles([t])}},{key:"processFiles",value:function(t){var e,s=d(t,!0);try{for(s.s();!(e=s.n()).done;){var o=e.value;o.processing=!0,o.status=i.UPLOADING,this.emit("processing",o)}}catch(t){s.e(t)}finally{s.f()}return this.options.uploadMultiple&&this.emit("processingmultiple",t),this.uploadFiles(t)}},{key:"_getFilesWithXhr",value:function(t){return this.files.filter((function(e){return e.xhr===t})).map((function(t){return t}))}},{key:"cancelUpload",value:function(t){if(t.status===i.UPLOADING){var e,s=this._getFilesWithXhr(t.xhr),o=d(s,!0);try{for(o.s();!(e=o.n()).done;)e.value.status=i.CANCELED}catch(t){o.e(t)}finally{o.f()}void 0!==t.xhr&&t.xhr.abort();var n,r=d(s,!0);try{for(r.s();!(n=r.n()).done;){var a=n.value;this.emit("canceled",a)}}catch(t){r.e(t)}finally{r.f()}this.options.uploadMultiple&&this.emit("canceledmultiple",s)}else t.status!==i.ADDED&&t.status!==i.QUEUED||(t.status=i.CANCELED,this.emit("canceled",t),this.options.uploadMultiple&&this.emit("canceledmultiple",[t]));if(this.options.autoProcessQueue)return this.processQueue()}},{key:"resolveOption",value:function(t){if("function"==typeof t){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];return t.apply(this,i)}return t}},{key:"uploadFile",value:function(t){return this.uploadFiles([t])}},{key:"uploadFiles",value:function(t){var e=this;this._transformFiles(t,(function(s){if(e.options.chunking){var o=s[0];t[0].upload.chunked=e.options.chunking&&(e.options.forceChunking||o.size>e.options.chunkSize),t[0].upload.totalChunkCount=Math.ceil(o.size/e.options.chunkSize)}if(t[0].upload.chunked){var n=t[0],r=s[0];n.upload.chunks=[];var a=function(){for(var s=0;void 0!==n.upload.chunks[s];)s++;if(!(s>=n.upload.totalChunkCount)){var o=s*e.options.chunkSize,a=Math.min(o+e.options.chunkSize,r.size),l={name:e._getParamName(0),data:r.webkitSlice?r.webkitSlice(o,a):r.slice(o,a),filename:n.upload.filename,chunkIndex:s};n.upload.chunks[s]={file:n,index:s,dataBlock:l,status:i.UPLOADING,progress:0,retries:0},e._uploadData(t,[l])}};if(n.upload.finishedChunkUpload=function(s,o){var r=!0;s.status=i.SUCCESS,s.dataBlock=null,s.xhr=null;for(var l=0;l<n.upload.totalChunkCount;l++){if(void 0===n.upload.chunks[l])return a();n.upload.chunks[l].status!==i.SUCCESS&&(r=!1)}r&&e.options.chunksUploaded(n,(function(){e._finished(t,o,null)}))},e.options.parallelChunkUploads)for(var l=0;l<n.upload.totalChunkCount;l++)a();else a()}else{for(var c=[],d=0;d<t.length;d++)c[d]={name:e._getParamName(d),data:s[d],filename:t[d].upload.filename};e._uploadData(t,c)}}))}},{key:"_getChunk",value:function(t,e){for(var i=0;i<t.upload.totalChunkCount;i++)if(void 0!==t.upload.chunks[i]&&t.upload.chunks[i].xhr===e)return t.upload.chunks[i]}},{key:"_uploadData",value:function(t,e){var s,o=this,n=new XMLHttpRequest,r=d(t,!0);try{for(r.s();!(s=r.n()).done;)s.value.xhr=n}catch(t){r.e(t)}finally{r.f()}t[0].upload.chunked&&(t[0].upload.chunks[e[0].chunkIndex].xhr=n);var a=this.resolveOption(this.options.method,t),l=this.resolveOption(this.options.url,t);n.open(a,l,!0),this.resolveOption(this.options.timeout,t)&&(n.timeout=this.resolveOption(this.options.timeout,t)),n.withCredentials=!!this.options.withCredentials,n.onload=function(e){o._finishedUploading(t,n,e)},n.ontimeout=function(){o._handleUploadError(t,n,"Request timedout after ".concat(o.options.timeout/1e3," seconds"))},n.onerror=function(){o._handleUploadError(t,n)},(null!=n.upload?n.upload:n).onprogress=function(e){return o._updateFilesUploadProgress(t,n,e)};var c={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"};for(var u in this.options.headers&&i.extend(c,this.options.headers),c){var h=c[u];h&&n.setRequestHeader(u,h)}var p=new FormData;if(this.options.params){var g=this.options.params;for(var m in"function"==typeof g&&(g=g.call(this,t,n,t[0].upload.chunked?this._getChunk(t[0],n):null)),g){var f=g[m];if(Array.isArray(f))for(var v=0;v<f.length;v++)p.append(m,f[v]);else p.append(m,f)}}var w,y=d(t,!0);try{for(y.s();!(w=y.n()).done;){var b=w.value;this.emit("sending",b,n,p)}}catch(t){y.e(t)}finally{y.f()}this.options.uploadMultiple&&this.emit("sendingmultiple",t,n,p),this._addFormElementData(p);for(var E=0;E<e.length;E++){var S=e[E];p.append(S.name,S.data,S.filename)}this.submitRequest(n,p,t)}},{key:"_transformFiles",value:function(t,e){for(var i=this,s=[],o=0,n=function(n){i.options.transformFile.call(i,t[n],(function(i){s[n]=i,++o===t.length&&e(s)}))},r=0;r<t.length;r++)n(r)}},{key:"_addFormElementData",value:function(t){if("FORM"===this.element.tagName){var e,i=d(this.element.querySelectorAll("input, textarea, select, button"),!0);try{for(i.s();!(e=i.n()).done;){var s=e.value,o=s.getAttribute("name"),n=s.getAttribute("type");if(n&&(n=n.toLowerCase()),null!=o)if("SELECT"===s.tagName&&s.hasAttribute("multiple")){var r,a=d(s.options,!0);try{for(a.s();!(r=a.n()).done;){var l=r.value;l.selected&&t.append(o,l.value)}}catch(t){a.e(t)}finally{a.f()}}else(!n||"checkbox"!==n&&"radio"!==n||s.checked)&&t.append(o,s.value)}}catch(t){i.e(t)}finally{i.f()}}}},{key:"_updateFilesUploadProgress",value:function(t,e,i){if(t[0].upload.chunked){var s=t[0],o=this._getChunk(s,e);i?(o.progress=100*i.loaded/i.total,o.total=i.total,o.bytesSent=i.loaded):(o.progress=100,o.bytesSent=o.total),s.upload.progress=0,s.upload.total=0,s.upload.bytesSent=0;for(var n=0;n<s.upload.totalChunkCount;n++)s.upload.chunks[n]&&void 0!==s.upload.chunks[n].progress&&(s.upload.progress+=s.upload.chunks[n].progress,s.upload.total+=s.upload.chunks[n].total,s.upload.bytesSent+=s.upload.chunks[n].bytesSent);s.upload.progress=s.upload.progress/s.upload.totalChunkCount,this.emit("uploadprogress",s,s.upload.progress,s.upload.bytesSent)}else{var r,a=d(t,!0);try{for(a.s();!(r=a.n()).done;){var l=r.value;l.upload.total&&l.upload.bytesSent&&l.upload.bytesSent==l.upload.total||(i?(l.upload.progress=100*i.loaded/i.total,l.upload.total=i.total,l.upload.bytesSent=i.loaded):(l.upload.progress=100,l.upload.bytesSent=l.upload.total),this.emit("uploadprogress",l,l.upload.progress,l.upload.bytesSent))}}catch(t){a.e(t)}finally{a.f()}}}},{key:"_finishedUploading",value:function(t,e,s){var o;if(t[0].status!==i.CANCELED&&4===e.readyState){if("arraybuffer"!==e.responseType&&"blob"!==e.responseType&&(o=e.responseText,e.getResponseHeader("content-type")&&~e.getResponseHeader("content-type").indexOf("application/json")))try{o=JSON.parse(o)}catch(t){s=t,o="Invalid JSON response from server."}this._updateFilesUploadProgress(t,e),200<=e.status&&e.status<300?t[0].upload.chunked?t[0].upload.finishedChunkUpload(this._getChunk(t[0],e),o):this._finished(t,o,s):this._handleUploadError(t,e,o)}}},{key:"_handleUploadError",value:function(t,e,s){if(t[0].status!==i.CANCELED){if(t[0].upload.chunked&&this.options.retryChunks){var o=this._getChunk(t[0],e);if(o.retries++<this.options.retryChunksLimit)return void this._uploadData(t,[o.dataBlock]);console.warn("Retried this chunk too often. Giving up.")}this._errorProcessing(t,s||this.options.dictResponseError.replace("{{statusCode}}",e.status),e)}}},{key:"submitRequest",value:function(t,e,i){1==t.readyState?t.send(e):console.warn("Cannot send this request because the XMLHttpRequest.readyState is not OPENED.")}},{key:"_finished",value:function(t,e,s){var o,n=d(t,!0);try{for(n.s();!(o=n.n()).done;){var r=o.value;r.status=i.SUCCESS,this.emit("success",r,e,s),this.emit("complete",r)}}catch(t){n.e(t)}finally{n.f()}if(this.options.uploadMultiple&&(this.emit("successmultiple",t,e,s),this.emit("completemultiple",t)),this.options.autoProcessQueue)return this.processQueue()}},{key:"_errorProcessing",value:function(t,e,s){var o,n=d(t,!0);try{for(n.s();!(o=n.n()).done;){var r=o.value;r.status=i.ERROR,this.emit("error",r,e,s),this.emit("complete",r)}}catch(t){n.e(t)}finally{n.f()}if(this.options.uploadMultiple&&(this.emit("errormultiple",t,e,s),this.emit("completemultiple",t)),this.options.autoProcessQueue)return this.processQueue()}}],[{key:"initClass",value:function(){this.prototype.Emitter=n,this.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","addedfiles","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],this.prototype._thumbnailQueue=[],this.prototype._processingThumbnail=!1}},{key:"extend",value:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];for(var o=0,n=i;o<n.length;o++){var r=n[o];for(var a in r){var l=r[a];t[a]=l}}return t}},{key:"uuidv4",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}}]),i}(n);b.initClass(),b.version="5.9.3",b.options={},b.optionsForElement=function(t){return t.getAttribute("id")?b.options[S(t.getAttribute("id"))]:void 0},b.instances=[],b.forElement=function(t){if("string"==typeof t&&(t=document.querySelector(t)),null==(null!=t?t.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return t.dropzone},b.autoDiscover=!0,b.discover=function(){var t;if(document.querySelectorAll)t=document.querySelectorAll(".dropzone");else{t=[];var e=function(e){return function(){var i,s=[],o=d(e,!0);try{for(o.s();!(i=o.n()).done;){var n=i.value;/(^| )dropzone($| )/.test(n.className)?s.push(t.push(n)):s.push(void 0)}}catch(t){o.e(t)}finally{o.f()}return s}()};e(document.getElementsByTagName("div")),e(document.getElementsByTagName("form"))}return function(){var e,i=[],s=d(t,!0);try{for(s.s();!(e=s.n()).done;){var o=e.value;!1!==b.optionsForElement(o)?i.push(new b(o)):i.push(void 0)}}catch(t){s.e(t)}finally{s.f()}return i}()},b.blockedBrowsers=[/opera.*(Macintosh|Windows Phone).*version\/12/i],b.isBrowserSupported=function(){var t=!0;if(window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a")){void 0!==b.blacklistedBrowsers&&(b.blockedBrowsers=b.blacklistedBrowsers);var e,i=d(b.blockedBrowsers,!0);try{for(i.s();!(e=i.n()).done;)e.value.test(navigator.userAgent)&&(t=!1)}catch(t){i.e(t)}finally{i.f()}}else t=!1;else t=!1;return t},b.dataURItoBlob=function(t){for(var e=atob(t.split(",")[1]),i=t.split(",")[0].split(":")[1].split(";")[0],s=new ArrayBuffer(e.length),o=new Uint8Array(s),n=0,r=e.length,a=0<=r;a?n<=r:n>=r;a?n++:n--)o[n]=e.charCodeAt(n);return new Blob([s],{type:i})};var E=function(t,e){return t.filter((function(t){return t!==e})).map((function(t){return t}))},S=function(t){return t.replace(/[\-_](\w)/g,(function(t){return t.charAt(1).toUpperCase()}))};b.createElement=function(t){var e=document.createElement("div");return e.innerHTML=t,e.childNodes[0]},b.elementInside=function(t,e){if(t===e)return!0;for(;t=t.parentNode;)if(t===e)return!0;return!1},b.getElement=function(t,e){var i;if("string"==typeof t?i=document.querySelector(t):null!=t.nodeType&&(i=t),null==i)throw new Error("Invalid `".concat(e,"` option provided. Please provide a CSS selector or a plain HTML element."));return i},b.getElements=function(t,e){var i,s;if(t instanceof Array){s=[];try{var o,n=d(t,!0);try{for(n.s();!(o=n.n()).done;)i=o.value,s.push(this.getElement(i,e))}catch(t){n.e(t)}finally{n.f()}}catch(t){s=null}}else if("string"==typeof t){s=[];var r,a=d(document.querySelectorAll(t),!0);try{for(a.s();!(r=a.n()).done;)i=r.value,s.push(i)}catch(t){a.e(t)}finally{a.f()}}else null!=t.nodeType&&(s=[t]);if(null==s||!s.length)throw new Error("Invalid `".concat(e,"` option provided. Please provide a CSS selector, a plain HTML element or a list of those."));return s},b.confirm=function(t,e,i){return window.confirm(t)?e():null!=i?i():void 0},b.isValidFile=function(t,e){if(!e)return!0;e=e.split(",");var i,s=t.type,o=s.replace(/\/.*$/,""),n=d(e,!0);try{for(n.s();!(i=n.n()).done;){var r=i.value;if("."===(r=r.trim()).charAt(0)){if(-1!==t.name.toLowerCase().indexOf(r.toLowerCase(),t.name.length-r.length))return!0}else if(/\/\*$/.test(r)){if(o===r.replace(/\/.*$/,""))return!0}else if(s===r)return!0}}catch(t){n.e(t)}finally{n.f()}return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(t){return this.each((function(){return new b(this,t)}))}),b.ADDED="added",b.QUEUED="queued",b.ACCEPTED=b.QUEUED,b.UPLOADING="uploading",b.PROCESSING=b.UPLOADING,b.CANCELED="canceled",b.ERROR="error",b.SUCCESS="success";var x=function(t,e,i,s,o,n,r,a,l,c){var d=function(t){t.naturalWidth;var e=t.naturalHeight,i=document.createElement("canvas");i.width=1,i.height=e;var s=i.getContext("2d");s.drawImage(t,0,0);for(var o=s.getImageData(1,0,1,e).data,n=0,r=e,a=e;a>n;)0===o[4*(a-1)+3]?r=a:n=a,a=r+n>>1;var l=a/e;return 0===l?1:l}(e);return t.drawImage(e,i,s,o,n,r,a,l,c/d)},L=function(){function t(){h(this,t)}return g(t,null,[{key:"initClass",value:function(){this.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}},{key:"encode64",value:function(t){for(var e="",i=void 0,s=void 0,o="",n=void 0,r=void 0,a=void 0,l="",c=0;n=(i=t[c++])>>2,r=(3&i)<<4|(s=t[c++])>>4,a=(15&s)<<2|(o=t[c++])>>6,l=63&o,isNaN(s)?a=l=64:isNaN(o)&&(l=64),e=e+this.KEY_STR.charAt(n)+this.KEY_STR.charAt(r)+this.KEY_STR.charAt(a)+this.KEY_STR.charAt(l),i=s=o="",n=r=a=l="",c<t.length;);return e}},{key:"restore",value:function(t,e){if(!t.match("data:image/jpeg;base64,"))return e;var i=this.decode64(t.replace("data:image/jpeg;base64,","")),s=this.slice2Segments(i),o=this.exifManipulation(e,s);return"data:image/jpeg;base64,".concat(this.encode64(o))}},{key:"exifManipulation",value:function(t,e){var i=this.getExifArray(e),s=this.insertExif(t,i);return new Uint8Array(s)}},{key:"getExifArray",value:function(t){for(var e=void 0,i=0;i<t.length;){if(255===(e=t[i])[0]&225===e[1])return e;i++}return[]}},{key:"insertExif",value:function(t,e){var i=t.replace("data:image/jpeg;base64,",""),s=this.decode64(i),o=s.indexOf(255,3),n=s.slice(0,o),r=s.slice(o),a=n;return a=(a=a.concat(e)).concat(r)}},{key:"slice2Segments",value:function(t){for(var e=0,i=[];!(255===t[e]&218===t[e+1]);){if(255===t[e]&216===t[e+1])e+=2;else{var s=e+(256*t[e+2]+t[e+3])+2,o=t.slice(e,s);i.push(o),e=s}if(e>t.length)break}return i}},{key:"decode64",value:function(t){var e=void 0,i=void 0,s="",o=void 0,n=void 0,r="",a=0,l=[];for(/[^A-Za-z0-9\+\/\=]/g.exec(t)&&console.warn("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");e=this.KEY_STR.indexOf(t.charAt(a++))<<2|(o=this.KEY_STR.indexOf(t.charAt(a++)))>>4,i=(15&o)<<4|(n=this.KEY_STR.indexOf(t.charAt(a++)))>>2,s=(3&n)<<6|(r=this.KEY_STR.indexOf(t.charAt(a++))),l.push(e),64!==n&&l.push(i),64!==r&&l.push(s),e=i=s="",o=n=r="",a<t.length;);return l}}]),t}();L.initClass(),b._autoDiscoverFunction=function(){if(b.autoDiscover)return b.discover()},function(t,e){var i=!1,s=!0,o=t.document,n=o.documentElement,r=o.addEventListener?"addEventListener":"attachEvent",a=o.addEventListener?"removeEventListener":"detachEvent",l=o.addEventListener?"":"on",c=function s(n){if("readystatechange"!==n.type||"complete"===o.readyState)return("load"===n.type?t:o)[a](l+n.type,s,!1),!i&&(i=!0)?e.call(t,n.type||n):void 0};if("complete"!==o.readyState){if(o.createEventObject&&n.doScroll){try{s=!t.frameElement}catch(t){}s&&function t(){try{n.doScroll("left")}catch(e){return void setTimeout(t,50)}return c("poll")}()}o[r](l+"DOMContentLoaded",c,!1),o[r](l+"readystatechange",c,!1),t[r](l+"load",c,!1)}}(window,b._autoDiscoverFunction),window.Dropzone=b;var A=b}(),s}()},t.exports=e()},362:(t,e,i)=>{"use strict";var s=i(584);class o extends s.Xt{constructor(t,e,i){super(t,e,i),this.editor=void 0,this.initEditor(),this.listenEvent(document,"epi:save:form",(t=>this.onBeforeSave(t)))}async initEditor(){await import("./ace/ace.js"),window.ace.config.set("basePath","/widgets/js/ace"),this.editor=window.ace.edit(this.widgetElement,{mode:"ace/mode/json",selectionStyle:"text",showPrintMargin:!1,indentedSoftWrap:!0,wrap:"free",theme:"ace/theme/chrome",fontSize:16}),this.editor.setValue(this.getInputValue()),setTimeout((()=>this.foldAll()),70)}foldAll(){const t=this.editor.getSession(),e=t.getLength();e>2&&t.foldAll(1,e-1)}getInputElement(){return this.widgetElement.parentElement.querySelector("input[type=hidden]")}getInputValue(){const t=this.getInputElement();let e=t&&t.value?t.value:"{}";try{e=JSON.parse(t.value),e=JSON.stringify(e,null,"  ")}catch{e=t.value}return e}onBeforeSave(t){this.getInputElement().value=this.editor.getValue()??""}}class n extends s.Xt{constructor(t,e,i){super(t,e,i),this.editor=null,EpiEditor.DocEditor.create(t).then((t=>{this.editor=t})),this.listenEvent(document,"epi:save:form",(t=>this.onBeforeSave(t)))}onBeforeSave(t){this.editor&&this.widgetElement&&(this.widgetElement.textContent=this.editor.getData())}}class r extends s.lf{constructor(t,e,i){super(t,e,i),this.isActivating=!1,this.position=!1,this.listenEvent(document,"epi:save:form",(t=>this.onBeforeSave(t)))}initWidget(t){this.initEditor()}initEditor(){const t=this,e=t.getDocumentWidget();e.editMode&&(this.widgetElement.getAttribute("contentenditable")||(this.widgetElement.setAttribute("contenteditable","true"),this.widgetElement.addEventListener("mouseenter",(function(e){t.createEditor()})),this.widgetElement.addEventListener("focusin",(function(e){t.activateEditor()}))),this.listenEvent(this.widgetElement,"tag:create",(t=>{e.models.tags.onCreateTag(this.widgetElement,t.detail.data)})),this.listenEvent(this.widgetElement,"tag:remove",(t=>{e.models.tags.onRemoveTag(this.widgetElement,t.detail.data)})))}createEditor(){const t=this;return t.widgetElement.editorPromise||(t.widgetElement.editorPromise=new Promise((function(e,i){const s=t.getDocumentWidget();t.widgetElement?s?t.widgetElement.ckeditorInstance?e(t.widgetElement.ckeditorInstance):s.models.types.getTagSet(t.widgetElement,!1).then((s=>{document.activeElement===t.widgetElement&&t.widgetElement.blur(),EpiEditor.XmlEditor.create(t.widgetElement,s).then((t=>{if(App.debug&&EpiEditor.CKEditorInspector){EpiEditor.CKEditorInspector.attach(t);const e=document.querySelector("footer");e&&(e.style.marginBottom="2em");const i=document.querySelector(".ck-inspector");i&&(i.style.paddingRight="3em",i.style.position="")}e(t)})).catch((t=>{i("XMLEditor could not be created: "+t)}))})).catch((t=>{i("XMLEditor config could not be loaded: "+t)})):i("Missing document"):i("Missing element")}))),t.widgetElement.editorPromise}posStore(){this.widgetElement&&(this.position=this.widgetElement.getBoundingClientRect())}posRestore(){if(this.position&&this.widgetElement){const t=this.widgetElement.getBoundingClientRect().top-this.position.top;if(0!==t){const e=this.widgetElement.closest(".widget-content-pane");if(e){e.getBoundingClientRect().top<this.position.top&&(e.scrollTop+=t)}}}}activateEditor(t=!0){if(this.isActivating)return;this.isActivating=!0;const e=this.getDocumentWidget();e&&this.createEditor().then((i=>{this.posStore(),e.attachToolbar(i.ui.view.toolbar.element),t&&(i.editing.view.focus(),this.posRestore()),this.isActivating=!1})).catch((t=>{console.log("XMLEditor could not be focused: "+t),this.isActivating=!1}))}removeTag(t){t&&(t instanceof Element&&(t=t.dataset.tagid),this.createEditor(this.widgetElement).then((e=>{e.plugins.get("XmlTagEditing").removeTag(e,t)})))}updateTag(t,e,i){t&&(t instanceof Element&&(t=t.dataset.tagid),this.createEditor().then((s=>{null===e?s.plugins.get("XmlTagEditing").removeTag(s,t):(delete e.tab,delete e.id,s.plugins.get("XmlTagEditing").updateTag(s,t,e)),i&&this.widgetElement.focus()})))}setContent(t,e=!0){this.createEditor().then((e=>e.setData(t)))}onBeforeSave(t){const e=this.widgetElement.parentElement.querySelector("input[type=hidden]");let i;if(e&&!e.disabled){i=this.widgetElement.ckeditorInstance?this.widgetElement.ckeditorInstance.getData():this.widgetElement.innerHTML;try{i=(new XMLSerializer).serializeToString(document.createRange().createContextualFragment(i)).replaceAll(/ xmlns="[^"]+"/g,"").replaceAll(/\u00a0/g," ")}catch(t){console.log(t)}e.value=i}}}class a extends s.Xt{constructor(t,e,i){super(t,e,i),this.initEditor()}async initEditor(){this.listenEvent(this.widgetElement,"input",(t=>this.onInput(t))),this.listenEvent(this.widgetElement,"keydown",(t=>this.onKeyDown(t)))}async onInput(t){this.widgetElement.classList.add("dirty")}async onKeyDown(t){if(13==t.keyCode){let e=this.widgetElement.value;const i=await import("./historicdates.js");window.HistoricDates=i.default;const s=HistoricDates.normalize(e);this.widgetElement.value=s,this.widgetElement.classList.remove("dirty"),t.preventDefault()}}}window.App.widgetClasses.jsoneditor=o,window.App.widgetClasses.htmleditor=n,window.App.widgetClasses.xmleditor=r,window.App.widgetClasses.dateseditor=a},92:(t,e,i)=>{"use strict";var s=i(584),o=i(182);class n extends s.Xt{constructor(t,e,i){super(t,e,i),t.widgetFilter=this,this.widgetElement=t,this.filterGroup=t.dataset.filterGroup,this.filters=[]}initWidget(){let t=!1;this.getFilterWidgetElements().forEach((e=>{this.registerFilter(e),e.classList.contains("widget-filter-item-sort")&&(t=!0)})),t||new c(this,this.widgetElement),this.listenEvent(document,"click",(t=>this.resetFilterClick(t)))}registerFilter(t){t.filterCoordinator||(t.classList.contains("widget-filter-item-selector")&&new a(this,t),t.classList.contains("widget-filter-item-sort")&&new c(this,t),t.classList.contains("widget-filter-item-template")&&new d(this,t),t.classList.contains("widget-filter-item-map")&&new u(this,t))}addFilter(t){this.filters.push(t),t.coordinator=this,t.widgetElement.filterCoordinator=this}removeFilter(t){const e=this.filters.indexOf(t);e>-1&&this.filters.splice(e,1),t.coordinator=null,t.widgetElement.filterCoordinator=null}resetFilterClick(t){const e=".widget-filter-item-reset[data-filter-group="+this.filterGroup+"]";t.target.closest(e)&&(this.clearResults(),t.preventDefault())}getUrlParams(t=!1){let e={};return this.getFilterWidgets().forEach((t=>{if("function"==typeof t.getUrlParams)try{e={...e,...t.getUrlParams()}}catch{console.log("Filter not ready yet")}})),t&&(delete e.save,delete e.load,delete e.sort,delete e.direction,delete e.columns),e}getPath(){let t="";return this.getFilterWidgets().forEach((e=>{if("function"==typeof e.getPath){const i=e.getPath();void 0!==i&&(t=i)}})),t}getResultTable(){return document.querySelector(".recordlist[data-filter-group="+this.filterGroup+"]")}getFilterWidgetElements(){return document.querySelectorAll(".widget-filter-item[data-filter-group="+this.filterGroup+"]")}getFilterWidgets(){let t=this.filters;return document.querySelectorAll(".widget-filter-item[data-filter-group="+this.filterGroup+"]").forEach((e=>{t=[...t,...e.filterWidgets||[]]})),t}updateWidget(t){this.getFilterWidgets().forEach((e=>{"function"==typeof e.updateWidget&&e.updateWidget(t)}))}updateResults(t,e=!1){App.ajaxQueue.stop();let i=e?{save:!0}:this.getUrlParams();const s=this.getPath(),o=$(this.widgetElement);let n=o.attr("data-action");n=n||o.attr("action");let r=n.split("?")[0];r+=s?"/"+s:"";let a={...i};r+="?"+jQuery.param(a);let l=n.split("?")[0];l+=s?"/"+s:"",l+="?"+jQuery.param(i),o.attr("action",l),this.loadData(r,l),this.emitEvent("epi:update:filter",{source:t}),this.filters.forEach((e=>{"function"==typeof e.updateFilter&&e.updateFilter(t)}))}loadData(t,e){this.pushHistory=window.history.pushState&&e&&!this.isInFrame();const i=this.getFrame(!1);App.ajaxQueue.add("",{type:"GET",url:t,dataType:"html",beforeSend:t=>{App.showLoader()},success:(t,s,o)=>{this.pushHistory&&window.history.pushState(e,"Epigraf - search results",e),App.replaceDataSnippets(t,i),this.updateWidget()},error:(t,e,i)=>{if(t.readyState===XMLHttpRequest.UNSENT&&0===t.status)return;let s=o.Z.getValue(t.responseJSON,"error.message");s=s?i+": "+s:i,App.showMessage(s,e)},complete:(t,e)=>{App.hideLoader()}})}clearResults(){App.ajaxQueue.stop();const t=$(this.widgetElement);let e=t.attr("data-action");e=e||t.attr("action");const i=this.getPath();let s=e.split("?")[0];s+=i?"/"+i:"";if(s+="?"+jQuery.param({save:!0}),this.isInFrame()){const t=this.getFrame();t.loadUrl(s,t.options)}else App.ajaxQueue.stop(),window.location=s}}class r extends s.Xt{constructor(t,e,i){super(t,e,i),this.filterGroup=t.dataset.filterGroup,this.coordinator=this.getCoordinator(),t.filterWidgets=t.filterWidgets||[],t.filterWidgets.push(this)}getCoordinator(){const t=document.querySelector(".widget-filter[data-filter-group="+this.filterGroup+"]");if(t)return t.widgets=t.widgets||{},t.widgets.filter}updateResults(t){this.coordinator.updateResults(this)}getUrlParams(){return{}}getUrlPath(){}}class a{constructor(t,e){if(this.coordinator=t,this.widgetElement=e,this.dropdown=null,this.widgetCheckboxlist=null,this.valueAttribute="value",this.clearParameters=e.dataset.filterClear,this.param=e.dataset.filterParam,!this.initWidgets())return console.log("Error initializing selector widget."),!1;this.coordinator.addFilter(this)}initWidgets(){if(!this.coordinator)return void console.log("Missing coordinator.");const t=this.coordinator.getResultTable(),e=t?t.querySelector('[data-filter-param="'+this.param+'"]'):void 0;e&&(this.widgetElement=e);const i=this.widgetElement?this.widgetElement.querySelector(".widget-dropdown-selector"):void 0;if(i&&i!==this.dropdown)return this.dropdown=i,this.dropdown.addEventListener("changed",(t=>this.updateResults(t))),!0;const s=this.widgetElement?this.widgetElement.querySelector(".widget-checkboxlist"):void 0;return!(!this.widgetCheckboxlist||s===this.widgetCheckboxlist)&&(this.widgetCheckboxlist=s,this.widgetCheckboxlist.addEventListener("change",(t=>this.updateResults(t))),!0)}updateWidget(t){return this.initWidgets()}updateResults(){this.coordinator.updateResults(this,this.clearParameters)}getUrlParams(){const t={};if(this.param){let e="";if(this.dropdown)e=this.dropdown&&this.dropdown.widgetDropdownSelector?this.dropdown.widgetDropdownSelector.getValue():"";else if(this.widgetCheckboxlist){e=Array.from(this.widgetCheckboxlist.querySelectorAll("input:checked")).map((t=>t.closest("[data-"+this.valueAttribute+"]").dataset[this.valueAttribute])).join(",")}t[this.param]=e}return t}getPath(){let t;return this.param||(t=this.dropdown&&this.dropdown.widgetDropdownSelector?this.dropdown.widgetDropdownSelector.getValue():""),t}}class l extends r{constructor(t,e,i){super(t,e,i),this.filterParameter=void 0,this.flagsParameter=void 0}initWidget(){this.coordinator&&(this.listenEvent(this.coordinator.widgetElement,"epi:update:filter",(t=>this.onFilterUpdated(t))),this.listenEvent(this.widgetElement.querySelector(".widget-filter-facets-term"),"input",(t=>this.onTermChanged(t))),this.listenEvent(this.widgetElement.querySelector(".widget-filter-facets-reset"),"click",(t=>this.onResetClicked(t))),this.listenEvent(this.widgetElement.querySelector(".widget-filter-facets-options"),"input",(t=>this.onFlagsChanged(t)),"input"),this.listenEvent(this.widgetElement,"change",(t=>this.onNodeChanged(t))),this.loadFacets(),this.updateTabCounter())}onFilterUpdated(t){t.detail.data.source!==this&&this.loadFacets()}onFlagsChanged(t){const e=this.widgetElement.querySelector(".widget-filter-facets-options");if(!e)return;clearTimeout(this.inputTimeout);const i=[...e.querySelectorAll("input:checked")].map((t=>t.value));i.includes("grp")&&this.clearOtherFlag("grp"),this.widgetElement.dataset.filterFlags=i.join(","),this.coordinator.updateResults(this),this.emitEvent("epi:load:facets")}clearOtherFlag(t){this.coordinator.getFilterWidgets().forEach((e=>{e!==this&&"function"==typeof e.clearFlag&&e.clearFlag(t)}))}clearFlag(t){if(!this.widgetElement.dataset.filterFlags)return;const e=this.widgetElement.querySelector(".widget-filter-facets-options input[value="+t+"] ");e&&(e.checked=!1);const i=this.widgetElement.dataset.filterFlags.split(",").map((t=>t.trim())).filter((e=>e&&e!==t)).join(",");this.widgetElement.dataset.filterFlags=i}hasFlag(t){if(!this.widgetElement.dataset.filterFlags)return!1;const e=this.widgetElement.querySelector(".widget-filter-facets-options input[value="+t+"] ");return e?e.checked:void 0}onTermChanged(t){clearTimeout(this.inputTimeout),13===t.keyCode&&t.preventDefault(),this.inputTimeout=setTimeout((()=>this.loadFacets()),App.settings.timeout)}onResetClicked(t){this.widgetElement.querySelectorAll("input.property:checked").forEach((t=>t.checked=!1)),this.widgetElement.dataset.filterSelected="",this.updateTabCounter(),this.coordinator.updateResults(this)}onNodeChanged(t){const e=t.target.closest(".widget-filter-facets-results");if(!e)return;clearTimeout(this.inputTimeout);const i=[...e.querySelectorAll("input.property:checked")].map((t=>t.value));this.widgetElement.dataset.filterSelected=i.join(","),this.updateTabCounter(),this.emitEvent("epi:load:facets"),this.inputTimeout=setTimeout((()=>this.coordinator.updateResults(this)),App.settings.timeout)}clearWidget(){this.emitEvent("epi:close:facets"),super.clearWidget();const t=this.widgetElement.querySelector(".widget-filter-facets-all input"),e=this.widgetElement.querySelector(".widget-filter-facets-inverse input");(this.widgetElement.dataset.filterSelected||t&&t.checked||e&&e.checked)&&this.coordinator.updateResults()}updateTabCounter(){const t=this.widgetElement.dataset.filterSelected,e=t?t.toString().split(",").length:0,i=e>0?" ("+e+")":"",s=(this.widgetElement.dataset.filterCaption||"")+i,o=this.widgetElement.closest(".widget-tabsheets-sheet"),n=o?o.dataset.tabsheetId:void 0,r=this.getWidget(this.widgetElement,"tabsheets");r&&r.setTitle(n,s)}showLoader(){const t=this.widgetElement.querySelector(".widget-filter-facets-results");if(t){const e=o.Z.spawnFromString('<div class="loader" data-snippet="rows"></div>');t.replaceChildren(e)}}hideLoader(){const t=this.widgetElement.querySelector(".loader");t&&t.remove()}loadFacets(){if(!this.coordinator)return;App.ajaxQueue.stop("filter-facets-"+this.filterParameter.replace(".","-"));let t=this.getArticleParams(),e=this.getFacetParams();const i=$.extend({},e,t);i.template="select";const s=this.widgetElement.dataset.filterAction.split("?")[0],o=App.databaseUrl+s+"?"+jQuery.param(i);let n=this;App.ajaxQueue.add("filter-facets-"+this.filterParameter.replace(".","-"),{type:"GET",url:o,dataType:"html",beforeSend:function(t){n.showLoader()},success:function(t,e,i){App.replaceDataSnippets(t,n.widgetElement),n.emitEvent("epi:load:facets")},error:function(t,e,i){t.readyState===XMLHttpRequest.UNSENT&&0===t.status||App.showMessage(i,e)},complete:function(t,e){n.hideLoader()}})}getFacets(){return{}}getFilterTerm(){const t=this.widgetElement.querySelector("input.widget-filter-facets-term");let e=t?t.value:void 0;return void 0!==e&&(e=e.trim()),e}getArticleParams(){let t=this.coordinator.getUrlParams(!0);return delete t[this.filterParameter],delete t[this.flagsParameter],t}getUrlParams(){let t={};return t[this.filterParameter]=this.widgetElement.dataset.filterSelected,this.flagsParameter&&this.widgetElement.dataset.filterFlags&&(t[this.flagsParameter]=this.widgetElement.dataset.filterFlags),t}getFacetParams(){return{}}}class c{constructor(t,e){if(this.coordinator=t,this.widgetElement=e,!this.widgetElement)return!1;this.coordinator.addFilter(this),this.prefix=this.widgetElement&&this.widgetElement.dataset.filterPrefix||"",this.sortSelector=this.widgetElement.querySelector("select.widget-filter-item-sort-field"),this.sortSelector&&this.sortSelector.addEventListener("change",(t=>this.selectorsChanged(t)))}updateWidget(t){if(this.coordinator){if(this.sortSelector)try{const t=this.coordinator.getResultTable().dataset.sortkey;this.sortSelector.value=t}catch{console.log("Sort key is missing")}return!0}console.log("Missing coordinator.")}getUrlParams(){const t={},e=this.prefix;return t[e+"sort"]=this.getSortField(),t[e+"direction"]=this.getSortDirection(),t}updateFilter(t){}selectorsChanged(){this.coordinator.updateResults(this)}getSortField(){if(this.sortSelector)return this.sortSelector.value;{if(!this.coordinator)return void console.log("Missing coordinator.");const t=this.coordinator.getResultTable();return t?t.dataset.sortkey:""}}getSortDirection(){if(this.sortSelector)return"asc";{if(!this.coordinator)return void console.log("Missing coordinator.");const t=this.coordinator.getResultTable();return t?t.dataset.sortdir:"asc"}}}class d{constructor(t,e){if(this.coordinator=t,this.widgetElement=e,this.template="table",this.mode=null,!this.initWidgets())return!1;this.coordinator.addFilter(this)}initWidgets(){return!!this.widgetElement&&(this.mode=this.widgetElement.dataset.filterMode,this.template=this.widgetElement.dataset.filterTemplate,!0)}updateWidget(t){return this.initWidgets()}getUrlParams(){const t={template:this.template};return this.mode&&(t.mode=this.mode),t}updateResults(t){this.coordinator.updateResults(this)}}class u extends r{constructor(t,e){if(super(e,"filtermap",t),this.coordinator=t,this.widgetElement=e,this.inputTimeout=null,this.widgetMap=null,!this.initWidgets())return!1;this.coordinator.addFilter(this)}initWidgets(){return!!this.widgetElement&&(this.widgetMap=this.getWidget(this.widgetElement,"map"),void 0!==this.widgetMap&&this.widgetMap.updateMarkers(),!this.widgetElement.classList.contains("widget-initialized")&&(this.widgetElement.classList.add("widget-initialized"),!0))}updateWidget(t){return this.initWidgets()}updateFilter(t){if(t===this)return!1}getUrlParams(){if(!this.widgetMap)return{};const t=this.widgetMap.getCenter();return{template:"map",lat:t.lat,lng:t.lng,sort:"distance",direction:"asc"}}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.filter=n,window.App.widgetClasses["filter-item-columns"]=class extends r{constructor(t,e,i){super(t,e,i)}initWidget(){if(!this.coordinator)return void console.log("Missing coordinator.");const t=this.coordinator.getResultTable();if(!t||!t.classList.contains("widget-table"))return;if(this.button=t.querySelector(".widget-dropdown-toggle.button-settings"),this.pane=this.button?this.button.widgetDropdown.pane:void 0,!this.button||!this.pane)return;if(this.pane.classList.contains("widget-initialized"))return;this.listenEvent(this.pane,"epi:move:row",(t=>this.moveRow(t))),this.listenEvent(this.pane,"click",(t=>this.resetSelection(t))),this.listenEvent(this.pane,"click",(t=>this.clickCheckbox(t)));let e=this.pane.querySelector("widget-dragitems");App.initWidgets(e),this.pane.classList.add("widget-initialized")}clickCheckbox(t){t.target.closest("input")&&(clearTimeout(this.inputTimeout),this.inputTimeout=setTimeout((()=>this.updateResults()),2*App.settings.timeout))}moveRow(t){setTimeout((()=>this.updateResults()),100)}resetSelection(t){t.target.closest(".selector-reset")&&(Array.from(this.pane.querySelectorAll("input:checked")).forEach((t=>{t.checked=!1})),this.updateResults())}getUrlParams(){this.selector=this.pane.querySelector(".selector-columns");const t=this.selector.querySelectorAll('input[type="checkbox"]:checked');return{columns:Array.from(t).map((t=>t.closest("[data-value]").dataset.value)).join(","),save:!0}}},window.App.widgetClasses["filter-item-properties"]=class extends l{colors=["#E69F00","#56B4E9","#009E73","#bb3fc3","#0072B2"];constructor(t,e,i){super(t,e,i);let s=this.widgetElement.dataset.filterPropertytype;this.filterParameter="properties."+s+".selected",this.flagsParameter="properties."+s+".flags"}getFacetParams(){return{selected:this.widgetElement.dataset.filterSelected,term:this.getFilterTerm(),field:"lemma",references:0}}getFacets(){let t={};this.widgetElement.querySelectorAll(".node .tree-meta").forEach((t=>{t.style.backgroundColor="",t.style.color=""}));let e=0;const i=[...this.widgetElement.querySelectorAll("input.property:checked")];for(let s of i){const i=s.closest(".node");if(i){const o=this.colors[e%this.colors.length],n=s.closest("label");n&&(t[s.value]={label:n.textContent,color:o,id:s.value});const r=i.querySelector(".tree-meta");r&&(r.style.backgroundColor=o,r.style.color="white"),e++}}return t}},window.App.widgetClasses["filter-item-projects"]=class extends l{constructor(t,e,i){super(t,e,i),this.filterParameter="articles.projects"}getFacetParams(){return{selected:this.widgetElement.dataset.filterSelected,term:this.getFilterTerm(),field:"name"}}},window.App.widgetClasses["filter-item-fixed"]=class extends r{getPath(){if(this.widgetElement&&this.widgetElement.dataset){return this.widgetElement.dataset.filterPath}}},window.App.widgetClasses["filter-item-searchbar"]=class extends r{constructor(t,e,i){if(super(t,e,i),this.inputTimeout=null,!this.widgetElement)return!1;if(this.prefix=this.widgetElement&&this.widgetElement.dataset.filterPrefix||"",this.paramTerm=this.widgetElement?this.widgetElement.dataset.filterParam||"term":"",this.paramField=this.widgetElement?this.widgetElement.dataset.filterField||"field":"",this.searchBox=this.widgetElement.querySelector(".search-term"),this.searchBox){["input","paste","propertychange"].forEach((t=>{this.searchBox.addEventListener(t,(t=>{this.articlesTermChanged(t)}))}))}this.searchField=this.widgetElement.querySelector(".search-field"),this.searchField&&(this.searchField.addEventListener("change",(t=>this.articlesTermChanged())),this.searchField.closest("form").addEventListener("submit",(t=>{this.selectorsChanged(t),t.preventDefault()})))}updateWidget(t){return!0}getUrlParams(){const t={},e=this.prefix;t[e+this.paramTerm]=this.getSearchTerm();const i=this.getSearchField();return i&&(t[e+this.paramField]=i),t}updateFilter(t){clearTimeout(this.inputTimeout)}articlesTermChanged(){clearTimeout(this.inputTimeout),this.inputTimeout=setTimeout((()=>{this.coordinator.updateResults(this)}),App.settings.timeout)}selectorsChanged(){this.coordinator.updateResults(this)}getSearchTerm(){let t=this.searchBox?this.searchBox.value:void 0;return void 0!==t&&(t=t.trim()),t}getSearchField(){let t=this.searchField?this.searchField.value:void 0;return void 0!==t&&(t=t.trim()),t}}},482:(t,e,i)=>{"use strict";i.a(t,(async(t,s)=>{try{i.d(e,{AH:()=>c,Gp:()=>g,P:()=>p,PZ:()=>u,R4:()=>m,aV:()=>v,dF:()=>f,z2:()=>h});var o=i(182),n=i(649),r=i(584),a=t([n]);n=(a.then?(await a)():a)[0];class l extends r.I{constructor(t,e,i){super(t,e,i),this.titlePane=void 0,this.contentPane=void 0,this.buttonPane=void 0,this.footerPane=void 0,this.actionButtons=void 0,this.options={},this.formOptions={},this.currentUrl=void 0,this.isSaving=!1}initWidget(){this.listenEvent(this.widgetElement,"app:show:message",(t=>this.showMessage(t))),this.listenEvent(this.widgetElement,"app:hide:message",(t=>this.hideMessage(t)))}showData(t){return this.options={...this.defaults,...t},this.openWindow(t.frameTarget||"details",t.force),void 0!==t.url?t.delay?setTimeout((()=>this.loadUrl(t.url,t)),t.delay):this.loadUrl(t.url,t):void 0!==t.element&&this.loadElement(t.element,t),this}toggleLoader(t=!0){if(this.widgetElement)if(t){let t=this.widgetElement.querySelector(".frame-loader, .loader");t||(t=o.Z.spawnFromString('<div class="loader frame-loader"></div>'),this.contentPane?this.contentPane.appendChild(t):this.widgetElement.appendChild(t))}else{const t=this.widgetElement.querySelector(".frame-loader, .loader");t&&t.remove()}}clearData(t){this.unlock(),this.showLoader(t)}clearWindow(){this.clearData(),this.updateTitle(),this.updateTitleButtons(),this.updateToolbar(),this.updateActionButtons()}openWindow(){}closeWindow(t=!1){return!1}showLoader(){this.toggleLoader(!0)}hideLoader(){this.toggleLoader(!1)}showMessage(t,e){let i;t instanceof CustomEvent&&(i=t,e=i.detail.data.status||e,t=i.detail.data.msg);let s=this.widgetElement.querySelector(".content-flash");if(s||i||(s=document.querySelector(".content-flash")),s){let i=o.Z.spawnFromString(`<div class="message ${e}">${t}</div>`);s.replaceChildren(i)}s&&i&&i.stopPropagation()}hideMessage(t){}attachButtons(t,e){const i=this;if(void 0===t)return[];const s=(e=e||{}).ajaxButtons;return s instanceof Array&&(t=t.filter((t=>s.includes(t.dataset.role)))),t.map((function(t){const s=t.dataset.role;let o="role-"+s;const n=t.dataset.shortcuts;return n&&(o+=" widget-shortcut"),{text:t.textContent,title:t.getAttribute("title",t.textContent),ariaLabel:t.getAttribute("aria-label",t.textContent),class:o,role:s,shortcuts:n,click:function(o){if(i.emitEvent("epi:click:button",{button:t,role:s},!0)){if("import"!==s){if("submit"===s||"save"===s||"cancel"===s||"delete"===s){let n;return n=t.hasAttribute("form")?document.getElementById(t.getAttribute("form")):t.form,void(n?(t.setAttribute("disabled","disabled"),e.focus=!1,e.keepopen="save"===s,i.formOptions=e,"submit"===s||"save"===s?i.submitForm(o):"delete"===s?(i.unlockForm(n.dataset.deleteUrl,!0),o.preventDefault()):"cancel"===s&&(i.unlockForm(n.dataset.cancelUrl,!0),o.preventDefault())):"cancel"===s&&i.cancelForm(!0))}if("A"===t.tagName){let e=o.target.dataset.href||t.getAttribute("href"),s={focus:!0};t.dataset.target&&(s.target=t.dataset.target),i.loadUrl(e,s)}}}else o.preventDefault()}}}))}addButtons(t,e,i=!1){t.forEach((t=>{const s=document.createElement("button");s.textContent=t.text||"",s.classList.add(...(t.class||"").split(" ")),s.onclick=t.click,s.dataset.role=t.role,s.setAttribute("title",t.title||""),s.setAttribute("aria-label",t.ariaLabel||""),t.shortcuts&&(s.setAttribute("aria-keyshortcuts",t.ariaKeyshortcuts||""),s.dataset.shortcuts=t.shortcuts,s.classList.add("widget-shortcut")),i?e.prepend(s):e.appendChild(s)})),App.initWidgets(e)}showButton(t,e,i){if(this.buttonPane){const s=this.buttonPane.querySelector('[data-role="'+t+'"],.role-'+t);o.Z.show(s,e),i&&s&&("A"===s.tagName?s.setAttribute("href",i):s.dataset.href=i)}}hideButton(t){if(this.buttonPane){const e=this.buttonPane.querySelector('[data-role="'+t+'"], .role-'+t);o.Z.hide(e)}}clickButton(t){if(!this.buttonPane)return!1;const e=this.buttonPane.querySelector('[data-role="'+t+'"], .role-'+t);return!!e&&(e.click(),!0)}setButtonUrl(t,e){if(this.buttonPane){const i=this.buttonPane.querySelector('[data-role="'+t+'"], .role-'+t);i&&("A"===i.tagName?i.setAttribute("href",e):i.dataset.href=e)}}updateTitle(t){}updateTitleButtons(t){}updateToolbar(t){}updateActionButtons(t,e){let i=[];if(this.options.ajaxButtons&&(i=this.attachButtons(t,e)),this.options.dialogButtons&&("exclusive"!==this.options.ajaxButtons||!i.length))for(const[t,e]of Object.entries(this.options.dialogButtons))i.push({text:e.text,title:e.title,ariaLabel:e.ariaLabel,class:"role-"+t,click:t=>e.handler(this)});this.actionButtons=i;const s=this.contentPane.querySelector("form");this.attachForm(s)}updateSelection(){const t=this.widgetElement.querySelector(".row-selected");t?o.Z.scrollIntoViewIfNeeded(t,t.parentElement,!0,"y"):$(this.widgetElement).scrollTop(0)}updateNavigation(t,e){o.Z.isString(t)&&(t=o.Z.spawnFromString(t,void 0,!1));let i=t.querySelector("nav.breadcrumbs");i?(this.updateTitle(i.textContent),i.remove()):e.title&&this.updateTitle(e.title);const s=o.Z.extractElements(t,'[data-snippet="actions-top"]',"a, button");this.updateTitleButtons(s);const n=t.querySelector("div.content-toolbar");this.updateToolbar(n);const r=o.Z.extractElements(t,'[data-snippet="actions-bottom"], [data-snippet="actions-content"]',"a, button");this.updateActionButtons(r,e);const a=t.querySelector("footer");a&&""===a.innerHTML.trim()&&a.remove()}updatePage(t,e){if(e=e||{focus:!0,openDropdown:!1,title:""},this.clearData(),t instanceof Element?this.contentPane.replaceChildren(t):this.contentPane.innerHTML=t,this.updateSelection(),this.updateNavigation(this.widgetElement,e),"function"==typeof App.initWidgets&&App.initWidgets(this.widgetElement),this.footerPane){this.footerPane.innerHTML="";Array.from(this.widgetElement.querySelectorAll("[data-position=fixed]")).forEach(((t,e)=>{let i=t.closest("form");i&&Array.from(t.querySelectorAll("input")).forEach((t=>{t.setAttribute("form",i.getAttribute("id"))})),this.footerPane.appendChild(t)}))}e.onLoad&&e.onLoad(this,t,e),e.focus&&this.focusWidget()}loadElement(t,e={}){e.element=t,e.clone&&(e.element=e.element.cloneNode(!0)),this.updatePage(e.element,e)}loadUrl(t,e={}){if("external"===e.target)return void window.open(t);if("main"===e.target)return App.ajaxQueue.stop(),void(window.location=t);this.currentUrl=t,this.showLoader();let i=null,s="GET",o=!1;e.lock&&(i=$.param({lock:e.lock}),s="POST",o="application/x-www-form-urlencoded");const n=this;$.ajax({type:s,url:t,data:i,dataType:"html",async:!0,retryLimit:3,tryCount:0,contentType:o,processData:!1,success:function(t){n.updatePage(t,e)},error:function(t,i,s){const o="Error loading data:"+t.responseText;if(n.emitEvent("app:show:message",{msg:o,status:"error"}),n.updatePage(o,e),403===t.status){let t=this;t.tryCount++,App.user.showLogin({onLogin:function(){t.tryCount<=t.retryLimit&&$.ajax(t)}})}},complete:function(t,e){n.isSaving=!1,n.hideLoader()}})}}class c extends l{constructor(t){const e=document.querySelector(".content-content");if(super(e,"content-pane"),this.buttonPane=void 0,e){e.classList.add("widget-content-pane"),e.classList.add("widget-content-pane-main"),this.buttonPane=e.querySelector(".actions-content"),this.contentPane=e;const t=this.widgetElement.querySelector(".widget-entity form, .widget-document form");this.attachForm(t)}}updateNavigation(t,e){this.buttonPane&&App.replaceDataSnippets(t,this.buttonPane);const i=this.widgetElement.querySelector("form");this.attachForm(i)}loadUrl(t,e={}){if("external"!==e.target){e.message&&this.emitEvent("app:open:dialog",{message:e.message,loader:!0,id:"reload-dialog",delay:0});const i=window.location.href.split("#")[0];"string"!=typeof t&&(t=t.toString());const s=t.split("#")[0];return App.ajaxQueue.stop(),void(i===s?(window.location.href=t,window.location.reload()):window.location.href=t)}window.open(t)}onSaveProceed(t,e){if(!super.onSaveProceed(t,e))return;let i=new URL(e.responseURL).searchParams.get("open");i||(i=this.formElement.dataset.proceedUrl,i=new URL(i?o.Z.decodeHtmlAttribute(i):e.responseURL,App.baseUrl));const s=n.a.t("Reloading document");this.loadUrl(i,{message:s})}}class d extends l{constructor(t,e,i){super(t,e,i),this.attachElement(t,"content-pane"),this.widgetElement.classList.add("widget-content-pane");const s=o.Z.spawnFromString('<div class="frame-title"><div class="frame-title-caption"></div><div class="frame-title-manage"><button class="btn-close" title="Close" aria-label="Close"></button></div></div>');this.widgetElement.appendChild(s),this.titlePane=s.querySelector(".frame-title-caption"),this.titleButtons=s.querySelector(".frame-title-manage"),this.toolbarPane=o.Z.spawnFromString('<div class="frame-toolbar"></div>'),this.widgetElement.appendChild(this.toolbarPane),this.contentPane=o.Z.spawnFromString('<div class="frame-content"></div>'),this.widgetElement.appendChild(this.contentPane),this.footerPane=o.Z.spawnFromString('<div class="frame-footer"></div>'),this.widgetElement.appendChild(this.footerPane),this.buttonPane=o.Z.spawnFromString('<div class="frame-buttons actions-bottom"></div>'),this.widgetElement.appendChild(this.buttonPane),this.isClosing=!1,this.defaults={title:"",width:800,ajaxButtons:!0,external:!1,dialogButtons:{},focus:!0},this.options={},this.currentUrl=void 0,this.closeButton=void 0,this.openExtButton=void 0}openWindow(t="default",e=!0){this.clearWindow(),this.isClosing=!1,App.sidebarright.showSidebar(e);const i=this.getWidget(this.widgetElement,"tabsheets");i&&i.showTab(t,"last"),this.listenerReload||(this.listenerReload=t=>this.showData(this.options),this.listenEvent(this.widgetElement,"epi:reload:page",this.listenerReload))}closeWindow(t){return!!this.isClosing||(this.options.onClose&&this.options.onClose(this),!t&&(this.isClosing=!0,this.clearData(),App.sidebarright.hideSidebar(),void(this.listenerReload&&this.unlistenEvent(this.widgetElement,"epi:reload:page",this.listenerReload))))}updateTitle(t){this.titlePane.innerHTML=t||""}updateTitleButtons(t){if(this.options.external&&(void 0===this.openExtButton&&(this.openExtButton=o.Z.spawnFromString('<button class="btn-open" title="'+n.a.t("Open in new tab")+'" aria-label="'+n.a.t("Open in new tab")+'"></button>'),this.titleButtons.appendChild(this.openExtButton)),this.openExtButton.dataset.targetUrl=!0!==this.options.external?this.options.external:this.currentUrl,o.Z.toggle(this.openExtButton,!1!==this.options.external)),void 0===this.closeButton&&(this.closeButton=o.Z.spawnFromString('<button class="btn-close" title="'+n.a.t("Close")+'" aria-label="'+n.a.t("Close")+'"></button>'),this.titleButtons.appendChild(this.closeButton)),this.options.ajaxButtons&&this.titlePane){const e=this.attachButtons(t);this.addButtons(e,this.titlePane,!0)}super.updateTitleButtons(t)}updateToolbar(t){t?this.toolbarPane.replaceChildren(t):this.toolbarPane.innerHTML=""}updateActionButtons(t,e){super.updateActionButtons(t,e),this.buttonPane.innerHTML="",this.addButtons(this.actionButtons,this.buttonPane),this.listenButtons()}clearData(t,e=!1){this.openExtButton&&(this.openExtButton.remove(),this.openExtButton=void 0),this.closeButton&&(this.closeButton.remove(),this.closeButton=void 0),this.widgetElement&&(this.emitEvent("epi:clear:widgets"),e?(this.titlePane.remove(),this.titleButtons.remove(),this.toolbarPane.remove(),this.footerPane.remove(),this.buttonPane.remove(),this.contentPane.remove()):(this.titlePane.innerHTML="",this.titleButtons.innerHTML="",this.toolbarPane.innerHTML="",this.footerPane.innerHTML="",this.buttonPane.innerHTML="",this.contentPane.innerHTML="")),super.clearData(t)}onSaveProceed(t,e){if(!super.onSaveProceed(t,e))return;let i=new URL(e.responseURL).searchParams.get("open");if(i)window.setTimeout((function(){window.open(i)}),1e3),this.updatePage(t,this.formOptions);else if(this.formElement&&this.formElement.dataset.proceedUrl){i=new URL(o.Z.decodeHtmlAttribute(this.formElement.dataset.proceedUrl),App.baseUrl);const t=n.a.t("Reloading document");this.loadUrl(i,{message:t})}else this.updatePage(t,this.formOptions)}}class u extends l{constructor(t){super(),this.dialog=!1,this.isClosing=!1,this.isInitialized=!1,this.isCollapsed=!1,this.defaults={title:"",width:800,height:600,autosize:!0,modal:!0,ajaxButtons:!0,external:!1,valueKey:"id",dialogButtons:{},focus:!0},this.options=t,this.currentUrl=void 0,this.buttonPane=void 0,this.openExtButton=void 0,this.contentPane=void 0}initWindow(){if(!this.isInitialized){const t=o.Z.spawnFromString('<div class="popup-window"></div>');document.body.appendChild(t),this.attachElement(t,"content-pane"),this.initWidget(),this.widgetElement.classList.add("widget-content-pane"),this.contentPane=this.widgetElement;const e=t=>this.resizeWindow(t),i=this;this.dialog=$(t),this.dialog.dialog({autoOpen:!1,maxHeight:800,position:{my:"center",at:"center",of:window},create:function(t,e){i.options.closeIcon&&$(".ui-dialog-titlebar-close span",$(this).dialog("widget")).removeClass("ui-icon-closethick").addClass(i.options.closeIcon)},open:function(t,s){window.addEventListener("resize",e),i.listenEvent(i.widgetElement,"keypress",(t=>i.onKeyPress(t))),i.dialog.focus(),$(i.buttonPane).find(":tabbable").eq(-1).focus()},close:function(t,s){window.removeEventListener("resize",e),i.closeWindow(),i.clearWidget(),i.dialog.remove(),i.dialog=!1,i.isInitialized=!1}}),this.isInitialized=!0}}openWindow(){this.initWindow(),this.dialog.dialog("option",this.options),this.clearWindow(),this.isClosing=!1,this.dialog.dialog("isOpen")||(this.dialog.dialog({width:Math.min(this.options.width||800,window.innerWidth-5),height:Math.min(this.options.height||600,window.innerHeight)}),this.dialog.dialog("open")),this.listenerReload||(this.listenerReload=t=>this.showData(this.options),this.listenEvent(this.widgetElement,"epi:reload:page",this.listenerReload))}resizeWindow(t){const e=document.documentElement.clientHeight,i=document.documentElement.clientWidth,s=this.dialog.dialog("option","height"),o=this.dialog.dialog("option","width");e<s&&this.dialog.dialog("option","height",e),i<o&&this.dialog.dialog("option","width",i)}collapseWindow(t){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.defaults.height=this.dialog.dialog("option","height"),o.Z.toggle(this.contentPane,!1)):o.Z.toggle(this.contentPane,!0)}centerWindow(){this.dialog.dialog("option","position",{my:"center",at:"center",of:window})}closeWindow(t){return this.isClosing||(this.isClosing=!0,this.options.onClose&&this.options.onClose(this),this.clearData(),this.dialog&&this.dialog.dialog("close"),this.listenerReload&&this.unlistenEvent(this.widgetElement,"epi:reload:page",this.listenerReload)),!0}updateTitle(t){this.dialog&&this.dialog.dialog("option","title",t||this.options.title)}updateTitleButtons(t){const e=this;if(this.options.external){if(this.dialog&&void 0===this.openExtButton){let t=e.dialog.dialog("instance").uiDialogTitlebar.get(0);this.openExtButton=o.Z.spawnFromString('<button class="btn-open" title="Open in new tab" aria-label="Open in new tab"></button>'),t.appendChild(this.openExtButton),$(this.openExtButton).button({icon:"ui-icon-extlink",showLabel:!1}),this.listenEvent(this.openExtButton,"click",(function(){const t=!0!==e.options.external?e.options.external:e.currentUrl;window.open(t)}))}o.Z.toggle(this.openExtButton,!1!==this.options.external)}if(this.options.collapsable){let t=e.dialog.dialog("instance").uiDialogTitlebar.get(0);if(this.dialog&&!t.querySelector(".btn-collapse")){const e=o.Z.spawnFromString('<button class="btn-collapse" title="Collapse / expand" aria-label="Collapse / expand the window."></button>');t.appendChild(e),$(e).button({icon:"ui-icon-arrow-2-n-s",showLabel:!1}),this.listenEvent(e,"click",(t=>this.collapseWindow(t)))}}super.updateTitleButtons(t)}updateActionButtons(t,e){if(super.updateActionButtons(t,e),this.dialog){for(const t of this.actionButtons)t["data-shortcuts"]=t.shortcuts,t["aria-keyshortcuts"]=t.shortcuts;this.dialog.dialog("option","buttons",this.actionButtons),this.buttonPane=this.widgetElement.closest(".ui-dialog").querySelector(".ui-dialog-buttonpane"),App.initWidgets(this.buttonPane),$(this.buttonPane).find(":tabbable").eq(-1).focus()}}clearData(t){this.openExtButton&&(this.openExtButton.remove(),this.openExtButton=void 0),this.widgetElement&&(this.emitEvent("epi:clear:widgets"),this.widgetElement.innerHTML=""),this.buttonPane&&App.finishWidgets(this.buttonPane),super.clearData(t)}onSaveProceed(t,e){let i=!1,s=null,o=null;if(super.onSaveProceed(t,e)){const n=new URL(e.responseURL),r=(new DOMParser).parseFromString(t,"text/html"),a=r.querySelector('a[data-role="download"]');o=a?a.getAttribute("href"):n.searchParams.get("open");const l=r.querySelector('a[data-role="proceed"]');l&&"main"===l.dataset.target&&(s=l.getAttribute("href"));const c=n.searchParams.get("close"),d=r.querySelector('input[data-role="submit"],button[data-role="submit"]');i=Boolean(Number(c||!(d||s||o)))}o?(this.closeWindow(),window.setTimeout((function(){window.open(o)}),1e3)):s?window.location=s:i?this.closeWindow():this.updatePage(t,this.formOptions)}onKeyPress(t){13===t.keyCode&&this.clickButton("apply")&&t.preventDefault()}}class h extends u{constructor(t){super(t),this.defaults={title:"Confirm",dialogClass:"popup-confirm",width:400,height:150,modal:!0,focus:!0,dialogButtons:{close:{text:"Cancel",handler:t=>t.closeWindow()},confirm:{text:"Confirm",handler:t=>t.onConfirm()}}},this.isConfirmed=!1}showData(t){this.isConfirmed=!1,t.element=o.Z.spawnFromString("<div>"+t.message+"</div>"),super.showData(t)}closeWindow(t){return this.isConfirmed||"function"!=typeof this.options.onConfirm||this.options.onConfirm(!1),super.closeWindow(t)}onConfirm(){"function"==typeof this.options.onConfirm&&(this.isConfirmed=!0,this.options.onConfirm(!0)),this.closeWindow()}}class p extends u{constructor(t){super(t),this.defaults={title:"Epigraf",dialogClass:"popup-message",width:400,height:150,modal:!0,focus:!0,dialogButtons:{}},setTimeout((e=>this.showData(t)),t.delay||0)}showData(t){this.isClosing||((t=t||this.options||{}).element=o.Z.spawnFromString('<div class="messagebox"></div>'),t.element.appendChild(o.Z.spawnFromString('<div class="messagebox-loader loader"></div>')),t.element.appendChild(o.Z.spawnFromString('<div class="messagebox-message">'+t.message+"</div>")),super.showData(t))}}class g extends u{constructor(t){let e={};e.cancel={text:"Cancel",handler:t=>{t.options.removeOnCancel?this.onRemove(t):t.closeWindow()}},t.buttonRemove&&(e.remove={text:"Remove",handler:t=>this.onRemove(t)}),t.buttonSelect&&(e.select={text:"Select",handler:t=>this.onSelect(t)}),t.dialogButtons=e,super(t),this.showData(t)}openWindow(){super.openWindow(),this.listenerClick||(this.listenerClick=t=>this.onClick(t),this.listenEvent(this.widgetElement,"click",this.listenerClick),this.listenEvent(this.widgetElement,"dblclick",this.listenerClick)),this.listenerChanged||(this.listenerChanged=t=>this.onChange(t),this.listenEvent(this.widgetElement,"changed",this.listenerChanged)),this.listenerKeyDown||(this.listenerKeyDown=t=>this.onKeyDown(t),this.listenEvent(this.widgetElement,"keydown",this.listenerKeyDown))}closeWindow(t){return this.listenerClick&&(this.unlistenEvent(this.widgetElement,"click",this.listenerClick),this.unlistenEvent(this.widgetElement,"dblclick",this.listenerClick)),this.listenerChanged&&this.unlistenEvent(this.widgetElement,"changed",this.listenerChanged),this.listenerKeyDown&&this.unlistenEvent(this.widgetElement,"keydown",this.listenerKeyDown),super.closeWindow()}updatePage(t,e){if(super.updatePage(t,e),this.options.openDropdown){const t=App.findWidget(this.widgetElement,"dropdown-selector");t&&t.openDropdown()}}onKeyDown(t){if(13!==t.keyCode)return;const e=t.target.closest(".input-group-filter");if(!e)return;const i=e.closest("form");i&&(this.options.url=o.Z.formToUrl(i,App.baseUrl),this.showData(this.options),t.preventDefault())}onClick(t){const e=t.target.closest("[data-list-itemof]"),i=o.Z.splitString(this.options.itemtype);(this.options.selectItem,e&&(!i.length||i.includes(e.dataset.listItemtype)))&&(this.options.selectOnClick||2===t.detail)?("function"==typeof this.options.onSelect&&this.options.onSelect(e),t.preventDefault(),this.closeWindow()):e&&"folder"===e.dataset.listItemtype&&(this.options.url=e.dataset.url,this.showData(this.options),t.preventDefault())}onSelect(t){let e,i=!1;this.options.selectItem,e=this.widgetElement.querySelector(".row-selected"),i=e&&(!this.options.itemtype||this.options.itemtype.includes(e.dataset.listItemtype)),!i&&this.options.selectList&&(e=this.widgetElement.querySelector("[data-list-name]"),i=!0),i&&"function"==typeof this.options.onSelect&&this.options.onSelect(e),this.options.removeOnCancel=!1,this.closeWindow()}onRemove(t){"function"==typeof t.options.onRemove&&t.options.onRemove(),t.closeWindow()}onChange(t){if(!t.target.classList.contains("widget-dropdown-selector"))return;let e={value:t.target.querySelector("input[type=hidden]").value,new:t.target.querySelector("input[type=hidden]").dataset.append,type:t.target.querySelector("input[type=hidden]").dataset.type,label:t.target.querySelector("input[type=text]").value,caption:t.target.querySelector("input[type=text]").dataset.label};this.options.required&&""===e.value||("function"==typeof this.options.onSelect&&this.options.onSelect(e),this.options.removeOnCancel=!1,this.closeWindow())}}class m extends u{constructor(t,e){super(e),this.defaults={dialogClass:"popup-detach",width:600,height:500,position:{my:"right",at:"right-100",of:window},modal:!1,focus:!0,closeIcon:"ui-icon-check"},this.showData(t,e)}showData(t,e={}){t&&(this.storeElement(t),e.element=t,super.showData(e))}closeWindow(t){this.restoreElement(),super.closeWindow(t)}storeElement(t){this.restoreElement(),this.detachedElement=t,this.placeholder=document.createElement("div"),this.placeholder.classList.add("frame-placeholder"),t.parentElement.insertBefore(this.placeholder,t)}restoreElement(){this.placeholder&&(this.placeholder.parentElement.insertBefore(this.detachedElement,this.placeholder),this.placeholder.remove(),this.placeholder=void 0)}}class f extends d{constructor(t,e,i){const s=e.createTab("more",i.title);s.widgets=s.widgets||{},s.widgets.more&&s.widgets.more.closeWindow(),super(s,"more"),s.widgets.more=this,this.listenEvent(s,"epi:remove:tabsheet",(t=>this.closeWindow(!0))),this.defaults={focus:!0,closeIcon:"ui-icon-check"},this.showData(t,i)}showData(t,e={}){t&&(this.storeElement(t),e.element=t,e.frameTarget=e.frameTarget||"more",delete e.title,delete e.frameCaption,super.showData(e))}closeWindow(t){this.restoreElement(),super.closeWindow(!0),this.clearData(!1,!0)}storeElement(t){this.restoreElement(),this.detachedElement=t,this.placeholder=document.createElement("div"),this.placeholder.classList.add("frame-placeholder"),t.parentElement.insertBefore(this.placeholder,t)}restoreElement(){this.placeholder&&(this.placeholder.parentElement.insertBefore(this.detachedElement,this.placeholder),this.placeholder.remove(),this.placeholder=void 0)}}class v extends r.gq{constructor(t){super(),this.pane=t,this.overlay=null,this.closeButton=null,this.content=null,this.listenEvent(this.pane,"click",(t=>this.clickPane(t)))}clickPane(t){let e=200;"checkbox"===t.target.type&&(e=2*App.settings.timeout),clearTimeout(this.inputTimeout),this.inputTimeout=setTimeout((()=>this.close(t)),e)}build(t=null,e="right"){this.overlay=document.createElement("div"),this.paneParent=this.pane.parentElement;const i=document.createElement("div");let s=null;t&&(s=document.createElement("div"),s.textContent=t);const o=document.createElement("div");this.closeButton=document.createElement("button"),this.content=document.createElement("div"),this.closeButton.classList.add("btn-close"),o.classList.add("overlay-header-buttons","overlay-header-buttons-"+e),s&&s.classList.add("overlay-header-title"),i.classList.add("overlay-header"),this.content.classList.add("overlay-content-inner"),this.overlay.classList.add("overlay-center"),this.listenEvent(this.closeButton,"click",(t=>this.close(t))),this.listenEvent(this.content,"keyup",(t=>{"Escape"===t.key&&this.close(t)})),o.appendChild(this.closeButton),s&&i.appendChild(s),i.appendChild(o),this.content.append(i,this.pane),this.overlay.append(this.content)}show(){document.body.appendChild(this.overlay),this.content.setAttribute("tabindex","0"),this.content.focus()}close(t){this.paneParent&&this.paneParent.appendChild(this.pane),this.unlistenEvent(this.closeButton),this.unlistenEvent(this.content),this.emitEvent(this.overlay,"epi:close:overlay",{paneId:this.pane.id}),this.overlay.remove()}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.frame=d,s()}catch(t){s(t)}}))},380:(t,e,i)=>{"use strict";var s=i(584),o=i(182);class n extends s.Xt{constructor(t,e,i){super(t,e,i),this.itemtype=t.dataset.itemtype,this.gridSizeElement=t.querySelector(".doc-section-grid-size"),this.gridTable=t.querySelector(".doc-section-grid-table"),this.itemContainer=t.closest(".doc-section").querySelector(".doc-section-groups")}initWidget(){this.sectionElement=this.widgetElement.closest(".doc-section"),this.sectionElement&&(this.listenEvent(this.sectionElement,"epi:add:item",(t=>this.onItemAdded(t))),this.listenEvent(this.sectionElement,"epi:remove:item",(t=>this.onItemRemoved(t))),this.listenEvent(this.sectionElement,"epi:change:item",(t=>this.onItemChanged(t))),this.listenEvent(this.sectionElement,"epi:drop:item",(t=>this.onGridItemDropped(t)))),this.listenEvent(this.widgetElement.querySelector(".doc-section-grid-size"),"change",(t=>this.onLayoutChanged(t)))}initLayout(){if(!this.gridSizeElement)return;const t=this.getGridSize();this.setGridSize(t),this.setMaxValues(t)}onLayoutChanged(t){this.initLayout()}onItemAdded(t){t.target.dataset.rowType===this.itemtype&&(this.initPosition(t.target),this.updateGridItem(t.target),this.initLayout())}onItemRemoved(t){!t.target.dataset.rowType!==this.itemtype&&this.removeGridItem(t.target)}onItemChanged(t){!t.target.dataset.rowType!==this.itemtype&&this.updateGridItem(t.target)}onGridItemDropped(t){const e=t.target.dataset.rowId,i=this.getTableItem(e),s=i.querySelector('input[data-row-field="pos_x"]'),o=i.querySelector('input[data-row-field="pos_y"]');s.value=[...t.target.closest("tr").children].indexOf(t.target.closest("td"))+1,o.value=[...t.target.closest("tbody").children].indexOf(t.target.closest("tr"))+1,this.updateZInputs(t.detail.data.dragOrigin),this.updateZInputs(t.detail.data.dragTarget)}getTableItem(t){if(this.itemContainer)return this.itemContainer.querySelector(`.doc-section-item[data-row-id='${t}']`)}getGridCell(t,e){if(!this.gridTable)return;let i;try{const s=this.gridTable.rows[e-1].cells[t-1];i=s.querySelector(".doc-section-item-group"),i||(i=o.Z.spawnFromString('<div class="doc-section-item-group"></div>'),s.appendChild(i))}catch(t){i=void 0}return i}getGridItem(t){if(this.gridTable)return this.gridTable.querySelector('[data-row-table="items"][data-row-id="'+t+'"]')}removeGridItem(t){const e=t.dataset.rowId,i=this.getGridItem(e);if(i){const t=i.parentElement;i.remove(),this.updateZInputs(t)}}initPosition(t){const e=this.gridTable.querySelectorAll(".doc-section-item");if(0===e.length)return;const i=e[e.length-1],s=this.getTableItem(i.dataset.rowId);if(!s)return;const n=parseInt(s.querySelector('[data-row-field="pos_x"]').value),r=parseInt(s.querySelector('[data-row-field="pos_y"]').value),a=parseInt(s.querySelector('[data-row-field="pos_z"]').value);o.Z.setInputValue(t.querySelector('[data-row-field="pos_x"]'),n),o.Z.setInputValue(t.querySelector('[data-row-field="pos_y"]'),r),o.Z.setInputValue(t.querySelector('[data-row-field="pos_z"]'),a+1)}updateGridItem(t){const e=t.dataset.rowId,i=parseInt(t.querySelector('[data-row-field="pos_x"]').value),s=parseInt(t.querySelector('[data-row-field="pos_y"]').value),n=parseInt(t.querySelector('[data-row-field="pos_z"]').value);let r=this.getGridItem(e);if(!r&&i&&s&&n){const t=this.widgetElement.querySelector(".template-doc-section-grid-item");r=o.Z.spawnFromTemplate(t,{id:e});const n=this.getGridCell(i,s);n&&n.appendChild(r)}if(!r)return!1;this.moveGridItem(r,i,s,n),r.querySelectorAll(".doc-field").forEach((function(e){const i=e.dataset.rowField,s=e.querySelector(".doc-field-content");let o,n;if("property"===e.dataset.rowFormat)n=t.querySelector("input.input-reference-value").value,o=t.querySelector("input.input-reference-text").value;else{const e=t.querySelector('[data-row-field="'+i+'"] input');o=e?e.value:void 0}s&&o&&(s.textContent=o),s&&n&&(s.dataset.rowValue=n)}))}moveGridItem(t,e,i,s){let n=this.getGridSize();n.cols<e&&(n.cols=e,o.Z.setInputValue(this.gridSizeElement.querySelector("input.doc-section-grid-cols"),e)),n.rows<i&&(n.rows=i,o.Z.setInputValue(this.gridSizeElement.querySelector("input.doc-section-grid-rows"),i)),this.setGridSize(n);try{const o=t.parentElement;t.remove();const n=this.getGridCell(e,i);n&&(s>=1&&((s=Math.min(s,n.childElementCount+1))>n.childElementCount?n.appendChild(t):n.insertBefore(t,n.children[s-1])),this.updateZInputs(n)),this.updateZInputs(o)}catch(t){return!1}return!0}sortItems(){const t=document.activeElement,e=this.itemContainer.querySelector(".doc-group-headers"),i=this.gridTable.querySelectorAll('[data-row-table="items"][data-row-id]');for(let t=i.length-1;t>=0;t--){const s=this.getTableItem(i[t].dataset.rowId),o=s?s.querySelector(".doc-fieldname-sortno input"):void 0;o&&(o.value=t+1);const n=i[t].querySelector('[data-row-field="sortno"] .doc-field-content');n&&(n.innerHTML=t+1),e&&s&&(e.insertAdjacentElement("afterend",s),s.classList.remove("doc-section-item-first"))}const s=this.itemContainer.querySelector('[data-row-table="items"][data-row-id]');s&&s.classList.add("doc-section-item-first"),t.focus()}fetchItems(t,e,i){if(!this.itemContainer)return;this.getGridCell(e,i);const s=this;this.itemContainer.querySelectorAll('[data-row-table="items"]').forEach((t=>{const o=t.querySelector('[data-row-field="pos_x"]'),n=t.querySelector('[data-row-field="pos_y"]');o&&n&&o.value==e&&n.value==i&&s.updateGridItem(t)}))}findPositionInGrid(t){let e,i;return i=[...this.gridTable.rows].findIndex((i=>(e=[...i.cells].findIndex((e=>e.querySelector(`[data-row-id="${t}"]`)))+1,0!==e)))+1,{x:e,y:i}}getGridSize(){const t=this.gridSizeElement.querySelector('input[data-row-field="layout_rows"]'),e=this.gridSizeElement.querySelector('input[data-row-field="layout_cols"]');return{rows:Math.max(1,Number(t.value||1)),cols:Math.max(1,Number(e.value||1))}}setGridSize(t){if(this.gridSizeElement&&(o.Z.setInputValue(this.gridSizeElement.querySelector('input[data-row-field="layout_rows"]'),t.rows),o.Z.setInputValue(this.gridSizeElement.querySelector('input[data-row-field="layout_cols"]'),t.cols)),!this.gridTable)return;const e=this.gridTable.rows.length,i=e?this.gridTable.rows[0].cells.length:0;for(let i=e;i<t.rows;i++){let e=this.gridTable.insertRow(-1);for(let s=0;s<t.cols;s++){let t=e.insertCell(-1);this.fetchItems(t,s+1,i+1)}}if(i<t.cols)for(let s=0;s<e;s++){let e=this.gridTable.rows[s];for(let o=i;o<t.cols;o++){let t=e.insertCell(-1);this.fetchItems(t,o+1,s+1)}}for(let i=e;i>t.rows;i--){let t=this.gridTable.rows[i-1];for(let e=0;e<t.cells.length;e++){t.cells[e].classList.add("hide")}t.classList.add("hide")}if(i>t.cols)for(let e of this.gridTable.rows)for(let i=e.cells.length;i>t.cols;i--){e.cells[i-1].classList.add("hide")}for(let e=0;e<t.rows;e++){let i=this.gridTable.rows[e];for(let e=0;e<t.cols;e++){i.cells[e].classList.remove("hide")}i.classList.remove("hide")}}setMaxValues(t){if(!this.itemContainer)return;this.itemContainer.querySelectorAll(".doc-section-item:not([data-deleted]) .doc-fieldname-pos input").forEach((e=>{"pos_x"===e.dataset.rowField&&e.setAttribute("max",t.cols),"pos_y"===e.dataset.rowField&&e.setAttribute("max",t.rows)}))}updateZInputs(t){for(let e=1;e<=t.children.length;e++){const i=t.children[e-1].dataset.rowId,s=this.getTableItem(i).querySelector('input[data-row-field="pos_z"]');s.setAttribute("max",t.children.length),s.value=e}this.sortItems()}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.grid=n},773:(t,e,i)=>{"use strict";var s=i(182),o=i(584);class n extends o.Xt{constructor(t,e,i){super(t,e,i),this.terms=s.Z.getDataValue(this.widgetElement,"highlight"),this.listenEvent(document,"epi:save:form",(t=>this.onBeforeSave(t)))}initWidget(){this.highlightDocument(),this.jumpToHighlighted()}highlightDocument(){this.highlightTerms(this.widgetElement),this.widgetElement.classList.contains("widget-document")&&document.querySelectorAll(".widget-document-satellite").forEach((t=>this.highlightTerms(t)))}unHighlightDocument(){this.unHighlightTerms(this.widgetElement),this.widgetElement.classList.contains("widget-document")&&document.querySelectorAll(".widget-document-satellite").forEach((t=>this.unHighlightTerms(t)))}highlightTerms(t){if(!t||!this.terms)return;let e=this.terms.split(",").map((t=>t.trim().replace(/^['" ]+|['" ]+$/g,""))).filter((t=>t.length>0));if(e.length>0){new Mark(t).mark(e)}}unHighlightTerms(t){if(!t||!this.terms)return;new Mark(t).unmark()}jumpToHighlighted(){const t=this.widgetElement.querySelector("mark");t&&t.scrollIntoView()}onBeforeSave(t){this.unHighlightDocument()}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.highlight=n},903:(t,e,i)=>{"use strict";var s=i(584),o=i(956),n=i(182);class r extends s.Xt{constructor(t,e,i){super(t,e,i),this.config={closeOnOpen:!1,recreateContainer:!1,containerSelector:".doc-imagelist",imageSelector:".doc-image"},this.overlay=void 0,this.overlay_header=void 0,this.image_container=void 0,this.image_viewport=void 0,this.image_image=void 0,this.loader=void 0,this.items=void 0,this.currentPosition=void 0,this.sideBarRight=void 0,this.sideBarLeft=void 0,this.items=void 0,this.options={title:"Image viewer"},this.rotationAngle=0,this.dragX=void 0,this.dragY=void 0,this.listenEvent(this.widgetElement,"click",(t=>this.clickOnImage(t))),this.selectImageByHash()}static attachImages(t,e){const i=document.querySelector(t);if(!i)return;if(!i.querySelector(e))return;const s=new r(container);s.config.containerSelector=t,s.config.imageSelector=e}createOverlay(){const t=n.Z.spawnFromString('<div class="overlay hidden">\n    <div class="overlay-header">\n        <div class="overlay-header-buttons overlay-header-buttons-left"></div>\n        <div class="overlay-header-title"></div>\n        <div class="overlay-header-buttons overlay-header-buttons-right"></div>\n    </div>\n    <div class="overlay-content">\n        <nav class="sidebar sidebar-left sidebar-size-2 sidebar-expanded">\n            <div class="sidebar-content"></div>\n        </nav>\n\n        <div class="image-container">\n            <div class="image-viewport" style="transform: rotate(0deg);">\n                <img alt="" src="" class="">\n                <div class="loader"></div>\n            </div>\n        </div>\n        <div class="metadata-container">\n            <div class="metadata-content"></div>\n        </div>\n    </div>\n    <footer class="overlay-footer">\n        <div class="overlay-footer-left">\n        <nav></nav>\n        </div>\n        <div class="overlay-footer-title"></div>\n    </footer>\n</div>');return this.listenEvent(t,"click",(t=>this.clickOnImage(t))),t}loadItems(t){if(this.items)return;const e=this.overlay.querySelector(".sidebar-left .sidebar-content");if(e&&t){if(this.config.recreateContainer){const e=t.querySelectorAll(this.config.imageSelector);(t=document.createElement("div")).classList.add("image-list"),e.forEach((e=>{const i=e.cloneNode(!0);i.classList.remove("hidden"),t.append(i)}))}else t=t.cloneNode(!0);e.replaceChildren(t)}this.items=e.querySelectorAll(this.config.imageSelector);const i=this.overlay.querySelector(".overlay-header-buttons-left");this.items.length<2?(this.sideBarLeft.hideSidebar(!0),n.Z.hide(i)):(this.sideBarLeft.showSidebar(),n.Z.show(i))}clickOnImage(t){if(!t.target.closest("a.link-image")||t.ctrlKey||t.metaKey)return;const e=t.target.closest(this.config.imageSelector);e&&(t.preventDefault(),this.selectImageByElement(e))}selectImageByElement(t){if(this.isActive()&&this.items)this.currentPosition=Array.from(this.items).findIndex((e=>t===e));else{this.showOverlay();const e=t.closest(this.config.containerSelector);if(e){this.loadItems(e);const i=e.querySelectorAll(this.config.imageSelector);this.currentPosition=Array.from(i).findIndex((e=>t===e))}else this.currentPosition=0,this.items=[t]}this.showCurrentImage()}selectImageByHash(){const t=location.hash.match(/^#items-(\d+)$/),e=t?document.querySelector('.doc-image[data-row-id="'+t[1]+'"]'):null;e&&this.selectImageByElement(e)}getCurrentImage(){return this.currentPosition>-1&&this.currentPosition<this.items.length?this.items[this.currentPosition]:null}showCurrentImage(){const t=this.getCurrentImage();this.items.forEach((t=>{t.classList.remove("selected")})),t.classList.add("selected"),n.Z.scrollIntoViewIfNeeded(t),this.image_image.classList.add("hidden"),this.loader.classList.remove("hidden");const e=new Image;e.onload=()=>{e.onload=null,this.loader.classList.add("hidden"),this.image_image.classList.remove("hidden"),this.image_image.setAttribute("src",e.src)};const i=t.querySelector("img");e.src=i?i.dataset.display:"",this.showMetadata(t),this.fitSize()}getMetadata(t){let e={};const i=t.querySelector(".doc-image-metadata");return i&&(e.title=i.querySelector('[data-row-field="file"]').textContent,e.element=i.cloneNode(!0)),e}showMetadata(t){const e=this.getMetadata(t),i=this.overlay.querySelector(".overlay-header-title");i&&e.title&&(i.innerText=e.title||"");const s=this.overlay.querySelector(".overlay-footer-title");s&&e.footer&&(s.innerText=e.footer||"");const o=this.overlay.querySelector(".metadata-content");o&&e.element?o.replaceChildren(e.element):this.sideBarRight.hideSidebar(!0);const r=this.overlay.querySelector(".btn-open");r&&n.Z.toggle(r,t.dataset.itemUrl||!1)}isActive(){return this.overlay&&!this.overlay.classList.contains("hidden")}closeOverlay(){this.overlay&&(this.overlay.classList.add("hidden"),document.body.classList.remove("no-scroll"))}showOverlay(){if(this.overlay)return this.overlay.classList.remove("hidden"),void document.body.classList.add("no-scroll");this.overlay=this.createOverlay(),this.overlay.classList.remove("hidden"),document.body.classList.add("no-scroll"),this.overlay_header=this.overlay.querySelector(".overlay-header");const t=this.getDialogButtons();for(const[e,i]of Object.entries(t))if("topleft"===i.position||"topright"===i.position){const t=document.createElement("button");t.className=i.class,t.addEventListener("click",i.click),"topleft"===i.position?this.overlay_header.querySelector(".overlay-header-buttons-left").append(t):"topright"===i.position&&this.overlay_header.querySelector(".overlay-header-buttons-right").append(t)}this.image_container=this.overlay.querySelector(".image-container"),this.image_viewport=this.overlay.querySelector(".image-viewport"),this.image_image=this.overlay.querySelector("img"),this.loader=this.overlay.querySelector(".loader");const e=this.overlay.querySelector(".metadata-container");this.sideBarRight=new o._2(e,"right",10,!0);const i=this.overlay.querySelector(".sidebar-left");this.sideBarLeft=new o._2(i,"left",10,!1);const s=this.getDialogButtons();for(const[t,e]of Object.entries(s))if("bottom"===e.position){const t=document.createElement("button");t.className=e.class,t.addEventListener("click",e.click),this.overlay.querySelector(".overlay-footer-left nav").append(t)}document.querySelector("body").append(this.overlay),this.image_container.addEventListener("mousedown",(t=>this.dragMouseDown(t))),this.image_container.addEventListener("wheel",(t=>this.mouseWheel(t))),this.image_image.addEventListener("load",(t=>this.fitSize(t)))}openInNewTab(){const t=this.getCurrentImage();t&&t.dataset.itemUrl&&(window.open(t.dataset.itemUrl,"_blank"),this.config.closeOnOpen&&this.closeOverlay())}getDialogButtons(){return{"Previous Image":{class:"button-svg button-previous",title:"Previous image",ariaLabel:"Previous image",position:"topleft",click:t=>this.previousImage()},"Next Image":{class:"button-svg button-next",position:"topleft",title:"Next image",ariaLabel:"Next image",click:t=>this.nextImage()},"Open in new tab":{class:"btn-open",title:"Open in new tab",ariaLabel:"Open in new tab",position:"topright",click:t=>this.openInNewTab()},Close:{class:"btn-close",position:"topright",title:"Close",ariaLabel:"Close",click:t=>this.closeOverlay()},"Rotate to left":{class:"button-svg button-rotate-left",title:"Rotate left",ariaLabel:"Rotate left",position:"bottom",click:t=>this.rotateLeft()},"Rotate to right":{class:"button-svg button-rotate-right",title:"Rotate right",ariaLabel:"Rotate right",position:"bottom",click:t=>this.rotateRight()},"Zoom in":{class:"button-svg button-zoom-in",title:"Zoom in",ariaLabel:"Zoom in",position:"bottom",click:t=>this.zoomIn()},"Zoom out":{class:"button-svg button-zoom-out",title:"Zoom out",ariaLabel:"Zoom out",position:"bottom",click:t=>this.zoomOut()},"Fit size":{class:"button-svg button-size-fit",title:"Fit image size to frame",ariaLabel:"Fit image size to frame",position:"bottom",click:t=>this.fitSize(t)}}}previousImage(){this.currentPosition-=1;const t="string"==typeof items?0:this.items.length;this.currentPosition=n.Z.mod(this.currentPosition,t),this.showCurrentImage()}nextImage(){this.currentPosition+=1;const t="string"==typeof items?0:this.items.length;this.currentPosition=n.Z.mod(this.currentPosition,t),this.showCurrentImage()}rotateLeft(){this.rotateBy(-45)}rotateRight(){this.rotateBy(45)}rotateBy(t){this.rotationAngle=(this.rotationAngle+t)%360,this.image_viewport.style.transform=`rotate(${this.rotationAngle}deg)`}rotateCoordinates(t,e,i,s,o){const n=Math.PI/180*o,r=Math.cos(n),a=Math.sin(n);return[r*(i-t)+a*(s-e)+t,r*(s-e)-a*(i-t)+e]}dragMouseDown(t){t.target.closest("img")&&(t.preventDefault(),this.dragX=t.clientX,this.dragY=t.clientY,document.onmouseup=t=>this.dragMouseUp(t),document.onmousemove=t=>this.dragMouseMove(t))}dragMouseMove(t){t.preventDefault();let e=this.dragX-t.clientX,i=this.dragY-t.clientY;this.dragX=t.clientX,this.dragY=t.clientY;const s=this.rotateCoordinates(0,0,e,i,this.rotationAngle);e=s[0],i=s[1];const o=this.image_image;o.style.left=o.offsetLeft-e+"px",o.style.top=o.offsetTop-i+"px"}dragMouseUp(t){document.onmouseup=null,document.onmousemove=null}zoomIn(){this.zoom(.3,!0)}zoomOut(){this.zoom(-.3,!0)}zoom(t,e,i,s){const o=this.image_image,n=this.image_container,r=o.offsetHeight,a=o.offsetWidth,l=r+t*r,c=a*(l/r);i=void 0===i?n.offsetWidth/2-o.offsetLeft:i,s=void 0===s?n.offsetHeight/2-o.offsetTop:s;const d=o.offsetLeft-i/a*(c-a),u=o.offsetTop-s/r*(l-r);!0===e&&(this.image_image.classList.add("animate-zoom"),setTimeout((()=>this.image_image.classList.remove("animate-zoom")),150)),this.image_image.style.left=`${d}px`,this.image_image.style.top=`${u}px`,this.image_image.style.height=`${l}px`}mouseWheel(t){if(!t.target.closest("img"))return;const e=this.image_image,i=this.image_container,s=i.getBoundingClientRect();let o=t.clientX-s.left,n=t.clientY-s.top;const r=this.rotateCoordinates(i.offsetWidth/2,i.offsetHeight/2,o,n,this.rotationAngle);o=r[0]-e.offsetLeft,n=r[1]-e.offsetTop;const a=t.deltaY>0?-.1:.1;this.zoom(a,!1,o,n),t.preventDefault()}fitSize(t){this.loader.classList.add("hidden");const e=this.image_viewport;e.style.transform="rotate(0deg)",this.rotationAngle=0;const i=e.offsetHeight,s=e.offsetWidth,o=this.image_image;let n,r=o.offsetHeight,a=o.offsetWidth;n=i/r*a>s?s/a*r:i,o.style.height=`${n}px`,r=o.offsetHeight,a=o.offsetWidth;const l=.5*(s-a),c=.5*(i-r);o.style.left=`${l}px`,o.style.top=`${c}px`,o.style.position="absolute"}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses["image-viewer"]=r},160:(t,e,i)=>{"use strict";i.a(t,(async(t,e)=>{try{var s=i(584),o=i(182),n=i(649),r=t([n]);n=(r.then?(await r)():r)[0];class a extends s.Xt{constructor(t,e,i){super(t,e,i),this.delay=0,this.lastRefresh=0,this.isPolling=!1,this.isCancelled=!1,this.isFinished=!1,this.proceedUrl=null,this.progressBar=this.widgetElement.querySelector(".widget-job-bar"),$(this.progressBar).progressbar({disabled:!1,value:!1}),this.messageBar=this.widgetElement.querySelector(".widget-job-message"),this.resultTable=this.widgetElement.querySelector(".widget-job-results"),this.frameWidget=this.getFrame()}initWidget(){this.frameWidget=this.getFrame(),this.frameWidget&&(this.listenEvent(this.frameWidget.buttonPane,"click",(t=>this.onButtonClick(t))),this.listenEvent(this.frameWidget.widgetElement,"epi:click:button",(t=>this.onButtonClick(t)))),this.startPolling()}getNextUrl(){return this.widgetElement.dataset.jobNexturl}getRedirectUrl(){if(this.widgetElement.dataset.jobRedirect){return new URL(this.widgetElement.dataset.jobRedirect,App.baseUrl).toString()}}getDownloadUrl(){if(this.widgetElement.dataset.jobDownload){return new URL(this.widgetElement.dataset.jobDownload,App.baseUrl).toString()}}getCancelUrl(){return this.widgetElement.dataset.jobCancelurl}startPolling(){const t={downloadUrl:this.getDownloadUrl(),redirectUrl:this.getRedirectUrl()};return t.downloadUrl||t.redirectUrl?(this.showProceed(t),!0):(this.url=this.getNextUrl(),!!this.url&&(!!this.frameWidget&&(this.isCancelled=!1,this.frameWidget.hideButton("proceed"),this.frameWidget.showButton("cancel","Stop"),this.continuePolling(this.url),!0)))}stopPolling(t){this.isCancelled?this.showError("Cancelled"):this.showResult(t)}onButtonClick(t){const e=o.Z.getValue(t,"detail.data.role",t.target.dataset.role);"cancel"===e?this.isPolling?(this.cancel(),t.preventDefault()):this.isInFrame()&&(this.frameWidget.closeWindow(),t.preventDefault()):this.isFinished&&"proceed"===e&&(window.location=this.proceedUrl,t.preventDefault())}showError(t){this.isPolling=!1,t=void 0===t?"An error occured. See the logs for details.":t,this.messageBar.innerHTML=t,this.messageBar.classList.add("error"),o.Z.hide(this.progressBar),this.frameWidget.hideButton("proceed"),this.frameWidget.showButton("cancel","Close")}showSuccess(t){this.messageBar.innerHTML=t,this.messageBar.classList.add("success"),this.frameWidget.hideButton("cancel"),o.Z.hide(this.progressBar)}showProceed(t){let e;this.showResult(t),e=t.downloadUrl?t.downloadUrl:t.redirectUrl,e=new URL(e,App.baseUrl),this.proceedUrl=e.toString();const i=t.downloadUrl?"Download":"Proceed";this.frameWidget.showButton("proceed",i,this.proceedUrl),this.isInFrame()&&(this.frameWidget.showButton("cancel","Close"),this.frameWidget.closeWindow()),t.downloadUrl?window.open(this.proceedUrl):window.location=this.proceedUrl}showResult(t){this.isPolling=!1,this.isFinished=!0;const e=t&&t.message?t.message:"Finished";this.showSuccess(e);const i=o.Z.getValue(t,"result.downloads"),s=this.resultTable?this.resultTable.querySelector("td"):void 0;if(!i||!s)return;let n="";i.forEach((t=>{n+=`<a href="${t.url}" target="_blank">${t.caption}</a><br>`})),s.innerHTML=n,this.resultTable.classList.remove("empty")}continuePolling(t,e){const i=this;this.isPolling=!0;const s=Date.now();if(this.lastRefresh&&this.lastRefresh+this.delay>s)return void setTimeout((()=>{this.continuePolling(t,e)}),this.delay);this.lastRefresh=s;let n={};void 0!==e&&(n=$(e).serialize()),App.showLoader(),$.ajax({type:"post",url:t,data:n,dataType:"json",success:function(t,e){if(t=t.job,i.progressBar&&(t.progressmax&&$(i.progressBar).progressbar("option","max",parseInt(t.progressmax)),t.progress&&($(i.progressBar).progressbar("option","value",parseInt(t.progress)),i.progressBar.querySelector(".ui-progressbar-value").innerHTML=t.progress+" / "+t.progressmax)),i.messageBar.innerHTML=t.message?t.message:"",t.error||"error"===t.status)i.showError(t.error||o.Z.getValue(t,"result.error"));else if(t.downloadUrl||t.redirectUrl)i.showProceed(t);else if(t.nexturl&&!i.isCancelled){1===t.delay&&(i.delay=1e3);const e=new URL(t.nexturl,App.baseUrl);i.continuePolling(e)}else i.stopPolling(t)},error:function(t,e,s){i.showError(s)},complete:function(t,e){App.hideLoader()}})}cancel(){this.isCancelled=!0,this.progressBar.querySelector(".ui-progressbar-value").innerHtml="",$(this.progressBar).progressbar("option","value",!1),$(this.progressBar).progressbar("option","max",!1);const t=this.getCancelUrl();if(t)return fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"}})}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.job=a,e()}catch(t){e(t)}}))},956:(t,e,i)=>{"use strict";i.d(e,{Ew:()=>l,UQ:()=>r,_2:()=>n});var s=i(182),o=i(584);class n extends o.Xt{constructor(t,e,i,o){if(super(t),!t)return;this.wrapper=s.Z.getValue(t,"parentElement"),this.sidebar=t,this.orientation=e||"left",this.snapWidth=i||150,this.collapsed=o||!t||t.classList.contains("sidebar-init-collapsed"),this.closeButton=t?t.querySelector(".btn-close, .btn-apply"):void 0,this.empty=!!t&&t.classList.contains("sidebar-empty"),this.width=void 0,this.getFrame()||(this.widgetElement.dataset.uiKey=this.getController()+"-"+this.getAction()+"-sidebar-"+e);const n='<div class="sidebar-resizer sidebar-resizer-'+this.orientation+'"></div>';this.sidebar.insertAdjacentHTML("afterbegin",n),this.resizer=this.sidebar.firstChild,this.isResizing=!1;const r='<div class="sidebar-imploder sidebar-imploder-'+this.orientation+'"></div>';this.resizer.insertAdjacentHTML("afterbegin",r),this.imploder=this.resizer.firstChild;let a="sidebar-exploder sidebar-exploder-"+this.orientation;this.empty&&(a+=" sidebar-empty");const l='<div class="'+a+'"></div>';this.sidebar.insertAdjacentHTML("afterend",l),this.exploder=this.sidebar.nextSibling,this.resizer.addEventListener("mousedown",(t=>this.toggleResize(t))),this.imploder.addEventListener("click",(t=>this.toggleSidebar(t))),this.exploder.addEventListener("click",(t=>this.toggleSidebar(t))),this.listenEvent(this.widgetElement,"click",(t=>{t.target.classList.contains("btn-close")||t.target.classList.contains("btn-apply")?this.hideSidebar():t.target.classList.contains("btn-open")&&this.emitEvent("epi:open:tab",void 0,!0)&&window.open(t.target.dataset.targetUrl)})),!0===this.collapsed?this.hideSidebar():this.showSidebar()}hideSidebar(t=!1){this.sidebar.classList.remove("sidebar-expanded"),this.sidebar.classList.add("sidebar-collapsed"),this.exploder.classList.remove("sidebar-expanded"),this.exploder.classList.add("sidebar-collapsed"),t&&this.exploder.classList.add("sidebar-empty"),"undefined"!=typeof App&&App.accordion&&App.accordion.showMain()}showSidebar(t,e){void 0===e||this.sidebar.classList.contains("sidebar-expanded")||this.setWidth(e),!1===t&&(t=s.Z.isTrue(this.getSetting("expanded",!0))),void 0===t||t?(this.sidebar.classList.add("sidebar-expanded"),this.sidebar.classList.remove("sidebar-collapsed"),this.exploder.classList.add("sidebar-expanded"),this.exploder.classList.remove("sidebar-collapsed"),this.exploder.classList.remove("sidebar-full")):this.exploder.classList.add("sidebar-full"),this.sidebar.classList.remove("sidebar-empty"),this.exploder.classList.remove("sidebar-empty"),"undefined"!=typeof App&&App.accordion&&App.accordion.showPanel(this.sidebar)}toggleSidebar(t){const e=this.sidebar.classList.contains("sidebar-expanded");e?this.hideSidebar():this.showSidebar(),this.setSetting("expanded",!e)}toggleResize(t){this.isResizing=!0,this.resizer.classList.add("is-resizing"),document.body.classList.add("dragging");const e=t=>this.resizeSidebar(t);document.addEventListener("mousemove",e,!1),document.addEventListener("mouseup",(()=>{this.isResizing=!1,this.resizer.classList.remove("is-resizing"),document.body.classList.remove("dragging"),document.removeEventListener("mousemove",e,!1),this.setSetting("width",this.width)}),!1)}isVisible(){return this.sidebar&&this.sidebar.clientWidth>0}setWidth(t){this.width=t,this.sidebar.style.flexBasis="string"==typeof t?t:`${t}px`}resizeSidebar(t){if(!1===this.isResizing)return;t.preventDefault();const e=this.wrapper.getBoundingClientRect().left;let i;i="right"===this.orientation?this.wrapper.clientWidth+this.resizer.clientWidth-(t.x-e):this.resizer.clientWidth+(t.x-e),i<this.snapWidth?this.hideSidebar():this.setWidth(i)}}class r extends o.Xt{constructor(t,e,i){super(t,e,i),this.items=t.querySelectorAll(".accordion-item"),this.toggles=t.querySelectorAll(".accordion-toggle"),this.main=t.querySelector(".accordion-main"),this.toggles.forEach((t=>this.listenEvent(t,"click",(t=>this.onToggleClick(t))))),this.items.forEach((t=>{t.classList.contains("accordion-main")||this.listenEvent(t,"click",(t=>this.onLinkClick(t)))}))}showMain(){this.showPanel(this.main)}showPanel(t,e){t&&(this.toggles.forEach((t=>{t.classList.remove("accordion-active")})),this.items.forEach((t=>{t.classList.remove("accordion-expanded"),t.classList.add("accordion-collapsed")})),t.classList.add("accordion-expanded"),t.classList.remove("accordion-collapsed"),!e&&t.dataset.accordionItem&&(e=document.querySelector('[data-toggle-accordion="'+t.dataset.accordionItem+'"]')),e&&e.classList.add("accordion-active"))}hidePanel(t,e){t&&(e.classList.remove("accordion-active"),t.classList.remove("accordion-expanded"),t.classList.add("accordion-collapsed"),this.main.classList.add("accordion-expanded"),this.main.classList.remove("accordion-collapsed"))}onToggleClick(t){const e=t.target,i=document.querySelector("[data-accordion-item="+e.dataset.toggleAccordion+"]");e.classList.contains("accordion-active")?this.hidePanel(i,e):this.showPanel(i,e)}onLinkClick(t){if("A"===t.target.tagName){const e=t.target.getAttribute("href");e&&e.startsWith("#")&&this.showMain()}}}class a extends o.Xt{constructor(t,e,i){super(t,e,i),this.buttonContainer=this.widgetElement.querySelector(".widget-tabsheets-selectors-tabs"),this.tabContainer=this.widgetElement.querySelector(".widget-tabsheets-sheets");const s=this.widgetElement.querySelector(".btn-add");if(s){const t=document.querySelector("#"+s.dataset.toggle);this.listenEvent(t,"changed",(t=>this.onTabAdd(t)))}this.listenEvent(this.buttonContainer,"click",(t=>this.onTabClick(t)))}initWidget(){let t=this.widgetElement.querySelector(".widget-tabsheets-sheet.active");t||(t=this.widgetElement.querySelector(".widget-tabsheets-sheet")),t&&this.showTab(t.dataset.tabsheetId)}createTab(t,e){let i=this.widgetElement.querySelector('.widget-tabsheets-sheet[data-tabsheet-id="'+t+'"]'),o=this.widgetElement.querySelector('.widget-tabsheets-button[data-tabsheet-id="'+t+'"]');return i||(i=s.Z.spawnFromString('<div class="widget-tabsheets-sheet empty" data-tabsheet-id="'+t+'"></div>'),this.tabContainer.appendChild(i)),o||(e=e||"Details",o=s.Z.spawnFromString('<div class="widget-tabsheets-button empty" data-tabsheet-id="'+t+'"><button class="caption">'+e+'</button><button class="btn-remove">x</button></div>'),this.buttonContainer.appendChild(o)),this.emitEvent("epi:create:tabsheet",{name:t}),i}removeTab(t){let e=this.widgetElement.querySelector('.widget-tabsheets-sheet[data-tabsheet-id="'+t+'"]'),i=this.widgetElement.querySelector('.widget-tabsheets-button[data-tabsheet-id="'+t+'"]');if(s.Z.emitEvent(e,"epi:remove:tabsheet",{name:t},this,!0)){if(i&&i.classList.contains("active")){const t=i.previousElementSibling||i.nextElementSibling;t&&this.showTab(t.dataset.tabsheetId)}e.remove(),i.remove(),App.finishWidgets(e)}}showTab(t,e){const i=this.widgetElement.querySelector('.widget-tabsheets-sheet[data-tabsheet-id="'+t+'"]'),o=this.widgetElement.querySelector('.widget-tabsheets-button[data-tabsheet-id="'+t+'"]');i&&o&&("last"===e&&this.buttonContainer.appendChild(o),o.classList.remove("empty"),i.classList.remove("empty"),this.widgetElement.querySelectorAll(".widget-tabsheets-button").forEach((t=>t.classList.remove("active"))),this.widgetElement.querySelectorAll(".widget-tabsheets-sheet").forEach((t=>t.classList.remove("active"))),o.classList.add("active"),i.classList.add("active"),s.Z.emitEvent(i,"epi:show:tabsheet"));const n=this.buttonContainer.querySelectorAll(".widget-tabsheets-button:not(.empty)").length;return 0===n?(this.widgetElement.classList.add("empty"),this.widgetElement.classList.remove("simple")):1===n?(this.widgetElement.classList.remove("empty"),this.widgetElement.classList.toggle("simple",!this.widgetElement.classList.contains("extendable"))):(this.widgetElement.classList.remove("empty"),this.widgetElement.classList.remove("simple")),i}loadTab(t,e){const i=this.spawnFromTemplate("template-tabsheet",{name:t,caption:e}),s=this.createTab(t,e);return s.replaceChildren(i),App.initWidgets(s),this.showTab(t),s}setTitle(t,e){const i=this.widgetElement.querySelector('.widget-tabsheets-button[data-tabsheet-id="'+t+'"] button.caption');i&&(i.textContent=e)}onTabAdd(t){if("changed"===t.type){this.loadTab(t.detail.data.id,t.detail.data.label);const e=this.widgetElement.querySelector(".btn-add");this.getWidget(e,"dropdown",!1).closeDropdown()}}onTabClick(t){const e=t.target.closest(".widget-tabsheets-button");e&&(t.target.classList.contains("btn-remove")?this.removeTab(e.dataset.tabsheetId):this.showTab(e.dataset.tabsheetId))}}class l extends o.Xt{constructor(){super(),this.content=null,this.menu=null,this.observer=null,this.activeSection=null,this.isScrolling=0,this.content=document.querySelector(".widget-scrollsync-content"),this.menu=document.querySelector(".widget-scrollsync"),this.menu&&(this.listenEvent(this.menu,"click",(t=>this.itemClicked(t))),this.listenEvent(document,"keydown",(t=>this.onKeydown(t))),this.initScrollObserver(),this.updateWidget()),this.listenEvent(document,"epi:focus:widgets",(t=>this.focusWidget(t)))}initWidget(){this.scrollToHashFragment()}updateWidget(){this.isScrolling+=1;this.getSections().forEach((t=>{void 0===t.widgetScrollSync&&(t.widgetScrollSync=this,this.observer&&this.observer.observe(t))})),this.isScrolling-=1}initScrollObserver(){const t={threshold:[0],root:this.content};this.observer=new IntersectionObserver((t=>{t.forEach((t=>{t.target.isVisible=!0===t.isIntersecting,t.target.isAbove=t.boundingClientRect.y<t.rootBounds.y}));let e=this.activeSection;if(this.activeSection&&!this.activeSection.isVisible)if(e.isAbove)for(;!e.isVisible&&e.nextElementSibling;)e=e.nextElementSibling;else for(;!e.isVisible&&e.previousElementSibling;)e=e.previousElementSibling;else!e&&t[0].target.isVisible&&(e=t[0].target);e&&e.classList.contains("widget-scrollsync-section")&&(this.scrollToLi(this.getLi(e),!0),this.scrollToSection(e,!1))}),t)}getSections(){return this.content.querySelectorAll(".widget-scrollsync-section")}getLi(t){return t&&this.menu?this.menu.querySelector('[data-section-id="'+t.id+'"]'):null}getSection(t){return t?document.getElementById(t.dataset.sectionId):null}itemClicked(t){const e=t.target.closest("li"),i=this.getSection(e);this.scrollToLi(e,!1),this.scrollToSection(i,!0),this.expandSection(i)}focusWidget(t){if(!t.detail.data.focus)return;const e=t.target.closest(".widget-scrollsync-section");e&&(this.scrollToLi(this.getLi(e),!0),this.scrollToSection(e,!1))}onKeydown(t){let e;if("PageDown"===t.key){if(!s.Z.bottomAboveViewport(this.activeSection,this.content))return;e=s.Z.getNextVisibleSibling(this.activeSection,".widget-scrollsync-section")}else if("PageUp"===t.key){if(!s.Z.topBelowViewport(this.activeSection,this.content))return;e=s.Z.getPrevVisibleSibling(this.activeSection,".widget-scrollsync-section")}e&&(this.activateSection(e),t.preventDefault())}scrollToHashFragment(){const t=window.location.hash;if(!t)return!1;let e;try{e=document.querySelector(t)}catch{e=null}if(!e)return!1;this.expandSection(e),this.activateSection(e),this.focusSection(e)}activateSection(t){this.scrollToLi(this.getLi(t),!0),this.scrollToSection(t,!0)}focusSection(t){s.Z.scrollToTop(t,t.closest(".widget-scrollsync-content"))}activateLi(t){this.scrollToLi(t,!0),this.scrollToSection(this.getSection(t),!0)}scrollToLi(t,e=!1){return!(this.isScrolling>0)&&((!t||!t.classList.contains("active"))&&(this.isScrolling+=1,t&&(e&&s.Z.scrollIntoViewIfNeeded(t,t.closest(".frame-content"),!1,"y"),this.menu.querySelectorAll("li").forEach((t=>t.classList.remove("active"))),t.classList.add("active")),void(this.isScrolling-=1)))}expandSection(t,e=!1){(e||t&&!t.classList.contains("doc-section-collapsed"))&&s.Z.emitEvent(t,"epi:focus:section",{},this)}scrollToSection(t,e=!1){return!(this.isScrolling>0)&&(t!==this.scrollToSection&&(this.isScrolling+=1,this.activeSection=t,t&&(e&&(window.location.hash="#"+t.id,s.Z.scrollIntoViewIfNeeded(t,t.closest(".widget-scrollsync-content"),!1,"y")),t.parentElement&&[...t.parentElement.children].forEach((t=>{t.classList.remove("active")})),this.setActive(t)),void(this.isScrolling-=1)))}setActive(t){t.classList.add("active");const e=document.querySelector('.doc-section-note[data-section-id="'+t.id+'"]');s.Z.toggleClass("active",e,document.querySelectorAll(".doc-section-note"));const i=e?e.closest(".widget-tabsheets-sheets"):void 0;s.Z.scrollIntoViewIfNeeded(e,i);const o=t.closest(".widget-document");if(o){const e=o.dataset.rootTable+"-"+o.dataset.rootId;document.querySelectorAll('a[data-target="'+e+'"]').forEach((e=>{const i=e.getAttribute("href");if(i){const s=new URL(i,App.baseUrl);s.hash="#"+t.id,e.setAttribute("href",s.toString())}}));const i=o.querySelector('form[data-target="'+e+'"]');if(i){const e=i.getAttribute("action");if(e){const s=new URL(e,App.baseUrl);s.searchParams.set("hash",t.id),i.setAttribute("action",s.toString())}if(i.dataset.proceedUrl){const e=new URL(i.dataset.proceedUrl,App.baseUrl);e.hash="#"+t.id,i.dataset.proceedUrl=e.toString()}if(i.dataset.cancelUrl){const e=new URL(i.dataset.cancelUrl,App.baseUrl);e.hash="#"+t.id,i.dataset.cancelUrl=e.toString()}}}}}class c extends o.Xt{constructor(t){super(t),this.tabsheet=void 0,this.loaded=!1,this.url=this.widgetElement.dataset.url}initWidget(){this.tabsheet=this.widgetElement.closest(".widget-tabsheets-sheet"),this.tabsheet?this.listenEvent(this.tabsheet,"epi:show:tabsheet",(t=>this.loadTabsheet(t))):App.loadDataSnippets(url,this.widgetElement)}loadTabsheet(t){this.loaded||(this.loaded=!0,App.loadDataSnippets(this.url,this.widgetElement),this.unlistenEvent(this.tabsheet,"epi:show:tabsheet"))}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.tabsheets=a,window.App.widgetClasses.loadcontent=c},7:(t,e,i)=>{"use strict";var s=i(584),o=i(182);class n extends s.Xt{constructor(t,e,i){super(t,e,i),this.rowTable=t.dataset.rowTable||"items",this.rowTypes=t.dataset.rowTypes?t.dataset.rowTypes.split(","):[],this.editTypes=(t.dataset.editTypes||t.dataset.rowTypes||"").split(","),this.fieldName=t.dataset.fieldName||"value",this.searchText=t.dataset.searchText||"",this.segments=o.Z.splitString(t.dataset.segments),this.config={markerPopup:!1,groupMode:!1},this.apiUrl=null,this.apiGroupUrl=null,this.requestMode=null,this.maxZoom=19,this.oldZoomLevel=void 0,this.positionInitialized=!1,this.isUpdating=!1,this.moveTimeout=null;let s=t.dataset.mode;this.widgetElement.closest(".widget-document-edit")&&(s="edit"),this.pushHistory="search"===s,this.clusterMarkers="search"===s,this.markerLayer=void 0,this.ajaxMarkers="search"===s,this.editMarkers="edit"===s,this.showNumber=this.editMarkers&&"1"===(t.dataset.showNumber||"1"),this.displayMarkerRadius=!1,this.customStyles={quality:{0:{content:"?"},1:{content:"?"},2:{content:""},3:{content:""},4:{content:""}}},this.facets={},this.userMarker=void 0,this.userPosition={lat:49.98419,lng:8.2791,zoom:12,initialized:!1,geolocation:!1},this.initMap(),this.bindEvents(),this.updateMarkers()}initMap(){this.map=L.map(this.widgetElement,{gestureHandling:!0}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:this.maxZoom,attribution:"© OpenStreetMap"}).addTo(this.map),this.loaderLayer=L.layerGroup().addTo(this.map),this.subGroups={0:L.layerGroup(),1:L.layerGroup(),2:L.layerGroup()},this.clusterMarkers?(this.clusterLayer=L.markerClusterGroup.layerSupport({iconCreateFunction:t=>this.renderCluster(t),spiderfyOnMaxZoom:!1,showCoverageOnHover:!1,zoomToBoundsOnClick:!0,maxClusterRadius:40}),this.map.addLayer(this.clusterLayer),this.markerLayer=this.clusterLayer,this.clusterLayer.checkIn(this.subGroups[0]),this.clusterLayer.checkIn(this.subGroups[1]),this.clusterLayer.checkIn(this.subGroups[2])):this.markerLayer=this.map,this.map.addLayer(this.subGroups[0]),this.map.addLayer(this.subGroups[1]),this.map.addLayer(this.subGroups[2]),this.initControls(),this.widgetElement.addEventListener("click",(t=>this.onLegendClicked(t))),this.listenResize(this.widgetElement,(()=>this.map.invalidateSize()))}initControls(){this.legend=L.control({position:"bottomleft"}),this.legend.onAdd=t=>{const e=L.DomUtil.create("div","legend");if(e.innerHTML+='<span class="data-quality data-quality-2" data-quality-content="">geprüft</span>',e.innerHTML+='<span class="data-quality data-quality-1" data-quality-content="?">vermutet</span>',e.innerHTML+='<span class="data-quality data-quality-0" data-quality-content="?">ungeprüft</span>',this.segments.length>1)for(let t=0;t<this.segments.length;t++)e.innerHTML+=`<span class="data-segment data-segment-${t+1}">${this.segments[t]}</span>`;return e},this.legend.addTo(this.map),this.scaleBar=L.control.scale({position:"bottomright",maxWidth:150,imperial:!1}).addTo(this.map),this.geoLocButton=L.easyButton("btn-geolocation",(()=>{this.positionInitialized=!1,this.updateUserPosition()}),"Zoom to user position").addTo(this.map),this.geoLocButton.button.classList.remove("btn-geolocation-active"),this.geoLocButton.button.classList.add("btn-geolocation-inactive"),this.toggleRadiusButton=L.easyButton("btn-toggle-radius",(()=>this.toggleMarkerRadius()),"Toggle marker radius").addTo(this.map),this.toggleRadiusButton.button.classList.toggle("active",this.displayMarkerRadius),this.zoomToMarkerButton=L.easyButton("btn-zoom-to-marker",(()=>{this.fitMarkers()}),"Zoom to marker").addTo(this.map),this.geocodeLayer=L.layerGroup(),this.geocodeBox;const t=L.Control.Geocoder.nominatim({serviceUrl:App.baseUrl+"services/geo/"});this.geocoder=L.Control.geocoder({query:this.searchText,defaultMarkGeocode:!1,geocoder:t}).on("markgeocode",(t=>this.onGeocode(t))).addTo(this.map)}bindEvents(){this.map.on("movestart",(t=>{this.oldZoomLevel=this.map.getZoom()})),this.map.on("moveend",(t=>{this.rerenderMarkers(),this.ajaxMarkers&&this.onMapMoved()})),this.clusterMarkers&&(this.clusterLayer.on("click",(t=>{this.showMarkerContent(t)})),this.clusterLayer.on("clusterclick",(t=>{this.clusterLayer.options.zoomToBoundsOnClick=!0;const e=t.layer.getAllChildMarkers();this.map.getZoom()<this.maxZoom&&!this.markersInSamePlace(e)||(this.clusterLayer.options.zoomToBoundsOnClick=!1,this.config.markerPopup?this.showMarkerPopup(e,t.layer.getLatLng()):this.showMarkerList(e))})));const t=this.widgetElement.closest(".doc-section");t&&(t.addEventListener("epi:add:item",(t=>this.onItemAdded(t))),t.addEventListener("epi:remove:item",(t=>this.onItemRemoved(t))),t.addEventListener("epi:change:item",(t=>this.onItemChanged(t))));const e=this.widgetElement.closest(".widget-entity");e&&e.addEventListener("epi:change:entity",(t=>this.onItemChanged(t))),this.listenEvent(document,"epi:load:facets",(t=>this.onLoadFacets(t))),this.listenEvent(document,"epi:close:facets",(t=>this.onCloseFacets(t)))}resetLoading(){this.removeAllLoaders(),this.apiUrl=null,this.apiGroupUrl=null,this.mapReady=!1,this.tilesLoaded={},this.tilesQueue=[],this.loaders=[],this.markersLoaded={},this.clusterMarkers&&this.clusterLayer.clearLayers()}updateUrl(){if(!this.apiUrl)return;let t=new URL(this.apiUrl,App.baseUrl);t.searchParams.delete("page"),t.searchParams.delete("tile"),t.searchParams.delete("limit"),t.searchParams.set("sort","distance"),t.searchParams.set("direction","asc");const e=this.getCenter(),i=this.getZoom();t.searchParams.set("lat",e.lat),t.searchParams.set("lng",e.lng),t.searchParams.set("zoom",i),t=t.toString(),window.history.pushState&&this.pushHistory&&window.history.pushState(t,"Epigraf - search results",t),this.apiUrl=t}updateMarkers(){this.resetMarkers(),this.loadMarkers()}resetMarkers(){if(this.isUpdating)return!1;App.ajaxQueue.stop("map"),this.resetLoading();const t=this.getDataElement();t.dataset.consumed="false",this.apiGroupUrl=t.dataset.groupUrl,this.apiUrl=t.dataset.url;const e=new URL(this.apiUrl,App.baseUrl);this.requestMode=e.searchParams.get("mode"),this.mapReady=!0}onMapMoved(){clearTimeout(this.moveTimeout),this.moveTimeout=setTimeout((()=>{this.loadMarkers(),this.userPosition.zoom=this.map.getZoom()}),App.settings.timeout)}getDataElement(){return this.widgetElement.nextElementSibling}getTileUrl(t){if(!t||!this.rowTypes.length)return!1;let e;if(this.config.groupMode){if(!this.apiGroupUrl)return!1;e=new URL(this.apiGroupUrl,App.baseUrl),e.searchParams.delete("page"),e.searchParams.delete("snippets"),e.pathname=e.pathname+".geojson"}else{if(!this.apiUrl)return!1;t.page+=1,e=new URL(this.apiUrl,App.baseUrl),e.searchParams.set("page",t.page),e.searchParams.set("snippets","article,properties"),e.pathname=e.pathname+"/items.geojson"}return e.searchParams.set("tile",t.id),e.searchParams.set("itemtypes",this.rowTypes.join(",")),e.searchParams.delete("sort"),e.searchParams.delete("direction"),e.searchParams.delete("lat"),e.searchParams.delete("lng"),e.searchParams.delete("zoom"),e.toString()}initTiles(){this.removeAllLoaders(),this.tilesQueue=[];const t=Math.max(1,this.map.getZoom()-1),e=this.map.getBounds(),i=[o.Z.lon2tile(e.getWest(),t),o.Z.lon2tile(e.getEast(),t)],s=[o.Z.lat2tile(e.getNorth(),t),o.Z.lat2tile(e.getSouth(),t)];for(let e=i[0];e<=i[1];e++)for(let i=s[0];i<=s[1];i++){let s="",o=e,n=i,r=!1;for(let e=t;e>=1&&(s=`${e}/${n}/${o}`,r=this.tilesLoaded[s],!r);e--)n=Math.round(n/2),o=Math.round(o/2);if(!r){const s=`${t}/${i}/${e}`;this.tilesQueue.push({z:t,y:i,x:e,id:s,loader:this.addLoader(t,i,e),page:0}),this.tilesLoaded[s]=!1}}}finishTile(t){this.tilesLoaded[t.id]=!0,t.loader.remove()}loadMarkers(){this.mapReady&&(this.positionInitialized||this.initMapPosition(),this.loadMarkersFromDataElement(),this.positionInitialized||this.fitMarkers(),(this.apiUrl||this.apiGroupUrl)&&this.initUserPosition((()=>this.loadMarkersFromAjax())))}fetchMore(t){if(!t&&0===this.tilesQueue.length)return!1;t||(t=this.tilesQueue.pop());const e=this.getTileUrl(t);if(!e)return!1;App.ajaxQueue.add("map",{type:"GET",url:e,dataType:"json",beforeSend:t=>{App.showLoader()},success:(e,i,s)=>{this.isUpdating=!0;const o=this.extractJsonData(e);this.addMarkers(o),this.isUpdating=!1,e.pagination.page_next?this.fetchMore(t):(this.finishTile(t),this.fetchMore())},error:(e,i,s)=>{if(e.readyState===XMLHttpRequest.UNSENT&&0===e.status)return;if(404===e.status)return this.finishTile(t),void this.fetchMore();let n=o.Z.getValue(e.responseJSON,"error.message");n=n?s+": "+n:s,App.showMessage(n,i)},complete:(t,e)=>{App.hideLoader()}})}extractHtmlData(t){let e=[];if(t&&"true"!==t.dataset.consumed){t.dataset.consumed="true";try{e=JSON.parse(t.textContent)}catch(t){console.log("Could not parse GeoJSON data from HTML element.")}}return e}extractJsonData(t){return t.features||[]}renderMarker(t,e=null){if(t){if(null==e&&(e=t.customData),t.customData.quality!==e.quality){const i=this.subGroups[t.customData.quality]||this.markerLayer,s=this.subGroups[e.quality]||this.markerLayer;i.removeLayer(t),s.addLayer(t)}t.customData.lat===e.lat&&t.customData.lng===e.lng||t.setLatLng([e.lat,e.lng])}else{null==e&&(e={});const i=this.editMarkers&&(void 0===e.edit||e.edit);t=L.marker([e.lat,e.lng],{draggable:i}),this.makeMarkerDraggable(t)}t.customData=e;const i=void 0!==e.radius&&0!==Number(e.radius),s=this.map.getZoom();let o=10;(i&&this.displayMarkerRadius&&s>13||e.totals)&&(o=Math.min(Math.max(this.meterToPixel(e.lat,e.radius,s),20),500));const n=2*o,r=["item-marker",i&&this.displayMarkerRadius?"area-marker":"point-marker"];s>=14&&r.push("zoomed-in"),e.radius>=500&&r.push("area-marker-big"),e.segment&&r.push(`marker-segment-${e.segment}`);let a,l="";if(e.properties&&this.facets){for(const[t,i]of Object.entries(e.properties))for(let t of i){let e=this.facets[t];e&&e.color&&(l=`background-color:${e.color};border-color:${e.color};`)}a="1"}else e.totals?(a=e.totals,r.push(`data-quality-${e.quality}`)):(a=this.showNumber?e.number:this.customStyles.quality[e.quality].content||"",r.push(`data-quality-${e.quality}`));const c=L.divIcon({html:`<div class="item-marker-label" data-quality-content="${a}" style="${l}"></div>`,className:r.join(" "),iconSize:[n,n]});return t.setIcon(c),t}renderCluster(t){let e=t.getChildCount();const i=t.getAllChildMarkers();let s={},o={};i.forEach((t=>{if(t.customData.properties)for(const[e,i]of Object.entries(t.customData.properties))for(let t of i){let e=this.facets[t];e&&e.color&&(o[t]=o[t]||e.color,s[t]=s[t]||0,s[t]+=1)}t.customData.totals&&(e+=t.customData.totals-1)}));const n=d3.scaleLinear([10,500],[30,80]).clamp(!0)(e),a=" data-quality-"+i.reduce(((t,e)=>Math.min(t,e.customData.quality)),2);let l,c;return Object.keys(s).length>0?(l=r.getSvg(s,o,e,n),c="marker-cluster"):(l=`<div class="item-marker-label"><span style="line-height:${.85*n}px;">${e}</span></div>`,c="marker-cluster"+a),new L.DivIcon({html:l,className:c,iconSize:new L.Point(n,n)})}rerenderMarkers(t){let e=!1;t?(this.map.setZoom(t),e=!0):e=(t=this.map.getZoom())>=14||14===this.oldZoomLevel&&13===t;const i=this.map.getBounds();if(e)for(const t in this.markersLoaded){const e=i.contains(this.markersLoaded[t].getLatLng()),s=this.markersLoaded[t].customData.radius;e&&(0!==s&&""!==s)&&this.renderMarker(this.markersLoaded[t])}}makeMarkerDraggable(t){t.on("mousedown",(t=>{t.originalEvent.preventDefault()})),t.on("dragend",(()=>{const e=t.customData.id,i=t.getLatLng();t.customData.lat=i.lat,t.customData.lng=i.lng,this.updateRow(e,i),this.map.panTo([i.lat,i.lng])}))}addMarkers(t){t.forEach((t=>{if("Point"===t.geometry.type||this.editMarkers){const e=t.data,i=o.Z.getValue(t,"geometry.coordinates",[0,0]);if(e.lat=i[1],e.lng=i[0],e.type="single",!this.markersLoaded[e.id]){const t=this.renderMarker(null,e);this.markersLoaded[e.id]=t,(this.subGroups[e.quality]||this.markerLayer).addLayer(t)}}else if("Polygon"===t.geometry.type){const e=t.data;e.id="group-"+(e.id||e.tile);let i=o.Z.getValue(t,"geometry.coordinates");if(i&&!this.markersLoaded[e.id]){i=i[0],i=i.map((([t,e])=>[e,t])),e.coords=i;let t=L.polygon(i).getBounds().getCenter(),s=t.distanceTo(i[0]);e.lat=t.lat,e.lng=t.lng,e.radius=s,e.quality=e.quality||0,e.number=e.totals||0,e.type="group";const o=this.renderMarker(null,e);this.markersLoaded[e.id]=o,(this.subGroups[e.quality]||this.markerLayer).addLayer(o)}}}))}getPosition(t){return new Promise(((e,i)=>navigator.geolocation.getCurrentPosition((t=>e(t)),(t=>i(t)),t)))}async updateUserPosition(t){if(navigator.geolocation)try{const t=await this.getPosition({enableHighAccuracy:!0});this.userPosition.lat=t.coords.latitude,this.userPosition.lng=t.coords.longitude,this.userPosition.geolocation=!0}catch(t){console.log(t),App.showMessage("Please enable the location feature of your browser if you want to see your location.","notice")}else App.showMessage("Your browser doesn't support the geolocation feature.","notice");this.showUserPosition(),void 0!==t&&t()}showUserPosition(){if(this.positionInitialized||this.map.setView([this.userPosition.lat,this.userPosition.lng],this.userPosition.zoom),this.userPosition.initialized=!0,this.positionInitialized=!0,this.userMarker&&(this.map.removeLayer(this.userMarker),this.userMarker=void 0),this.userPosition.geolocation){this.geoLocButton.button.classList.remove("btn-geolocation-inactive"),this.geoLocButton.button.classList.add("btn-geolocation-active");const t=L.divIcon({html:"",className:"user-position-marker",iconSize:15});this.userMarker=L.marker([this.userPosition.lat,this.userPosition.lng],{icon:t}).addTo(this.map)}else this.geoLocButton.button.classList.remove("btn-geolocation-active"),this.geoLocButton.button.classList.add("btn-geolocation-inactive")}toggleMarkerRadius(t){this.displayMarkerRadius=t||!this.displayMarkerRadius,this.toggleRadiusButton.button.classList.toggle("active",this.displayMarkerRadius),this.rerenderMarkers()}initUserPosition(t){this.userPosition.initialized?void 0!==t&&t():this.updateUserPosition(t)}initMapPosition(){const t=this.getDataElement(),e=t.dataset.locationLat||null,i=t.dataset.locationLng||null,s=t.dataset.locationZoom||this.userPosition.zoom;e&&i&&(this.userPosition.lat=e,this.userPosition.lng=i,this.userPosition.zoom=s,this.map.setView([this.userPosition.lat,this.userPosition.lng],this.userPosition.zoom),this.userPosition.initialized=!0,this.positionInitialized=!0)}getCenter(){return this.userPosition.initialized?this.map.getCenter():{lat:this.userPosition.lat,lng:this.userPosition.lng}}getZoom(){return this.userPosition.initialized?this.map.getZoom():this.userPosition.zoom}loadMarkersFromDataElement(){this.isUpdating=!0;const t=this.extractHtmlData(this.getDataElement());return this.addMarkers(t),this.isUpdating=!1,t.length}loadMarkersFromAjax(){App.ajaxQueue.stop("map"),this.updateUrl(),this.initTiles(),this.fetchMore(),this.fetchMore(),this.fetchMore(),this.fetchMore()}fitMarkers(){const t=L.featureGroup(Object.values(this.markersLoaded)).getBounds();t.isValid()&&(this.map.fitBounds(t.pad(.1)),this.map.getZoom()>14&&this.rerenderMarkers(14),this.positionInitialized=!0)}addLoader(t,e,i){const s=[[o.Z.tile2lat(e,t),o.Z.tile2long(i,t)],[o.Z.tile2lat(e+1,t),o.Z.tile2long(i+1,t)]],n=L.rectangle(s,{color:"#01545b",stroke:!1,fillOpacity:.1});return n.addTo(this.loaderLayer),this.loaders.push(n),n}removeAllLoaders(){this.loaders&&this.loaders.forEach((t=>t.remove()))}showMap(){const t=this.widgetElement.closest(".widget-map-container");t&&(t.style.display="block"),this.map.invalidateSize()}hideMap(){const t=this.widgetElement.closest(".widget-map-container");t&&(t.style.display="none")}showMarkerContent(t){let e=this.widgetElement.dataset.viewUrl;e&&(e=decodeURI(e).formatUnicorn(t.sourceTarget.customData),App.openDetails(e,{external:!1}))}showMarkerList(t){let e=this.widgetElement.dataset.indexUrl;if(!e)return;const i=t.map((t=>t.customData.rootId)).join(",");e=decodeURI(e).formatUnicorn({rootId:i}),App.openDetails(e,{external:!1})}showMarkerPopup(t,e){let i='<ol class="popup-article-list">';for(let e of t)i+=`<li class="data-quality-${e.customData.quality||0}" data-quality-content="${this.customStyles.quality[e.customData.quality||0].content}">\n                                <a href="${e.customData.url}" class="frame" target="_blank">\n                                ${e.customData.caption||"No title"}\n                                </a>\n                             </li>`;i+="</ol>",L.popup({maxHeight:250,minWidth:200}).setLatLng(e).setContent(i).openOn(this.map)}onLegendClicked(t){if(!t.target.matches(".legend span"))return;let e;try{let i=Array.from(t.target.classList).filter((t=>t.startsWith("data-quality-")));i=i.length>0?i[0].replace("data-quality-",""):void 0,i=Number(i),e=this.subGroups[i]||void 0}catch(t){console.log(t)}if(!e)return;!t.target.classList.contains("disabled")?(this.map.removeLayer(e),t.target.classList.add("disabled")):(this.map.addLayer(e),t.target.classList.remove("disabled"))}onItemAdded(t){this.editTypes.includes(t.target.dataset.rowType)&&(this.showMap(),this.initUserPosition((()=>{const e=t.target.dataset.rowId,i=this.getCenter();let s=o.Z.getInputValue(t.target.querySelector("[data-row-field='published'] select"),0);s=""===s?0:s;const n=[{type:"Feature",data:{number:o.Z.getInputValue(t.target.querySelector("[data-row-field='sortno'] input"),0),id:e,rootId:null,quality:s,radius:o.Z.getInputValue(t.target.querySelector(`[data-row-field='${this.fieldName}.radius'] input`),0)},geometry:{type:"Point",coordinates:[i.lng,i.lat]}}];this.addMarkers(n),this.updateRow(e,i)})))}onItemRemoved(t){if(!this.rowTypes.includes(t.target.dataset.rowType))return;const e=t.target.dataset.rowId,i=this.markersLoaded[e];i&&(this.map.removeLayer(i),delete this.markersLoaded[e],0===Object.keys(this.markersLoaded).length&&this.hideMap())}onItemChanged(t){if(!this.editTypes.includes(t.target.dataset.rowType))return;this.showMap();const e=t.target.dataset.rowId,i=this.markersLoaded[e];if(!i)return;const s=Object.assign({},i.customData);let n=o.Z.getInputValue(t.target.querySelector("[data-row-field='published'] select"),s.quality);n=""===n?0:n,s.lat=o.Z.getInputValue(t.target.querySelector(`[data-row-field='${this.fieldName}.lat'] input`),s.lat),s.lng=o.Z.getInputValue(t.target.querySelector(`[data-row-field='${this.fieldName}.lng'] input`),s.lng),s.radius=o.Z.getInputValue(t.target.querySelector(`[data-row-field='${this.fieldName}.radius'] input`),s.radius),s.number=o.Z.getInputValue(t.target.querySelector("[data-row-field='sortno'] input"),s.number),s.quality=n,this.renderMarker(i,s)}updateRow(t,e,i){const s=document.querySelector(`[data-row-table='${this.rowTable}'][data-row-id='${t}']`);if(s){const t=s.querySelector(`[data-row-field='${this.fieldName}.lat'] input`),n=s.querySelector(`[data-row-field='${this.fieldName}.lng'] input`);if(o.Z.setInputValue(t,e.lat),o.Z.setInputValue(n,e.lng),void 0!==i){const t=s.querySelector(`[data-row-field='${this.fieldName}.radius'] input`);o.Z.setInputValue(t,i)}}}markersInSamePlace(t,e=1e-4){const i=t[0]._latlng;for(let s of t)if(Math.abs(s._latlng.lat-i.lat)+Math.abs(s._latlng.lng-i.lng)>e)return!1;return!0}meterToPixel(t,e,i){const s=t*(Math.PI/180);return e/(40075017*Math.cos(s)/Math.pow(2,i+8))}onGeocode(t){const e=t.geocode.bbox,i=[[e.getSouthEast().lat,e.getSouthEast().lng],[e.getNorthEast().lat,e.getNorthEast().lng],[e.getNorthWest().lat,e.getNorthWest().lng],[e.getSouthWest().lat,e.getSouthWest().lng]];if(this.geocodeBox)this.geocodeBox.box.setLatLngs(i);else{const t=L.polygon(i,{weight:1}).addTo(this.geocodeLayer);this.geocodeBox={box:t},this.editMarkers&&(t.on("click",(()=>this.onGeocodeApply())),t.on("mouseover",(()=>{t.setStyle({weight:3})})),t.on("mouseout",(()=>{t.setStyle({weight:1})})))}this.map.addLayer(this.geocodeLayer),this.map.fitBounds(this.geocodeBox.box.getBounds())}onGeocodeApply(){if(!this.geocodeBox)return;let t=Object.keys(this.markersLoaded).pop();if(!t){const e=[{type:"Feature",data:{number:0,id:-1,rootId:null,quality:0,radius:0},geometry:{type:"Point",coordinates:[0,0]}}];this.addMarkers(e),t=-1}const e=this.markersLoaded[t];if(!e)return;const i=Object.assign({},e.customData),s=this.geocodeBox.box.getBounds(),o=s.getCenter(),n=s.getSouthEast(),r=Math.round(o.distanceTo(n));i.lat=o.lat,i.lng=o.lng,i.radius=r,this.map.removeLayer(this.geocodeLayer),this.renderMarker(e,i),this.toggleMarkerRadius(!0),this.updateRow(t,o,r)}onLoadFacets(t){if(!t.detail.sender)return;const e=t.detail.sender;if(!e.hasFlag("grp"))return;const i=e.getFacets();this.updateColors(i)}onCloseFacets(t){t.detail.sender&&this.updateColors()}updateColors(t){this.facets=t,this.facets?this.legend.remove():this.legend.addTo(this.map);const e=this.map.getBounds();for(const t in this.markersLoaded){e.contains(this.markersLoaded[t].getLatLng())&&this.renderMarker(this.markersLoaded[t])}this.clusterMarkers&&this.map.eachLayer((t=>{t instanceof L.MarkerCluster&&t.setIcon(this.renderCluster(t))}))}}class r{static getSvg(t,e,i,s){const o=.15*s/2;s*=.85,t=Array.isArray(t)?t:Object.values(t),e=Array.isArray(e)?e:Object.values(e);let n=d3.pie()(t),r=d3.arc().innerRadius(0).outerRadius(s/2),a=d3.create("svg").attr("width",s).attr("height",s).attr("style",`margin-top: ${o}px;margin-left: ${o}px;`).attr("viewBox",[-s/2,-s/2,s,s]);return a.selectAll("path").data(n).enter().append("path").attr("d",r).attr("fill",((t,i)=>e[i])),a.append("text").attr("text-anchor","middle").attr("dy","0.35em").attr("fill","white").attr("font-size","0.8rem").attr("line-height","0.8rem").text(i),a.node().outerHTML}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.map=n},113:(t,e,i)=>{"use strict";var s=i(584),o=i(182);class n extends s.Xt{constructor(t,e,i){super(t,e,i),this.horizontal=t.classList.contains("widget-scrollbox-horizontal"),this.dataList=null,this.listName=null,this.isLoading=!1,this.stopped=!1,t.addEventListener("scroll",(t=>this.onBoxScrolled(t))),t.addEventListener("click",(t=>this.onHeaderClicked(t))),t.addEventListener("epi:toggle:node",(t=>this.onNodeToggled(t))),this.tabsheet=this.widgetElement.closest(".widget-tabsheets-sheet"),this.tabsheet&&this.listenEvent(this.tabsheet,"epi:show:tabsheet",(()=>this.seekRow())),this.updateWidget(),document.addEventListener("epi:cancel:row",(t=>this.onUpdateRow(t))),document.addEventListener("epi:update:row",(t=>this.onUpdateRow(t))),document.addEventListener("epi:move:row",(t=>this.onUpdateRow(t))),document.addEventListener("epi:create:row",(t=>this.onUpdateRow(t))),document.addEventListener("epi:delete:row",(t=>this.onUpdateRow(t)))}initList(){this.dataList=this.widgetElement.querySelector("[data-list-name]"),this.listName=this.dataList?this.dataList.dataset.listName:null,this.modelName=o.Z.querySelectorData(this.widgetElement,"[data-model]","model","");const t=this.modelName.split(".",2);this.tableName=1===t.length?t[0]:t[1];const e=this.widgetElement.querySelector(".widget-tree");this.treeWidget=this.getWidget(e,"tree",!1);const i=this.widgetElement.querySelector(".widget-table");this.tableWidget=this.getWidget(i,"table",!1)}initWidget(){this.initList()}updateWidget(){this.initList(),this.seekRow(),this.treeWidget&&this.treeWidget.treeUpdatePositions(),this.onBoxScrolled()}onHeaderClicked(t){if(!t.target.closest("thead a")||!this.widgetElement.contains(t.target))return;t.preventDefault(),App.showLoader();const e=t.target.closest("thead a").getAttribute("href");this.pushHistory=window.history.pushState&&e&&!this.isInFrame(),$.ajax({type:"GET",url:e,dataType:"html",success:t=>{this.pushHistory&&window.history.pushState(e,"Epigraf - search results",e),App.replaceDataSnippets(t,this.getFrame(!1)),this.loadCursors(),App.hideLoader(),this.onBoxScrolled()},error:(t,e,i)=>{if(t.readyState===XMLHttpRequest.UNSENT&&0===t.status)return void(this.stopped=!0);let s=o.Z.getValue(t.responseJSON,"error.message");s=s?i+": "+s:i,App.showMessage(s,e)},complete:(t,e)=>{this.isLoading=!1,App.hideLoader()}})}onNodeToggled(t){this.initList(),this.loadCursors()}onBoxScrolled(t){if(this.horizontal){const t=this.widgetElement.offsetWidth,e=this.widgetElement.scrollWidth,i=this.widgetElement.scrollLeft;t>0&&i<120&&this.prevRows(),i>e-t-120&&this.nextRows()}else{const t=this.widgetElement.offsetHeight,e=this.widgetElement.scrollHeight,i=this.widgetElement.scrollTop;t>0&&i<120&&this.prevRows(),t>0&&i>e-t-120&&this.nextRows()}this.loadCursors()}seekRow(t,e=!1){if(this.initList(),!this.dataList)return;let i;if(t){i=this.dataList.querySelector('[data-id="'+t+'"]');const s=this.dataList.closest("table"),o=s?s.widgets.table:void 0;o&&i&&(o.activateRow(i,e),o.setFocus(!0))}else i=this.dataList.querySelector(".row-selected, .active");i&&o.Z.scrollIntoViewIfNeeded(i,this.widgetElement,"y","y")}getCursor(t){return"prev"===t?o.Z.querySelectorLast(this.dataList,'.node-cursor[data-cursor-dir="'+t+'"]:not(.item-hidden)'):this.dataList.querySelector('.node-cursor[data-cursor-dir="'+t+'"]:not(.item-hidden)')}loadCursors(){if(this.initList(),!this.dataList||0===this.dataList.offsetHeight)return!1;const t=Array.from(this.dataList.querySelectorAll('.node-cursor[data-cursor-dir="prev"]:not(.item-hidden)')).filter((t=>o.Z.isVisible(t,this.widgetElement))).at(-1);t&&this.fetchRows(t);const e=Array.from(this.dataList.querySelectorAll('.node-cursor[data-cursor-dir="next"]:not(.item-hidden)')).filter((t=>o.Z.isVisible(t,this.widgetElement))).at(0);e&&this.fetchRows(e)}prevRows(){}nextRows(){this.fetchRows("next")}updateRow(t,e=!1,i=!1,s=!1){if(!this.dataList||!this.listName)return!1;let n=this.dataList.dataset.listActionGet;if(!n)return!1;const r=this.dataList.querySelector('[data-id="'+t+'"]');r&&r.classList.add("row-stale"),n=new URL(n,App.baseUrl),s?(n.searchParams.set("seek",t),n.searchParams.delete("find")):n.searchParams.set("id",t),n=n.toString(),App.ajaxQueue.add(this.listName,{type:"GET",url:n,dataType:"html",beforeSend:t=>{App.showLoader()},success:(o,n,r)=>{const a=(o=(new DOMParser).parseFromString(o,"text/html")).querySelectorAll("[data-list-itemof="+this.listName+"]");a.length>0&&(s&&this.clearRows(),this.mergeRows(a,void 0,s?"next":"mount"),s&&this.updateWidget(),e&&this.seekRow(t,i))},error:(t,e,i)=>{if(t.readyState===XMLHttpRequest.UNSENT&&0===t.status)return void(this.stopped=!0);let s=o.Z.getValue(t.responseJSON,"error.message");s=s?i+": "+s:i,App.showMessage(s,e)},complete:(t,e)=>{App.hideLoader()}})}clearRows(){if(!this.dataList||!this.listName)return!1;const t=this.dataList.closest("table"),e=t?t.widgets.table:void 0;e&&e.deactivateRows();let i=this.dataList.querySelector("[data-list-itemof]");for(;i;)i.remove(),i=this.dataList.querySelector("[data-list-itemof]");return!0}deleteRow(t,e=!1,i=!1){if(!this.dataList||!this.listName)return!1;const s=this.dataList.querySelector('[data-id="'+t+'"]');if(s){let t;const o=this.dataList.closest("table"),n=o?o.widgets.table:void 0,r=o?o.widgets.tree:void 0;return e&&s&&r?(t=r.treeGetNextSibling(s),t!==s&&t||(t=r.treeGetPrevSibling(s)),t===s&&(t=void 0)):e&&s&&n&&(t=n.getNextVisibleNode(s),t!==s&&t||(t=n.getPreviousVisibleNode(s)),t===s&&(t=void 0)),s&&r?r.treeRemoveItem(s):s&&s.remove(),n&&t?(n.activateRow(t,i),n.setFocus(!0)):n.deactivateRows(),!0}return!1}fetchRows(t){if(this.initList(),!this.dataList||!this.listName||this.isLoading)return!1;let e="next";"next"===t?(e="next",t=this.getCursor(e)):"prev"===t?(e="prev",t=this.getCursor(e)):t&&(e=t.dataset.cursorDir);const i="next"===e?"listActionNext":"listActionPrev";let s;if(s=t?t?t.dataset.cursorAction:null:this.dataList.dataset[i],!s)return!1;this.isLoading=!0,this.stopped=!1,App.ajaxQueue.add(this.listName,{type:"GET",url:s,dataType:"html",beforeSend:t=>{App.showLoader()},success:(s,o,n)=>{const r=(s=(new DOMParser).parseFromString(s,"text/html")).querySelectorAll("[data-list-itemof="+this.listName+"]");this.mergeRows(r,t,e);const a=s.querySelector("[data-list-name="+this.listName+"]"),l=a?a.dataset[i]:void 0;void 0!==l&&(this.dataList.dataset[i]=l)},error:(t,e,i)=>{if(this.stopped=!0,t.readyState===XMLHttpRequest.UNSENT&&0===t.status)return void(this.stopped=!0);let s=o.Z.getValue(t.responseJSON,"error.message");s=s?i+": "+s:i,App.showMessage(s,e)},complete:(t,e)=>{this.isLoading=!1,App.hideLoader(),this.stopped||this.onBoxScrolled()}})}mergeRows(t,e,i){this.initList(),i=e?e.dataset.cursorDir:i;const s=e&&"1"===e.dataset.cursorCollapsed,n="prev"===i?this.getScrollPosition():void 0;"prev"===i&&(t=[...t].reverse());let r=e,a="above",l=[""];const c=o.Z.getNextSibling(e,".node:not([data-cursor-id])");let d=!1;t.forEach((t=>{if(t&&t.dataset.cursorId&&c&&Number(t.dataset.level)<=Number(c.dataset.level)&&(d=!0),d)return;if(t.dataset.cursorDir&&t.dataset.cursorDir!==i)return;if("next"===i){for(;l.length&&l[l.length-1]!==t.dataset.treeParent;)l.pop();l.push(t.dataset.id)}let o=null,n=null;if(void 0!==t.dataset.cursorId?(o=this.dataList.querySelector('[data-cursor-id="'+t.dataset.cursorId+'"][data-cursor-child="'+t.dataset.cursorChild+'"]'),n=this.dataList.querySelector('[data-parent="'+t.dataset.parent+'"][data-cursor-id]:not([data-cursor-child="1"])')):void 0!==t.dataset.id&&(o=this.dataList.querySelector('[data-id="'+t.dataset.id+'"]:not([data-cursor-id])'),n=this.dataList.querySelector('[data-cursor-id="'+t.dataset.id+'"]:not([data-cursor-child="1"])')),n&&!s&&n.remove(),o)return o.classList.remove("row-stale"),o.replaceChildren(...t.children),"next"===i?r="above"!==a?o:r:"prev"===i&&(r=o),void(e&&l.includes(e.dataset.treeParent)?a="inside":e&&(a="inside"===a?"below":a));if(e&&e.dataset.treeParent===t.dataset.treeParent&&t.classList.contains("item-hidden")&&(t.classList.remove("item-hidden"),t.classList.toggle("item-collapsed",!t.classList.contains("item-nochildren"))),"mount"===i){if(!t.dataset.cursorId){const e=t.dataset.parent,i=t.dataset.preceding;let s;i?(s=this.dataList.querySelector('[data-id="'+i+'"]'),s&&this.treeWidget?this.treeWidget.treeAppendAfter(s,t):s&&this.dataList.insertBefore(t,s.nextElementSibling)):e?(s=this.dataList.querySelector('[data-id="'+e+'"]'),s&&this.treeWidget?this.treeWidget.treePrependChild(s,t):s&&this.dataList.insertBefore(t,s.nextElementSibling)):e||i||(this.treeWidget?this.treeWidget.treeAppendChild(this.dataList,t):this.dataList.prepend(t))}}else r="prev"===i?r?this.dataList.insertBefore(t,r):this.dataList.prepend(t):r?this.dataList.insertBefore(t,r.nextElementSibling):this.dataList.append(t)})),e&&e.remove(),this.treeWidget&&this.treeWidget.treeUpdatePositions(),this.tableWidget&&this.tableWidget.setRowNumbers(),this.restoreScrollPosition(n),this.loadCursors()}onUpdateRow(t){if(!this.dataList||!this.listName||!this.tableName)return;if(!t.detail.data||!t.detail.data.row||"string"!=typeof t.detail.data.row)return;const e=t.detail.data.row.split("-"),i=e[0]||"",s=e.slice(1).join("-"),o="epi:create:row"===t.type,n="epi:delete:row"===t.type,r="epi:move:row"===t.type,a="epi:cancel:row"===t.type;i&&s&&i===this.tableName&&(n?this.deleteRow(s,!0,!0):r?this.updateRow(s,!0,!0,!0):a?this.seekRow(s,!1):this.updateRow(s,!0,o))}getScrollPosition(){if(this.widgetElement)return{clientHeight:this.widgetElement.clientHeight,clientWidth:this.widgetElement.clientWidth,scrollHeight:this.widgetElement.scrollHeight,scrollTop:this.widgetElement.scrollTop,scrollWidth:this.widgetElement.scrollWidth,scrollLeft:this.widgetElement.scrollLeft}}restoreScrollPosition(t){if(!t)return;const e=this.widgetElement.scrollHeight-t.scrollHeight;this.widgetElement.scrollTop=t.scrollTop+e;const i=this.widgetElement.scrollWidth-t.scrollWidth;this.widgetElement.scrollLeft=t.scrollLeft+i}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.scrollbox=n},467:(t,e,i)=>{"use strict";var s=i(584),o=i(182);class n extends s.Xt{constructor(t,e,i){super(t,e,i),this.plot=null,this.itemtype=t.dataset.itemtype,this.isUpdating=!1,this.apiUrl=t.dataset.apiUrl,this.apiUrl&&(this.apiUrl=new URL(this.apiUrl,App.baseUrl)),this.listenEvent(document,"epi:load:facets",(t=>this.onLoadFacets(t))),this.listenEvent(document,"epi:close:facets",(t=>this.onCloseFacets(t)))}initWidget(){this.loadData()}updateWidget(){}loadData(){this.apiUrl?this.loadApiData():this.loadScriptData()}loadScriptData(){this.isUpdating=!0;const t=this.getDataElement(),e=this.extractData(t),i=this.getPlotType();this.showData(e,i),this.isUpdating=!1}loadApiData(){App.ajaxQueue.add("plot",{type:"GET",url:this.apiUrl,dataType:"json",beforeSend:t=>{App.showLoader()},success:(t,e,i)=>{this.isUpdating=!0;const s=this.getPlotType();this.showData(t.groups||[],s),this.isUpdating=!1},error:(t,e,i)=>{if(t.readyState===XMLHttpRequest.UNSENT&&0===t.status)return;let s=o.Z.getValue(t.responseJSON,"error.message");s=s?i+": "+s:i,App.showMessage(s,e)},complete:(t,e)=>{App.hideLoader()}})}getDataElement(){return this.widgetElement.querySelector("script[data-snippet=widget-data]")}extractData(t){let e=[];if(t&&"true"!==t.dataset.consumed){t.dataset.consumed="true";try{e=JSON.parse(t.textContent)}catch(t){console.log("Could not parse JSON data from HTML element.")}}return e}getPlotType(){if(this.widgetElement.dataset.scope)return this.widgetElement.dataset.scope;return this.getDataElement().dataset.scope||"auto"}getCanvasElement(){let t=this.widgetElement.querySelector("div.plot");return t||(t=document.createElement("div"),t.classList.add("plot"),t.style.width="100%",t.style.height="100%",this.widgetElement.appendChild(t)),t}showData(t,e){const i=this.getCanvasElement(),s={onNodeClick:t=>this.showDetails(t),onGroupClick:t=>this.showList(t),imageBaseUrl:this.widgetElement.dataset.imageBaseUrl};"tiles"===e?this.plot=new l(i,t,s):"timeline"===e?this.plot=new a(i,t,s):"graph"===e&&(this.plot=new c(i,t,s))}showDetails(t){let e=this.widgetElement.dataset.viewUrl;e&&(e=decodeURI(e).formatUnicorn(t),this.emitEvent("epi:open:details",{url:e}))}showList(t){let e=this.widgetElement.dataset.indexUrl;e&&(e=decodeURI(e).formatUnicorn(t),this.emitEvent("epi:open:details",{url:e}))}onLoadFacets(t){if(!t.detail.sender)return;const e=t.detail.sender;if(!e.hasFlag("grp"))return;const i=e.getFacets();this.plot&&this.plot.updateColors(i)}onCloseFacets(t){t.detail.sender&&this.plot&&this.plot.updateColors()}}class r{static defaults={onNodeClick:void 0,onGroupClick:void 0};plot=null;constructor(t,e,i={}){this.canvas=t,this.config={...this.constructor.defaults,...i,width:t.clientWidth||this.constructor.defaults.width,height:t.clientHeight||this.constructor.defaults.height},this.values=e}initialize(){}updateColors(t){}}class a extends r{static defaults={nozero:!1,plotType:"bar"};constructor(t,e,i={}){super(t,e,i),this.initialize()}initialize(){let t=this.values.filter((t=>void 0!==t.x&&void 0!==t.totals));this.config.nozero&&(t=t.filter((t=>0!==t.x)));const e={x:t.map((t=>t.x)),y:t.map((t=>t.totals)),type:this.config.plotType,mode:"lines+markers",marker:{color:"blue"},line:{shape:"linear"}};this.plot=Plotly.newPlot(this.canvas,[e],{title:"Timeline",xaxis:{title:"Year",type:"linear"},yaxis:{title:"Count"}})}updateColors(t){this.facets=t,console.log(t)}}class l extends r{static defaults={plotType:"bar"};constructor(t,e,i={}){super(t,e,i),this.initialize()}initialize(){const t=this.values.filter((t=>void 0!==t.x&&void 0!==t.y&&void 0!==t.totals)),e=t.map((t=>t.x)),i=t.map((t=>t.y)),s=t.map((t=>t.totals)),o=[...new Set(e)],n=[...new Set(i)],r=n.map((()=>o.map((()=>null))));for(let t=0;t<e.length;t++){const a=o.indexOf(e[t]);r[n.indexOf(i[t])][a]=s[t]}const a={x:o,y:n,z:r,type:"heatmap",colorscale:"Viridis",hoverongaps:!1};this.plot=Plotly.newPlot(this.canvas,[a],{title:"Map",xaxis:{title:"X Axis"},yaxis:{title:"Y Axis"}})}}class c extends r{static defaults={width:800,height:600,scale:5,padding:40,sourceColor:"#6cc24a",targetColor:"#4ab7c2",sourceRadius:25,targetRadius:10,sourceImg:!0,targetImg:!0,fixTargets:!1,arcs:!1,sourceLabelMaxLength:0,targetLabelMaxLength:20,mode:"bimodal",fixedLength:150,linkStrength:.9,centerPullStrength:.02,targetChargeStrength:-500,sourceChargeStrength:-20,forceCollide:100,alphaMin:.03,alphaDecay:.09,fitInterval:100};constructor(t,e,i={}){super(t,e,i),"bimodal"!==this.config.mode&&(this.config.sourceColor=this.config.targetColor,this.config.sourceRadius=this.config.targetRadius,this.config.sourceLabelMaxLength=this.config.targetLabelMaxLength,this.config.sourceChargeStrength=this.config.targetChargeStrength,this.values=this.twoModesToOneMode(e,!0)),this.zoomInterval=null,this.initialized=!1,this.nodesMap=new Map,this.initialize()}initialize(){this.initCanvas(),this.initData(),this.initialLayout(),this.createSimulation(),this.draw(),this.zoomToFit()}initCanvas(){this.canvas.innerHTML="",this.svg=d3.select(this.canvas).append("svg").attr("width",this.config.width).attr("height",this.config.height),this.container=this.svg.append("g").attr("class","network-group"),this.zoom=d3.zoom().scaleExtent([.1,5]),this.svg.call(this.zoom.on("zoom",(t=>{this.container.attr("transform",t.transform)})))}initData(){const t=this.config;this.values.forEach((({x:e,x_label:i,x_type:s,x_id:o,x_image:n,y:r,y_label:a,y_type:l,y_id:c,y_image:d})=>{this.nodesMap.has(e)||this.nodesMap.set(e,{id:e,label:i,shortLabel:this.shortenLabel(i,t.sourceLabelMaxLength),type:s,role:"source",dbid:o,image:!!this.config.sourceImg&&n,radius:t.sourceRadius,color:t.sourceColor}),this.nodesMap.has(r)||this.nodesMap.set(r,{id:r,label:a,shortLabel:this.shortenLabel(a,t.targetLabelMaxLength),type:l,role:"target",dbid:c,image:!!this.config.targetImg&&d,radius:t.targetRadius,color:t.targetColor})})),this.nodes=Array.from(this.nodesMap.values()),this.links=this.values.map((({x:t,y:e,z:i})=>({source:this.nodesMap.get(t),target:this.nodesMap.get(e),weight:i}))),this.nodesSorted=this.nodes.slice().sort(((t,e)=>this.getNodeOrder(t.id)-this.getNodeOrder(e.id)))}initialLayout(){const t=this.config.width,e=this.config.height,i=this.config.padding,s=this.nodes.filter((t=>"source"===t.role)),o=this.nodes.filter((t=>"target"===t.role)),n=o.length,r=t/2,a=e/2,l=this.config.targetRadius;let c=n*l*1.25/Math.PI;Math.min(r,a);o.forEach(((t,e)=>{const i=2*Math.PI*(e/n);t.x=r+Math.cos(i)*c,t.y=a+Math.sin(i)*c}));const d=Math.min(12,this.config.sourceRadius);s.forEach(((t,e)=>{const i=2*Math.PI*(e/(s.length||1));t.x=r+Math.cos(i)*d,t.y=a+Math.sin(i)*d})),this.config.fixTargets&&o.forEach((t=>{t.fx=t.x,t.fy=t.y}))}initialSpiralLayout(){const t=this.config.width*this.config.scale,e=this.config.height*this.config.scale,i=this.config.padding,s={};this.links.forEach((t=>{s[t.source.id?t.source.id:t.source]=(s[t.source.id?t.source.id:t.source]||0)+1,s[t.target.id?t.target.id:t.target]=(s[t.target.id?t.target.id:t.target]||0)+1})),this.nodes.forEach((t=>t.degree=s[t.id]||0));const o=this.nodes.slice().sort(((t,e)=>e.degree-t.degree)),n=Math.min(5,Math.ceil(Math.sqrt(this.nodes.length))),r=o.slice(0,n),a=o.slice(n),l=t/2,c=e/2;r.forEach(((t,e)=>{const i=2*Math.PI*e/n;t.x=l+50*Math.cos(i)+2*Math.random()-1,t.y=c+50*Math.sin(i)+2*Math.random()-1}));const d=Math.min(l,c)-i-30,u=a.length>24;a.forEach(((t,e)=>{if(u){const i=2,s=e/a.length,o=2*Math.PI*i*s,n=d*(.5+.5*s);t.x=l+Math.cos(o)*n,t.y=c+Math.sin(o)*n}else{const i=2*Math.PI*e/a.length;t.x=l+Math.cos(i)*d,t.y=c+Math.sin(i)*d}}))}initialRandomLayout(){const t=this.config.width,e=this.config.height,i=this.config.padding;this.nodes.forEach((s=>{s.x=Math.random()*(t-2*i)+i,s.y=Math.random()*(e-2*i)+i}))}createSimulation(){const t=this.config;this.simulation=d3.forceSimulation(this.nodes).force("link",d3.forceLink(this.links).id((t=>t.id)).distance(t.fixedLength).strength(1)).force("charge",d3.forceManyBody().strength((e=>"properties"===e.type?t.targetChargeStrength:t.sourceChargeStrength))).force("collide",d3.forceCollide().radius((t=>t.radius))).force("x",d3.forceX(t.width/2).strength(t.centerPullStrength)).force("y",d3.forceY(t.height/2).strength(t.centerPullStrength)).alphaMin(t.alphaMin).alphaDecay(t.alphaDecay),this.simulation.on("tick",(()=>this.onTick())),this.zoomInterval&&clearInterval(this.zoomInterval),this.zoomInterval=setInterval((()=>this.zoomToFit()),t.fitInterval),this.simulation.on("end",(()=>{this.zoomInterval&&(clearInterval(this.zoomInterval),this.zoomInterval=null,this.initialized=!0),this.initialized||this.zoomToFit(),this.initialized=!0}))}getNodeOrder(t){const e=this.nodesMap.get(t);return e&&"source"==e.role?0:e&&"source"==e.role?1:2}shortenLabel(t,e){return 0===e||null==t?"":t.length>e?t.slice(0,e)+"…":t}linkArcPath(t){const e=t.source.x,i=t.source.y,s=t.target.x,o=t.target.y,n=s-e,r=o-i,a=Math.sqrt(n*n+r*r);return`M${e},${i}A${a},${a} 0 0,1 ${s},${o}`}draw(){this.config.arcs?this.link=this.container.append("g").selectAll("path").data(this.links).join("path").attr("stroke-width",(t=>2*t.weight)).attr("fill","none").attr("stroke","#aaa").attr("d",(t=>this.linkArcPath(t))):this.link=this.container.append("g").attr("stroke","#aaa").selectAll("line").data(this.links).join("line").attr("stroke-width",(t=>2*t.weight)).attr("x1",(t=>t.source.x)).attr("y1",(t=>t.source.y)).attr("x2",(t=>t.target.x)).attr("y2",(t=>t.target.y)),this.node=this.container.append("g").selectAll("g").data(this.nodesSorted).join("g").attr("transform",(t=>`translate(${t.x}, ${t.y})`)).style("cursor","pointer").on("click",((t,e)=>this.showNode(e))).call(this.drag(this.simulation));const t=this.node.filter((t=>t.image));t.append("rect").attr("x",(t=>-t.radius-2)).attr("y",(t=>-t.radius-2)).attr("width",(t=>2*t.radius+4)).attr("height",(t=>2*t.radius+4)).attr("rx",6).attr("ry",6).attr("fill","#E9FFDBFF").attr("stroke","#fff").attr("stroke-width",2),t.append("image").attr("href",(t=>this.config.imageBaseUrl+t.image)).attr("width",(t=>2*t.radius)).attr("height",(t=>2*t.radius)).attr("x",(t=>-t.radius)).attr("y",(t=>-t.radius)).append("title").text((t=>t.label)),this.node.filter((t=>!t.image)).append("circle").attr("stroke","#fff").attr("stroke-width",1.5).attr("r",(t=>t.radius)).attr("cx",0).attr("cy",0).attr("fill",(t=>t.color)).append("title").text((t=>t.label)),this.label=this.container.append("g").selectAll("text").data(this.nodesSorted).join("text").text((t=>t.shortLabel)).attr("font-size",12).attr("x",(t=>t.x)).attr("y",(t=>t.y)).attr("text-anchor","middle").attr("dy",(t=>t.radius+16)).style("display",(t=>""==t.shortLabel?"none":"block"))}onTick(){const t=this.config;this.links.forEach((e=>{const i=e.target.x-e.source.x,s=e.target.y-e.source.y,o=Math.sqrt(i*i+s*s);if(0===o)return;let n=0,r=0;if(t.fixedLength){const e=(o-t.fixedLength)/2;n=e*(i/o),r=e*(s/o)}e.source.fx||(e.source.x+=n),e.source.fy||(e.source.y+=r),e.target.fx||(e.target.x-=n),e.target.fy||(e.target.y-=r)})),this.link.attr("x1",(t=>t.source.x)).attr("y1",(t=>t.source.y)).attr("x2",(t=>t.target.x)).attr("y2",(t=>t.target.y)),this.config.arcs&&this.link.attr("d",(t=>this.linkArcPath(t))),this.node.attr("transform",(t=>`translate(${t.x}, ${t.y})`)),this.label.attr("x",(t=>t.x)).attr("y",(t=>t.y))}drag(t){return d3.drag().on("start",(function(t,e){e.__drag_init={x:t.x,y:t.y,fired:!1},e.fx=e.x,e.fy=e.y})).on("drag",(function(e,i){if(!i.__drag_init)return;const s=e.x-i.__drag_init.x,o=e.y-i.__drag_init.y;!i.__drag_init.fired&&s*s+o*o>9&&(t.alphaTarget(.3).restart(),i.__drag_init.fired=!0),i.fx=e.x,i.fy=e.y})).on("end",(function(e,i){e.active||t.alphaTarget(0),i.fx=null,i.fy=null,delete i.__drag_init}))}zoomToFit(t=50){const e=this.nodes;if(0===e.length)return;let i=d3.min(e,(t=>t.x)),s=d3.max(e,(t=>t.x)),o=d3.min(e,(t=>t.y)),n=d3.max(e,(t=>t.y));i===s&&(i-=1,s+=1),o===n&&(o-=1,n+=1),i-=t,s+=t,o-=t,n+=t;const r=this.config.width,a=this.config.height,l=s-i,c=n-o,d=Math.min(r/l,a/c),u=[r/2-d*(i+s)/2,a/2-d*(o+n)/2];this.svg.transition().duration(700).call(this.zoom.transform,d3.zoomIdentity.translate(u[0],u[1]).scale(d))}showNode(t){this.config.onNodeClick&&this.config.onNodeClick(t)}twoModesToOneMode(t,e=!1){const i={},s={};t.forEach((t=>{i[t.x]||(i[t.x]={id:t.x_id,label:t.x_label,type:t.x_type}),i[t.y]||(i[t.y]={id:t.y_id,label:t.y_label,type:t.y_type}),e?(s[t.x]||(s[t.x]=[]),s[t.x].push(t.y)):(s[t.y]||(s[t.y]=[]),s[t.y].push(t.x))}));const o={};for(const t in s){const e=s[t];for(let t=0;t<e.length;t++)for(let s=t+1;s<e.length;s++){const n=e[t]<e[s]?e[t]:e[s],r=e[t]<e[s]?e[s]:e[t],a=`${n}|${r}`;o[a]||(o[a]={x:n,x_id:i[n].id,x_label:i[n].label,x_type:i[n].type,y:r,y_id:i[r].id,y_label:i[r].label,y_type:i[r].type,z:0}),o[a].z+=1}}return Object.values(o)}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.plot=n},972:(t,e,i)=>{"use strict";i.a(t,(async(t,e)=>{try{var s=i(584),o=i(182),n=i(649),r=i(482),a=t([n,r]);[n,r]=a.then?(await a)():a;class l extends s.Xt{constructor(t,e,i){super(t,e,i),this.delay=1e3,this.isPolling=!1,this.progressBar=void 0}initWidget(){const t=this.widgetElement.dataset.serviceTaskId,e=this.widgetElement.dataset.serviceTaskState;t&&"PENDING"===e&&this.refresh()}showProgress(){this.progressBar||(this.progressBar=this.widgetElement.querySelector(".widget-service-bar"),this.progressBar||(this.progressBar=o.Z.spawnFromString('<div class="widget-service-bar"></div>'),this.widgetElement.appendChild(this.progressBar)),$(this.progressBar).progressbar({disabled:!1,value:!1}))}refresh(){this.refreshUrl=this.widgetElement.dataset.serviceRefreshUrl,this.refreshUrl&&(this.isPolling=!0,this.showProgress(),this.refreshTimeout=setTimeout((()=>App.loadDataSnippets(this.refreshUrl,this.widgetElement)),this.delay))}}class c extends l{constructor(t,e,i){super(t,e,i),this.delay=1e3,this.messageBox=void 0,this.progressBar=void 0,this.button=this.widgetElement.querySelector("a.button"),this.listenEvent(this.button,"click",(t=>this.onButtonClick(t)))}onButtonClick(t){this.isPolling?this.stop():this.start(),t.preventDefault()}getItemContent(){const t=this.widgetElement.closest('[data-row-table="items"]');if(!t)return;const e=t.querySelector('[data-row-field="content"]');return e?!!this.emitEvent("epi:save:form",{},!0)&&o.Z.getInputValue(e.querySelector("input")):void 0}start(){if(this.isPolling)return;let t;this.isPolling=!0,this.button.dataset.serviceLabel=this.button.textContent,this.button.textContent=n.a.t("Stop"),this.progressShow(),this.messageShow(n.a.t("Please stand by, weaving the words may take a minute."));try{t=JSON.parse(decodeURIComponent(this.widgetElement.dataset.serviceData))}catch(t){return void this.error(n.a.t("Invalid service data"))}let e="/services/"+t.service;const i=this.getData(t);!1!==i?fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(i)}).then((t=>t.json())).then((i=>this.poll(e,i,t))).catch((e=>this.error(n.a.t("An error occurred"),e,t))):this.error(n.a.t("Invalid service input"))}getData(t,e=!0){let i={};if(i.database=t.database||"",i.task=t.task,i.prompts=t.prompts||"",i.tagname=o.Z.getValue(t,"target.tagname",""),i.itemtype=o.Z.getValue(t,"target.itemtype",""),i.multinomial=t.multinomial||"",e)if("article"===t.input){const t=this.widgetElement.closest('[data-root-table="articles"]').dataset.rootId;i.record="articles-"+t}else"item"===t.input?i.input=this.getItemContent():i=!1;return i}getPollUrl(t,e,i){let s=`${t}/${e}?task=${i.task}`;const o=this.getData(i);return["database","tagname","itemtype","multinomial"].forEach((t=>{o[t]&&(s+=`&${t}=${o[t]}`)})),s}poll(t,e,i){if(!this.isPolling)return;const s=o.Z.getValue(e,"task.state"),r=o.Z.getValue(e,"task.task_id");if("SUCCESS"===s)this.showResult(e,i);else if("PENDING"!==s)this.error(n.a.t("An error occurred"),e,i);else if(r){const e=this.getPollUrl(t,r,i);setTimeout((()=>{fetch(e,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then((t=>t.json())).then((e=>this.poll(t,e,i))).catch((t=>this.error("An error occurred: "+t.message)))}),this.delay)}}showResult(t,e){if(!this.isPolling)return;let i,s;this.success(),"summarize"===e.task||"annotate"===e.task?(i=o.Z.getValue(e,"target.fields",{content:"llm_result",value:"state"}),s="item"):(i=o.Z.getValue(e,"target.fields",{properties_id:"properties_id",properties_label:"properties_label",value:"value"}),s="article");const n=o.Z.getValue(t,"task.result.answers"),r=[];for(const e in n){let s=n[e];s.state=o.Z.getValue(t,"task.state");let a={};for(const t in i)a[t]=o.Z.getValue(s,i[t]);r.push(a)}if(0!==r.length)if(s=o.Z.getValue(e,"target.container",s),"item"===s){const t=this.widgetElement.closest('[data-row-table="items"]');if(t){const e={};e.table=t.dataset.rowTable,e.id=t.dataset.rowId,e.content=r[0],this.emitEvent("epi:update:item",e)}}else if("section"===s){const t=this.widgetElement.closest('[data-row-table="sections"]'),i=o.Z.getValue(e,"target.itemtype"),s=t.dataset.rowType;if(i&&s){const t={itemtype:i,sectiontype:s,items:r};this.emitEvent("epi:import:item",t)}}else if("article"===s){const t=o.Z.getValue(e,"target.itemtype"),i=o.Z.getValue(e,"target.sectiontype");if(t&&i){const e={itemtype:t,sectiontype:i,items:r};this.emitEvent("epi:import:item",e)}}}progressShow(){this.progressBar||(this.progressBar=this.widgetElement.querySelector(".widget-service-bar"),this.progressBar||(this.progressBar=o.Z.spawnFromString('<div class="widget-service-bar"></div>'),this.widgetElement.appendChild(this.progressBar)),$(this.progressBar).progressbar({disabled:!1,value:!1})),o.Z.show(this.progressBar)}progressHide(){o.Z.hide(this.progressBar),this.button.textContent=this.button.dataset.serviceLabel}messageShow(t){this.messageBox||(this.messageBox=this.widgetElement.querySelector(".widget-service-msg"),this.messageBox||(this.messageBox=o.Z.spawnFromString('<div class="widget-service-msg"></div>'),this.widgetElement.appendChild(this.messageBox))),o.Z.show(this.messageBox,t)}messageHide(){o.Z.hide(this.messageBox)}success(){this.isPolling=!1,this.progressHide(),this.messageHide(),this.button.textContent=this.button.dataset.serviceLabel}error(t,e,i){this.isPolling=!1,this.progressHide(),this.messageShow(t);const s=o.Z.getValue(e,"status.message");s&&self.emitEvent("app:show:message",{msg:s,status:"error"})}stop(){this.isPolling=!1,this.progressHide(),this.messageHide()}}class d extends l{constructor(t,e,i){super(t,e,i),this.button=this.widgetElement.querySelector("a.button"),this.listenEvent(this.button,"click",(t=>this.onButtonClick(t)))}onButtonClick(t){let e;try{e=JSON.parse(decodeURIComponent(this.widgetElement.dataset.serviceData))}catch(t){return void this.error(n.a.t("Invalid service data"))}this.openPopup(e),t.preventDefault()}getTerm(t){const e=this.widgetElement.closest(".widget-document");if(!e)return;const i=t.input;if("path"===i){const t=e.querySelector('[data-row-field="parent_id"] input');let i=o.Z.getInputValue(t);const s=e.querySelector('[data-row-field="lemma"] input');return[i,o.Z.getInputValue(s)].filter(Boolean).join(", ")}{const t=e.querySelector('[data-row-field="'+i+'"] input');return o.Z.getInputValue(t)}}getTargetData(){const t=this.widgetElement.closest(".widget-document");if(!t)return;const e=t.querySelector("[data-row-field=norm_data] textarea");return o.Z.getInputValue(e)}setTargetData(t){const e=this.widgetElement.closest(".widget-document");if(!e)return;const i=e.querySelector("[data-row-field=norm_data] textarea");return o.Z.setInputValue(i,t)}openPopup(t){let e="/services/reconcile?q="+encodeURIComponent(this.getTerm(t))+"&provider="+t.provider+"&preview=1";t.type&&(e+="&type="+t.type);const i={title:"Reconcile",height:500,width:600,focus:!0,url:e,selectOnClick:!0,onSelect:t=>{this.applyValue(t.dataset.value)}};new r.Gp(i)}applyValue(t){let e=this.getTargetData();const i=o.Z.getPrefix(t);e=e.split("\n").filter((t=>""!==t&&!t.startsWith(i+":"))),e.push(t),e=e.join("\n"),this.setTargetData(e)}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.service=l,window.App.widgetClasses["service-button"]=c,window.App.widgetClasses["reconcile-button"]=d,e()}catch(t){e(t)}}))},752:(t,e,i)=>{"use strict";var s=i(584),o=i(182);class n extends s.Xt{constructor(t,e,i){super(t,e,i),this.scrollbox=t.parentElement,this.mode="select",this.lastSelected=null,this.lastInCurrentSelection=null,this.selectedRows=[],this.currentSelection=[],this.focusChanged=!1,this.initEvents(),this.initResizableCols()}initWidget(){this.initList(),this.isInFrame()||this.initSelection()}initList(){this.datalist=this.widgetElement.querySelector("[data-list-name]"),this.modelName=this.widgetElement.dataset.model||"";const t=this.modelName.split(".",2);this.tableName=1===t.length?t[0]:t[1]}initEvents(){this.listenEvent(document,"keydown",(t=>this.onKeyDown(t))),this.listenEvent(document,"keyup",(t=>this.onKeyUp(t))),this.listenEvent(this.widgetElement,"click",(t=>this.onClickRow(t))),this.listenEvent(this.widgetElement,"dblclick",(t=>this.onDoubleClickRow(t))),this.listenEvent(this.widgetElement,"mouseover",(t=>this.linkAction(t))),this.listenEvent(this.widgetElement,"mouseout",(t=>this.unlinkAction(t)));const t=document.querySelector("body");this.listenEvent(t,"click",(t=>this.toggleSelectMode(t))),this.listenResize(this.scrollbox,(t=>window.setTimeout((()=>this.expandLastColumn()),100)))}updateWidget(){}initResizableCols(){let t,e,i;const s=this.widgetElement.getElementsByTagName("tr")[0],o=s?s.children:void 0;if(!o)return;this.widgetElement.style.tableLayout="fixed";const n=this;function r(s){n.listenEvent(s,"mousedown",(s=>function(s){e=s.target.parentElement,t=s.pageX;const o=function(t){const e=l(t,"padding-left"),i=l(t,"padding-right");return parseInt(e)+parseInt(i)}(e);i=e.offsetWidth-o,n.widgetElement.classList.add("is-resizing")}(s))),n.listenEvent(document,"mousemove",(s=>function(s){if(e){const o=s.pageX-t+8;n.setColumnWidth(e,i+o),s.preventDefault()}}(s))),n.listenEvent(document,"mouseup",(s=>function(s){e&&(n.saveColumnSizes(),n.widgetElement.classList.remove("is-resizing"));t=void 0,e=void 0,i=void 0}()))}function a(){const t=document.createElement("div");return t.classList.add("resize-bar"),t}function l(t,e){return window.getComputedStyle(t,null).getPropertyValue(e)}for(let t=0;t<o.length;t++){if(o[t].classList.contains("cols-fixed"))continue;const e=a();o[t].appendChild(e),o[t].style.position="relative",r(e)}this.setColumnSizes(),this.setRowNumbers()}setColumnWidth(t,e){const i=this.widgetElement.offsetWidth+(e-t.clientWidth);this.widgetElement.style.width=i+"px",t.style.maxWidth=e+"px",t.style.width=e+"px",t.dataset.targetWidth=e,this.expandLastColumn()}expandLastColumn(){if(!this.isExpanding){this.isExpanding=!0;try{const t=this.widgetElement.parentElement.clientWidth-this.widgetElement.offsetWidth,e=this.widgetElement.offsetWidth,i=this.getLastVisibleColumn();if(!i)return!1;const s=i.clientWidth,o=i.dataset.targetWidth-s;void 0===i.dataset.targetWidth&&(i.dataset.targetWidth=s);let n=s;if(t<0&&o<0?n=s+Math.max(o,t):t>0&&(n=s+t),n!==s){i.style.maxWidth=n+"px",i.style.width=n+"px";const t=e+(n-s);this.widgetElement.style.width=t+"px"}}finally{this.isExpanding=!1}}}getLastVisibleColumn(){const t=this.widgetElement.querySelectorAll("thead tr th:not(.actions)");for(let e=t.length;0!==e;e--)if(0!==t[e-1].offsetWidth)return t[e-1]}setColumnSizes(){const t=this.widgetElement.querySelectorAll("th[data-col]"),e=this.widgetElement.dataset.model;let i=App.user.settings.get("columns",e,{});t.forEach((t=>{const e=t.dataset.col;let s=i.hasOwnProperty(e)?i[e]:t.dataset.width;s=s||App.settings.colwidth,this.setColumnWidth(t,s)}))}getColumnSizes(){const t={};return this.widgetElement.querySelectorAll("th[data-col]").forEach((e=>{const i=e.dataset.col;i&&(t[i]=e.offsetWidth)})),t}saveColumnSizes(){const t=this.getColumnSizes(),e=this.widgetElement.dataset.model;e&&t&&App.user.settings.save("columns",e,t,!0)}setRowNumbers(){this.widgetElement.querySelectorAll("tbody tr:not(.row-supplement) td.first.cols-fixed").forEach(((t,e)=>{t.textContent=e+1}))}getRow(t){let e=t.closest("tr");for(;e&&e.classList.contains("row-supplement");)e=e.previousElementSibling;return e}getFirstAction(t,e){if(!t)return;let i;return e&&(i=t.querySelector('.actions a[data-role="'+e+'"]')),i||(i=t.querySelector(".actions a")),i&&(i=i.getAttribute("href")),i}getOpenAction(t){if(!t)return;let e=t.querySelector('.actions a[data-role="open"]');return e||(e=t.querySelector(".actions a")),e}linkAction(t){if(t.target.closest("thead")||t.target.closest("a")||o.Z.childMatches(t.target,"a")||t.target.closest(".tree-indent"))return!0;let e=t.target.closest("td:not(.actions)"),i=(e?e.querySelector(".tree-content"):void 0)||e;if(!i||"true"===i.dataset.linked)return!1;const s=this.getRow(i),n=this.getFirstAction(s,"tab");if(!n)return!1;const r=document.createElement("a");r.setAttribute("href",n),r.dataset.linkwrapper="true",n&&(this.widgetElement.classList.contains("actions-topopup")?r.classList.add("popup"):this.widgetElement.classList.contains("actions-totab")?r.classList.add("tab"):this.widgetElement.classList.contains("actions-toframe")&&!s.classList.contains("actions-noframe")&&r.classList.add("frame")),o.Z.wrapAll(i,r),i.dataset.linked="true"}unlinkAction(t){t.target.closest("tbody tr td:not(.actions)")}onDoubleClickRow(t){if(t.target.closest("thead")||!t.target.closest("tr")||t.target.closest(".tree-indent"))return;if(t.target.closest(".ui-dialog, .sidebar"))return;const e=this.getRow(t.target),i=this.getOpenAction(e),s=i?i.getAttribute("href"):void 0;s&&(App.ajaxQueue.stop(),window.location=s)}onKeyUp(t){this.hasFocus&&("Shift"===t.key&&(this.lastSelected=this.lastInCurrentSelection,this.selectedRows=this.selectedRows.concat(...this.currentSelection),this.selectedRows=this.selectedRows.filter(((t,e)=>this.selectedRows.indexOf(t)===e)),this.currentSelection=[]),this.focusChanged&&this.openRow(this.getFocusedRow()))}onKeyDown(t){if(!this.hasFocus)return;if(t.ctrlKey||t.metaKey)return;const e=t.key;let i=this.lastInCurrentSelection;if("Tab"===e&&this.activateEntity(i))return void t.preventDefault();const s=this.getWidget(this.widgetElement,"tree");if("select"===this.mode&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Home","End","Enter"].includes(e)){if("ArrowDown"===e&&t.shiftKey)i=this.selectUntil(this.lastSelected,this.getNextVisibleNode(i));else if("ArrowDown"===e)i=i?this.selectSingleRow(this.getNextVisibleNode(i)):this.selectSingleRow(this.getFirstVisibleRow());else if("ArrowUp"===e&&t.shiftKey)i=this.selectUntil(this.lastSelected,this.getPreviousVisibleNode(i));else if("ArrowUp"===e)i=i?this.selectSingleRow(this.getPreviousVisibleNode(i)):this.selectSingleRow(this.getLastVisibleRow());else if("ArrowLeft"===e&&s)i.treeLevel>0&&(!i.treeChildren||i.classList.contains("item-collapsed"))?i=this.selectSingleRow(s.treeGetParent(i)):s.treeToggleItem(i,!0);else if("ArrowRight"===e&&s)s.treeToggleItem(i,!1);else if("Enter"===e){if(i){const t=new Event("dblclick",{bubbles:!0,cancelable:!1});i.dispatchEvent(t)}}else if("PageUp"===e){let e=this.paginateRows(i,"up");i=t.shiftKey?this.selectUntil(this.lastSelected,e):this.selectSingleRow(e)}else if("PageDown"===e){let e=this.paginateRows(i,"down");i=t.shiftKey?this.selectUntil(this.lastSelected,e):this.selectSingleRow(e)}else if("Home"===e){const e=this.getFirstVisibleRow();if(i=t.shiftKey?this.selectUntil(this.lastSelected,e):this.selectSingleRow(e),!i)return!1}else if("End"===e){const e=this.getLastVisibleRow();if(i=t.shiftKey?this.selectUntil(this.lastSelected,e):this.selectSingleRow(e),!i)return!1}t.preventDefault(),i&&(o.Z.scrollIntoViewIfNeeded(i,this.scrollbox,!1,"y"),i.focus(),i.classList.add("row-selected"),i.classList.contains("row-focused")||(this.widgetElement.querySelectorAll(".row-focused").forEach((t=>{t.classList.remove("row-focused")})),i.classList.add("row-focused"),this.focusChanged=!0))}}unselectRows(){this.datalist&&this.datalist.querySelectorAll("tr").forEach((t=>{t.classList.remove("row-selected")}))}handleSelectRow(t){let e=t.target.closest("tr");"select"===this.mode?t.target.closest(".actions")||(e&&e.focus(),(t.ctrlKey||t.metaKey)&&this.selectAdd(e),t.shiftKey&&this.lastSelected&&this.selectUntil(this.lastSelected,e),t.ctrlKey||t.metaKey||t.shiftKey||this.selectSingleRow(e),this.updateSelectLinks()):(this.unselectRows(),e.classList.add("row-selected"))}handleRowAction(t){if(t.target.closest("a"))return!1;const e=this.getRow(t.target);this.openRow(e)}openRow(t){this.focusChanged=!1;const e=this.getFirstAction(t);if(!e)return;return!this.widgetElement.closest(".ui-dialog, .sidebar")&&(e&&(this.widgetElement.classList.contains("actions-topopup")?App.openPopup(e):this.widgetElement.classList.contains("actions-totab")?App.openTab(e):this.widgetElement.classList.contains("actions-toframe")&&!t.classList.contains("actions-noframe")?App.openDetails(e,{external:!0,force:!1,focus:!1}):(App.ajaxQueue.stop(),window.location=e)),!0)}onClickRow(t){t.target.closest("thead")||!t.target.closest("tbody tr")||t.target.closest(".tree-indent")||t.detail>1||(this.handleSelectRow(t),"select"===this.mode&&(t.ctrlKey||t.metaKey)&&(t.stopPropagation(),t.preventDefault()),this.handleRowAction(t))}initSelection(){let t=this.widgetElement.querySelector("tbody tr.row-selected");t&&this.activateRow(t)}getRowCount(){return this.widgetElement.querySelectorAll("[data-list-itemof]:not(.node-cursor, .item-hidden)").length}activateEntity(t){if(t){const e=this.tableName+"-"+t.dataset.id;return this.emitEvent("epi:focus:entity",{row:e,sender:this},!0)}}activateRow(t,e=!0){t&&(this.selectSingleRow(t),this.focusRow(t),e&&(this.widgetElement.classList.contains("actions-toframe")||this.widgetElement.classList.contains("actions-totab"))&&this.openRow(t))}deactivateRows(){this.updateSelectLinks()}focusRow(t){t&&t.focus(),this.updateSelectLinks()}getNextVisibleNode(t){for(;t.nextElementSibling&&(t=t.nextElementSibling).classList.contains("item-hidden"););return t}getPreviousVisibleNode(t){for(;t.previousElementSibling&&(t=t.previousElementSibling).classList.contains("item-hidden"););return t}getFirstVisibleRow(){return this.widgetElement.querySelector("[data-list-itemof]")}getLastVisibleRow(){return[...this.widgetElement.querySelectorAll("[data-list-itemof]:not(.node-cursor, .item-hidden)")].pop()}getRowAt(t){return[...this.widgetElement.querySelectorAll("[data-list-itemof]:not(.node-cursor, .item-hidden)")][t-1]}getRowIndex(t){const e=this.widgetElement.querySelectorAll("[data-list-itemof]:not(.node-cursor, .item-hidden)");return Array.prototype.indexOf.call(e,t)}paginateRows(t,e){const i=this.getRowCount(),s=this.getRowIndex(t),o=Math.floor(this.scrollbox.offsetHeight/t.offsetHeight);let n;return n="up"===e?s>o?s-o:1:s>i-o?i:s+o,this.getRowAt(n)}selectUntil(t,e){this.currentSelection=[t],this.widgetElement.querySelectorAll(".row-selected").forEach((t=>{t.classList.remove("row-selected")}));const i=t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING;let s=t;for(;i&&(s=s.nextElementSibling)&&(this.currentSelection.includes(s)||this.currentSelection.push(s),s!==e););for(s=t;!i&&s!==e&&(s=s.previousElementSibling)&&(this.currentSelection.includes(s)||this.currentSelection.push(s),s!==e););return this.currentSelection.forEach((t=>{t.classList.add("row-selected")})),this.selectedRows.forEach((t=>{t.classList.add("row-selected")})),this.lastInCurrentSelection=e,e}selectAdd(t){return this.selectedRows.includes(t)?(this.selectedRows=this.selectedRows.filter((e=>e!==t)),t.classList.remove("row-selected")):(this.selectedRows.push(t),t.classList.add("row-selected")),this.lastSelected=t,this.lastInCurrentSelection=t,t}selectSingleRow(t){return this.widgetElement.querySelectorAll("tr").forEach((t=>{t.classList.remove("row-selected"),t.classList.remove("row-focused")})),t?(this.selectedRows=[t],t.classList.add("row-selected"),t.classList.add("row-focused")):this.selectedRows=[],this.focusChanged=!0,this.lastSelected=t,this.lastInCurrentSelection=t,t}selectRowById(t){let e=this.widgetElement.querySelectorAll("[data-id="+t+"]");this.selectSingleRow(e),this.updateSelectLinks()}clickWrapper(t){t.target.matches("a[data-linkwrapper]")}toggleSelectMode(t){if(!t.target.matches(".button-toggle-selectmode"))return;const e="click"===this.mode?"select":"click";this.setMode(e)}setMode(t){this.mode=t,this.widgetElement.classList.toggle("widget-table-mode-select","select"===t),document.querySelector(".button-toggle-selectmode").classList.toggle("active","select"===this.mode),"click"===t&&this.unselectRows(),this.updateSelectLinks()}updateSelectLinks(){if(!this.datalist)return!1;const t=this.datalist.dataset.listName,e="select"!==this.mode?"":Array.from(this.datalist.querySelectorAll(".row-selected[data-id]")).map((t=>t.dataset.id)).join(",");document.querySelectorAll('[data-list-select="'+t+'"]').forEach((t=>{const i=t.dataset.listParam,s=new URL(t.getAttribute("href"),App.baseUrl);s.searchParams.set(i,e),t.setAttribute("href",s.toString())}))}getFocusedRow(){return this.widgetElement.querySelector(".row-focused")}}class r extends s.Xt{constructor(t,e,i){super(t,e,i),this.switchButton,this.toolbar=null,this.datalist=null,this.listname=null,this.treeWidget=null,this.widgetElementWidget=null,this.dragObject=null,this.currentMouseCoords=[0,0],this.oldMouseCoords=[0,0],this.enabled=t.classList.contains("widget-dragitems-enabled"),this.widgetElement.addEventListener("dragstart",(t=>t.preventDefault())),this.widgetElement.addEventListener("mousedown",(t=>this.onMouseDown(t))),this.widgetElement.addEventListener("mousemove",(t=>this.onMouseMove(t))),this.widgetElement.addEventListener("mouseup",(t=>this.onMouseUp(t))),this.listenEvent(document,"click",(t=>this.onMoveButtonClicked(t)),".actions-set-move"),this.listenEvent(document,"keydown",(t=>this.onKeyDown(t))),this.listenEvent(document,"epi:toggle:switch",(t=>this.onSwitched(t))),this.listenEvent(document,"click",(t=>this.onSaveClick(t))),this.updateWidget()}initWidget(){this.datalist=o.Z.querySelectorAndSelf(this.widgetElement,"[data-list-name]"),this.listname=this.datalist?this.datalist.dataset.listName:null,this.treeWidget=this.getWidget(this.widgetElement,"tree"),this.widgetElementWidget=this.getWidget(this.widgetElement,"table")}enableWidget(t){this.enabled=t,this.widgetElement.classList.toggle("widget-dragitems-enabled",this.enabled),this.switchButton&&t?this.createButtons():this.clearButtons(),this.treeWidget&&this.treeWidget.setFocus(),this.widgetElementWidget&&this.widgetElementWidget.setFocus()}createButton(t,e,i){const s=document.createElement("button");return s.dataset.role="move-"+t,s.classList.add("actions-set-move"),s.title="Move item "+t+" (Ctrl + Arrow "+t+")",s.textContent=e,i.appendChild(s),s}createButtons(){this.toolbar||(this.toolbar=document.createElement("div"),this.toolbar.classList.add(["widget-dragitems-toolbar"]),this.switchButton.parentElement.insertBefore(this.toolbar,this.switchButton),this.createButton("left","",this.toolbar),this.createButton("up","",this.toolbar),this.createButton("down","",this.toolbar),this.createButton("right","",this.toolbar))}clearButtons(){this.toolbar&&(this.toolbar.remove(),this.toolbar=null)}onMoveButtonClicked(t){if(!this.enabled||!this.datalist)return;const e=t.target.dataset.role;if(!["move-left","move-right","move-up","move-down"].includes(e))return;const i=e.split("-")[1],s="left"===i||"down"===i;this.getSelectedRows(s).forEach((t=>this.moveRow(t,i)))}onKeyDown(t){if(!t.ctrlKey&&!t.metaKey||!this.enabled)return;if(this.widgetElementWidget&&!this.widgetElementWidget.hasFocus)return;const e=t.key;let i;if("ArrowDown"===e?i="down":"ArrowUp"===e?i="up":"ArrowLeft"===e?i="left":"ArrowRight"===e&&(i="right"),i){const t="left"===i||"down"===i;this.getSelectedRows(t).forEach((t=>this.moveRow(t,i)))}}async onSaveClick(t){if("save"===t.target.dataset.role&&this.enabled){if(!await this.saveOrder())return;this.switchButton&&App.switchbuttons.switchButton(this.switchButton)}}onSwitched(t){if("move"===t.target.dataset.role&&t.target.dataset.targetModel===this.widgetElement.dataset.model){this.switchButton=t.target;const e=this.switchButton.classList.contains("widget-switch-active");this.enableWidget(e),t.preventDefault(),t.stopImmediatePropagation()}}async saveOrder(){const t=this.datalist.dataset.listActionMove;if(!t)return!1;const e=this.datalist.querySelectorAll("[data-dirty=true]"),i=[...e].map((t=>{const e=t.dataset.id,i=this.treeWidget?this.treeWidget.treeGetPrevSibling(t,!1):null,s=i?i.dataset.id:null;return{id:e,parent_id:t.dataset.treeParent,preceding_id:s}})),s=JSON.stringify({moves:i}),n=this.getFrame();return App.ajaxQueue.add(t,{type:"POST",url:t,dataType:"json",data:s,contentType:"application/json;charset=utf-8",processData:!1,beforeSend:t=>{App.showLoader()},success:(t,i,s)=>{const r=o.Z.getValue(t,"status.message"),a=o.Z.getValue(t,"status.success",!1)?"success":"error";App.showMessage(r,a,n),e.forEach((t=>delete t.dataset.dirty))},error:(t,e,i)=>{if(t.readyState===XMLHttpRequest.UNSENT&&0===t.status)return;let s=o.Z.getValue(t.responseJSON,"error.message");s=s?i+": "+s:i,App.showMessage(s,e,n)},complete:(t,e)=>{App.hideLoader()}}),!0}onMouseDown(t){if(!this.enabled)return;if("checkbox"===t.target.type)return;const e=t.target.closest("[data-list-itemof]:not(.item-virtual)");e&&!e.classList.contains("fixed")&&(this.dragObject=this.createDragObject(e),this.dragObject.initMouseCoords=this.getMouseCoords(t),this.widgetElement.classList.add("is-dragging"))}createDragObject(t){let e={moved:!1};return t&&(e.draggedRow=t,e.oldParentRow=t.treeParent,e.newParentRow=null,e.draggedDescendants=this.treeWidget?this.treeWidget.treeGetDescendants(t):[],e.draggedDescendants.length>0?e.lastRow=e.draggedDescendants[e.draggedDescendants.length-1]:e.lastRow=e.draggedRow,e.isMouseMoving=!1),e}activateDragObject(t){t.draggedRow.classList.add("is-dragging"),t.draggedDescendants.forEach((t=>t.classList.add("is-dragging")))}releaseDragObject(t){t.draggedRow.classList.remove("is-dragging"),t.draggedDescendants.forEach((t=>t.classList.remove("is-dragging"))),t.draggedRow.dataset.dirty=!0,t.moved&&this.emitEvent("epi:move:row",{row:t.draggedRow})}onMouseUp(t){this.dragObject&&(this.widgetElement.classList.remove("is-dragging"),this.releaseDragObject(this.dragObject),this.dragObject=null)}async onMouseMove(t){if(!this.dragObject)return;if(this.currentMouseCoords=this.getMouseCoords(t),this.activateDragObject(this.dragObject),this.dragObject.isMouseMoving)return;let e=!0;for(;e&&this.dragObject;){const t=this.getDropTarget(this.currentMouseCoords.x,this.currentMouseCoords.y),i=t&&t.querySelector(".tree-indent");if(this.dragObject.newParentRow=null,i){const t=this.dragObject.draggedRow.querySelector(".tree-indent").offsetWidth;this.dragObject.initMouseCoords.x-this.currentMouseCoords.x>t?(this.dragObject.isMouseMoving=!0,this.moveHorizontally(this.dragObject,"left")):this.currentMouseCoords.x-this.dragObject.initMouseCoords.x>t&&(this.dragObject.isMouseMoving=!0,this.moveHorizontally(this.dragObject,"right"))}if(e=!1,t){const i=this.currentMouseCoords.y>this.oldMouseCoords.y?"down":"up";this.dragObject.isMouseMoving=!0,this.moveVertically(this.dragObject,i,t),e=await this.scrollIfNeeded(t)}}this.oldMouseCoords=this.currentMouseCoords,this.dragObject&&(this.dragObject.isMouseMoving=!1)}getSelectedRows(t=!1){let e;return e=this.widgetElementWidget?this.datalist.querySelectorAll(".row-selected"):this.datalist.querySelectorAll(".node.active, .node.selected"),e&&t?[...e].reverse():e}getMouseCoords(t){const e={};return e.x=t.pageX,e.y=t.pageY,e}getDropTarget(t,e){let i;const s=this.datalist.querySelectorAll("[data-list-itemof]");for(let t=0;t<=s.length-1;t++){const o=s[t],n=o.getBoundingClientRect().top;if(e>n&&e<n+o.offsetHeight){i=o;break}}if(!i||!i.classList.contains("fixed"))return i}moveRow(t,e,i){if(!t)return;const s=this.createDragObject(t);this.activateDragObject(s);const n=this.widgetElementWidget||this.treeWidget;"left"===e||"right"===e?this.moveHorizontally(s,e):"up"!==e&&"down"!==e||!n||(i||"up"!==e?i||"down"!==e||(i=n.getNextVisibleNode(s.lastRow)):i=n.getPreviousVisibleNode(s.draggedRow),i&&this.moveVertically(s,e,i)),this.releaseDragObject(s),o.Z.scrollIntoViewIfNeeded(t,t.closest(".widget-scrollbox"),!1,"y"),n&&n.setFocus()}moveHorizontally(t,e){if(!t||!t.draggedRow||!t.draggedRow.querySelector(".tree-indent"))return!1;const i=t.draggedRow.treePosition===t.draggedRow.treeParent.treeChildren;if(t.initMouseCoords=this.currentMouseCoords,"left"===e){if(!i)return;t.newParentRow=t.oldParentRow?t.oldParentRow.treeParent:void 0}else t.newParentRow=this.findNewParentRow(t);return t.oldParentRow=t.newParentRow,this.updateHierarchy(t),t.moved=!0,!0}findNewParentRow(t){const e=o.Z.getPrevSibling(t.draggedRow,"[data-list-itemof]");if(!e||!o.Z.isElementVisible(e)||e.classList.contains("fixed"))return t.oldParentRow;let i=null;if(e.treeLevel===t.draggedRow.treeLevel)i=e;else if(e.treeLevel===t.draggedRow.treeLevel+1)i=e.treeParent;else if(e.treeLevel!==t.draggedRow.treeLevel-1){for(let s of this.treeWidget.treeGetAncestors(e))if(s.treeLevel===t.draggedRow.treeLevel){i=s;break}}else i=t.oldParentRow;return i}moveVertically(t,e,i){if(i===t.draggedRow||[...t.draggedDescendants].includes(i))return!1;if("down"===e){if(i.classList.contains("item-haschildren")&&i.classList.contains("item-collapsed")){const e=this.treeWidget?this.treeWidget.treeGetDescendants(i):[];e[e.length-1].after(t.draggedRow)}else i.after(t.draggedRow);i.classList.contains("item-haschildren")&&!i.classList.contains("item-collapsed")?t.newParentRow=i:t.newParentRow=i.treeParent}else i.before(t.draggedRow),t.newParentRow=i.treeParent;return t.oldParentRow=t.newParentRow,t.draggedRow.after(...t.draggedDescendants),this.updateHierarchy(t),t.moved=!0,!0}updateHierarchy(t){if(this.treeWidget){const e=t.newParentRow&&t.newParentRow.dataset.id||"",i=t.newParentRow?t.newParentRow.treeLevel:0;t.draggedRow.dataset.parent=e,t.draggedRow.dataset.treeParent=e;const s=[t.draggedRow,...t.draggedDescendants],o=i+1-t.draggedRow.treeLevel;0!==o&&(s.forEach((t=>{t.treeLevel=t.treeLevel+o,t.dataset.level=t.treeLevel})),this.treeWidget.treeRecreateIndentation(s)),this.treeWidget.treeUpdatePositions()}}async scrollIfNeeded(t){const e=t.closest(".widget-scrollbox")||t.closest(".widget-scrollsync-content");let i=this.currentMouseCoords.y-(e.getBoundingClientRect().top+90),s=this.currentMouseCoords.y-(e.getBoundingClientRect().bottom-80);return i<0?(i/=2,e.scrollBy({top:i,behavior:"instant"}),await new Promise((t=>setTimeout(t,40))),!0):s>0&&(s/=2,e.scrollBy({top:s,behavior:"instant"}),await new Promise((t=>setTimeout(t,40))),!0)}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.table=n,window.App.widgetClasses.dragitems=r},464:(t,e,i)=>{"use strict";var s=i(584),o=i(182);class n extends s.Xt{constructor(t,e,i){super(t,e,i),this.widgetElement=t,this.datalist=null,this.listname=null,this.isLoading=!1,this.widgetElement.addEventListener("click",(t=>this.treeItemClicked(t))),this.updateWidget()}updateWidget(){this.datalist=o.Z.querySelectorAndSelf(this.widgetElement,"[data-list-name]"),this.listname=this.datalist?this.datalist.dataset.listName:null,this.listname&&this.treeUpdatePositions()}treeItemClicked(t){const e=t.target.closest(".node.item-haschildren, .node.tree-indent-leaf");return!!e&&(t.target.classList.contains("tree-indent-leaf")&&this.treeToggleItem(e),!1)}treeGetSiblings(t){return document.querySelectorAll(`tr[data-tree-parent='${t.dataset.treeParent}']:not([data-id='${t.dataset.id}'])`)}treeGetNextSibling(t){const e=t?Number(t.dataset.level||0):0;for(;t;){if((t=t.nextElementSibling)&&t.classList.contains("node")&&Number(t.dataset.level||0)===e&&!t.classList.contains("item-removed"))return t;if(t&&t.classList.contains("node")&&Number(t.dataset.level||0)<e&&!t.classList.contains("item-removed"))return}}treeGetPrevSibling(t,e=!0){const i=Number(t.dataset.level);for(;t;){if((t=t.previousElementSibling)&&Number(t.dataset.level)===i&&!t.classList.contains("item-removed")&&(e||!t.classList.contains("item-virtual")))return t;if(t&&Number(t.dataset.level)<i&&!t.classList.contains("item-removed"))return}}treeGetDescendants(t){const e=t?Number(t.dataset.level):0;let i=[],s=t?t.nextElementSibling:void 0;for(;s&&s.dataset.level>e&&!s.classList.contains("item-removed");)i.push(s),s=s.nextElementSibling;return i}treeGetChildren(t){const e=(t?Number(t.dataset.level):0)+1;return this.treeGetDescendants(t).filter((t=>Number(t.dataset.level||0)===e&&!t.classList.contains("item-removed")))}treeGetFirstChild(t){const e=this.treeGetChildren(t);return e.length>0?e[0]:void 0}treeGetLastChild(t){const e=this.treeGetChildren(t);return e.length>0?e[e.length-1]:void 0}treeGetLastDescendant(t){const e=t?Number(t.dataset.level):0;let i,s=t?t.nextElementSibling:void 0;for(;s&&s.dataset.level>e&&!s.classList.contains("item-removed");)i=s,s=s.nextElementSibling;return i}treeGetPosition(t){return t.treePosition}treeGetOpenDescendants(t){const e=this.treeGetChildren(t);let i=e;return e.forEach((t=>{if(!t.classList.contains("item-collapsed")){const e=this.treeGetOpenDescendants(t);i=i.concat(e)}})),i}*treeGetAncestors(t){let e=t.treeParent;for(;e&&e.classList.contains("node");)yield e,e=e.treeParent}treeGetParent(t){const e=t?t.treeParent:void 0;if(e&&e.classList.contains("node"))return e}treeGetPath(t){let e=[t];for(let i of this.treeGetAncestors(t))e.unshift(i);return e=e.map((t=>{let e=t.querySelector("label");return e=e?e.dataset.label??e.textContent:t.dataset.label??t.textContent,e.trim()})),e.join(" › ")}treeAppendChild(t,e){let i;if(t&&t!==this.datalist){const e=this.treeGetLastDescendant(t);i=e?e.nextElementSibling:t.nextElementSibling}return i?(i.before(e),e=i.previousElementSibling):(this.datalist.appendChild(e),e=this.datalist.lastElementChild),e.treeParent=t||this.datalist,e.treeLevel=t?t.treeLevel+1:0,e.dataset.treeParent=e.treeParent.dataset.id||"",e.dataset.parent=e.treeParent.dataset.id||"",e.dataset.level=e.treeLevel,this.treeRecreateIndentation([e]),this.treeUpdatePositions(),e}treePrependChild(t,e){let i;return t&&t!==this.datalist&&(i=this.treeGetFirstChild(t)),i?(i.before(e),(e=i.previousElementSibling).treeParent=t,e.treeLevel=t.treeLevel+1):this.treeAppendChild(t,e),e.dataset.treeParent=e.treeParent.dataset.id||"",e.dataset.parent=e.treeParent.dataset.id||"",e.dataset.level=e.treeLevel,this.treeRecreateIndentation([e]),this.treeUpdatePositions(),e}treeAppendAfter(t,e){const i=this.treeGetNextSibling(t);if(i)return i.before(e),(e=i.previousElementSibling).treeParent=i.treeParent,e.treeLevel=i.treeLevel,e.dataset.treeParent=e.treeParent.dataset.id||"",e.dataset.parent=e.treeParent.dataset.id||"",e.dataset.level=e.treeLevel,this.treeRecreateIndentation([e]),this.treeUpdatePositions(),e;{const i=this.treeGetParent(t);return this.treeAppendChild(i,e)}}treeRemoveItem(t){this.treeGetDescendants(t).forEach((t=>{t.remove()})),t.remove(),this.treeUpdatePositions()}treeToggleItem(t,e,i=!0){let s;void 0===e&&(e=!t.classList.contains("item-collapsed")),s=e?this.treeGetDescendants(t):this.treeGetOpenDescendants(t),t.classList.toggle("item-collapsed",e),s.forEach((t=>{t.classList.toggle("item-hidden",e)})),i&&this.emitEvent("epi:toggle:node")}treeUpdatePositions(){const t=this.datalist;if(!t)return;t.treeChildren=0,t.treePosition=0,t.treeLevel=-1;let e=[t];this.widgetElement.querySelectorAll("[data-list-itemof], .node").forEach((i=>{if(i.dataset.role)return i.treeParent=t,i.treeChildren=0,i.treePosition=0,i.treeLevel=0,void(i.treeIndents=[]);if(i.classList.contains("item-removed"))return;for(;e.length&&e[e.length-1].dataset.id!==(i.dataset.treeParent||"");)e.pop();e.length||e.push(t);const s=e[e.length-1];s.treeChildren+=1,i.treeParent=s,i.treeChildren=0,i.treePosition=s.treeChildren,i.treeLevel=e.length-1,i.treeIndents=Array.from(i.querySelectorAll(".tree-indent")).reverse();let o=i;i.treeIndents.forEach((t=>{t.treeParent=o,o=void 0!==o?o.treeParent:void 0})),e.push(i)})),this.widgetElement.querySelectorAll("[data-list-itemof], .node").forEach((t=>{t.dataset.role||t.classList.contains("item-removed")||(t.treeFirst=0===t.treePosition,t.treeLast=t.treePosition===(t.treeParent.treeChildren||!1),t.dataset.level=t.treeLevel,t.dataset.first=t.treeFirst,t.dataset.last=t.treeLast,o.Z.removeClassByPrefix(t,"item-level-"),t.classList.add("item-level-"+t.treeLevel),t.classList.toggle("item-haschildren",t.treeChildren>0),t.classList.toggle("item-nochildren",0===t.treeChildren),0===t.treeChildren&&t.classList.remove("item-collapsed"),t.classList.toggle("item-first",t.treeFirst),t.classList.toggle("item-last",t.treeLast),t.treeIndents.forEach(((e,i)=>{if(t.classList.contains("node-cursor"))e.classList.add("tree-indent-cursor");else if(0===i)e.classList.add("tree-indent-leaf");else{const t=!e.treeParent||e.treeParent.treeLast;e.classList.toggle("tree-indent-line",!t),e.classList.toggle("tree-indent-empty",t)}})))}));const i=this.widgetElement.querySelector(".node.active");if(this.widgetElement.querySelectorAll(".active-trail").forEach((t=>{t.classList.remove("active-trail")})),i){for(let t of this.treeGetAncestors(i))t.classList.add("active-trail"),this.treeToggleItem(t,!1);this.treeToggleItem(i,!1)}this.widgetElement.querySelectorAll(".node.item-collapsed").forEach((t=>{this.treeToggleItem(t,!0,!1)}))}treeRecreateIndentation(t){t.forEach((t=>{const e=t.querySelectorAll(".tree-indent");if(0!==e.length){const i=e[0].parentElement;e.forEach((t=>t.remove()));const s=document.createElement("div");s.classList.add("tree-indent","tree-indent-leaf"),i.prepend(s);const o=Number(t.dataset.level);for(let t=0;t<o;t++){const t=document.createElement("div");t.classList.add("tree-indent","tree-indent-line"),i.prepend(t)}}}))}getNextVisibleNode(t,e=!0){for(;t;){if((t=t.nextElementSibling)&&t.classList.contains("node")&&!t.classList.contains("item-removed")&&!t.classList.contains("item-hidden")&&(e||!t.classList.contains("item-virtual")))return t}}getPreviousVisibleNode(t,e=!0){for(;t;){if((t=t.previousElementSibling)&&t.classList.contains("node")&&!t.classList.contains("item-removed")&&!t.classList.contains("item-hidden")&&(e||!t.classList.contains("item-virtual")))return t}}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.tree=n},221:(t,e,i)=>{"use strict";i.a(t,(async(t,e)=>{try{var s=i(584),o=i(182),n=i(649),r=t([n]);n=(r.then?(await r)():r)[0];class a extends s.Xt{constructor(t,e,i){if(super(t,e,i),this.widgetElement=t,this.widgetElement.widgetFiles=this,this.dataList=null,"FORM"!==t.tagName)return;const s={paramName:"FileData",uploadMultiple:!0,maxFilesize:250,queuecomplete:()=>this.onComplete(),success:t=>this.onSuccess(t)};$.fn.dropzone&&(this.widgetElement.classList.add("dropzone"),$(t).dropzone(s)),this.listenEvent(document,"click",(t=>this.onClicked(t)),"[data-role=import]")}initWidget(){const t=this.widgetElement.dataset.targetListName;this.dataList=document.querySelector([`[data-list-name="${t}"]`])}onSuccess(t){if(t&&t.xhr){const e=JSON.parse(t.xhr.responseText),i=o.Z.getValue(e,"files.filenames"),s=Array.from(i,(t=>({fileName:t})));this.importFiles(s)}}onComplete(){if(this.isInFrame()){const t=new Event("epi:reload:page",{bubbles:!0,cancelable:!1});this.widgetElement.dispatchEvent(t)}else location.reload()}onClicked(t){if(this.getFrame(!1).contains(t.target))return this.importListedFiles(),t.preventDefault(),!1}importFiles(t){this.dataList&&this.emitEvent("epi:upload:files",{items:t,listName:this.dataList.dataset.listName})}importListedFiles(t){this.importFiles(this.getListedFiles())}getListedFiles(){if(!this.dataList)return;const t=this.dataList.querySelectorAll("[data-list-itemtype=file]");return Array.from(t,(t=>({fileName:t.dataset.value})))}}window.App.widgetClasses=window.App.widgetClasses||{},window.App.widgetClasses.upload=a,e()}catch(t){e(t)}}))},447:(t,e,i)=>{"use strict";i.a(t,(async(t,e)=>{try{var s=i(954),o=i(6),n=(i(92),i(752),i(464),i(934),i(113),i(956)),r=i(482),a=(i(773),i(362),i(7),i(380),i(903),i(221)),l=i(979),c=i(160),d=i(972),u=(i(467),i(370),i(182)),h=t([s,o,r,a,l,c,d]);[s,o,r,a,l,c,d]=h.then?(await h)():h,Dropzone.autoDiscover=!1,window.App.initApp=function(){App.mainframe||void 0===r.AH||(App.mainframe=new r.AH),App.confirmWindow||void 0===r.z2||(App.confirmWindow=new r.z2),"function"==typeof l.r7&&void 0===App.switchbuttons&&(App.switchbuttons=new l.r7(document)),"function"==typeof l.s0&&void 0===document.widgetToggleButtons&&new l.s0(document),new l.U9(document,"filename"),App.scrollsync||void 0===n.Ew||(App.scrollsync=new n.Ew),"function"==typeof n._2&&(App.sidebarleft=new n._2(document.querySelector(".sidebar-left"),"left"),App.sidebarright=new n._2(document.querySelector(".sidebar-right"),"right")),"function"==typeof n.UQ&&(App.accordion=new n.UQ(document.querySelector(".accordion"),"accordion"))},window.App.initWidgets=function(t=null){App.widgetsInitializing=(App.widgetsInitializing||0)+1,null===t&&(t=document);for(const[e,i]of Object.entries(window.App.widgetClasses))u.Z.querySelectorAllAndSelfAndContainer(t,".widget-"+e).forEach((i=>App.createWidget(i,e,t)));if(App.widgetsInitializing-=1,0===App.widgetsInitializing){let t=new CustomEvent("epi:init:widgets",{bubbles:!0,cancelable:!1,detail:{data:{},sender:this}});document.dispatchEvent(t)}},window.App.finishWidgets=function(t=null){t&&App.emitEvent(t,"epi:remove:content");for(const[e,i]of Object.entries(window.App.widgetClasses))u.Z.querySelectorAllAndSelf(t,".widget-"+e).forEach((t=>{t.widgets=t.widgets||{};const i=t.widgets[e];i&&i.clearWidget()}))},window.App.findWidget=function(t,e){if(!t)return;let i=t.querySelector(".widget-"+e);return i=i||t.closest(".widget-"+e),i?(i.widgets=i.widgets||{},i.widgets[e]):void 0},window.App.createWidget=function(t,e,i){if(!t)return;t.widgets=t.widgets||{};let s=t.widgets[e];if(s)s.updateWidget(i);else{const i=App.widgetClasses[e];i&&(s=new i(t,e))}return s},window.App.showDialog=function(t){const e=new r.P(t.detail.data||{});window.App.addWidget(t.detail.data.id||void 0,e)},window.App.hideDialog=function(t){const e=window.App.clearWidget(t.detail.data.id||void 0);e&&e.closeWindow()},window.App.openPopup=function(t,e){"string"==typeof t?(e=e||{}).url=t:"object"==typeof t?(e=e||{}).element=t:e=t||e||{},e.name&&App.hidePopup(e.name);const i=new r.PZ;return e.name&&App.addWidget(e.name,i),i.showData(e),i},window.App.hidePopup=function(t){const e=window.App.clearWidget(t);return e&&e.closeWindow(),e},window.App.initApp(),window.App.initWidgets(),e()}catch(t){e(t)}}))}},n={};function r(t){var e=n[t];if(void 0!==e)return e.exports;var i=n[t]={exports:{}};return o[t](i,i.exports,r),i.exports}t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",i="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},r.a=(o,n,r)=>{var a;r&&((a=[]).d=-1);var l,c,d,u=new Set,h=o.exports,p=new Promise(((t,e)=>{d=e,c=t}));p[e]=h,p[t]=t=>(a&&t(a),u.forEach(t),p.catch((t=>{}))),o.exports=p,n((o=>{var n;l=(o=>o.map((o=>{if(null!==o&&"object"==typeof o){if(o[t])return o;if(o.then){var n=[];n.d=0,o.then((t=>{r[e]=t,s(n)}),(t=>{r[i]=t,s(n)}));var r={};return r[t]=t=>t(n),r}}var a={};return a[t]=t=>{},a[e]=o,a})))(o);var r=()=>l.map((t=>{if(t[i])throw t[i];return t[e]})),c=new Promise((e=>{(n=()=>e(r)).r=0;var i=t=>t!==a&&!u.has(t)&&(u.add(t),t&&!t.d&&(n.r++,t.push(n)));l.map((e=>e[t](i)))}));return n.r?c:r()}),(t=>(t?d(p[i]=t):c(h),s(a)))),a&&a.d<0&&(a.d=0)},r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r(447);r(348)})();